<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="baidu-site-verification" content="codeva-2tBONWXoFH" />
  <meta name="msvalidate.01" content="DEF5F2F984531D10266A543EDD015EB1" />
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="https://blog.shawncoding.top">
  <title>Hadoop3.xå­¦ä¹ ç¬”è®° | æ˜Ÿæ˜Ÿçš„çŒ«(&gt;^Ï‰^&lt;)å–µ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="ä¸€ã€Hadoopå…¥é—¨ 1ã€Hadoopæ¦‚è¿° 1.1 ç®€ä»‹ Hadoopæ˜¯ä¸€ä¸ªç”±ApacheåŸºé‡‘ä¼šæ‰€å¼€å‘çš„åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€æ¶æ„ã€‚ä¸»è¦è§£å†³æµ·é‡æ•°æ®çš„å­˜å‚¨å’Œæµ·é‡æ•°æ®çš„åˆ†æè®¡ç®—é—®é¢˜ã€‚å¹¿ä¹‰ä¸Šæ¥è¯´ï¼ŒHadoopé€šå¸¸æ˜¯æŒ‡ä¸€ä¸ªæ›´å¹¿æ³›çš„æ¦‚å¿µâ€”â€”Hadoopç”Ÿæ€åœˆã€‚  å®˜ç½‘åœ°å€ï¼šhttp:&#x2F;&#x2F;hadoop.apache.org ä¸‹è½½åœ°å€ï¼šhttps:&#x2F;&#x2F;hadoop.apache.org&#x2F;releases.html">
<meta property="og:type" content="article">
<meta property="og:title" content="Hadoop3.xå­¦ä¹ ç¬”è®°">
<meta property="og:url" content="https://blog.shawncoding.top/posts/6f0694e3.html">
<meta property="og:site_name" content="æ˜Ÿæ˜Ÿçš„çŒ«(&gt;^Ï‰^&lt;)å–µ">
<meta property="og:description" content="ä¸€ã€Hadoopå…¥é—¨ 1ã€Hadoopæ¦‚è¿° 1.1 ç®€ä»‹ Hadoopæ˜¯ä¸€ä¸ªç”±ApacheåŸºé‡‘ä¼šæ‰€å¼€å‘çš„åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€æ¶æ„ã€‚ä¸»è¦è§£å†³æµ·é‡æ•°æ®çš„å­˜å‚¨å’Œæµ·é‡æ•°æ®çš„åˆ†æè®¡ç®—é—®é¢˜ã€‚å¹¿ä¹‰ä¸Šæ¥è¯´ï¼ŒHadoopé€šå¸¸æ˜¯æŒ‡ä¸€ä¸ªæ›´å¹¿æ³›çš„æ¦‚å¿µâ€”â€”Hadoopç”Ÿæ€åœˆã€‚  å®˜ç½‘åœ°å€ï¼šhttp:&#x2F;&#x2F;hadoop.apache.org ä¸‹è½½åœ°å€ï¼šhttps:&#x2F;&#x2F;hadoop.apache.org&#x2F;releases.html">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330896.jpg">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330897.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330898.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330899.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330900.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330901.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330902.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330903.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330904.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330905.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330906.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330907.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330908.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330909.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330910.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330911.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330912.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330913.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330914.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330915.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330916.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330917.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330918.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330919.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330920.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330921.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330922.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330923.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330924.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330925.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330926.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330927.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330928.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330929.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330930.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330931.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330932.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330933.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330934.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330935.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330936.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330937.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330938.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330939.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330940.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330941.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330942.png">
<meta property="og:image" content="http://qnypic.shawncoding.top/blog/202401251330943.png">
<meta property="article:published_time" content="2024-02-06T07:03:43.000Z">
<meta property="article:modified_time" content="2024-02-29T12:00:08.279Z">
<meta property="article:author" content="Shawn">
<meta property="article:tag" content="å¤§æ•°æ®">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://qnypic.shawncoding.top/blog/202401251330896.jpg">
  
    <link rel="alternative" href="/atom.xml" title="æ˜Ÿæ˜Ÿçš„çŒ«(&gt;^Ï‰^&lt;)å–µ" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/1.png">
  
  <link rel="stylesheet" type="text/css" href="/./main.0cf68a.css">
<link rel="stylesheet" type="text/css" href="/./search.css">
  
  <link rel="stylesheet" type="text/css" href="/./avatarrotation.css">
  
  <style type="text/css">
  
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  <!-- Global site tag (gtag.js) - Google Analytics -->

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-178745185-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-178745185-1');
    </script>

<!-- End Google Analytics -->
  
<script>
var _hmt = _hmt || [];
(function() {
	var hm = document.createElement("script");
	hm.src = "https://hm.baidu.com/hm.js?bfc79b86aa87f7cc5e5cb4920188a950";
	var s = document.getElementsByTagName("script")[0]; 
	s.parentNode.insertBefore(hm, s);
})();
</script>

  <link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css">
  <!--ç™¾åº¦è‡ªåŠ¨æ¨é€-->

    <!-- å¼€å¯ç™¾åº¦ç«™é•¿å¹³å°è‡ªåŠ¨æ¨é€https://ziyuan.baidu.com/linksubmit/indexï¼Œ
    https://ziyuan.baidu.com/college/courseinfo?id=267&page=2#h2_article_title19-->
    <script>
      (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
      })();
    </script>
    
<meta name="generator" content="Hexo 4.2.0"></head>


<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>

    <div class="mymenucontainer" onclick="myFunction(this)">
      <div class="bar1"></div>
      <div class="bar2"></div>
      <div class="bar3"></div>
    </div>

    <div class="left-col" q-class="show:isShow">
      
<!-- <div class="overlay" style="background: url('https://w.wallhaven.cc/full/k9/wallhaven-k9zqjd.png') no-repeat center bottom;background-size: cover;opacity: 1"></div> -->
<div class="overlay" ></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="/img/1.png" class="js-avatar">
		</a>
		<hgroup>
		  <h1 class="header-author"><a href="/">Shawn</a></h1>
		</hgroup>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">ä¸»é¡µ</a></li>
	        
				<li><a href="/categories">åˆ†ç±»</a></li>
	        
				<li><a href="/archives">å½’æ¡£</a></li>
	        
				<li><a href="/photos/index.html">ç›¸å†Œ</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
    		
    			
    			<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">æ‰€æœ‰æ–‡ç« </a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'friends')" href="javascript:void(0)">å‹é“¾</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">å…³äºæˆ‘</a>
    			
            
            
		</nav>
		<ul style="font-size:12px; font-style:oblique; font-weight:100; color:#1D94CE; margin-top:-15px" >
			æ€»æ–‡ç« æ•°ï¼š200
		</ul>
		
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/LXT2017" title="github"><i class="icon-github"></i></a>
		        
					<a class="csdn" target="_blank" href="https://blog.csdn.net/lemon_TT" title="csdn"><i class="icon-csdn"></i></a>
		        
					<a class="rss" target="_blank" href="/atom.xml" title="rss"><i class="icon-rss"></i></a>
		        
					<a class="mail" target="_blank" href="mailto:shawn955@163.com" title="mail"><i class="icon-mail"></i></a>
		        
			</div>

			
			<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=244 height=100 src="//music.163.com/outchain/player?type=2&id=550082870&auto=0&height=66"></iframe>
			

			
		</nav>

	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse" style="background: rgba(255, 255, 255, 0.4)">
    <!-- <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse"> -->
      
<nav id="mobile-nav">
  	<!-- <div class="overlay js-overlay" style="background: #4d4d4d"></div> -->
  	<div class="overlay js-overlay"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="/img/1.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author">Shawn</h1>
			</hgroup>
			
			
			
				
			
				
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/LXT2017" title="github"><i class="icon-github"></i></a>
			        
						<a class="csdn" target="_blank" href="https://blog.csdn.net/lemon_TT" title="csdn"><i class="icon-csdn"></i></a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss"><i class="icon-rss"></i></a>
			        
						<a class="mail" target="_blank" href="mailto:shawn955@163.com" title="mail"><i class="icon-mail"></i></a>
			        
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 80%">
				
				
					<li style="width: 25%"><a href="/">ä¸»é¡µ</a></li>
		        
					<li style="width: 25%"><a href="/categories">åˆ†ç±»</a></li>
		        
					<li style="width: 25%"><a href="/archives">å½’æ¡£</a></li>
		        
					<li style="width: 25%"><a href="/photos/index.html">ç›¸å†Œ</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>



            
      <div class="page-header" style="">
          
          <span>ğŸ»  
              <span id="jinrishici-sentence" title="ä»Šæ—¥è¯—è¯">æ­£åœ¨åŠ è½½ä»Šæ—¥è¯—è¯....</span>
          </span>
          <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>

          
          <script type="text/javascript" src="/js/search.js"></script>
          <span id="local-search" class="local-search local-search-plugin" style="">
            <input type="search" placeholder="ç«™å†…æœç´¢" id="local-search-input" class="local-search-input-cls" style="">
            <i id="local-search-icon-search" class="icon" aria-hidden="true" title="ç«™å†…æœç´¢">ğŸ”</i>
            <div id="local-search-result" class="local-search-result-cls"></div>
          </span>

          <script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
          <script>
              if ($('.local-search').size()) {
                $.getScript('/js/search.js', function() {
                  searchFunc("/search.xml", 'local-search-input', 'local-search-result');
                });
              }
          </script>
          
      </div>
      



      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1" class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            <article id="post-Hadoop3-xå­¦ä¹ ç¬”è®°" class="article article-type-post " itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
        
        <a href="/posts/6f0694e3.html" class="archive-article-date">
  	<time datetime="2024-02-06T07:03:43.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2024-02-06</time>
  	
</a>
        

        <!-- å¼€å§‹æ·»åŠ å­—æ•°ç»Ÿè®¡-->
            
        <div style="margin-top:10px;">
    <span class="post-time">
      <span class="post-meta-item-icon">
        <i class="fa fa-keyboard-o"></i>
        <span class="post-meta-item-text">  å­—æ•°ç»Ÿè®¡: </span>
        <span class="post-count">37.3kå­—</span>
      </span>
    </span>

    <span class="post-time">
      &nbsp; | &nbsp;
      <span class="post-meta-item-icon">
        <i class="fa fa-hourglass-half"></i>
        <span class="post-meta-item-text">  é˜…è¯»æ—¶é•¿â‰ˆ</span>
        <span class="post-count">169åˆ†</span>
      </span>
    </span>
</div>
        
        <!-- æ·»åŠ å®Œæˆ -->

      </header>
    
    <div class="article-entry" itemprop="articleBody">

      

      
      <center><p>
  
    <h1 class="article-title_code_ant" itemprop="name">
      Hadoop3.xå­¦ä¹ ç¬”è®°
    </h1>
  
</p></center>

      
        <h1>ä¸€ã€Hadoopå…¥é—¨</h1>
<h2 id="1ã€Hadoopæ¦‚è¿°">1ã€Hadoopæ¦‚è¿°</h2>
<h3 id="1-1-ç®€ä»‹">1.1 ç®€ä»‹</h3>
<p>Hadoopæ˜¯ä¸€ä¸ªç”±ApacheåŸºé‡‘ä¼šæ‰€å¼€å‘çš„åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€æ¶æ„ã€‚ä¸»è¦è§£å†³æµ·é‡æ•°æ®çš„å­˜å‚¨å’Œæµ·é‡æ•°æ®çš„åˆ†æè®¡ç®—é—®é¢˜ã€‚å¹¿ä¹‰ä¸Šæ¥è¯´ï¼ŒHadoopé€šå¸¸æ˜¯æŒ‡ä¸€ä¸ªæ›´å¹¿æ³›çš„æ¦‚å¿µâ€”â€”Hadoopç”Ÿæ€åœˆã€‚</p>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330896.jpg" alt></p>
<p>å®˜ç½‘åœ°å€ï¼š<a href="http://hadoop.apache.org" target="_blank" rel="noopener" title="http://hadoop.apache.org">http://hadoop.apache.org</a></p>
<p>ä¸‹è½½åœ°å€ï¼š<a href="https://hadoop.apache.org/releases.html" target="_blank" rel="noopener" title="https://hadoop.apache.org/releases.html">https://hadoop.apache.org/releases.html</a></p>
<a id="more"></a>
<h3 id="1-2-hadoopä¼˜åŠ¿">1.2 hadoopä¼˜åŠ¿</h3>
<ul>
<li>é«˜å¯é ï¼šHadoopåº•å±‚ç»´æŠ¤å¤šä¸ªæ•°æ®å‰¯æœ¬ï¼Œæ‰€ä»¥å³ä½¿HadoopæŸä¸ªè®¡ç®—å…ƒç´ æˆ–å­˜å‚¨å‡ºç°æ•…éšœï¼Œä¹Ÿä¸ä¼šå¯¼è‡´æ•°æ®çš„ä¸¢å¤±</li>
<li>é«˜æ‰©å±•æ€§ï¼šåœ¨é›†ç¾¤é—´åˆ†é…ä»»åŠ¡æ•°æ®,å¯æ–¹ä¾¿çš„æ‰©å±•æ•°ä»¥åƒè®¡çš„èŠ‚ç‚¹</li>
<li>é«˜æ•ˆæ€§ï¼šåœ¨MapReduceçš„æ€æƒ³ä¸‹ï¼ŒHadoopæ˜¯å¹¶è¡Œå·¥ä½œçš„ï¼Œä»¥åŠ å¿«ä»»åŠ¡å¤„<br>
ç†é€Ÿåº¦</li>
<li>é«˜å®¹é”™æ€§ï¼šèƒ½å¤Ÿè‡ªåŠ¨å°†å¤±è´¥çš„ä»»åŠ¡é‡æ–°åˆ†é…</li>
</ul>
<h3 id="1-3-hadoopç»„æˆ">1.3 hadoopç»„æˆ</h3>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330897.png" alt></p>
<p><strong>1)HDFSæ¶æ„æ¦‚è¿°</strong></p>
<p>Hadoop Distributed File Systemï¼Œç®€ç§°HDFSï¼Œæ˜¯ä¸€ä¸ª<strong>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ</strong></p>
<ul>
<li>NameNodeï¼ˆNNï¼‰ï¼šå­˜å‚¨æ–‡ä»¶çš„<strong>å…ƒæ•°æ®</strong>ï¼Œå¦‚æ–‡ä»¶åã€æ–‡ä»¶ç›®å½•ç»“æ„ã€æ–‡ä»¶å±æ€§ï¼Œä»¥åŠæ¯ä¸ªæ–‡ä»¶çš„å—åˆ—è¡¨å’Œå—æ‰€åœ¨çš„DataNodeç­‰</li>
<li>DataNodeï¼ˆDNï¼‰ï¼šåœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ<strong>å­˜å‚¨æ–‡ä»¶å—æ•°æ®</strong>ï¼Œä»¥åŠ<strong>å—æ•°æ®çš„æ ¡éªŒå’Œ</strong></li>
<li>Secondary NameNodeï¼ˆ2NNï¼‰ï¼šæ¯éš”ä¸€æ®µæ—¶é—´å¯¹NameNode<strong>å…ƒæ•°æ®å¤‡ä»½</strong></li>
</ul>
<p><strong>2)YARN æ¶æ„æ¦‚è¿°</strong></p>
<p>YARNï¼ˆYet Another Resource Negotiaterï¼‰ï¼šå¦ä¸€ç§èµ„æºåè°ƒè€…ï¼Œæ˜¯Hadoopçš„èµ„æºç®¡ç†å™¨</p>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330898.png" alt></p>
<p><strong>3)MapReduceæ¶æ„æ¦‚è¿°</strong></p>
<p>MapReduceå°†è®¡ç®—è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šMapå’ŒReduce</p>
<ul>
<li>Mapé˜¶æ®µå¹¶è¡Œå¤„ç†è¾“å…¥æ•°æ®</li>
<li>Reduceé˜¶æ®µå¯¹Mapç»“æœè¿›è¡Œæ±‡æ€»</li>
</ul>
<p><strong>4)HDFSã€YARNã€MapReduceä¸‰è€…å…³ç³»</strong></p>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330899.png" alt></p>
<h3 id="1-4-å¤§æ•°æ®æŠ€æœ¯ç”Ÿæ€ä½“ç³»">1.4 å¤§æ•°æ®æŠ€æœ¯ç”Ÿæ€ä½“ç³»</h3>
<ul>
<li>Sqoopï¼šSqoopæ˜¯ä¸€æ¬¾å¼€æºçš„å·¥å…·ï¼Œä¸»è¦ç”¨äºåœ¨Hadoopã€Hiveä¸ä¼ ç»Ÿçš„æ•°æ®åº“ï¼ˆMySQLï¼‰é—´è¿›è¡Œæ•°æ®çš„ä¼ é€’ï¼Œå¯ä»¥å°†ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ï¼ˆä¾‹å¦‚ ï¼šMySQLï¼ŒOracle ç­‰ï¼‰ä¸­çš„æ•°æ®å¯¼è¿›åˆ°Hadoopçš„HDFSä¸­ï¼Œä¹Ÿå¯ä»¥å°†HDFSçš„æ•°æ®å¯¼è¿›åˆ°å…³ç³»å‹æ•°æ®åº“ä¸­</li>
<li>Flumeï¼šFlumeæ˜¯ä¸€ä¸ªé«˜å¯ç”¨çš„ï¼Œé«˜å¯é çš„ï¼Œåˆ†å¸ƒå¼çš„æµ·é‡æ—¥å¿—é‡‡é›†ã€èšåˆå’Œä¼ è¾“çš„ç³»ç»Ÿï¼ŒFlumeæ”¯æŒåœ¨æ—¥å¿—ç³»ç»Ÿä¸­å®šåˆ¶å„ç±»æ•°æ®å‘é€æ–¹ï¼Œç”¨äºæ”¶é›†æ•°æ®ï¼›</li>
<li>Kafkaï¼šKafkaæ˜¯ä¸€ç§é«˜ååé‡çš„åˆ†å¸ƒå¼å‘å¸ƒè®¢é˜…æ¶ˆæ¯ç³»ç»Ÿï¼› </li>
<li>Sparkï¼šSparkæ˜¯å½“å‰æœ€æµè¡Œçš„å¼€æºå¤§æ•°æ®å†…å­˜è®¡ç®—æ¡†æ¶ã€‚å¯ä»¥åŸºäºHadoopä¸Šå­˜å‚¨çš„å¤§æ•°æ®è¿›è¡Œè®¡ç®—</li>
<li>Flinkï¼šFlinkæ˜¯å½“å‰æœ€æµè¡Œçš„å¼€æºå¤§æ•°æ®å†…å­˜è®¡ç®—æ¡†æ¶ã€‚ç”¨äºå®æ—¶è®¡ç®—çš„åœºæ™¯è¾ƒå¤š</li>
<li>Oozieï¼šOozieæ˜¯ä¸€ä¸ªç®¡ç†Hadoopä½œä¸šï¼ˆjobï¼‰çš„å·¥ä½œæµç¨‹è°ƒåº¦ç®¡ç†ç³»ç»Ÿ</li>
<li>Hbaseï¼šHBaseæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ã€é¢å‘åˆ—çš„å¼€æºæ•°æ®åº“ã€‚HBaseä¸åŒäºä¸€èˆ¬çš„å…³ç³»æ•°æ®åº“ï¼Œå®ƒæ˜¯ä¸€ä¸ªé€‚åˆäºéç»“æ„åŒ–æ•°æ®å­˜å‚¨çš„æ•°æ®åº“</li>
<li>Hiveï¼šHiveæ˜¯åŸºäºHadoopçš„ä¸€ä¸ªæ•°æ®ä»“åº“å·¥å…·ï¼Œå¯ä»¥å°†ç»“æ„åŒ–çš„æ•°æ®æ–‡ä»¶æ˜ å°„ä¸ºä¸€å¼ æ•°æ®åº“è¡¨ï¼Œå¹¶æä¾›ç®€å•çš„SQLæŸ¥è¯¢åŠŸèƒ½ï¼Œå¯ä»¥å°†SQLè¯­å¥è½¬æ¢ä¸ºMapReduceä»»åŠ¡è¿›è¡Œè¿è¡Œã€‚å…¶ä¼˜ç‚¹æ˜¯å­¦ä¹ æˆæœ¬ä½ï¼Œå¯ä»¥é€šè¿‡ç±»SQLè¯­å¥å¿«é€Ÿå®ç°ç®€å•çš„MapReduceç»Ÿè®¡ï¼Œä¸å¿…å¼€å‘ä¸“é—¨çš„MapReduceåº”ç”¨ï¼Œååˆ†é€‚åˆæ•°æ®ä»“åº“çš„ç»Ÿè®¡åˆ†æ</li>
<li>ZooKeeperï¼šå®ƒæ˜¯ä¸€ä¸ªé’ˆå¯¹å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯é åè°ƒç³»ç»Ÿï¼Œæä¾›çš„åŠŸèƒ½åŒ…æ‹¬ï¼šé…ç½®ç»´æŠ¤ã€åå­—æœåŠ¡ã€åˆ†å¸ƒå¼åŒæ­¥ã€ç»„æœåŠ¡ç­‰</li>
</ul>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330900.png" alt></p>
<h2 id="2ã€ç¯å¢ƒå‡†å¤‡-é‡ç‚¹">2ã€ç¯å¢ƒå‡†å¤‡(é‡ç‚¹)</h2>
<h3 id="2-1-æ¨¡æ¿æœºé…ç½®">2.1 æ¨¡æ¿æœºé…ç½®</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…æ¨¡æ¿è™šæ‹Ÿæœºï¼ŒIPåœ°å€192.168.10.100ã€ä¸»æœºåç§°hadoop100ã€å†…å­˜4Gã€ç¡¬ç›˜50G</span></span><br><span class="line"><span class="comment"># å…·ä½“å®‰è£…ä¸ä»‹ç»äº†ï¼Œå¯ä»¥VMwareä¹Ÿå¯ä»¥pveè¿›è¡Œå®‰è£…ï¼Œç³»ç»Ÿå¯ä»¥é€‰æ‹©æœ€å°å®‰è£…æˆ–è€…å¸¦å›¾å½¢å®‰è£…</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨yumå®‰è£…éœ€è¦è™šæ‹Ÿæœºå¯ä»¥æ­£å¸¸ä¸Šç½‘ï¼Œyumå®‰è£…å‰å¯ä»¥å…ˆæµ‹è¯•ä¸‹è™šæ‹Ÿæœºè”ç½‘æƒ…å†µ</span></span><br><span class="line">ping www.baidu.com</span><br><span class="line"><span class="comment"># å®‰è£…epel-release</span></span><br><span class="line"><span class="comment"># æ³¨ï¼šExtra Packages for Enterprise Linuxæ˜¯ä¸ºâ€œçº¢å¸½ç³»â€çš„æ“ä½œç³»ç»Ÿæä¾›é¢å¤–çš„è½¯ä»¶åŒ…ï¼Œé€‚ç”¨äºRHELã€CentOSå’ŒScientific Linuxã€‚ç›¸å½“äºæ˜¯ä¸€ä¸ªè½¯ä»¶ä»“åº“ï¼Œå¤§å¤šæ•°rpmåŒ…åœ¨å®˜æ–¹ repository ä¸­æ˜¯æ‰¾ä¸åˆ°çš„</span></span><br><span class="line">yum install -y epel-release</span><br><span class="line"><span class="comment"># å¦‚æœLinuxå®‰è£…çš„æ˜¯æœ€å°ç³»ç»Ÿç‰ˆï¼Œè¿˜éœ€è¦å®‰è£…å¦‚ä¸‹å·¥å…·ï¼›å¦‚æœå®‰è£…çš„æ˜¯Linuxæ¡Œé¢æ ‡å‡†ç‰ˆï¼Œä¸éœ€è¦æ‰§è¡Œå¦‚ä¸‹æ“ä½œ</span></span><br><span class="line"><span class="comment"># net-toolï¼šå·¥å…·åŒ…é›†åˆï¼ŒåŒ…å«ifconfigç­‰å‘½ä»¤</span></span><br><span class="line">yum install -y net-tools </span><br><span class="line">yum install -y vim</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­é˜²ç«å¢™ï¼Œå…³é—­é˜²ç«å¢™å¼€æœºè‡ªå¯</span></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šåœ¨ä¼ä¸šå¼€å‘æ—¶ï¼Œé€šå¸¸å•ä¸ªæœåŠ¡å™¨çš„é˜²ç«å¢™æ—¶å…³é—­çš„ã€‚å…¬å¸æ•´ä½“å¯¹å¤–ä¼šè®¾ç½®éå¸¸å®‰å…¨çš„é˜²ç«å¢™</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºatguiguç”¨æˆ·ï¼Œå¹¶ä¿®æ”¹atguiguç”¨æˆ·çš„å¯†ç </span></span><br><span class="line">useradd atguigu</span><br><span class="line">passwd atguigu</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®atguiguç”¨æˆ·å…·æœ‰rootæƒé™ï¼Œæ–¹ä¾¿åæœŸåŠ sudoæ‰§è¡Œrootæƒé™çš„å‘½ä»¤</span></span><br><span class="line">vim /etc/sudoers</span><br><span class="line"><span class="comment"># ä¿®æ”¹/etc/sudoersæ–‡ä»¶ï¼Œåœ¨%wheelè¿™è¡Œä¸‹é¢æ·»åŠ ä¸€è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Allow root to run any commands anywhere</span></span><br><span class="line">root ALL=(ALL) ALL</span><br><span class="line"><span class="comment">## Allows people in group wheel to run all commands</span></span><br><span class="line">%wheel ALL=(ALL) ALL</span><br><span class="line">atguigu ALL=(ALL) NOPASSWD:ALL</span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šatguigu è¿™ä¸€è¡Œä¸è¦ç›´æ¥æ”¾åˆ° root è¡Œä¸‹é¢ï¼Œå› ä¸ºæ‰€æœ‰ç”¨æˆ·éƒ½å±äº wheel ç»„ï¼Œä½ å…ˆé…ç½®äº† atguigu å…·æœ‰å…å¯†åŠŸèƒ½ï¼Œä½†æ˜¯ç¨‹åºæ‰§è¡Œåˆ°%wheel è¡Œæ—¶ï¼Œè¯¥åŠŸèƒ½åˆè¢«è¦†ç›–å›éœ€è¦å¯†ç ã€‚æ‰€ä»¥ atguigu è¦æ”¾åˆ°%wheel è¿™è¡Œä¸‹é¢</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨/opt ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œå¹¶ä¿®æ”¹æ‰€å±ä¸»å’Œæ‰€å±ç»„,æŸ¥çœ‹æƒé™</span></span><br><span class="line">mkdir /opt/module</span><br><span class="line">mkdir /opt/software</span><br><span class="line">chown atguigu:atguigu /opt/module </span><br><span class="line">chown atguigu:atguigu /opt/software</span><br><span class="line">ll /opt</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸è½½è™šæ‹Ÿæœºè‡ªå¸¦çš„ JDK</span></span><br><span class="line"><span class="comment"># å¦‚æœä½ çš„è™šæ‹Ÿæœºæ˜¯æœ€å°åŒ–å®‰è£…ä¸éœ€è¦æ‰§è¡Œè¿™ä¸€æ­¥</span></span><br><span class="line">rpm -qa | grep -i java | xargs -n1 rpm -e --nodeps</span><br><span class="line"><span class="comment"># rpm -qaï¼šæŸ¥è¯¢æ‰€å®‰è£…çš„æ‰€æœ‰rpmè½¯ä»¶åŒ…</span></span><br><span class="line"><span class="comment"># grep -iï¼šå¿½ç•¥å¤§å°å†™</span></span><br><span class="line"><span class="comment"># xargs -n1ï¼šè¡¨ç¤ºæ¯æ¬¡åªä¼ é€’ä¸€ä¸ªå‚æ•°</span></span><br><span class="line"><span class="comment"># rpm -e â€“nodepsï¼šå¼ºåˆ¶å¸è½½è½¯ä»¶</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>
<p>å¦å¤–è¿˜éœ€è¦é…ç½®ç½‘å¡ä¿¡æ¯å’Œä¸»æœºåï¼Œè¿™æ ·æ›´å®¹æ˜“ç®¡ç†</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆæ‰¾åˆ°è‡ªå·±çš„ç½‘å¡ï¼Œå¯èƒ½ä¸åŒæœºå™¨ä¸ä¸€æ ·ï¼Œæ¯”å¦‚æˆ‘çš„å°±æ˜¯eth0</span></span><br><span class="line">ip a</span><br><span class="line"><span class="comment"># ä¿®æ”¹å…‹éš†è™šæ‹Ÿæœºçš„é™æ€ IPï¼ŒåŠ¨æ€ä¹Ÿå¯ä»¥åªæ˜¯ä¸å¥½ç®¡ç†</span></span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line"><span class="comment"># æ”¹æˆä¸‹é¢ï¼Œæ ¹æ®å®é™…æƒ…å†µè‡ªå·±é€‰å–</span></span><br><span class="line">ONBOOT=yes</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">NAME=<span class="string">"eth0"</span></span><br><span class="line">IPADDR=192.168.31.210</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=192.168.31.1</span><br><span class="line">DNS1=192.168.31.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ä¸»æœºå,æ¨¡æ¿æœºå°±è®¾ç½®ä¸ºHadoop100</span></span><br><span class="line">vim /etc/hostname</span><br><span class="line"><span class="comment"># é…ç½® Linux å…‹éš†æœºä¸»æœºåç§°æ˜ å°„ hosts æ–‡ä»¶,åæœŸç›´æ¥å¯ä»¥é€šè¿‡åå­—è®¿é—®äº†</span></span><br><span class="line">vim /etc/hosts</span><br><span class="line">192.168.31.210 hadoop100</span><br><span class="line">192.168.31.211 hadoop101</span><br><span class="line">192.168.31.212 hadoop102</span><br><span class="line">192.168.31.213 hadoop103</span><br><span class="line">192.168.31.214 hadoop104</span><br><span class="line"><span class="comment"># æœ€åä¹Ÿå¯ä»¥å°†windows çš„ä¸»æœºæ˜ å°„æ–‡ä»¶ï¼ˆhosts æ–‡ä»¶ï¼‰ä¿®æ”¹ï¼Œåœ¨C:\Windows\System32\drivers\etc</span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-æ¨¡æ¿åˆ›å»º">2.2 æ¨¡æ¿åˆ›å»º</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…‹éš†hadoop100æœºå™¨ï¼Œæ‰“å¼€åä¿®æ”¹IPåœ°å€å’Œhostnameï¼Œé‡å¯</span></span><br><span class="line"><span class="comment"># ===================== å®‰è£…JDK8=========================</span></span><br><span class="line"><span class="comment"># å®˜ç½‘ä¸‹è½½ https://www.oracle.com/java/technologies/downloads/</span></span><br><span class="line"><span class="comment"># æŠŠæ–‡ä»¶ä¸Šä¼ åˆ°è¯¥ç›®å½•i</span></span><br><span class="line">ls /opt/software/</span><br><span class="line"><span class="comment"># è§£å‹åˆ°æŒ‡å®šç›®å½•</span></span><br><span class="line">tar -zxvf jdk-8u121-linux-x64.tar.gz -C /opt/module/</span><br><span class="line"><span class="comment"># çœ‹ä¸€ä¸‹å…¨å±€åŠ è½½çš„é…ç½®æ–‡ä»¶(ç¯å¢ƒä¾¿åˆ©)</span></span><br><span class="line">cat /etc/profile</span><br><span class="line">sudo vim /etc/profile.d/my_env.sh</span><br><span class="line"><span class="comment"># å†™å…¥ä»¥ä¸‹ç¯å¢ƒ</span></span><br><span class="line"><span class="comment">#JAVA_HOME</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/opt/module/jdk1.8.0_121</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ·æ–°ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="comment"># æµ‹è¯•</span></span><br><span class="line">java -version</span><br><span class="line"></span><br><span class="line"><span class="comment"># ==================å®‰è£…hadoop==================</span></span><br><span class="line"><span class="comment"># å®˜ç½‘ https://archive.apache.org/dist/hadoop/common/hadoop-3.1.3/</span></span><br><span class="line">wget https://archive.apache.org/dist/hadoop/common/hadoop-3.1.3/hadoop-3.1.3.tar.gz</span><br><span class="line">tar -zxvf hadoop-3.1.3.tar.gz -C /opt/module/</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºä»€ä¹ˆæ˜¯æŠŠç¯å¢ƒå˜é‡æ”¾åœ¨/etc/profile.dä¸‹å‘¢ï¼Ÿ</span></span><br><span class="line"><span class="comment"># å¦‚æœæ­£å¸¸ç™»é™†ï¼Œæ˜¯Login shellï¼Œä¼šåŠ è½½/etc/profileã€~/.bash_profileã€~/.bashrc-&gt;/etc/bashrc-&gt;/etc/profile.d/*.sh</span></span><br><span class="line"><span class="comment"># å¦‚æœæ˜¯sshç™»é™†,æ˜¯non-login shellï¼Œåªä¼šåŠ è½½~/.bashrc-&gt;/etc/bashrc-&gt;/etc/profile.d/*.sh</span></span><br><span class="line">sudo vim /etc/profile.d/my_env.sh</span><br><span class="line"><span class="comment"># ç»§ç»­æ·»åŠ ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="comment">#HADOOP_HOME</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/opt/module/hadoop-3.1.3</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/bin</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/sbin</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="comment"># æµ‹è¯•ï¼Œå¦‚æœhadoopå‘½ä»¤å¤±æ•ˆå¯ä»¥é‡å¯è¯•è¯•çœ‹</span></span><br><span class="line">hadoop version</span><br><span class="line"></span><br><span class="line"><span class="comment"># hadoopç›¸å…³ç›®å½•ä»‹ç»</span></span><br><span class="line"><span class="comment"># binç›®å½•ï¼šå­˜æ”¾å¯¹Hadoopç›¸å…³æœåŠ¡ï¼ˆhdfsï¼Œyarnï¼Œmapredï¼‰è¿›è¡Œæ“ä½œçš„è„šæœ¬</span></span><br><span class="line"><span class="comment"># etcç›®å½•ï¼šHadoopçš„é…ç½®æ–‡ä»¶ç›®å½•ï¼Œå­˜æ”¾Hadoopçš„é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment"># libç›®å½•ï¼šå­˜æ”¾Hadoopçš„æœ¬åœ°åº“ï¼ˆå¯¹æ•°æ®è¿›è¡Œå‹ç¼©è§£å‹ç¼©åŠŸèƒ½ï¼‰</span></span><br><span class="line"><span class="comment"># sbinç›®å½•ï¼šå­˜æ”¾å¯åŠ¨æˆ–åœæ­¢Hadoopç›¸å…³æœåŠ¡çš„è„šæœ¬</span></span><br><span class="line"><span class="comment"># shareç›®å½•ï¼šå­˜æ”¾Hadoopçš„ä¾èµ–jaråŒ…ã€æ–‡æ¡£ã€å’Œå®˜æ–¹æ¡ˆä¾‹</span></span><br></pre></td></tr></table></figure>
<h2 id="3ã€æœ¬åœ°è¿è¡Œæ¨¡å¼ï¼ˆå®˜æ–¹WordCountï¼‰">3ã€æœ¬åœ°è¿è¡Œæ¨¡å¼ï¼ˆå®˜æ–¹WordCountï¼‰</h2>
<blockquote>
<p>å®˜ç½‘ï¼š<a href="http://hadoop.apache.org/" target="_blank" rel="noopener" title="http://hadoop.apache.org/">http://hadoop.apache.org/</a></p>
</blockquote>
<p>Hadoopè¿è¡Œæ¨¡å¼åŒ…æ‹¬ï¼š<strong>æœ¬åœ°æ¨¡å¼</strong>ã€<strong>ä¼ªåˆ†å¸ƒå¼æ¨¡å¼</strong>ä»¥åŠ<strong>å®Œå…¨åˆ†å¸ƒå¼æ¨¡å¼</strong>ã€‚</p>
<ul>
<li><strong>æœ¬åœ°æ¨¡å¼</strong>ï¼šå•æœºè¿è¡Œï¼Œåªæ˜¯ç”¨æ¥æ¼”ç¤ºä¸€ä¸‹å®˜æ–¹æ¡ˆä¾‹ã€‚ç”Ÿäº§ç¯å¢ƒä¸ç”¨ã€‚</li>
<li>**ä¼ªåˆ†å¸ƒå¼æ¨¡å¼ï¼š**ä¹Ÿæ˜¯å•æœºè¿è¡Œï¼Œä½†æ˜¯å…·å¤‡Hadoopé›†ç¾¤çš„æ‰€æœ‰åŠŸèƒ½ï¼Œä¸€å°æœåŠ¡å™¨æ¨¡æ‹Ÿä¸€ä¸ªåˆ†å¸ƒå¼çš„ç¯å¢ƒã€‚ä¸ªåˆ«ç¼ºé’±çš„å…¬å¸ç”¨æ¥æµ‹è¯•ï¼Œç”Ÿäº§ç¯å¢ƒä¸ç”¨ã€‚</li>
<li>**å®Œå…¨åˆ†å¸ƒå¼æ¨¡å¼ï¼š**å¤šå°æœåŠ¡å™¨ç»„æˆåˆ†å¸ƒå¼ç¯å¢ƒã€‚ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/module/hadoop-3.1.3/</span><br><span class="line">mkdir wcinput</span><br><span class="line">vim word.txt</span><br><span class="line"><span class="comment"># åœ¨æ–‡ä»¶ä¸­è¾“å…¥å¦‚ä¸‹å†…å®¹</span></span><br><span class="line">hadoop yarn</span><br><span class="line">hadoop mapreduce</span><br><span class="line">atguigu</span><br><span class="line">atguigu shawn</span><br><span class="line"><span class="comment"># è¿”å›ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /opt/module/hadoop-3.1.3</span><br><span class="line"><span class="comment"># æ‰§è¡Œï¼Œç»Ÿè®¡æ¯ä¸ªå•è¯æ•°</span></span><br><span class="line">hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount wcinput wcoutput</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç»“æœ</span></span><br><span class="line">cat wcoutput/part-r-00000</span><br></pre></td></tr></table></figure>
<h2 id="4ã€Hadoopé›†ç¾¤æ­å»º-ğŸŒŸé‡ç‚¹">4ã€Hadoopé›†ç¾¤æ­å»º(ğŸŒŸé‡ç‚¹)</h2>
<h3 id="4-1-ç¯å¢ƒå‡†å¤‡-é›†ç¾¤åˆ†å‘è„šæœ¬xsync">4.1 ç¯å¢ƒå‡†å¤‡(é›†ç¾¤åˆ†å‘è„šæœ¬xsync)</h3>
<p>é¦–å…ˆå‡†å¤‡ä¸‰å°æœºå™¨ï¼Œæˆ‘è¿™é‡Œå‡†å¤‡hadoop102,103,104ï¼Œé…ç½®å¥½ç›¸å…³hostnameå’Œipï¼Œæ¥ä¸‹æ¥å¤åˆ¶ç›¸å…³è½¯ä»¶å’Œé…ç½®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># =====================scpï¼ˆsecure copyï¼‰å®‰å…¨æ‹·è´======================</span></span><br><span class="line"><span class="comment"># scpå¯ä»¥å®ç°æœåŠ¡å™¨ä¸æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®æ‹·è´</span></span><br><span class="line"><span class="comment"># åŸºæœ¬è¯­æ³•ï¼šscp -r $pdir/$fname  $user@$host:$pdir/$fname</span></span><br><span class="line"><span class="comment"># å‰æï¼šåœ¨hadoop102ã€hadoop103ã€hadoop104éƒ½å·²ç»åˆ›å»ºå¥½çš„/opt/moduleã€/opt/softwareä¸¤ä¸ªç›®å½•ï¼Œå¹¶ä¸”å·²ç»æŠŠè¿™ä¸¤ä¸ªç›®å½•ä¿®æ”¹ä¸ºatguigu:atguigu</span></span><br><span class="line"><span class="comment"># scp -r /opt/module/jdk1.8.0_121  atguigu@hadoop103:/opt/module</span></span><br><span class="line">scp -r atguigu@hadoop102:/opt/module/* atguigu@hadoop103:/opt/module</span><br><span class="line">scp -r atguigu@hadoop102:/opt/module/* atguigu@hadoop104:/opt/module</span><br><span class="line"></span><br><span class="line"><span class="comment"># =======================rsyncè¿œç¨‹åŒæ­¥å·¥å…·=======================</span></span><br><span class="line"><span class="comment"># rsyncä¸»è¦ç”¨äºå¤‡ä»½å’Œé•œåƒã€‚å…·æœ‰é€Ÿåº¦å¿«ã€é¿å…å¤åˆ¶ç›¸åŒå†…å®¹å’Œæ”¯æŒç¬¦å·é“¾æ¥çš„ä¼˜ç‚¹</span></span><br><span class="line"><span class="comment"># rsyncå’ŒscpåŒºåˆ«ï¼šç”¨rsyncåšæ–‡ä»¶çš„å¤åˆ¶è¦æ¯”scpçš„é€Ÿåº¦å¿«ï¼Œrsyncåªå¯¹å·®å¼‚æ–‡ä»¶åšæ›´æ–°ã€‚scpæ˜¯æŠŠæ‰€æœ‰æ–‡ä»¶éƒ½å¤åˆ¶è¿‡å»</span></span><br><span class="line"><span class="comment"># åŸºæœ¬å‘½ä»¤ï¼šrsync -av $pdir/$fname $user@$host:$pdir/$fname</span></span><br><span class="line"><span class="comment"># -a å½’æ¡£æ‹·è´;-v æ˜¾ç¤ºå¤åˆ¶è¿‡ç¨‹</span></span><br><span class="line">rm -rf wcinput/</span><br><span class="line">rsync -av hadoop-3.1.3/ atguigu@hadoop103:/opt/module/hadoop-3.1.3/</span><br><span class="line"></span><br><span class="line"><span class="comment"># =======================xsyncé›†ç¾¤åˆ†å‘è„šæœ¬=========================</span></span><br><span class="line"><span class="comment"># éœ€æ±‚ï¼šå¾ªç¯å¤åˆ¶æ–‡ä»¶åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„ç›¸åŒç›®å½•ä¸‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºxsyncæ–‡ä»¶</span></span><br><span class="line"><span class="built_in">cd</span> /home/atguigu</span><br><span class="line">mkdir bin</span><br><span class="line"><span class="built_in">cd</span> bin</span><br><span class="line">vim xsync</span><br><span class="line"><span class="comment"># å†™å…¥ä¸€ä¸‹è„šæœ¬</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#1. åˆ¤æ–­å‚æ•°ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -lt 1 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> Not Enough Arguement!</span><br><span class="line">    <span class="built_in">exit</span>;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#2. éå†é›†ç¾¤æ‰€æœ‰æœºå™¨</span></span><br><span class="line"><span class="keyword">for</span> host <span class="keyword">in</span> hadoop102 hadoop103 hadoop104</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> ====================  <span class="variable">$host</span>  ====================</span><br><span class="line">    <span class="comment">#3. éå†æ‰€æœ‰ç›®å½•ï¼ŒæŒ¨ä¸ªå‘é€</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> <span class="variable">$@</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        <span class="comment">#4. åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> [ -e <span class="variable">$file</span> ]</span><br><span class="line">            <span class="keyword">then</span></span><br><span class="line">                <span class="comment">#5. è·å–çˆ¶ç›®å½•</span></span><br><span class="line">                pdir=$(<span class="built_in">cd</span> -P $(dirname <span class="variable">$file</span>); <span class="built_in">pwd</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment">#6. è·å–å½“å‰æ–‡ä»¶çš„åç§°</span></span><br><span class="line">                fname=$(basename <span class="variable">$file</span>)</span><br><span class="line">                ssh <span class="variable">$host</span> <span class="string">"mkdir -p <span class="variable">$pdir</span>"</span></span><br><span class="line">                rsync -av <span class="variable">$pdir</span>/<span class="variable">$fname</span> <span class="variable">$host</span>:<span class="variable">$pdir</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="variable">$file</span> does not exists!</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹è„šæœ¬ xsync å…·æœ‰æ‰§è¡Œæƒé™</span></span><br><span class="line">chmod +x xsync</span><br><span class="line"><span class="comment"># æµ‹è¯•è„šæœ¬</span></span><br><span class="line">xsync /home/atguigu/bin</span><br><span class="line"><span class="comment"># å°†è„šæœ¬å¤åˆ¶åˆ°/binä¸­ï¼Œä»¥ä¾¿å…¨å±€è°ƒç”¨</span></span><br><span class="line">sudo cp xsync /bin/</span><br><span class="line"><span class="comment"># åŒæ­¥ç¯å¢ƒå˜é‡é…ç½®ï¼ˆrootæ‰€æœ‰è€…ï¼‰</span></span><br><span class="line">sudo ./bin/xsync /etc/profile.d/my_env.sh</span><br><span class="line"><span class="comment"># æ¯å°æœºå™¨éƒ½åˆ·ä¸€ä¸‹</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>
<h3 id="4-2-SSHå…å¯†é…ç½®">4.2 SSHå…å¯†é…ç½®</h3>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330901.png" alt></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">ls -la</span><br><span class="line"><span class="comment"># å¦‚æœæ²¡æœ‰å°±åˆ›å»º</span></span><br><span class="line"><span class="comment"># mkdir -p .ssh</span></span><br><span class="line"><span class="built_in">cd</span> .ssh/</span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line"><span class="comment"># å°†å…¬é’¥æ‹·è´åˆ°è¦å…å¯†ç™»å½•çš„ç›®æ ‡æœºå™¨ä¸Š</span></span><br><span class="line">ssh-copy-id hadoop102</span><br><span class="line">ssh-copy-id hadoop103</span><br><span class="line">ssh-copy-id hadoop104</span><br><span class="line"><span class="comment"># æ³¨æ„103ï¼Œ104æœºå™¨è¿˜éœ€è¦è¿›è¡Œç›¸åŒçš„é…ç½®æ“ä½œï¼Œä½¿å…¶äº’ç›¸å…å¯†ç™»é™†</span></span><br><span class="line"><span class="comment"># è¿˜éœ€è¦åœ¨ hadoop102 ä¸Šé‡‡ç”¨ root è´¦å·ï¼Œé…ç½®ä¸€ä¸‹æ— å¯†ç™»å½•åˆ° hadoop102ã€hadoop103ã€hadoop104ï¼›</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># .ssh æ–‡ä»¶å¤¹ä¸‹ï¼ˆ~/.sshï¼‰çš„æ–‡ä»¶åŠŸèƒ½è§£é‡Š</span></span><br><span class="line"><span class="comment"># known_hostsï¼Œè®°å½• ssh è®¿é—®è¿‡è®¡ç®—æœºçš„å…¬é’¥ï¼ˆpublic keyï¼‰</span></span><br><span class="line"><span class="comment"># id_rsaï¼Œç”Ÿæˆçš„ç§é’¥</span></span><br><span class="line"><span class="comment"># id_rsa.pubï¼Œç”Ÿæˆçš„å…¬é’¥</span></span><br><span class="line"><span class="comment"># authorized_keysï¼Œå­˜æ”¾æˆæƒè¿‡çš„æ— å¯†ç™»å½•æœåŠ¡å™¨å…¬é’¥</span></span><br></pre></td></tr></table></figure>
<h3 id="4-3-é›†ç¾¤é…ç½®">4.3 é›†ç¾¤é…ç½®</h3>
<p><strong>1)é›†ç¾¤éƒ¨ç½²è§„åˆ’</strong></p>
<ul>
<li>NameNodeå’ŒSecondaryNameNodeä¸è¦å®‰è£…åœ¨åŒä¸€å°æœåŠ¡å™¨</li>
<li>ResourceManagerä¹Ÿå¾ˆæ¶ˆè€—å†…å­˜ï¼Œä¸è¦å’ŒNameNodeã€SecondaryNameNodeé…ç½®åœ¨åŒä¸€å°æœºå™¨ä¸Šã€‚</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>hadoop102</th>
<th>hadoop103</th>
<th>hadoop104</th>
</tr>
</thead>
<tbody>
<tr>
<td>HDFS</td>
<td>NameNode

DataNode</td>
<td>DataNode</td>
<td>SecondaryNameNode

DataNode</td>
</tr>
<tr>
<td>YARN</td>
<td>NodeManager</td>
<td>ResourceManager

NodeManager</td>
<td>NodeManager</td>
</tr>
</tbody>
</table>
<p><strong>2)é…ç½®æ–‡ä»¶è¯´æ˜</strong></p>
<p>Hadoopé…ç½®æ–‡ä»¶åˆ†ä¸¤ç±»ï¼šé»˜è®¤é…ç½®æ–‡ä»¶å’Œè‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œåªæœ‰ç”¨æˆ·æƒ³ä¿®æ”¹æŸä¸€é»˜è®¤é…ç½®å€¼æ—¶ï¼Œæ‰éœ€è¦ä¿®æ”¹è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œæ›´æ”¹ç›¸åº”å±æ€§å€¼</p>
<ul>
<li>é»˜è®¤é…ç½®æ–‡ä»¶</li>
</ul>
<table>
<thead>
<tr>
<th>è¦è·å–çš„é»˜è®¤æ–‡ä»¶</th>
<th>æ–‡ä»¶å­˜æ”¾åœ¨Hadoopçš„jaråŒ…ä¸­çš„ä½ç½®</th>
</tr>
</thead>
<tbody>
<tr>
<td>[core-default.xml]</td>
<td>hadoop-common-3.1.3.jar/core-default.xml</td>
</tr>
<tr>
<td>[hdfs-default.xml]</td>
<td>hadoop-hdfs-3.1.3.jar/hdfs-default.xml</td>
</tr>
<tr>
<td>[yarn-default.xml]</td>
<td>hadoop-yarn-common-3.1.3.jar/yarn-default.xml</td>
</tr>
<tr>
<td>[mapred-default.xml]</td>
<td>hadoop-mapreduce-client-core-3.1.3.jar/mapred-default.xml</td>
</tr>
</tbody>
</table>
<ul>
<li>è‡ªå®šä¹‰é…ç½®æ–‡ä»¶</li>
</ul>
<p><strong>core-site.xml</strong>ã€<strong>hdfs-site.xml</strong>ã€<strong>yarn-site.xml</strong>ã€<strong>mapred-site.xml</strong>å››ä¸ªé…ç½®æ–‡ä»¶å­˜æ”¾åœ¨<code>$HADOOP_HOME/etc/hadoop</code>è¿™ä¸ªè·¯å¾„ä¸Šï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®é¡¹ç›®éœ€æ±‚é‡æ–°è¿›è¡Œä¿®æ”¹é…ç½®</p>
<p><strong>3)é…ç½®é›†ç¾¤</strong></p>
<p>æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œé…ç½®<code>core-site.xml</code>ï¼Œ<code>cd $HADOOP_HOME/etc/hadoop</code>ï¼Œ<code>vim core-site.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æŒ‡å®šNameNodeçš„åœ°å€ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hadoop102:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æŒ‡å®šhadoopæ•°æ®çš„å­˜å‚¨ç›®å½• --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/module/hadoop-3.1.3/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®HDFSç½‘é¡µç™»å½•ä½¿ç”¨çš„é™æ€ç”¨æˆ·ä¸ºatguigu --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.http.staticuser.user<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>atguigu<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>HDFSé…ç½®æ–‡ä»¶ï¼Œé…ç½®hdfs-site.xmlï¼Œ<code>vim hdfs-site.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- nn webç«¯è®¿é—®åœ°å€--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102:9870<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 2nn webç«¯è®¿é—®åœ°å€--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.secondary.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop104:9868<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>YARNé…ç½®æ–‡ä»¶ï¼Œé…ç½®yarn-site.xmlï¼Œ<code>vim yarn-site.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æŒ‡å®šMRèµ°shuffle --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- æŒ‡å®šResourceManagerçš„åœ°å€--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ç¯å¢ƒå˜é‡çš„ç»§æ‰¿ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.env-whitelist<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>MapReduceé…ç½®æ–‡ä»¶ï¼Œé…ç½®mapred-site.xmlï¼Œ<code>vim mapred-site.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æŒ‡å®šMapReduceç¨‹åºè¿è¡Œåœ¨Yarnä¸Š --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>4)åœ¨é›†ç¾¤ä¸Šåˆ†å‘é…ç½®å¥½çš„Hadoopé…ç½®æ–‡ä»¶</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xsync /opt/module/hadoop-3.1.3/etc/hadoop/</span><br><span class="line"><span class="comment"># å»å…¶ä»–èŠ‚ç‚¹æŸ¥çœ‹</span></span><br><span class="line">cat /opt/module/hadoop-3.1.3/etc/hadoop/core-site.xml</span><br></pre></td></tr></table></figure>
<h3 id="4-4-å¯åŠ¨é›†ç¾¤">4.4 å¯åŠ¨é›†ç¾¤</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆéœ€è¦é…ç½®workers,å…¶ä¸­æ¯ä¸€è¡Œéƒ½ä»£è¡¨ç€ä¸€ä¸ªworkerèŠ‚ç‚¹çš„ä¸»æœºåæˆ–IPåœ°å€ï¼Œhadoopé€šè¿‡è¿™ä¸ªæ–‡ä»¶æ¥ç¡®å®šé›†ç¾¤ä¸­æœ‰å“ªäº›èŠ‚ç‚¹å¹¶ä¸”å°†ä»»åŠ¡åˆ†é…åˆ°è¿™äº›èŠ‚ç‚¹ä¸Š</span></span><br><span class="line">vim /opt/module/hadoop-3.1.3/etc/hadoop/workers</span><br><span class="line"><span class="comment"># è¯¥æ–‡ä»¶ä¸­æ·»åŠ çš„å†…å®¹ç»“å°¾ä¸å…è®¸æœ‰ç©ºæ ¼ï¼Œæ–‡ä»¶ä¸­ä¸å…è®¸æœ‰ç©ºè¡Œ</span></span><br><span class="line">hadoop102</span><br><span class="line">hadoop103</span><br><span class="line">hadoop104</span><br><span class="line"><span class="comment"># åˆ†å‘</span></span><br><span class="line">xsync /opt/module/hadoop-3.1.3/etc</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨é›†ç¾¤</span></span><br><span class="line"><span class="comment"># å¦‚æœé›†ç¾¤æ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨ï¼Œéœ€è¦åœ¨hadoop102èŠ‚ç‚¹æ ¼å¼åŒ–NameNode</span></span><br><span class="line"><span class="comment">#ï¼ˆæ³¨æ„ï¼šæ ¼å¼åŒ–NameNodeï¼Œä¼šäº§ç”Ÿæ–°çš„é›†ç¾¤idï¼Œå¯¼è‡´NameNodeå’ŒDataNodeçš„é›†ç¾¤idä¸ä¸€è‡´ï¼Œé›†ç¾¤æ‰¾ä¸åˆ°å·²å¾€æ•°æ®ã€‚å¦‚æœé›†ç¾¤åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æŠ¥é”™ï¼Œéœ€è¦é‡æ–°æ ¼å¼åŒ–NameNodeçš„è¯ï¼Œä¸€å®šè¦å…ˆåœæ­¢namenodeå’Œdatanodeè¿›ç¨‹ï¼Œå¹¶ä¸”è¦åˆ é™¤æ‰€æœ‰æœºå™¨çš„dataå’Œlogsç›®å½•ï¼Œç„¶åå†è¿›è¡Œæ ¼å¼åŒ–ã€‚ï¼‰</span></span><br><span class="line"><span class="comment"># æ³¨æ„ä»¥ä¸‹æ“ä½œè¦åœ¨atguiguè´¦å·ä¸‹è¿›è¡Œï¼Œä¸è¦åœ¨rootä¸‹</span></span><br><span class="line">hdfs namenode -format</span><br><span class="line"><span class="comment"># å¯åŠ¨HDFS</span></span><br><span class="line">sbin/start-dfs.sh</span><br><span class="line"><span class="comment"># åœ¨é…ç½®äº†ResourceManagerçš„èŠ‚ç‚¹ï¼ˆhadoop103ï¼‰å¯åŠ¨YARN</span></span><br><span class="line">sbin/start-yarn.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥åœ¨æ¯ä¸ªèŠ‚ç‚¹jpsæŸ¥çœ‹å¯åŠ¨çš„æœåŠ¡</span></span><br><span class="line"><span class="comment"># Webç«¯æŸ¥çœ‹HDFSçš„NameNodeï¼Œæµè§ˆå™¨ä¸­è¾“å…¥ï¼šhttp://hadoop102:9870</span></span><br><span class="line"><span class="comment"># Webç«¯æŸ¥çœ‹YARNçš„ResourceManagerï¼Œæµè§ˆå™¨ä¸­è¾“å…¥ï¼šhttp://hadoop103:8088</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åè¿›è¡Œé›†ç¾¤åŸºæœ¬æµ‹è¯•</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -mkdir /input</span><br><span class="line"><span class="comment"># ä¼ å°æ–‡ä»¶</span></span><br><span class="line">hadoop fs -put <span class="variable">$HADOOP_HOME</span>/wcinput/word.txt /input</span><br><span class="line">hadoop fs -put  /opt/software/jdk-8u121-linux-x64.tar.gz  /</span><br><span class="line"><span class="comment"># æ³¨æ„é¢„è§ˆå’Œä¸‹è½½éœ€è¦åœ¨ç”µè„‘é…ç½®å¥½ipå’Œä¸»æœºåæ˜ å°„</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸Šä¼ æ–‡ä»¶åæŸ¥çœ‹æ–‡ä»¶å­˜æ”¾åœ¨ä»€ä¹ˆä½ç½®</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹HDFSæ–‡ä»¶å­˜å‚¨è·¯å¾„</span></span><br><span class="line"><span class="built_in">cd</span> /opt/module/hadoop-3.1.3/data/dfs/data/current/BP-1436128598-192.168.10.102-1610603650062/current/finalized/subdir0/subdir0</span><br><span class="line">ll</span><br><span class="line"><span class="comment"># å¯ä»¥å‘ç°æ˜¯é‚£ä¸ªtxtæ–‡ä»¶</span></span><br><span class="line">cat blk_1073741825</span><br><span class="line"><span class="comment"># å¯¹äºjdkä¹Ÿå¯ä»¥è¿›è¡Œæ‹¼æ¥</span></span><br><span class="line">cat blk_1073741836&gt;&gt;tmp.tar.gz</span><br><span class="line">cat blk_1073741837&gt;&gt;tmp.tar.gz</span><br><span class="line">tar -zxvf tmp.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># hadoopæ–‡ä»¶ä¸‹è½½</span></span><br><span class="line">hadoop fs -get /jdk-8u121-linux-x64.tar.gz ./</span><br><span class="line"><span class="comment"># æ‰§è¡Œwordcountç¨‹åº</span></span><br><span class="line">hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount /input /output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨æŠ¥é”™ï¼Œè¯¯åˆ æ•°æ®ç­‰æƒ…å†µï¼Œå¯¼è‡´é›†ç¾¤å´©æºƒ</span></span><br><span class="line"><span class="comment"># Versionæ˜¯å¯åŠ¨çš„ç‰ˆæœ¬å·ï¼Œé›†ç¾¤æ ¹æ®è¿™ä¸ªæ¥å®šä½ï¼Œå¦‚æœä¸ä¸€æ ·å°±å´©æºƒ</span></span><br><span class="line">cat data/dfs/name/current/VERSION</span><br><span class="line"><span class="comment"># å¦‚æœé›†ç¾¤å¼‚å¸¸ï¼Œæ­£å¸¸çš„æ“ä½œæ–¹æ³•æ˜¯sbin/xxxè„šæœ¬åœæ­¢è¿›ç¨‹ï¼Œç„¶ååˆ é™¤data/å’Œlogs/ï¼Œé‡æ–°æ ¼å¼åŒ–ï¼Œæœ€åå¯åŠ¨</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè®¿é—®SNNï¼š<code>http://hadoop104:9868/status.html</code>ï¼Œä¼šå‘ç°ç•Œé¢æœ‰bugï¼Œéœ€è¦è¿›å…¥hadoop104</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/module/hadoop-3.1.3/share/hadoop/hdfs/webapps/static</span><br><span class="line">vim dfs-dust.js</span><br><span class="line"><span class="comment"># åœ¨61è¡Œå°†momentæ‰€åœ¨è¡Œæ³¨é‡Šæ‰ï¼Œæ·»åŠ è‡ªå·±çš„,æœ€åæ¸…é™¤ç¼“å­˜å³å¯</span></span><br><span class="line"><span class="built_in">return</span> Number(v).toLocaleString()</span><br></pre></td></tr></table></figure>
<h3 id="4-5-é…ç½®å†å²æœåŠ¡å™¨">4.5 é…ç½®å†å²æœåŠ¡å™¨</h3>
<p>ä¸ºäº†æŸ¥çœ‹ç¨‹åºçš„å†å²è¿è¡Œæƒ…å†µï¼Œéœ€è¦é…ç½®ä¸€ä¸‹å†å²æœåŠ¡å™¨ï¼Œéœ€è¦é…ç½®mapred-site.xmlï¼Œåœ¨è¯¥æ–‡ä»¶é‡Œé¢å¢åŠ å¦‚ä¸‹é…ç½®</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å†å²æœåŠ¡å™¨ç«¯åœ°å€ï¼Œrpcç«¯å£ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102:10020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å†å²æœåŠ¡å™¨webç«¯åœ°å€ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102:19888<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åè¿›è¡Œæ“ä½œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ†å‘é…ç½®</span></span><br><span class="line">xsync <span class="variable">$HADOOP_HOME</span>/etc/hadoop/mapred-site.xml</span><br><span class="line"><span class="comment"># åœ¨hadoop102å¯åŠ¨å†å²æœåŠ¡å™¨</span></span><br><span class="line">mapred --daemon start historyserver</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å†å²æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨</span></span><br><span class="line">jps</span><br><span class="line"><span class="comment"># æŸ¥çœ‹JobHistory</span></span><br><span class="line">http://hadoop102:19888/jobhistory</span><br></pre></td></tr></table></figure>
<h3 id="4-6-é…ç½®æ—¥å¿—çš„èšé›†">4.6 é…ç½®æ—¥å¿—çš„èšé›†</h3>
<blockquote>
<p>æ—¥å¿—èšé›†æ¦‚å¿µï¼šåº”ç”¨è¿è¡Œå®Œæˆä»¥åï¼Œå°†ç¨‹åºè¿è¡Œæ—¥å¿—ä¿¡æ¯ä¸Šä¼ åˆ°HDFSç³»ç»Ÿä¸Š</p>
</blockquote>
<p>æ—¥å¿—èšé›†åŠŸèƒ½å¥½å¤„ï¼šå¯ä»¥æ–¹ä¾¿çš„æŸ¥çœ‹åˆ°ç¨‹åºè¿è¡Œè¯¦æƒ…ï¼Œæ–¹ä¾¿å¼€å‘è°ƒè¯•ã€‚<strong>æ³¨æ„ï¼šå¼€å¯æ—¥å¿—èšé›†åŠŸèƒ½ï¼Œéœ€è¦é‡æ–°å¯åŠ¨ NodeManager ã€ResourceManager å’ŒHistoryServer</strong></p>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330902.png" alt></p>
<p>éœ€è¦é…ç½® yarn-site.xmlï¼Œåœ¨è¯¥æ–‡ä»¶é‡Œé¢å¢åŠ å¦‚ä¸‹é…ç½®</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¼€å¯æ—¥å¿—èšé›†åŠŸèƒ½ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation-enable<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- è®¾ç½®æ—¥å¿—èšé›†æœåŠ¡å™¨åœ°å€ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log.server.url<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>http://hadoop102:19888/jobhistory/logs<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- è®¾ç½®æ—¥å¿—ä¿ç•™æ—¶é—´ä¸º7å¤© --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation.retain-seconds<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>604800<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ†å‘é…ç½®</span></span><br><span class="line">xsync <span class="variable">$HADOOP_HOME</span>/etc/hadoop/yarn-site.xml</span><br><span class="line"><span class="comment"># å…³é—­NodeManager ã€ResourceManagerå’ŒHistoryServer</span></span><br><span class="line"><span class="comment"># yarnåœ¨hadoop103æ“ä½œ</span></span><br><span class="line">sbin/stop-yarn.sh</span><br><span class="line">mapred --daemon stop historyserver</span><br><span class="line"><span class="comment"># å¯åŠ¨NodeManager ã€ResourceManageå’ŒHistoryServer</span></span><br><span class="line">start-yarn.sh</span><br><span class="line">mapred --daemon start historyserver</span><br><span class="line"><span class="comment"># åˆ é™¤HDFSä¸Šå·²ç»å­˜åœ¨çš„è¾“å‡ºæ–‡ä»¶</span></span><br><span class="line">hadoop fs -rm -r /output</span><br><span class="line"><span class="comment"># æ‰§è¡ŒWordCountç¨‹åº</span></span><br><span class="line">hadoop jar <span class="variable">$HADOOP_HOME</span>/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount /input /output</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ—¥å¿—</span></span><br><span class="line">http://hadoop102:19888/jobhistory</span><br></pre></td></tr></table></figure>
<h3 id="4-7-é›†ç¾¤å¯åŠ¨-åœæ­¢æ–¹å¼æ€»ç»“">4.7 é›†ç¾¤å¯åŠ¨/åœæ­¢æ–¹å¼æ€»ç»“</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å„ä¸ªæ¨¡å—åˆ†å¼€å¯åŠ¨/åœæ­¢ï¼ˆé…ç½®sshæ˜¯å‰æï¼‰å¸¸ç”¨</span></span><br><span class="line"><span class="comment"># æ•´ä½“å¯åŠ¨/åœæ­¢HDFS</span></span><br><span class="line">start-dfs.sh/stop-dfs.sh</span><br><span class="line"><span class="comment"># æ•´ä½“å¯åŠ¨/åœæ­¢YARN</span></span><br><span class="line">start-yarn.sh/stop-yarn.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># å„ä¸ªæœåŠ¡ç»„ä»¶é€ä¸€å¯åŠ¨/åœæ­¢</span></span><br><span class="line"><span class="comment"># åˆ†åˆ«å¯åŠ¨/åœæ­¢HDFSç»„ä»¶</span></span><br><span class="line">hdfs --daemon start/stop namenode/datanode/secondarynamenode</span><br><span class="line"><span class="comment"># å¯åŠ¨/åœæ­¢YARN</span></span><br><span class="line">yarn --daemon start/stop  resourcemanager/nodemanager</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹äºæ–°èŠ‚ç‚¹çš„åŠ å…¥ï¼Œé¦–å…ˆå®šä¹‰å¥½ä¸»æœºåå’Œsshå…å¯†ï¼Œç„¶åå°†é…ç½®æ–‡ä»¶åˆ†å‘åˆ°è¯¥æœºå™¨</span></span><br><span class="line"><span class="comment"># ç„¶åå¯åŠ¨èŠ‚ç‚¹</span></span><br><span class="line">hadoop-daemon.sh start datanode</span><br><span class="line"><span class="comment"># ç„¶åå¯åŠ¨æ•°æ®åŒæ­¥å‘½ä»¤</span></span><br><span class="line">start-balancer.sh</span><br><span class="line"><span class="comment"># å¯åŠ¨yarn</span></span><br><span class="line">yarn-daemon.sh start nodemanager</span><br></pre></td></tr></table></figure>
<p>å¦‚æœé›†ç¾¤é•¿æ—¶é—´å¯åŠ¨åæƒ³å»å…³é—­é›†ç¾¤ï¼Œä¼šå‘ç°é›†ç¾¤æ— æ³•å…³é—­ï¼Œè¿™æ˜¯å› ä¸ºè„šæœ¬å…³åœæ˜¯æ ¹æ®æœåŠ¡çš„pidæ¥å…³é—­çš„ï¼Œè€Œhadoop çš„ pid æ–‡ä»¶é»˜è®¤åœ¨ /tmp æ–‡ä»¶ä¸‹ï¼Œä¸€èˆ¬ä¸ƒå¤©è¢«ç³»ç»Ÿæ¸…ç†æ‰ï¼Œæ‰€ä»¥å¯¼è‡´å…³åœå¤±è´¥ï¼Œå¦‚æœéœ€è¦èƒ½ä½¿ç”¨è„šæœ¬å…³åœï¼Œéƒ½å¼€å§‹éœ€è¦å°†pidä¿å­˜åˆ°å…¶ä»–è·¯å¾„ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¥åˆ°hadoopç¨‹åºé…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$HADOOP_HOME</span></span><br><span class="line">mkdir tmp</span><br><span class="line"><span class="built_in">cd</span> etc/hadoop</span><br><span class="line">vim hadoop-env.sh</span><br><span class="line">:<span class="built_in">set</span> nu</span><br><span class="line"><span class="comment"># åœ¨198è¡Œè®¾ç½®æˆ$HADOOP_HOME/tmp</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_PID_DIR=<span class="variable">$&#123;HADOOP_HOME&#125;</span>/tmp</span><br><span class="line"><span class="comment"># åœ¨252è¡Œä¿®æ”¹</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_SECURE_PID_DIR=<span class="variable">$&#123;HADOOP_PID_DIR&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-8-Hadoopé›†ç¾¤å¸¸ç”¨è„šæœ¬">4.8 Hadoopé›†ç¾¤å¸¸ç”¨è„šæœ¬</h3>
<p>Hadoopé›†ç¾¤å¯åœè„šæœ¬ï¼ˆåŒ…å«HDFSï¼ŒYarnï¼ŒHistoryserverï¼‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/atguigu/bin</span><br><span class="line">vim myhadoop.sh</span><br><span class="line"><span class="comment"># å†™å…¥è„šæœ¬</span></span><br><span class="line">chmod +x myhadoop.sh</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -lt 1 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"No Args Input..."</span></span><br><span class="line">    <span class="built_in">exit</span> ;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">"start"</span>)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">" =================== å¯åŠ¨ hadoopé›†ç¾¤ ==================="</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">" --------------- å¯åŠ¨ hdfs ---------------"</span></span><br><span class="line">        ssh hadoop102 <span class="string">"/opt/module/hadoop-3.1.3/sbin/start-dfs.sh"</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">" --------------- å¯åŠ¨ yarn ---------------"</span></span><br><span class="line"></span><br><span class="line">        ssh hadoop103 <span class="string">"/opt/module/hadoop-3.1.3/sbin/start-yarn.sh"</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">" --------------- å¯åŠ¨ historyserver ---------------"</span></span><br><span class="line">        ssh hadoop102 <span class="string">"/opt/module/hadoop-3.1.3/bin/mapred --daemon start historyserver"</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">"stop"</span>)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">" =================== å…³é—­ hadoopé›†ç¾¤ ==================="</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">" --------------- å…³é—­ historyserver ---------------"</span></span><br><span class="line">        ssh hadoop102 <span class="string">"/opt/module/hadoop-3.1.3/bin/mapred --daemon stop historyserver"</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">" --------------- å…³é—­ yarn ---------------"</span></span><br><span class="line">        ssh hadoop103 <span class="string">"/opt/module/hadoop-3.1.3/sbin/stop-yarn.sh"</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">" --------------- å…³é—­ hdfs ---------------"</span></span><br><span class="line">        ssh hadoop102 <span class="string">"/opt/module/hadoop-3.1.3/sbin/stop-dfs.sh"</span></span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Input Args Error..."</span></span><br><span class="line">;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹ä¸‰å°æœåŠ¡å™¨Javaè¿›ç¨‹è„šæœ¬ï¼šjpsall</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> host <span class="keyword">in</span> hadoop102 hadoop103 hadoop104</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> =============== <span class="variable">$host</span> ===============</span><br><span class="line">        ssh <span class="variable">$host</span> jps </span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>æœ€åè¿›è¡Œå¯åŠ¨åˆ†å‘</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/atguigu/bin</span><br><span class="line">vim jpsall</span><br><span class="line">chmod +x jpsall</span><br><span class="line"></span><br><span class="line">xsync /home/atguigu/bin/</span><br></pre></td></tr></table></figure>
<h3 id="4-9-å¸¸ç”¨ç«¯å£å·è¯´æ˜">4.9 å¸¸ç”¨ç«¯å£å·è¯´æ˜</h3>
<table>
<thead>
<tr>
<th>ç«¯å£åç§°</th>
<th>Hadoop2.x</th>
<th>Hadoop3.x</th>
</tr>
</thead>
<tbody>
<tr>
<td>NameNodeå†…éƒ¨é€šä¿¡ç«¯å£</td>
<td>8020 / 9000</td>
<td>8020 / 9000/9820</td>
</tr>
<tr>
<td>NameNode HTTP UI</td>
<td>50070</td>
<td>9870</td>
</tr>
<tr>
<td>MapReduceæŸ¥çœ‹æ‰§è¡Œä»»åŠ¡ç«¯å£</td>
<td>8088</td>
<td>8088</td>
</tr>
<tr>
<td>å†å²æœåŠ¡å™¨é€šä¿¡ç«¯å£</td>
<td>19888</td>
<td>19888</td>
</tr>
</tbody>
</table>
<h3 id="4-10-é›†ç¾¤æ—¶é—´åŒæ­¥-å¯é€‰">4.10 é›†ç¾¤æ—¶é—´åŒæ­¥(å¯é€‰)</h3>
<blockquote>
<p>å¦‚æœæœåŠ¡å™¨åœ¨å…¬ç½‘ç¯å¢ƒï¼ˆèƒ½è¿æ¥å¤–ç½‘ï¼‰ï¼Œå¯ä»¥ä¸é‡‡ç”¨é›†ç¾¤æ—¶é—´åŒæ­¥ï¼Œå› ä¸ºæœåŠ¡å™¨ä¼šå®šæœŸå’Œå…¬ç½‘æ—¶é—´è¿›è¡Œæ ¡å‡†ï¼›å¦‚æœæœåŠ¡å™¨åœ¨å†…ç½‘ç¯å¢ƒï¼Œå¿…é¡»è¦é…ç½®é›†ç¾¤æ—¶é—´åŒæ­¥ï¼Œå¦åˆ™æ—¶é—´ä¹…äº†ï¼Œä¼šäº§ç”Ÿæ—¶é—´åå·®ï¼Œå¯¼è‡´é›†ç¾¤æ‰§è¡Œä»»åŠ¡æ—¶é—´ä¸åŒæ­¥</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ==================æ—¶é—´æœåŠ¡å™¨é…ç½®ï¼ˆå¿…é¡»rootç”¨æˆ·ï¼‰==============</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹ntpdæœåŠ¡çŠ¶æ€å’Œå¼€æœºè‡ªå¯åŠ¨çŠ¶æ€</span></span><br><span class="line">sudo systemctl status ntpd</span><br><span class="line">sudo systemctl start ntpd</span><br><span class="line">sudo systemctl is-enabled ntpd</span><br><span class="line"><span class="comment"># ä¿®æ”¹hadoop102çš„ntp.confé…ç½®æ–‡ä»¶</span></span><br><span class="line">sudo vim /etc/ntp.conf</span><br><span class="line"><span class="comment"># ä¿®æ”¹å†…å®¹å¦‚ä¸‹</span></span><br><span class="line"><span class="comment"># ä¿®æ”¹1ï¼ˆæˆæƒ192.168.31.0-192.168.31.255ç½‘æ®µä¸Šçš„æ‰€æœ‰æœºå™¨å¯ä»¥ä»è¿™å°æœºå™¨ä¸ŠæŸ¥è¯¢å’ŒåŒæ­¥æ—¶é—´ï¼‰</span></span><br><span class="line"><span class="comment"># restrict 192.168.31.0 mask 255.255.255.0 nomodify notrap è¿™è¡Œæ³¨é‡Šæ‰“å¼€</span></span><br><span class="line"><span class="comment"># ä¿®æ”¹2ï¼ˆé›†ç¾¤åœ¨å±€åŸŸç½‘ä¸­ï¼Œä¸ä½¿ç”¨å…¶ä»–äº’è”ç½‘ä¸Šçš„æ—¶é—´ï¼‰</span></span><br><span class="line"><span class="comment"># æ³¨é‡Šä»¥ä¸‹å››æ¡</span></span><br><span class="line"><span class="comment">#server 0.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 1.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 2.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 3.centos.pool.ntp.org iburst</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹hadoop102çš„/etc/sysconfig/ntpd æ–‡ä»¶</span></span><br><span class="line">sudo vim /etc/sysconfig/ntpd</span><br><span class="line"><span class="comment"># å¢åŠ å†…å®¹å¦‚ä¸‹ï¼ˆè®©ç¡¬ä»¶æ—¶é—´ä¸ç³»ç»Ÿæ—¶é—´ä¸€èµ·åŒæ­¥ï¼‰</span></span><br><span class="line">SYNC_HWCLOCK=yes</span><br><span class="line"><span class="comment"># é‡æ–°å¯åŠ¨ntpdæœåŠ¡</span></span><br><span class="line">sudo systemctl start ntpd</span><br><span class="line"><span class="comment"># è®¾ç½®ntpdæœåŠ¡å¼€æœºå¯åŠ¨</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> ntpd</span><br><span class="line"></span><br><span class="line"><span class="comment"># ========================å…¶ä»–æœºå™¨é…ç½®ï¼ˆå¿…é¡»rootç”¨æˆ·ï¼‰==========</span></span><br><span class="line"><span class="comment"># å…³é—­æ‰€æœ‰èŠ‚ç‚¹ä¸ŠntpæœåŠ¡å’Œè‡ªå¯åŠ¨</span></span><br><span class="line">sudo systemctl stop ntpd</span><br><span class="line">sudo systemctl <span class="built_in">disable</span> ntpd</span><br><span class="line">sudo systemctl stop ntpd</span><br><span class="line">sudo systemctl <span class="built_in">disable</span> ntpd</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨å…¶ä»–æœºå™¨é…ç½®1åˆ†é’Ÿä¸æ—¶é—´æœåŠ¡å™¨åŒæ­¥ä¸€æ¬¡</span></span><br><span class="line">sudo crontab -e</span><br><span class="line">*/1 * * * * /usr/sbin/ntpdate hadoop102</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•ï¼Œä¿®æ”¹ä»»æ„æœºå™¨æ—¶é—´</span></span><br><span class="line">sudo date -s <span class="string">"2023-9-11 11:11:11"</span></span><br><span class="line"><span class="comment"># 1åˆ†é’ŸåæŸ¥çœ‹æœºå™¨æ˜¯å¦ä¸æ—¶é—´æœåŠ¡å™¨åŒæ­¥</span></span><br><span class="line">sudo date</span><br></pre></td></tr></table></figure>
<h1>äºŒã€HDFS</h1>
<h2 id="1ã€HDFSæ¦‚è¿°">1ã€HDFSæ¦‚è¿°</h2>
<h3 id="1-1-ç®€ä»‹-v2">1.1 ç®€ä»‹</h3>
<p>HDFSï¼ˆHadoop Distributed File Systemï¼‰ï¼Œå®ƒæ˜¯ä¸€ä¸ª<strong>æ–‡ä»¶ç³»ç»Ÿ</strong>ï¼Œç”¨äºå­˜å‚¨æ–‡ä»¶ï¼Œé€šè¿‡ç›®å½•æ ‘æ¥å®šä½æ–‡ä»¶ï¼›å…¶æ¬¡å®ƒæ˜¯<strong>åˆ†å¸ƒå¼çš„</strong>ï¼Œç”±å¾ˆå¤šæœåŠ¡å™¨è”åˆèµ·æ¥å®ç°å…¶åŠŸèƒ½ï¼Œé›†ç¾¤ä¸­çš„æœåŠ¡å™¨æœ‰å„è‡ªçš„è§’è‰²ã€‚<strong>HDFSçš„ä½¿ç”¨åœºæ™¯ï¼šé€‚åˆä¸€æ¬¡å†™å…¥ï¼Œå¤šæ¬¡è¯»å‡ºçš„åœºæ™¯</strong>ã€‚ä¸€ä¸ªæ–‡ä»¶ç»è¿‡åˆ›å»ºã€å†™å…¥å’Œå…³é—­ä¹‹åå°±ä¸éœ€è¦æ”¹å˜</p>
<h3 id="1-2-HDFSä¼˜ç¼ºç‚¹">1.2 HDFSä¼˜ç¼ºç‚¹</h3>
<p><strong>ä¼˜ç‚¹</strong></p>
<ul>
<li>é«˜å®¹é”™æ€§ï¼šä¸€ä¸ªæ•°æ®ä¼šè‡ªåŠ¨ä¿å­˜å¤šä¸ªå‰¯æœ¬ï¼ŒæŸä¸ªå‰¯æœ¬ä¸¢å¤±åï¼Œå®ƒå¯ä»¥è‡ªåŠ¨æ¢å¤</li>
<li>é€‚åˆå¤„ç†å¤§æ•°æ®ï¼šæ— è®ºæ˜¯æ•°æ®è§„æ¨¡è¿˜æ˜¯æ–‡ä»¶æ•°é‡è§„æ¨¡å¤§éƒ½å¯ä»¥å¤„ç†</li>
<li>å¯æ„å»ºåœ¨å»‰ä»·çš„æœºå™¨ä¸Š</li>
</ul>
<p><strong>ç¼ºç‚¹</strong></p>
<ul>
<li>
<p>ä¸é€‚åˆä½å»¶è¿Ÿçš„æ•°æ®è®¿é—®ï¼šå¦‚æ¯«ç§’çº§çš„å­˜å‚¨æ•°æ®æ˜¯åšä¸åˆ°çš„</p>
</li>
<li>
<p>æ— æ³•é«˜æ•ˆåœ°å¯¹å¤§é‡å°æ–‡ä»¶è¿›è¡Œå­˜å‚¨ï¼š</p>
<ul>
<li>å­˜å‚¨å¤§é‡å°æ–‡ä»¶æ—¶ï¼Œä¼šå ç”¨NameNodeå¤§é‡å†…å­˜å»å­˜å‚¨æ–‡ä»¶ç›®å½•ä¿¡æ¯å’Œå—ä¿¡æ¯ï¼Œè€ŒNameNodeçš„å†…å­˜æ˜¯æœ‰é™çš„</li>
<li>å°æ–‡ä»¶å­˜å‚¨çš„å¯»å€æ—¶é—´ä¼šè¶…è¿‡è¯»å–æ—¶é—´ï¼Œå®ƒè¿åäº†HDFSçš„è®¾è®¡ç›®æ ‡</li>
</ul>
</li>
<li>
<p>ä¸æ”¯æŒå¹¶å‘å†™å…¥å’Œæ–‡ä»¶çš„éšæœºä¿®æ”¹</p>
<ul>
<li>ä¸å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™åŒä¸€æ–‡ä»¶</li>
<li>ä»…æ”¯æŒæ•°æ®è¿½åŠ ï¼Œä¸æ”¯æŒéšæœºä¿®æ”¹</li>
</ul>
</li>
</ul>
<h3 id="1-3-HDFSç»„æˆæ¶æ„">1.3 HDFSç»„æˆæ¶æ„</h3>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330903.png" alt></p>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330904.png" alt></p>
<h3 id="1-4-HDFSæ–‡ä»¶å—å¤§å°-é¢è¯•é‡ç‚¹">1.4 HDFSæ–‡ä»¶å—å¤§å°(é¢è¯•é‡ç‚¹)</h3>
<p>åœ¨Hadoop1.xä¸­æ–‡ä»¶å—å¤§å°é»˜è®¤ä¸º64Mï¼Œè€Œåœ¨2.xå’Œ3.xä¸­ä¸º128Mã€‚å½“å¯»å€æ—¶é—´ä¸ºä¼ è¾“æ—¶é—´çš„1%æ—¶ä¸ºæœ€ä½³çŠ¶æ€ã€‚æ–‡ä»¶å—çš„å¤§å°å¤ªå°ï¼Œåˆ™ä¼šå¯¼è‡´å¤§æ–‡ä»¶è¢«åˆ†å‰²æˆå¤ªå¤šå—ï¼Œå¢åŠ å¯»å€æ—¶é—´ã€‚è€Œæ–‡ä»¶å—å¤§å°å¤ªå¤§ï¼Œåˆ™ä¼šä½¿å¾—ä¼ è¾“æ—¶é—´è¿œå¤§äºå¯»å€æ—¶é—´ã€‚æ–‡ä»¶å—çš„å¤§å°ä¸»è¦å–å†³äºç£ç›˜çš„ä¼ è¾“é€Ÿç‡</p>
<h2 id="2ã€HDFSçš„Shellæ“ä½œ-é‡ç‚¹">2ã€HDFSçš„Shellæ“ä½œ(é‡ç‚¹)</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¸®åŠ©æŸ¥è¯¢æŸä¸ªå‘½ä»¤</span></span><br><span class="line">hadoop fs -<span class="built_in">help</span> rm</span><br><span class="line"><span class="comment"># åˆ›å»º/sanguoæ–‡ä»¶å¤¹</span></span><br><span class="line">hadoop fs -mkdir /sanguo</span><br><span class="line"></span><br><span class="line"><span class="comment"># ===================ä¸Šä¼ ================</span></span><br><span class="line"><span class="comment"># -moveFromLocalï¼šä»æœ¬åœ°å‰ªåˆ‡ç²˜è´´åˆ°HDFSï¼Œå†…å®¹è‡ªå·±è¾“å…¥</span></span><br><span class="line">vim shuguo.txt</span><br><span class="line">hadoop fs  -moveFromLocal  ./shuguo.txt  /sanguo</span><br><span class="line"><span class="comment"># -copyFromLocalï¼šä»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­æ‹·è´æ–‡ä»¶åˆ°HDFSè·¯å¾„å»</span></span><br><span class="line">vim weiguo.txt</span><br><span class="line">hadoop fs -copyFromLocal weiguo.txt /sanguo</span><br><span class="line"><span class="comment"># -putï¼šç­‰åŒäºcopyFromLocalï¼Œç”Ÿäº§ç¯å¢ƒæ›´ä¹ æƒ¯ç”¨put</span></span><br><span class="line">vim wuguo.txt</span><br><span class="line">hadoop fs -put ./wuguo.txt /sanguo</span><br><span class="line"><span class="comment"># -appendToFileï¼šè¿½åŠ ä¸€ä¸ªæ–‡ä»¶åˆ°å·²ç»å­˜åœ¨çš„æ–‡ä»¶æœ«å°¾</span></span><br><span class="line">vim liubei.txt</span><br><span class="line">hadoop fs -appendToFile liubei.txt /sanguo/shuguo.txt</span><br><span class="line"><span class="comment"># ==================ä¸‹è½½==================</span></span><br><span class="line"><span class="comment"># -copyToLocalï¼šä»HDFSæ‹·è´åˆ°æœ¬åœ°</span></span><br><span class="line">hadoop fs -copyToLocal /sanguo/shuguo.txt ./</span><br><span class="line"><span class="comment"># -getï¼šç­‰åŒäºcopyToLocalï¼Œç”Ÿäº§ç¯å¢ƒæ›´ä¹ æƒ¯ç”¨get</span></span><br><span class="line">hadoop fs -get /sanguo/shuguo.txt ./shuguo2.txt</span><br><span class="line"><span class="comment"># ===================HDFSç›´æ¥æ“ä½œ==============</span></span><br><span class="line"><span class="comment"># -ls: æ˜¾ç¤ºç›®å½•ä¿¡æ¯</span></span><br><span class="line">hadoop fs -ls /sanguo</span><br><span class="line"><span class="comment"># -catï¼šæ˜¾ç¤ºæ–‡ä»¶å†…å®¹</span></span><br><span class="line">hadoop fs -cat /sanguo/shuguo.txt</span><br><span class="line"><span class="comment"># -chgrpã€-chmodã€-chownï¼šLinuxæ–‡ä»¶ç³»ç»Ÿä¸­çš„ç”¨æ³•ä¸€æ ·ï¼Œä¿®æ”¹æ–‡ä»¶æ‰€å±æƒé™</span></span><br><span class="line">hadoop fs -chmod 666 /sanguo/shuguo.txt</span><br><span class="line">hadoop fs -chown atguigu:atguigu /sanguo/shuguo.txt</span><br><span class="line"><span class="comment"># -mkdirï¼šåˆ›å»ºè·¯å¾„</span></span><br><span class="line">hadoop fs -mkdir /jinguo</span><br><span class="line">hadoop fs -mkdir -p /jinguo</span><br><span class="line"><span class="comment"># -cpï¼šä»HDFSçš„ä¸€ä¸ªè·¯å¾„æ‹·è´åˆ°HDFSçš„å¦ä¸€ä¸ªè·¯å¾„</span></span><br><span class="line">hadoop fs -cp /sanguo/shuguo.txt /jinguo</span><br><span class="line"><span class="comment"># -mvï¼šåœ¨HDFSç›®å½•ä¸­ç§»åŠ¨æ–‡ä»¶</span></span><br><span class="line">hadoop fs -mv /sanguo/wuguo.txt /jinguo</span><br><span class="line">hadoop fs -mv /sanguo/weiguo.txt /jinguo</span><br><span class="line"><span class="comment"># -tailï¼šæ˜¾ç¤ºä¸€ä¸ªæ–‡ä»¶çš„æœ«å°¾1kbçš„æ•°æ®</span></span><br><span class="line">hadoop fs -tail /jinguo/shuguo.txt</span><br><span class="line"><span class="comment"># -rmï¼šåˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹</span></span><br><span class="line">hadoop fs -rm /sanguo/shuguo.txt</span><br><span class="line"><span class="comment"># -rm -rï¼šé€’å½’åˆ é™¤ç›®å½•åŠç›®å½•é‡Œé¢å†…å®¹ï¼›-få¼ºåˆ¶åˆ é™¤</span></span><br><span class="line">hadoop fs -rm -r /sanguo</span><br><span class="line"><span class="comment"># -duç»Ÿè®¡æ–‡ä»¶å¤¹çš„å¤§å°ä¿¡æ¯</span></span><br><span class="line">hadoop fs -du -s -h /jinguo</span><br><span class="line">hadoop fs -du  -h /jinguo</span><br><span class="line"><span class="comment"># -setrepï¼šè®¾ç½®HDFSä¸­æ–‡ä»¶çš„å‰¯æœ¬æ•°é‡</span></span><br><span class="line"><span class="comment"># è¿™ä¹ˆå¤šå‰¯æœ¬ï¼Œè¿˜å¾—çœ‹DataNodeçš„æ•°é‡ã€‚å› ä¸ºç›®å‰åªæœ‰3å°è®¾å¤‡ï¼Œæœ€å¤šä¹Ÿå°±3ä¸ªå‰¯æœ¬ï¼Œåªæœ‰èŠ‚ç‚¹æ•°çš„å¢åŠ åˆ°10å°æ—¶ï¼Œå‰¯æœ¬æ•°æ‰èƒ½è¾¾åˆ°10</span></span><br><span class="line">hadoop fs -setrep 10 /jinguo/shuguo.txt</span><br><span class="line"><span class="comment"># æŸ¥è¯¢è¿™ä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨å°±è¿”å›0ï¼Œä¸å­˜åœ¨è¿”å›1ï¼Œ</span></span><br><span class="line">hadoop fs -<span class="built_in">test</span> -e /jinguo</span><br><span class="line"><span class="comment"># æŸ¥è¯¢è¯¥è·¯å¾„ä¸‹çš„æ–‡ä»¶å¤¹æ•°é‡ï¼Œæ–‡ä»¶æ•°é‡ï¼Œå’Œæ–‡ä»¶æ€»å¤§å°</span></span><br><span class="line">hadoop fs -count /jinguo</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŸä¸ªå‹ç¼©æ–‡ä»¶çš„å†…å®¹</span></span><br><span class="line">hadoop fs -cat /origin_data/gmall/<span class="built_in">log</span>/topic_log/2020-06-14/* | zcat</span><br></pre></td></tr></table></figure>
<h2 id="3ã€HDFSçš„APIæ“ä½œ">3ã€HDFSçš„APIæ“ä½œ</h2>
<h3 id="3-1-ç¯å¢ƒå‡†å¤‡">3.1 ç¯å¢ƒå‡†å¤‡</h3>
<p>windowsè¦å¯åŠ¨hadooopï¼Œé¦–å…ˆè¿›å»<a href="https://github.com/cdarlint/winutils" target="_blank" rel="noopener" title="githubå®˜ç½‘">githubå®˜ç½‘</a>ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„hadoopï¼Œè¿™é‡Œæˆ‘ä¸‹è½½äº†3.1.0ï¼Œä¸‹è½½å®Œæˆåå°†è·¯å¾„çš„binç›®å½•æ”¾å…¥ç”µè„‘çš„ç¯å¢ƒå˜é‡ï¼›éªŒè¯Hadoopç¯å¢ƒå˜é‡æ˜¯å¦æ­£å¸¸ï¼ŒåŒå‡»winutils.exeï¼Œå¦‚æœæ— æŠ¥é”™å³æ­£å¸¸(æŠ¥é”™å¤§æ¦‚ç‡æ²¡æœ‰å¾®è½¯è¿è¡Œåº“ï¼Œå®‰è£…ä¸€ä¸‹å³å¯ï¼Œè¿˜ä¸è¡Œé‡å¯è¯•è¯•)</p>
<p>åœ¨IDEAä¸­åˆ›å»ºä¸€ä¸ªMavenå·¥ç¨‹HdfsClientDemoï¼Œå¹¶å¯¼å…¥ç›¸åº”çš„ä¾èµ–åæ ‡</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨é¡¹ç›®çš„src/main/resourcesç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå‘½åä¸º&quot;log4j.properties&quot;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">log4j.rootLogger&#x3D;INFO, stdout  </span><br><span class="line">log4j.appender.stdout&#x3D;org.apache.log4j.ConsoleAppender  </span><br><span class="line">log4j.appender.stdout.layout&#x3D;org.apache.log4j.PatternLayout  </span><br><span class="line">log4j.appender.stdout.layout.ConversionPattern&#x3D;%d %p [%c] - %m%n  </span><br><span class="line">log4j.appender.logfile&#x3D;org.apache.log4j.FileAppender  </span><br><span class="line">log4j.appender.logfile.File&#x3D;target&#x2F;spring.log  </span><br><span class="line">log4j.appender.logfile.layout&#x3D;org.apache.log4j.PatternLayout  </span><br><span class="line">log4j.appender.logfile.layout.ConversionPattern&#x3D;%d %p [%c] - %m%n</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºåŒ…åï¼šcom.atguigu.hdfsï¼Œåˆ›å»ºHdfsClientç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HdfsClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMkdirs</span><span class="params">()</span> <span class="keyword">throws</span> IOException, URISyntaxException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1 è·å–æ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line">        Configuration configuration = <span class="keyword">new</span> Configuration();</span><br><span class="line">        <span class="comment">// é»˜è®¤ä½¿ç”¨windowsç”¨æˆ·åï¼Œè¦é…ç½®ç”¨æˆ·</span></span><br><span class="line">        <span class="comment">// FileSystem fs = FileSystem.get(new URI("hdfs://hadoop102:8020"), configuration);</span></span><br><span class="line">        FileSystem fs = FileSystem.get(<span class="keyword">new</span> URI(<span class="string">"hdfs://hadoop102:8020"</span>), configuration,<span class="string">"atguigu"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 åˆ›å»ºç›®å½•</span></span><br><span class="line">        fs.mkdirs(<span class="keyword">new</span> Path(<span class="string">"/xiyou/huaguoshan/"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3 å…³é—­èµ„æº</span></span><br><span class="line">        fs.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-HDFSçš„APIæ¡ˆä¾‹å®æ“">3.2 HDFSçš„APIæ¡ˆä¾‹å®æ“</h3>
<p>** HDFSæ–‡ä»¶ä¸Šä¼ ï¼ˆæµ‹è¯•å‚æ•°ä¼˜å…ˆçº§ï¼‰**</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCopyFromLocalFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException, URISyntaxException </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1 è·å–æ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line">    Configuration configuration = <span class="keyword">new</span> Configuration();</span><br><span class="line">    configuration.set(<span class="string">"dfs.replication"</span>, <span class="string">"2"</span>);</span><br><span class="line">    FileSystem fs = FileSystem.get(<span class="keyword">new</span> URI(<span class="string">"hdfs://hadoop102:8020"</span>), configuration, <span class="string">"atguigu"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2 ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line">    fs.copyFromLocalFile(<span class="keyword">new</span> Path(<span class="string">"d:/sunwukong.txt"</span>), <span class="keyword">new</span> Path(<span class="string">"/xiyou/huaguoshan"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3 å…³é—­èµ„æº</span></span><br><span class="line">    fs.close();</span><br><span class="line">ï½</span><br></pre></td></tr></table></figure>
<p>å°†<code>hdfs-site.xml</code>æ‹·è´åˆ°é¡¹ç›®çš„resourcesèµ„æºç›®å½•ä¸‹ï¼Œæµ‹è¯•å‘ç°å‚æ•°ä¼˜å…ˆçº§æ’åºï¼šï¼ˆ1ï¼‰å®¢æˆ·ç«¯ä»£ç ä¸­è®¾ç½®çš„å€¼ &gt;ï¼ˆ2ï¼‰ClassPathä¸‹çš„ç”¨æˆ·è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ &gt;ï¼ˆ3ï¼‰ç„¶åæ˜¯æœåŠ¡å™¨çš„è‡ªå®šä¹‰é…ç½®ï¼ˆxxx-site.xmlï¼‰ &gt;ï¼ˆ4ï¼‰æœåŠ¡å™¨çš„é»˜è®¤é…ç½®ï¼ˆxxx-default.xmlï¼‰</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥å¸¸è§„APIç¼–å†™</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//HDFSæ–‡ä»¶ä¸‹è½½</span></span><br><span class="line"><span class="comment">//æ³¨æ„ï¼šå¦‚æœæ‰§è¡Œä¸Šé¢ä»£ç ï¼Œä¸‹è½½ä¸äº†æ–‡ä»¶ï¼Œæœ‰å¯èƒ½æ˜¯ä½ ç”µè„‘çš„å¾®è½¯æ”¯æŒçš„è¿è¡Œåº“å°‘ï¼Œéœ€è¦å®‰è£…ä¸€ä¸‹å¾®è½¯è¿è¡Œåº“</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCopyToLocalFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException, URISyntaxException</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1 è·å–æ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line">    Configuration configuration = <span class="keyword">new</span> Configuration();</span><br><span class="line">    FileSystem fs = FileSystem.get(<span class="keyword">new</span> URI(<span class="string">"hdfs://hadoop102:8020"</span>), configuration, <span class="string">"atguigu"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2 æ‰§è¡Œä¸‹è½½æ“ä½œ</span></span><br><span class="line">    <span class="comment">// boolean delSrc æŒ‡æ˜¯å¦å°†åŸæ–‡ä»¶åˆ é™¤</span></span><br><span class="line">    <span class="comment">// Path src æŒ‡è¦ä¸‹è½½çš„æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">    <span class="comment">// Path dst æŒ‡å°†æ–‡ä»¶ä¸‹è½½åˆ°çš„è·¯å¾„</span></span><br><span class="line">    <span class="comment">// boolean useRawLocalFileSystem æ˜¯å¦å¼€å¯æ–‡ä»¶æ ¡éªŒ</span></span><br><span class="line">    fs.copyToLocalFile(<span class="keyword">false</span>, <span class="keyword">new</span> Path(<span class="string">"/xiyou/huaguoshan/sunwukong.txt"</span>), <span class="keyword">new</span> Path(<span class="string">"d:/sunwukong2.txt"</span>), <span class="keyword">true</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3 å…³é—­èµ„æº</span></span><br><span class="line">    fs.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//HDFSæ–‡ä»¶æ›´åå’Œç§»åŠ¨</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testRename</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException, URISyntaxException</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1 è·å–æ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line">  Configuration configuration = <span class="keyword">new</span> Configuration();</span><br><span class="line">  FileSystem fs = FileSystem.get(<span class="keyword">new</span> URI(<span class="string">"hdfs://hadoop102:8020"</span>), configuration, <span class="string">"atguigu"</span>); </span><br><span class="line">  <span class="comment">// æ–‡ä»¶å¤¹ä¹Ÿæ˜¯åŒç†æ›´å</span></span><br><span class="line">  <span class="comment">// 2 ä¿®æ”¹æ–‡ä»¶åç§°</span></span><br><span class="line">  fs.rename(<span class="keyword">new</span> Path(<span class="string">"/xiyou/huaguoshan/sunwukong.txt"</span>), <span class="keyword">new</span> Path(<span class="string">"/xiyou/huaguoshan/meihouwang.txt"</span>));</span><br><span class="line">    </span><br><span class="line">  <span class="comment">// 3 å…³é—­èµ„æº</span></span><br><span class="line">  fs.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//HDFSåˆ é™¤æ–‡ä»¶å’Œç›®å½•</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException, URISyntaxException</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1 è·å–æ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line">  Configuration configuration = <span class="keyword">new</span> Configuration();</span><br><span class="line">  FileSystem fs = FileSystem.get(<span class="keyword">new</span> URI(<span class="string">"hdfs://hadoop102:8020"</span>), configuration, <span class="string">"atguigu"</span>);</span><br><span class="line">    </span><br><span class="line">  <span class="comment">// 2 æ‰§è¡Œåˆ é™¤</span></span><br><span class="line">  fs.delete(<span class="keyword">new</span> Path(<span class="string">"/xiyou"</span>), <span class="keyword">true</span>);</span><br><span class="line">    </span><br><span class="line">  <span class="comment">// 3 å…³é—­èµ„æº</span></span><br><span class="line">  fs.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//HDFSæ–‡ä»¶è¯¦æƒ…æŸ¥çœ‹</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testListFiles</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException, URISyntaxException </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1è·å–æ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line">  Configuration configuration = <span class="keyword">new</span> Configuration();</span><br><span class="line">  FileSystem fs = FileSystem.get(<span class="keyword">new</span> URI(<span class="string">"hdfs://hadoop102:8020"</span>), configuration, <span class="string">"atguigu"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2 è·å–æ–‡ä»¶è¯¦æƒ…</span></span><br><span class="line">  RemoteIterator&lt;LocatedFileStatus&gt; listFiles = fs.listFiles(<span class="keyword">new</span> Path(<span class="string">"/"</span>),<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (listFiles.hasNext()) &#123;</span><br><span class="line">    LocatedFileStatus fileStatus = listFiles.next();</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"========"</span> + fileStatus.getPath() + <span class="string">"========="</span>);</span><br><span class="line">    System.out.println(fileStatus.getPermission());</span><br><span class="line">    System.out.println(fileStatus.getOwner());</span><br><span class="line">    System.out.println(fileStatus.getGroup());</span><br><span class="line">    System.out.println(fileStatus.getLen());</span><br><span class="line">    System.out.println(fileStatus.getModificationTime());</span><br><span class="line">    System.out.println(fileStatus.getReplication());</span><br><span class="line">    System.out.println(fileStatus.getBlockSize());</span><br><span class="line">    System.out.println(fileStatus.getPath().getName());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å—ä¿¡æ¯</span></span><br><span class="line">    BlockLocation[] blockLocations = fileStatus.getBlockLocations();</span><br><span class="line">    System.out.println(Arrays.toString(blockLocations));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 3 å…³é—­èµ„æº</span></span><br><span class="line">  fs.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//HDFSæ–‡ä»¶å’Œæ–‡ä»¶å¤¹åˆ¤æ–­</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testListStatus</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException, URISyntaxException</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1 è·å–æ–‡ä»¶é…ç½®ä¿¡æ¯</span></span><br><span class="line">    Configuration configuration = <span class="keyword">new</span> Configuration();</span><br><span class="line">    FileSystem fs = FileSystem.get(<span class="keyword">new</span> URI(<span class="string">"hdfs://hadoop102:8020"</span>), configuration, <span class="string">"atguigu"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2 åˆ¤æ–­æ˜¯æ–‡ä»¶è¿˜æ˜¯æ–‡ä»¶å¤¹</span></span><br><span class="line">    FileStatus[] listStatus = fs.listStatus(<span class="keyword">new</span> Path(<span class="string">"/"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (FileStatus fileStatus : listStatus) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœæ˜¯æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> (fileStatus.isFile()) &#123;</span><br><span class="line">            System.out.println(<span class="string">"f:"</span>+fileStatus.getPath().getName());</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"d:"</span>+fileStatus.getPath().getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3 å…³é—­èµ„æº</span></span><br><span class="line">    fs.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4ã€HDFSçš„è¯»å†™æµç¨‹-é¢è¯•é‡ç‚¹">4ã€HDFSçš„è¯»å†™æµç¨‹(é¢è¯•é‡ç‚¹)</h2>
<h3 id="4-1-HDFS-å†™æ•°æ®æµç¨‹">4.1 HDFS å†™æ•°æ®æµç¨‹</h3>
<ul>
<li>å®¢æˆ·ç«¯é€šè¿‡Distributed FileSystemæ¨¡å—å‘NameNodeè¯·æ±‚ä¸Šä¼ æ–‡ä»¶ï¼ŒNameNodeæ£€æŸ¥ç›®æ ‡æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨ï¼Œçˆ¶ç›®å½•æ˜¯å¦å­˜åœ¨</li>
<li>NameNodeè¿”å›æ˜¯å¦å¯ä»¥ä¸Šä¼ </li>
<li>å®¢æˆ·ç«¯è¯·æ±‚ç¬¬ä¸€ä¸ª Blockä¸Šä¼ åˆ°å“ªå‡ ä¸ªDataNodeæœåŠ¡å™¨ä¸Š</li>
<li>NameNodeè¿”å›3ä¸ªDataNodeèŠ‚ç‚¹ï¼Œåˆ†åˆ«ä¸ºdn1ã€dn2ã€dn3</li>
<li>å®¢æˆ·ç«¯é€šè¿‡FSDataOutputStreamæ¨¡å—è¯·æ±‚dn1ä¸Šä¼ æ•°æ®ï¼Œdn1æ”¶åˆ°è¯·æ±‚ä¼šç»§ç»­è°ƒç”¨dn2ï¼Œç„¶ådn2è°ƒç”¨dn3ï¼Œå°†è¿™ä¸ªé€šä¿¡ç®¡é“å»ºç«‹å®Œæˆ</li>
<li>dn1ã€dn2ã€dn3é€çº§åº”ç­”å®¢æˆ·ç«¯</li>
<li>å®¢æˆ·ç«¯å¼€å§‹å¾€dn1ä¸Šä¼ ç¬¬ä¸€ä¸ªBlockï¼ˆå…ˆä»ç£ç›˜è¯»å–æ•°æ®æ”¾åˆ°ä¸€ä¸ªæœ¬åœ°å†…å­˜ç¼“å­˜ï¼‰ï¼Œä»¥Packetä¸ºå•ä½ï¼Œdn1æ”¶åˆ°ä¸€ä¸ªPacketå°±ä¼šä¼ ç»™dn2ï¼Œdn2ä¼ ç»™dn3ï¼›dn1æ¯ä¼ ä¸€ä¸ªpacketä¼šæ”¾å…¥ä¸€ä¸ªåº”ç­”é˜Ÿåˆ—ç­‰å¾…åº”ç­”</li>
<li>å½“ä¸€ä¸ªBlockä¼ è¾“å®Œæˆä¹‹åï¼Œå®¢æˆ·ç«¯å†æ¬¡è¯·æ±‚NameNodeä¸Šä¼ ç¬¬äºŒä¸ªBlockçš„æœåŠ¡å™¨ã€‚ï¼ˆé‡å¤æ‰§è¡Œ3-7æ­¥ï¼‰</li>
</ul>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330905.png" alt></p>
<p>å¯¹äº<strong>ç½‘ç»œæ‹“æ‰‘-èŠ‚ç‚¹è·ç¦»è®¡ç®—</strong>ï¼Œåœ¨HDFSå†™æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼ŒNameNodeä¼šé€‰æ‹©è·ç¦»å¾…ä¸Šä¼ æ•°æ®æœ€è¿‘è·ç¦»çš„DataNodeæ¥æ”¶æ•°æ®ï¼Œ<strong>èŠ‚ç‚¹è·ç¦»ï¼šä¸¤ä¸ªèŠ‚ç‚¹åˆ°è¾¾æœ€è¿‘çš„å…±åŒç¥–å…ˆçš„è·ç¦»æ€»å’Œã€‚</strong></p>
<p>å¯¹äº<strong>æœºæ¶æ„ŸçŸ¥ï¼ˆå‰¯æœ¬å­˜å‚¨èŠ‚ç‚¹é€‰æ‹©ï¼‰</strong>ï¼Œå¯ä»¥æŸ¥çœ‹<a href="http://hadoop.apache.org/docs/r3.1.3/hadoop-project-dist/hadoop-hdfs/HdfsDesign.html#Data_Replication" target="_blank" rel="noopener" title="å®˜æ–¹æ‰‹å†Œ">å®˜æ–¹æ‰‹å†Œ</a>ï¼Œ<code>Crtl + n </code>æŸ¥æ‰¾<code>BlockPlacementPolicyDefault</code>ï¼Œåœ¨è¯¥ç±»ä¸­æŸ¥æ‰¾<code>chooseTargetInOrder</code>æ–¹æ³•</p>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330906.png" alt></p>
<h3 id="4-2-HDFS-è¯»æ•°æ®æµç¨‹">4.2 HDFS è¯»æ•°æ®æµç¨‹</h3>
<ul>
<li>å®¢æˆ·ç«¯é€šè¿‡ DistributedFileSystem å‘ NameNode è¯·æ±‚ä¸‹è½½æ–‡ä»¶ï¼ŒNameNode é€šè¿‡æŸ¥è¯¢å…ƒæ•°æ®ï¼Œæ‰¾åˆ°æ–‡ä»¶å—æ‰€åœ¨çš„ DataNode åœ°å€</li>
<li>æŒ‘é€‰ä¸€å° DataNodeï¼ˆå°±è¿‘åŸåˆ™ï¼Œç„¶åéšæœºï¼‰æœåŠ¡å™¨ï¼Œè¯·æ±‚è¯»å–æ•°æ®</li>
<li>DataNode å¼€å§‹ä¼ è¾“æ•°æ®ç»™å®¢æˆ·ç«¯ï¼ˆä»ç£ç›˜é‡Œé¢è¯»å–æ•°æ®è¾“å…¥æµï¼Œä»¥ Packet ä¸ºå•ä½æ¥åšæ ¡éªŒï¼‰</li>
<li>å®¢æˆ·ç«¯ä»¥ Packet ä¸ºå•ä½æ¥æ”¶ï¼Œå…ˆåœ¨æœ¬åœ°ç¼“å­˜ï¼Œç„¶åå†™å…¥ç›®æ ‡æ–‡ä»¶</li>
</ul>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330907.png" alt></p>
<h2 id="5ã€NameNode-å’Œ-SecondaryNameNode">5ã€NameNode å’Œ SecondaryNameNode</h2>
<h3 id="5-1-NNå’Œ2NNå·¥ä½œæœºåˆ¶">5.1 NNå’Œ2NNå·¥ä½œæœºåˆ¶</h3>
<p>NameNode ä¸­çš„å…ƒæ•°æ®æ˜¯å­˜å‚¨åœ¨å“ªé‡Œçš„ï¼Ÿå¦‚æœåªå­˜åœ¨å†…å­˜ä¸­ï¼Œä¸€æ—¦æ–­ç”µï¼Œå…ƒæ•°æ®ä¸¢å¤±ï¼Œæ•´ä¸ªé›†ç¾¤å°±æ— æ³•å·¥ä½œäº†ã€‚å› æ­¤<strong>äº§ç”Ÿåœ¨ç£ç›˜ä¸­å¤‡ä»½å…ƒæ•°æ®çš„FsImage</strong>ã€‚ä¸ºäº†é˜²æ­¢NameNode èŠ‚ç‚¹æ–­ç”µï¼Œå°±ä¼šäº§ç”Ÿæ•°æ®ä¸¢å¤±ã€‚<strong>å¼•å…¥ Edits æ–‡ä»¶ï¼ˆåªè¿›è¡Œè¿½åŠ æ“ä½œï¼Œæ•ˆç‡å¾ˆé«˜ï¼‰ã€‚æ¯å½“å…ƒæ•°æ®æœ‰æ›´æ–°æˆ–è€…æ·»åŠ å…ƒæ•°æ®æ—¶ï¼Œä¿®æ”¹å†…å­˜ä¸­çš„å…ƒæ•°æ®å¹¶è¿½åŠ åˆ° Edits ä¸­</strong>ã€‚è¿™æ ·ï¼Œä¸€æ—¦ NameNode èŠ‚ç‚¹æ–­ç”µï¼Œå¯ä»¥<strong>é€šè¿‡ FsImage å’Œ Edits çš„åˆå¹¶ï¼Œåˆæˆå…ƒæ•°æ®</strong>ã€‚è€Œæ–°çš„èŠ‚ç‚¹SecondaryNamenodeï¼Œä¸“é—¨ç”¨äºFsImageå’ŒEditsçš„åˆå¹¶</p>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330908.png" alt></p>
<h3 id="5-2-Fsimageå’ŒEditsè§£æ">5.2 Fsimageå’ŒEditsè§£æ</h3>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330909.png" alt></p>
<p>å¦å¤–ä¼šç”Ÿæˆä¸¤ä¸ªfsimageï¼Œå…¶ä¸­å¦ä¸€ä¸ªæ˜¯åœ¨ Secondary NameNode ä¸Šç”Ÿæˆçš„ Checkpoint æ–‡ä»¶ï¼Œå®ƒè®°å½•äº†ä¸Šä¸€æ¬¡åˆå¹¶çš„æ–‡ä»¶ç³»ç»ŸçŠ¶æ€ä¿¡æ¯ã€‚æŸ¥çœ‹Fsimagesæ–‡ä»¶å’ŒEditsæ–‡ä»¶å¦‚ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># =====================oivæŸ¥çœ‹Fsimageæ–‡ä»¶=================</span></span><br><span class="line"><span class="comment"># åŸºæœ¬è¯­æ³•</span></span><br><span class="line">hdfs oiv -p æ–‡ä»¶ç±»å‹ -ié•œåƒæ–‡ä»¶ -o è½¬æ¢åæ–‡ä»¶è¾“å‡ºè·¯å¾„</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ˜¾ç¤ºçš„xmlæ–‡ä»¶å†…å®¹æ‹·è´åˆ°Ideaä¸­åˆ›å»ºçš„xmlæ–‡ä»¶ä¸­ï¼Œå¹¶æ ¼å¼åŒ–</span></span><br><span class="line"><span class="built_in">cd</span> /opt/module/hadoop-3.1.3/data/dfs/name/current</span><br><span class="line">hdfs oiv -p XML -i fsimage_0000000000000000025 -o /opt/module/hadoop-3.1.3/fsimage.xml</span><br><span class="line">cat /opt/module/hadoop-3.1.3/fsimage.xml</span><br><span class="line"><span class="comment"># å¯ä»¥çœ‹å‡ºï¼ŒFsimageä¸­æ²¡æœ‰è®°å½•å—æ‰€å¯¹åº”DataNode,å› ä¸ºåœ¨é›†ç¾¤å¯åŠ¨åï¼Œè¦æ±‚DataNodeä¸ŠæŠ¥æ•°æ®å—ä¿¡æ¯ï¼Œå¹¶é—´éš”ä¸€æ®µæ—¶é—´åå†æ¬¡ä¸ŠæŠ¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ======================oevæŸ¥çœ‹Editsæ–‡ä»¶=================</span></span><br><span class="line"><span class="comment"># åŸºæœ¬è¯­æ³•</span></span><br><span class="line">hdfs oev -p æ–‡ä»¶ç±»å‹ -iç¼–è¾‘æ—¥å¿— -o è½¬æ¢åæ–‡ä»¶è¾“å‡ºè·¯å¾„</span><br><span class="line">hdfs oev -p XML -i edits_0000000000000000012-0000000000000000013 -o /opt/module/hadoop-3.1.3/edits.xml</span><br><span class="line">cat /opt/module/hadoop-3.1.3/edits.xml</span><br><span class="line"><span class="comment"># NameNodeå¦‚ä½•ç¡®å®šä¸‹æ¬¡å¼€æœºå¯åŠ¨çš„æ—¶å€™åˆå¹¶å“ªäº›Editsï¼Ÿæ˜¯æ ¹æ®fsimageså·å¤§äºçš„è¿›è¡Œåˆå¹¶</span></span><br></pre></td></tr></table></figure>
<h3 id="5-3-CheckPointæ—¶é—´è®¾ç½®">5.3 CheckPointæ—¶é—´è®¾ç½®</h3>
<ul>
<li>é€šå¸¸æƒ…å†µä¸‹ï¼ŒSecondaryNameNodeæ¯éš”ä¸€å°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œé…ç½®æ–‡ä»¶åœ¨<code>[hdfs-default.xml]</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.checkpoint.period<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>3600s<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸€åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ“ä½œæ¬¡æ•°ï¼Œå½“æ“ä½œæ¬¡æ•°è¾¾åˆ°1ç™¾ä¸‡æ—¶ï¼ŒSecondaryNameNodeæ‰§è¡Œä¸€æ¬¡</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.checkpoint.txns<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>1000000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>æ“ä½œåŠ¨ä½œæ¬¡æ•°<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.checkpoint.check.period<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>60s<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span> 1åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ“ä½œæ¬¡æ•°<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="6ã€DataNode">6ã€DataNode</h2>
<h3 id="6-1-DataNodeå·¥ä½œæœºåˆ¶">6.1 DataNodeå·¥ä½œæœºåˆ¶</h3>
<ul>
<li>ä¸€ä¸ªæ•°æ®å—åœ¨DataNodeä¸Šä»¥æ–‡ä»¶å½¢å¼å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼ŒåŒ…æ‹¬ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯æ•°æ®æœ¬èº«ï¼Œä¸€ä¸ªæ˜¯å…ƒæ•°æ®åŒ…æ‹¬æ•°æ®å—çš„é•¿åº¦ï¼Œå—æ•°æ®çš„æ ¡éªŒå’Œï¼Œä»¥åŠæ—¶é—´æˆ³</li>
<li>DataNodeå¯åŠ¨åå‘NameNodeæ³¨å†Œï¼Œé€šè¿‡åï¼Œå‘¨æœŸæ€§ï¼ˆ6å°æ—¶ï¼‰çš„å‘NameNodeä¸ŠæŠ¥æ‰€æœ‰çš„å—ä¿¡æ¯ã€‚</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--DNå‘NNæ±‡æŠ¥å½“å‰è§£è¯»ä¿¡æ¯çš„æ—¶é—´é—´éš”ï¼Œé»˜è®¤6å°æ—¶--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.blockreport.intervalMsec<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>21600000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Determines block reporting interval in milliseconds.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--DNæ‰«æè‡ªå·±èŠ‚ç‚¹å—ä¿¡æ¯åˆ—è¡¨çš„æ—¶é—´ï¼Œé»˜è®¤6å°æ—¶--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.directoryscan.interval<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>21600s<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Interval in seconds for Datanode to scan data directories and reconcile the difference between blocks in memory and on the disk.</span><br><span class="line">  Support multiple time unit suffix(case insensitive), as described</span><br><span class="line">  in dfs.heartbeat.interval.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å¿ƒè·³æ˜¯æ¯3ç§’ä¸€æ¬¡ï¼Œå¿ƒè·³è¿”å›ç»“æœå¸¦æœ‰NameNodeç»™è¯¥DataNodeçš„å‘½ä»¤å¦‚å¤åˆ¶å—æ•°æ®åˆ°å¦ä¸€å°æœºå™¨ï¼Œæˆ–åˆ é™¤æŸä¸ªæ•°æ®å—ã€‚å¦‚æœè¶…è¿‡10åˆ†é’Ÿæ²¡æœ‰æ”¶åˆ°æŸä¸ªDataNodeçš„å¿ƒè·³ï¼Œåˆ™è®¤ä¸ºè¯¥èŠ‚ç‚¹ä¸å¯ç”¨</li>
<li>é›†ç¾¤è¿è¡Œä¸­å¯ä»¥å®‰å…¨åŠ å…¥å’Œé€€å‡ºä¸€äº›æœºå™¨</li>
</ul>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330910.png" alt></p>
<h3 id="6-2-æ•°æ®å®Œæ•´æ€§">6.2 æ•°æ®å®Œæ•´æ€§</h3>
<ul>
<li>å½“DataNodeè¯»å–Blockçš„æ—¶å€™ï¼Œå®ƒä¼šè®¡ç®—CheckSum</li>
<li>å¦‚æœè®¡ç®—åçš„CheckSumï¼Œä¸Blockåˆ›å»ºæ—¶å€¼ä¸ä¸€æ ·ï¼Œè¯´æ˜Blockå·²ç»æŸå</li>
<li>Clientè¯»å–å…¶ä»–DataNodeä¸Šçš„Block</li>
<li>å¸¸è§çš„æ ¡éªŒç®—æ³•crcï¼ˆ32ï¼‰ï¼Œmd5ï¼ˆ128ï¼‰ï¼Œsha1ï¼ˆ160ï¼‰</li>
<li>DataNodeåœ¨å…¶æ–‡ä»¶åˆ›å»ºåå‘¨æœŸéªŒè¯CheckSum</li>
</ul>
<h3 id="6-3-æ‰çº¿æ—¶é™å‚æ•°è®¾ç½®">6.3 æ‰çº¿æ—¶é™å‚æ•°è®¾ç½®</h3>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330911.png" alt></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯hdfs-site.xml é…ç½®æ–‡ä»¶ä¸­çš„heartbeat.recheck.intervalçš„å•ä½ä¸ºæ¯«ç§’ï¼Œdfs.heartbeat.intervalçš„å•ä½ä¸ºç§’</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.heartbeat.recheck-interval<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>300000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.heartbeat.interval<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1>ä¸‰ã€MapReduce</h1>
<h2 id="1ã€MapReduceæ¦‚è¿°">1ã€MapReduceæ¦‚è¿°</h2>
<h3 id="1-1-MapReduceå®šä¹‰">1.1 MapReduceå®šä¹‰</h3>
<p>MapReduceæ˜¯ä¸€ä¸ª<strong>åˆ†å¸ƒå¼è¿ç®—ç¨‹åº</strong>çš„ç¼–ç¨‹æ¡†æ¶ï¼Œæ˜¯ç”¨æˆ·å¼€å‘&quot;åŸºäºHadoopçš„æ•°æ®åˆ†æåº”ç”¨&quot;çš„æ ¸å¿ƒæ¡†æ¶ã€‚MapReduceæ ¸å¿ƒåŠŸèƒ½æ˜¯å°†ç”¨æˆ·ç¼–å†™çš„ä¸šåŠ¡é€»è¾‘ä»£ç å’Œè‡ªå¸¦é»˜è®¤ç»„ä»¶æ•´åˆæˆä¸€ä¸ªå®Œæ•´çš„åˆ†å¸ƒå¼è¿ç®—ç¨‹åºï¼Œå¹¶å‘è¿è¡Œåœ¨ä¸€ä¸ªHadoopé›†ç¾¤ä¸Šã€‚</p>
<h3 id="1-2-ä¼˜ç¼ºç‚¹">1.2 ä¼˜ç¼ºç‚¹</h3>
<p><strong>ä¼˜ç‚¹</strong></p>
<ul>
<li>æ˜“äºç¼–ç¨‹ã€‚ç”¨æˆ·åªéœ€è¦å…³å¿ƒä¸šåŠ¡é€»è¾‘</li>
<li>è‰¯å¥½çš„æ‰©å±•æ€§ã€‚å¯ä»¥åŠ¨æ€å¢åŠ æœåŠ¡å™¨ï¼Œè§£å†³è®¡ç®—èµ„æºä¸å¤Ÿçš„é—®é¢˜</li>
<li>é«˜å®¹é”™æ€§ã€‚ä»»ä½•ä¸€å°é›†ç¾¤æŒ‚æ‰ï¼Œå¯ä»¥å°†ä»»åŠ¡è½¬ç§»åˆ°å…¶ä»–èŠ‚ç‚¹</li>
<li>é€‚åˆæµ·é‡æ•°æ®è®¡ç®—ï¼ˆTB/PBï¼‰ã€‚å‡ åƒå°æœåŠ¡å™¨å…±åŒè®¡ç®—</li>
</ul>
<p><strong>ç¼ºç‚¹</strong></p>
<ul>
<li>ä¸æ“…é•¿å®æ—¶è®¡ç®—ã€‚MySQLæ“…é•¿</li>
<li>ä¸æ“…é•¿æµå¼è®¡ç®—ã€‚Flinkæ“…é•¿</li>
<li>ä¸æ“…é•¿DAGæœ‰å‘æ— å…³å›¾è®¡ç®—ã€‚Sparkæ“…é•¿</li>
</ul>
<h3 id="1-3-MapReduceæ ¸å¿ƒæ€æƒ³">1.3 MapReduceæ ¸å¿ƒæ€æƒ³</h3>
<p>ä¸€ä¸ªå®Œæ•´çš„MapReduceç¨‹åºåœ¨åˆ†å¸ƒå¼è¿è¡Œæ—¶æœ‰ä¸‰ç±»å®ä¾‹è¿›ç¨‹ï¼š</p>
<ul>
<li><strong>MrAppMaster</strong>ï¼šè´Ÿè´£æ•´ä¸ªç¨‹åºçš„è¿‡ç¨‹è°ƒåº¦åŠçŠ¶æ€åè°ƒ</li>
<li><strong>MapTask</strong>ï¼šè´Ÿè´£Mapé˜¶æ®µçš„æ•´ä¸ªæ•°æ®å¤„ç†æµç¨‹</li>
<li><strong>ReduceTask</strong>ï¼šè´Ÿè´£Reduceé˜¶æ®µçš„æ•´ä¸ªæ•°æ®å¤„ç†æµç¨‹</li>
</ul>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330912.png" alt></p>
<h3 id="1-4-åºåˆ—åŒ–ç±»å‹ä¸ç¼–ç¨‹è§„èŒƒ">1.4 åºåˆ—åŒ–ç±»å‹ä¸ç¼–ç¨‹è§„èŒƒ</h3>
<table>
<thead>
<tr>
<th><strong>Javaç±»å‹</strong></th>
<th><strong>Hadoop Writableç±»å‹</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Boolean</td>
<td>BooleanWritable</td>
</tr>
<tr>
<td>Byte</td>
<td>ByteWritable</td>
</tr>
<tr>
<td>Int</td>
<td>IntWritable</td>
</tr>
<tr>
<td>Float</td>
<td>FloatWritable</td>
</tr>
<tr>
<td>Long</td>
<td>LongWritable</td>
</tr>
<tr>
<td>Double</td>
<td>DoubleWritable</td>
</tr>
<tr>
<td><strong>String</strong></td>
<td><strong>Text</strong></td>
</tr>
<tr>
<td>Map</td>
<td>MapWritable</td>
</tr>
<tr>
<td>Array</td>
<td>ArrayWritable</td>
</tr>
<tr>
<td>Null</td>
<td>NullWritable</td>
</tr>
</tbody>
</table>
<p>ç”¨æˆ·ç¼–å†™çš„ç¨‹åºåˆ†ä¸º3ä¸ªéƒ¨åˆ†ï¼šMapperã€Reducerå’ŒDriver</p>
<p><strong>Mapperé˜¶æ®µ</strong></p>
<ul>
<li>ç”¨æˆ·è‡ªå®šä¹‰çš„Mapperè¦ç»§æ‰¿è‡ªå·±çš„çˆ¶ç±»</li>
<li>Mapperçš„è¾“å…¥æ˜¯é”®å€¼å¯¹çš„å½¢å¼</li>
<li>Mapperä¸­çš„ä¸šåŠ¡é€»è¾‘å†™åœ¨map()æ–¹æ³•ä¸­</li>
<li>Mapperçš„è¾“å‡ºæ˜¯é”®å€¼å¯¹çš„å½¢å¼</li>
<li>map()æ–¹æ³•å¯¹æ¯ä¸€ä¸ª&lt;K, V&gt;è°ƒç”¨ä¸€æ¬¡</li>
</ul>
<p><strong>Reduceré˜¶æ®µ</strong></p>
<ul>
<li>ç”¨æˆ·è‡ªå®šä¹‰çš„Reducerè¦ç»§æ‰¿è‡ªå·±çš„çˆ¶ç±»</li>
<li>Reducerçš„è¾“å…¥ç±»å‹ä¸Mapperçš„è¾“å…¥ç±»å‹ç›¸å¯¹åº”</li>
<li>Reducerçš„ä¸šåŠ¡é€»è¾‘å†™åœ¨reduce()æ–¹æ³•ä¸­</li>
<li>ReduceTaskè¿›ç¨‹å¯¹æ¯ä¸€ç»„ç›¸åŒçš„&lt;K, V&gt;è°ƒç”¨ä¸€æ¬¡reduce()æ–¹æ³•</li>
</ul>
<p><strong>Driveré˜¶æ®µ</strong></p>
<ul>
<li>ç›¸å½“äºYarné›†ç¾¤çš„å®¢æˆ·ç«¯ï¼Œç”¨äºæäº¤æ•´ä¸ªç¨‹åºåˆ°Yarné›†ç¾¤ï¼Œæäº¤çš„æ˜¯å°è£…</li>
<li>MapReduceç¨‹åºç›¸å…³è¿è¡Œ å‚æ•°çš„jobå¯¹è±¡</li>
</ul>
<h3 id="1-5-WordCountæ¡ˆä¾‹å®æ“">1.5 WordCountæ¡ˆä¾‹å®æ“</h3>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330913.png" alt></p>
<p>é€šè¿‡IDEAåˆ›å»ºå·¥ç¨‹ï¼Œç¯å¢ƒå’Œä¸Šé¢APIæ“ä½œä¸€è‡´ï¼Œåˆ›å»ºåŒ…åcom.atguigu.mapreduce.wordcount</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨æ„å¯¼å…¥åŒ…éƒ½è¦é€‰æ‹©mapreduce.xxxçš„ï¼Œmapredæ˜¯ä¹‹å‰1.xçš„å†™æ³•</span></span><br><span class="line"><span class="comment">//ç¼–å†™Mapperç±»</span></span><br><span class="line"><span class="comment">// å››å…ƒåˆ†åˆ«æ˜¯è¾“å…¥çš„&lt;key,value&gt;å’Œè¾“å‡ºåˆ°reducerçš„&lt;key,value&gt;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCountMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line">    Text k = <span class="keyword">new</span> Text();</span><br><span class="line">    IntWritable v = <span class="keyword">new</span> IntWritable(<span class="number">1</span>);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span>  <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// 1 è·å–ä¸€è¡Œ</span></span><br><span class="line">        String line = value.toString();</span><br><span class="line">        <span class="comment">// 2 åˆ‡å‰²</span></span><br><span class="line">        String[] words = line.split(<span class="string">" "</span>);</span><br><span class="line">        <span class="comment">// 3 è¾“å‡º</span></span><br><span class="line">        <span class="keyword">for</span> (String word : words) &#123;</span><br><span class="line">            k.set(word);</span><br><span class="line">            context.write(k, v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼–å†™Reducerç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCountReducer</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">IntWritable</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> sum;</span><br><span class="line">IntWritable v = <span class="keyword">new</span> IntWritable();</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;IntWritable&gt; values,Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">    <span class="comment">// 1 ç´¯åŠ æ±‚å’Œ</span></span><br><span class="line">    sum = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// è¿™ç›¸å½“äºä¸€ä¸ªç›¸åŒkeyé›†åˆ</span></span><br><span class="line">    <span class="keyword">for</span> (IntWritable count : values) &#123;</span><br><span class="line">      sum += count.get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2 è¾“å‡º</span></span><br><span class="line">         v.set(sum);</span><br><span class="line">    context.write(key,v);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼–å†™Driveré©±åŠ¨ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCountDriver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, InterruptedException </span>&#123;</span><br><span class="line">    <span class="comment">// 1 è·å–é…ç½®ä¿¡æ¯ä»¥åŠè·å–jobå¯¹è±¡</span></span><br><span class="line">    Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">    Job job = Job.getInstance(conf);</span><br><span class="line">    <span class="comment">// 2 å…³è”æœ¬Driverç¨‹åºçš„jar</span></span><br><span class="line">    job.setJarByClass(WordCountDriver<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="comment">// 3 å…³è”Mapperå’ŒReducerçš„jar</span></span><br><span class="line">    job.setMapperClass(WordCountMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    job.setReducerClass(WordCountReducer<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="comment">// 4 è®¾ç½®Mapperè¾“å‡ºçš„kvç±»å‹</span></span><br><span class="line">    job.setMapOutputKeyClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    job.setMapOutputValueClass(IntWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="comment">// 5 è®¾ç½®æœ€ç»ˆè¾“å‡ºkvç±»å‹</span></span><br><span class="line">    job.setOutputKeyClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    job.setOutputValueClass(IntWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="comment">// 6 è®¾ç½®è¾“å…¥å’Œè¾“å‡ºè·¯å¾„,å¯ä»¥æš‚æ—¶å†™è‡ªå·±çš„è·¯å¾„è¿›è¡Œæµ‹è¯•</span></span><br><span class="line">    FileInputFormat.setInputPaths(job, <span class="keyword">new</span> Path(args[<span class="number">0</span>]));</span><br><span class="line">    FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(args[<span class="number">1</span>]));</span><br><span class="line">    <span class="comment">// 7 æäº¤job</span></span><br><span class="line">    <span class="keyword">boolean</span> result = job.waitForCompletion(<span class="keyword">true</span>);</span><br><span class="line">    System.exit(result ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é›†ç¾¤ä¸Šæµ‹è¯•ï¼Œç”¨mavenæ‰“jaråŒ…ï¼Œéœ€è¦æ·»åŠ çš„æ‰“åŒ…æ’ä»¶ä¾èµ–ï¼Œç„¶åpackage</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="tag">&lt;/<span class="name">descriptorRef</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>make-assembly<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>single<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœç³»ç»Ÿå¸¦æœ‰ä¾èµ–ï¼Œå¯ä»¥ç›´æ¥æ‰“åŒ…ä¸ç”¨æ’ä»¶çš„jaråŒ…ï¼Œä¿®æ”¹ä¸å¸¦ä¾èµ–çš„jaråŒ…åç§°ä¸ºwc.jarï¼Œå¹¶æ‹·è´è¯¥jaråŒ…åˆ°Hadoopé›†ç¾¤çš„/opt/module/hadoop-3.1.3è·¯å¾„</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sbin/start-dfs.sh</span><br><span class="line">sbin/start-yarn.sh</span><br><span class="line"><span class="comment"># æ²¡æœ‰ä¾èµ–çš„è¯æŒ‡å®šå…¨ç±»å</span></span><br><span class="line">hadoop jar wc.jar com.atguigu.mapreduce.wordcount.WordCountDriver /user/atguigu/input /user/atguigu/output</span><br></pre></td></tr></table></figure>
<h2 id="2ã€Hadoopåºåˆ—åŒ–">2ã€Hadoopåºåˆ—åŒ–</h2>
<h3 id="2-1-æ¦‚è¿°">2.1 æ¦‚è¿°</h3>
<p><strong>åºåˆ—åŒ–</strong>å°±æ˜¯æŠŠå†…å­˜ä¸­çš„å¯¹è±¡ï¼Œè½¬æ¢æˆå­—èŠ‚åºåˆ—ï¼ˆæˆ–å…¶ä»–æ•°æ®ä¼ è¾“åè®®ï¼‰ä»¥ä¾¿äºå­˜å‚¨åˆ°ç£ç›˜ï¼ˆæŒä¹…åŒ–ï¼‰å’Œç½‘ç»œä¼ è¾“ã€‚<strong>ååºåˆ—åŒ–</strong>å°±æ˜¯å°†æ”¶åˆ°å­—èŠ‚åºåˆ—ï¼ˆæˆ–å…¶ä»–æ•°æ®ä¼ è¾“åè®®ï¼‰æˆ–è€…æ˜¯ç£ç›˜çš„æŒä¹…åŒ–æ•°æ®ï¼Œè½¬æ¢æˆå†…å­˜ä¸­çš„å¯¹è±¡</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œ&quot;æ´»çš„&quot;å¯¹è±¡åªç”Ÿå­˜åœ¨å†…å­˜é‡Œï¼Œå…³æœºæ–­ç”µå°±æ²¡æœ‰äº†ã€‚è€Œä¸”å¯¹è±¡åªèƒ½ç”±æœ¬åœ°çš„è¿›ç¨‹ä½¿ç”¨ï¼Œä¸èƒ½è¢«å‘é€åˆ°ç½‘ç»œä¸Šçš„å¦å¤–ä¸€å°è®¡ç®—æœºã€‚ ç„¶è€Œ<strong>åºåˆ—åŒ–å¯ä»¥å­˜å‚¨&quot;æ´»çš„&quot;å¯¹è±¡ï¼Œå¯ä»¥å°†&quot;æ´»çš„&quot;å¯¹è±¡å‘é€åˆ°è¿œç¨‹è®¡ç®—æœº</strong>ã€‚</p>
<p>ä¸ºä»€ä¹ˆä¸ç”¨Javaçš„åºåˆ—åŒ–ï¼ŸJavaçš„åºåˆ—åŒ–æ˜¯ä¸€ä¸ªé‡é‡çº§åºåˆ—åŒ–æ¡†æ¶ï¼ˆSerializableï¼‰ï¼Œä¸€ä¸ªå¯¹è±¡è¢«åºåˆ—åŒ–åï¼Œä¼šé™„å¸¦å¾ˆå¤šé¢å¤–çš„ä¿¡æ¯ï¼ˆå„ç§æ ¡éªŒä¿¡æ¯ï¼ŒHeaderï¼Œç»§æ‰¿ä½“ç³»ç­‰ï¼‰ï¼Œä¸ä¾¿äºåœ¨ç½‘ç»œä¸­é«˜æ•ˆä¼ è¾“ã€‚æ‰€ä»¥ï¼ŒHadoopè‡ªå·±å¼€å‘äº†ä¸€å¥—åºåˆ—åŒ–æœºåˆ¶ï¼ˆWritableï¼‰</p>
<h3 id="2-2-è‡ªå®šä¹‰beanå¯¹è±¡å®ç°åºåˆ—åŒ–æ¥å£-Writable">2.2 è‡ªå®šä¹‰beanå¯¹è±¡å®ç°åºåˆ—åŒ–æ¥å£(Writable)</h3>
<p>ä¼ä¸šå¼€å‘ä¸­å¾€å¾€å¸¸ç”¨çš„åŸºæœ¬åºåˆ—åŒ–ç±»å‹ä¸èƒ½æ»¡è¶³æ‰€æœ‰éœ€æ±‚ï¼Œæ¯”å¦‚åœ¨Hadoopæ¡†æ¶å†…éƒ¨ä¼ é€’ä¸€ä¸ªbeanå¯¹è±¡ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å°±éœ€è¦å®ç°åºåˆ—åŒ–æ¥å£</p>
<ul>
<li>å¿…é¡»å®ç°Writableæ¥å£</li>
<li>ååºåˆ—åŒ–æ—¶ï¼Œéœ€è¦åå°„è°ƒç”¨ç©ºå‚æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥å¿…é¡»æœ‰ç©ºå‚æ„é€ </li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">FlowBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">super</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>é‡å†™åºåˆ—åŒ–æ–¹æ³•å’Œé‡å†™ååºåˆ—åŒ–æ–¹æ³•ï¼Œ<strong>æ³¨æ„ååºåˆ—åŒ–çš„é¡ºåºå’Œåºåˆ—åŒ–çš„é¡ºåºå®Œå…¨ä¸€è‡´</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(DataOutput out)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  out.writeLong(upFlow);</span><br><span class="line">  out.writeLong(downFlow);</span><br><span class="line">  out.writeLong(sumFlow);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readFields</span><span class="params">(DataInput in)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  upFlow = in.readLong();</span><br><span class="line">  downFlow = in.readLong();</span><br><span class="line">  sumFlow = in.readLong();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>è¦æƒ³æŠŠç»“æœæ˜¾ç¤ºåœ¨æ–‡ä»¶ä¸­ï¼Œéœ€è¦é‡å†™toString()ï¼Œå¯ç”¨&quot;\t&quot;åˆ†å¼€ï¼Œæ–¹ä¾¿åç»­ç”¨</li>
<li>å¦‚æœéœ€è¦å°†è‡ªå®šä¹‰çš„beanæ”¾åœ¨keyä¸­ä¼ è¾“ï¼Œåˆ™è¿˜éœ€è¦å®ç°Comparableæ¥å£ï¼Œå› ä¸ºMapReduceæ¡†ä¸­çš„Shuffleè¿‡ç¨‹è¦æ±‚å¯¹keyå¿…é¡»èƒ½æ’åº</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(FlowBean o)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// å€’åºæ’åˆ—ï¼Œä»å¤§åˆ°å°</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.sumFlow &gt; o.getSumFlow() ? -<span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-åºåˆ—åŒ–æ¡ˆä¾‹å®æ“">2.3 åºåˆ—åŒ–æ¡ˆä¾‹å®æ“</h3>
<p>æ•°æ®æ ¼å¼å¦‚ä¸‹æ‰€ç¤º</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1  13736230513  192.196.100.1  www.atguigu.com  2481  24681  200</span><br><span class="line">2  13846544121  192.196.100.2      264  0  200</span><br><span class="line">3   13956435636  192.196.100.3      132  1512  200</span><br><span class="line">4   13966251146  192.168.100.1      240  0  404</span><br><span class="line">5   18271575951  192.168.100.2  www.atguigu.com  1527  2106  200</span><br><span class="line">6   84188413  192.168.100.3  www.atguigu.com  4116  1432  200</span><br><span class="line">7   13590439668  192.168.100.4      1116  954  200</span><br></pre></td></tr></table></figure>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330914.png" alt></p>
<p>åˆ›å»ºåŒ…</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1 ç»§æ‰¿ Writable æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlowBean</span> <span class="keyword">implements</span> <span class="title">Writable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> upFlow; <span class="comment">//ä¸Šè¡Œæµé‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> downFlow; <span class="comment">//ä¸‹è¡Œæµé‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> sumFlow; <span class="comment">//æ€»æµé‡</span></span><br><span class="line">    <span class="comment">//2 æä¾›æ— å‚æ„é€ </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FlowBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3 æä¾›ä¸‰ä¸ªå‚æ•°çš„ getter å’Œ setter æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getUpFlow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> upFlow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUpFlow</span><span class="params">(<span class="keyword">long</span> upFlow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.upFlow = upFlow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getDownFlow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> downFlow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDownFlow</span><span class="params">(<span class="keyword">long</span> downFlow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.downFlow = downFlow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getSumFlow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sumFlow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSumFlow</span><span class="params">(<span class="keyword">long</span> sumFlow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sumFlow = sumFlow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSumFlow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sumFlow = <span class="keyword">this</span>.upFlow + <span class="keyword">this</span>.downFlow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4 å®ç°åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ–¹æ³•,æ³¨æ„é¡ºåºä¸€å®šè¦ä¿æŒä¸€è‡´</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(DataOutput dataOutput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        dataOutput.writeLong(upFlow);</span><br><span class="line">        dataOutput.writeLong(downFlow);</span><br><span class="line">        dataOutput.writeLong(sumFlow);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readFields</span><span class="params">(DataInput dataInput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.upFlow = dataInput.readLong();</span><br><span class="line">        <span class="keyword">this</span>.downFlow = dataInput.readLong();</span><br><span class="line">        <span class="keyword">this</span>.sumFlow = dataInput.readLong();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//5 é‡å†™ ToString</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> upFlow + <span class="string">"\t"</span> + downFlow + <span class="string">"\t"</span> + sumFlow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼–å†™Mapperç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlowMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">FlowBean</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Text outK = <span class="keyword">new</span> Text();</span><br><span class="line">    <span class="keyword">private</span> FlowBean outV = <span class="keyword">new</span> FlowBean();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1 è·å–ä¸€è¡Œæ•°æ®,è½¬æˆå­—ç¬¦ä¸²</span></span><br><span class="line">        String line = value.toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2 åˆ‡å‰²æ•°æ®</span></span><br><span class="line">        String[] split = line.split(<span class="string">"\t"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3 æŠ“å–æˆ‘ä»¬éœ€è¦çš„æ•°æ®:æ‰‹æœºå·,ä¸Šè¡Œæµé‡,ä¸‹è¡Œæµé‡</span></span><br><span class="line">        String phone = split[<span class="number">1</span>];</span><br><span class="line">        String up = split[split.length - <span class="number">3</span>];</span><br><span class="line">        String down = split[split.length - <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4 å°è£…outK outV</span></span><br><span class="line">        outK.set(phone);</span><br><span class="line"></span><br><span class="line">        outV.setUpFlow(Long.parseLong(up));</span><br><span class="line">        outV.setDownFlow(Long.parseLong(down));</span><br><span class="line">        outV.setSumFlow();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5 å†™å‡ºoutK outV</span></span><br><span class="line">        context.write(outK, outV);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼–å†™Reducerç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlowReducer</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">FlowBean</span>, <span class="title">Text</span>, <span class="title">FlowBean</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> FlowBean outV = <span class="keyword">new</span> FlowBean();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;FlowBean&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> totalUp = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">long</span> totalDown = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1 éå†values,å°†å…¶ä¸­çš„ä¸Šè¡Œæµé‡,ä¸‹è¡Œæµé‡åˆ†åˆ«ç´¯åŠ </span></span><br><span class="line">        <span class="keyword">for</span> (FlowBean flowBean : values) &#123;</span><br><span class="line">            totalUp += flowBean.getUpFlow();</span><br><span class="line">            totalDown += flowBean.getDownFlow();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2 å°è£…outKV</span></span><br><span class="line">        outV.setUpFlow(totalUp);</span><br><span class="line">        outV.setDownFlow(totalDown);</span><br><span class="line">        outV.setSumFlow();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3 å†™å‡ºoutK outV</span></span><br><span class="line">        context.write(key,outV);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼–å†™Driveré©±åŠ¨ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlowDriver</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1 è·å–jobå¯¹è±¡</span></span><br><span class="line">        Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        Job job = Job.getInstance(conf);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2 å…³è”æœ¬Driverç±»</span></span><br><span class="line">        job.setJarByClass(FlowDriver<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3 å…³è”Mapperå’ŒReducer</span></span><br><span class="line">        job.setMapperClass(FlowMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setReducerClass(FlowReducer<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//4 è®¾ç½®Mapç«¯è¾“å‡ºKVç±»å‹</span></span><br><span class="line">        job.setMapOutputKeyClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setMapOutputValueClass(FlowBean<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//5 è®¾ç½®ç¨‹åºæœ€ç»ˆè¾“å‡ºçš„KVç±»å‹</span></span><br><span class="line">        job.setOutputKeyClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputValueClass(FlowBean<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//6 è®¾ç½®ç¨‹åºçš„è¾“å…¥è¾“å‡ºè·¯å¾„</span></span><br><span class="line">        FileInputFormat.setInputPaths(job, <span class="keyword">new</span> Path(<span class="string">"D:\\inputflow"</span>));</span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(<span class="string">"D:\\flowoutput"</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//7 æäº¤Job</span></span><br><span class="line">        <span class="keyword">boolean</span> b = job.waitForCompletion(<span class="keyword">true</span>);</span><br><span class="line">        System.exit(b ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3ã€MapReduceæ¡†æ¶åŸç†">3ã€MapReduceæ¡†æ¶åŸç†</h2>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330915.png" alt></p>
<h3 id="3-1-InputFormatæ•°æ®è¾“å…¥">3.1 InputFormatæ•°æ®è¾“å…¥</h3>
<p>åˆ‡ç‰‡ä¸MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶ï¼šMapTaskçš„å¹¶è¡Œåº¦å†³å®šMapé˜¶æ®µä»»åŠ¡å¤„ç†å¹¶å‘åº¦ï¼Œè¿›è€Œå½±å“åˆ°æ•´ä¸ªjobçš„å¤„ç†é€Ÿåº¦ã€‚æ•°æ®å—ï¼ˆblockï¼‰æ˜¯ç‰©ç†ä¸ŠæŠŠæ•°æ®åˆ†æˆä¸€å—ä¸€å—çš„ï¼Œæ•°æ®å—æ˜¯HDFSæ•°æ®å­˜å‚¨å•ä½ã€‚</p>
<p>æ•°æ®åˆ‡ç‰‡åªæ˜¯åœ¨é€»è¾‘ä¸Šå¯¹è¾“å…¥æ•°æ®è¿›è¡Œåˆ†ç‰‡ï¼Œæ•°æ®åˆ‡ç‰‡æ˜¯MapReduceç¨‹åºè®¡ç®—è¾“å…¥æ•°æ®çš„å•ä½ã€‚ä¸€ä¸ªåˆ‡ç‰‡ä¼šå¯¹åº”å¯åŠ¨ä¸€ä¸ªMapTaskã€‚</p>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330916.png" alt></p>
<p><strong>Jobæäº¤æµç¨‹æºç è¯¦è§£</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">waitForCompletion()</span><br><span class="line"></span><br><span class="line">submit();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1å»ºç«‹è¿æ¥</span></span><br><span class="line">  connect();  </span><br><span class="line">    <span class="comment">// 1ï¼‰åˆ›å»ºæäº¤Jobçš„ä»£ç†</span></span><br><span class="line">    <span class="keyword">new</span> Cluster(getConfiguration());</span><br><span class="line">      <span class="comment">// ï¼ˆ1ï¼‰åˆ¤æ–­æ˜¯æœ¬åœ°è¿è¡Œç¯å¢ƒè¿˜æ˜¯yarné›†ç¾¤è¿è¡Œç¯å¢ƒ</span></span><br><span class="line">      initialize(jobTrackAddr, conf); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 2 æäº¤job</span></span><br><span class="line">submitter.submitJobInternal(Job.<span class="keyword">this</span>, cluster)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1ï¼‰åˆ›å»ºç»™é›†ç¾¤æäº¤æ•°æ®çš„Stagè·¯å¾„</span></span><br><span class="line">  Path jobStagingArea = JobSubmissionFiles.getStagingDir(cluster, conf);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2ï¼‰è·å–jobid ï¼Œå¹¶åˆ›å»ºJobè·¯å¾„</span></span><br><span class="line">  JobID jobId = submitClient.getNewJobID();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3ï¼‰æ‹·è´jaråŒ…åˆ°é›†ç¾¤</span></span><br><span class="line">copyAndConfigureFiles(job, submitJobDir);  </span><br><span class="line">  rUploader.uploadFiles(job, jobSubmitDir);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4ï¼‰è®¡ç®—åˆ‡ç‰‡ï¼Œç”Ÿæˆåˆ‡ç‰‡è§„åˆ’æ–‡ä»¶</span></span><br><span class="line">writeSplits(job, submitJobDir);</span><br><span class="line">    maps = writeNewSplits(job, jobSubmitDir);</span><br><span class="line">    input.getSplits(job);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 5ï¼‰å‘Stagè·¯å¾„å†™XMLé…ç½®æ–‡ä»¶</span></span><br><span class="line">writeConf(conf, submitJobFile);</span><br><span class="line">  conf.writeXml(out);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 6ï¼‰æäº¤Job,è¿”å›æäº¤çŠ¶æ€</span></span><br><span class="line">status = submitClient.submitJob(jobId, submitJobDir.toString(), job.getCredentials());</span><br></pre></td></tr></table></figure>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330917.png" alt></p>
<p><strong>FileInputFormatåˆ‡ç‰‡æºç è§£æ(input.getSplits(job)****)</strong></p>
<p>æ³¨æ„è¿™é‡Œå°äº1.1å€åä¹‰ä¸Šæ˜¯åˆ‡æˆä¸€å—ï¼Œå…¶å®å­˜å‚¨è¿˜æ˜¯ä¸¤å—ï¼Œåªæ˜¯æŠŠå°çš„é‚£éƒ¨åˆ†é€šè¿‡ç½‘ç»œæ‹‰å–è¿‡æ¥å½¢æˆä¸€å—å¤„ç†</p>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330918.png" alt></p>
<ul>
<li>ç®€å•åœ°æŒ‰ç…§æ–‡ä»¶çš„å†…å®¹é•¿åº¦è¿›è¡Œåˆ‡ç‰‡</li>
<li>åˆ‡ç‰‡å¤§å°ï¼Œé»˜è®¤ç­‰äºBlockå¤§å°</li>
<li><strong>åˆ‡ç‰‡æ—¶ä¸è€ƒè™‘æ•°æ®é›†æ•´ä½“ï¼Œè€Œæ˜¯é€ä¸ªé’ˆå¯¹æ¯ä¸€ä¸ªæ–‡ä»¶å•ç‹¬åˆ‡ç‰‡</strong></li>
</ul>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330919.png" alt></p>
<p><strong>TextInputFormatå®ç°ç±»</strong></p>
<blockquote>
<p>FileInputFormatå¸¸è§çš„æ¥å£å®ç°ç±»åŒ…æ‹¬ï¼šTextInputFormatã€KeyValueTextInputFormatã€NLineInputFormatã€CombineTextInputFormatå’Œè‡ªå®šä¹‰InputFormatç­‰</p>
</blockquote>
<p>TextInputFormatæ˜¯é»˜è®¤çš„FileInputFormatå®ç°ç±»ã€‚æŒ‰è¡Œè¯»å–æ¯æ¡è®°å½•ã€‚é”®æ˜¯å­˜å‚¨è¯¥è¡Œåœ¨æ•´ä¸ªæ–‡ä»¶ä¸­çš„èµ·å§‹å­—èŠ‚åç§»é‡ï¼Œ LongWritableç±»å‹ã€‚å€¼æ˜¯è¿™è¡Œçš„å†…å®¹ï¼Œä¸åŒ…æ‹¬ä»»ä½•è¡Œç»ˆæ­¢ç¬¦ï¼ˆæ¢è¡Œç¬¦å’Œå›è½¦ç¬¦ï¼‰ï¼ŒTextç±»å‹</p>
<p><strong>CombineTextInputFormatå®ç°ç±»</strong></p>
<blockquote>
<p>æ¡†æ¶é»˜è®¤çš„TextInputFormatåˆ‡ç‰‡æœºåˆ¶æ˜¯å¯¹ä»»åŠ¡æŒ‰æ–‡ä»¶è§„åˆ’åˆ‡ç‰‡ï¼Œä¸ç®¡æ–‡ä»¶å¤šå°ï¼Œéƒ½ä¼šæ˜¯ä¸€ä¸ªå•ç‹¬çš„åˆ‡ç‰‡ï¼Œéƒ½ä¼šäº¤ç»™ä¸€ä¸ªMapTaskï¼Œè¿™æ ·å¦‚æœæœ‰å¤§é‡å°æ–‡ä»¶ï¼Œå°±ä¼šäº§ç”Ÿå¤§é‡çš„MapTaskï¼Œå¤„ç†æ•ˆç‡æå…¶ä½ä¸‹</p>
</blockquote>
<p>CombineTextInputFormatç”¨äºå°æ–‡ä»¶è¿‡å¤šçš„åœºæ™¯ï¼Œå®ƒå¯ä»¥å°†å¤šä¸ªå°æ–‡ä»¶ä»é€»è¾‘ä¸Šè§„åˆ’åˆ°ä¸€ä¸ªåˆ‡ç‰‡ä¸­ï¼Œè¿™æ ·ï¼Œå¤šä¸ªå°æ–‡ä»¶å°±å¯ä»¥äº¤ç»™ä¸€ä¸ªMapTaskå¤„ç†</p>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330920.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¦–å…ˆå‡†å¤‡å››ä¸ªå°æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸åšä»»ä½•å¤„ç†ï¼Œè¾“å‡ºåˆ‡ç‰‡ä¸º4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//é©±åŠ¨ç±»ä¸­æ·»åŠ ä»£ç å¦‚ä¸‹</span></span><br><span class="line"><span class="comment">//è¾“å‡ºä¸º3</span></span><br><span class="line"><span class="comment">// å¦‚æœä¸è®¾ç½® InputFormatï¼Œå®ƒé»˜è®¤ç”¨çš„æ˜¯ TextInputFormat.class</span></span><br><span class="line">job.setInputFormatClass(CombineTextInputFormat<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"><span class="comment">//è™šæ‹Ÿå­˜å‚¨åˆ‡ç‰‡æœ€å¤§å€¼è®¾ç½® 4m</span></span><br><span class="line">CombineTextInputFormat.setMaxInputSplitSize(job, <span class="number">4194304</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºä¸º1</span></span><br><span class="line"><span class="comment">// å¦‚æœä¸è®¾ç½® InputFormatï¼Œå®ƒé»˜è®¤ç”¨çš„æ˜¯ TextInputFormat.class</span></span><br><span class="line">job.setInputFormatClass(CombineTextInputFormat<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"><span class="comment">//è™šæ‹Ÿå­˜å‚¨åˆ‡ç‰‡æœ€å¤§å€¼è®¾ç½® 20m</span></span><br><span class="line">CombineTextInputFormat.setMaxInputSplitSize(job, <span class="number">20971520</span>);</span><br></pre></td></tr></table></figure>
<h3 id="3-2-MapReduceå·¥ä½œæµç¨‹">3.2 MapReduceå·¥ä½œæµç¨‹</h3>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330921.png" alt></p>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330922.png" alt></p>
<h3 id="3-3-Shuffleæœºåˆ¶">3.3 Shuffleæœºåˆ¶</h3>
<blockquote>
<p>Mapæ–¹æ³•ä¹‹åï¼ŒReduceæ–¹æ³•ä¹‹å‰çš„æ•°æ®å¤„ç†è¿‡ç¨‹ç§°ä¹‹ä¸ºShuffle</p>
</blockquote>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330923.png" alt></p>
<p><strong>Shuffleåˆ†åŒº</strong></p>
<ul>
<li>å¦‚æœReduceTaskçš„æ•°é‡&gt; getPartitionçš„ç»“æœæ•°ï¼Œåˆ™ä¼šå¤šäº§ç”Ÿå‡ ä¸ªç©ºçš„è¾“å‡ºæ–‡ä»¶part-r-000xxï¼›</li>
<li>å¦‚æœ1&lt;ReduceTaskçš„æ•°é‡&lt;getPartitionçš„ç»“æœæ•°ï¼Œåˆ™æœ‰ä¸€éƒ¨åˆ†åˆ†åŒºæ•°æ®æ— å¤„å®‰æ”¾ï¼Œä¼šExceptionï¼›</li>
<li>å¦‚æœReduceTaskçš„æ•°é‡=1ï¼Œåˆ™ä¸ç®¡MapTaskç«¯è¾“å‡ºå¤šå°‘ä¸ªåˆ†åŒºæ–‡ä»¶ï¼Œæœ€ç»ˆç»“æœéƒ½äº¤ç»™è¿™ä¸€ä¸ªReduceTaskï¼Œæœ€ç»ˆä¹Ÿå°±åªä¼šäº§ç”Ÿä¸€ä¸ªç»“æœæ–‡ä»¶ part-r-00000ï¼›</li>
<li>åˆ†åŒºå·å¿…é¡»ä»é›¶å¼€å§‹ï¼Œé€ä¸€ç´¯åŠ ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Partitionåˆ†åŒºæ¡ˆä¾‹å®æ“</span></span><br><span class="line"><span class="comment">//è¿™æ˜¯é»˜è®¤åˆ†åŒºreturn (key.hashCode()&amp;Integer.MAX_VALUE)% numReduceTasks;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProvincePartitioner</span> <span class="keyword">extends</span> <span class="title">Partitioner</span>&lt;<span class="title">Text</span>, <span class="title">FlowBean</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPartition</span><span class="params">(Text text, FlowBean flowBean, <span class="keyword">int</span> numPartitions)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è·å–æ‰‹æœºå·å‰ä¸‰ä½prePhone</span></span><br><span class="line">        String phone = text.toString();</span><br><span class="line">        String prePhone = phone.substring(<span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å®šä¹‰ä¸€ä¸ªåˆ†åŒºå·å˜é‡partition,æ ¹æ®prePhoneè®¾ç½®åˆ†åŒºå·</span></span><br><span class="line">        <span class="keyword">int</span> partition;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"136"</span>.equals(prePhone))&#123;</span><br><span class="line">            partition = <span class="number">0</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"137"</span>.equals(prePhone))&#123;</span><br><span class="line">            partition = <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"138"</span>.equals(prePhone))&#123;</span><br><span class="line">            partition = <span class="number">2</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"139"</span>.equals(prePhone))&#123;</span><br><span class="line">            partition = <span class="number">3</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            partition = <span class="number">4</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æœ€åè¿”å›åˆ†åŒºå·partition</span></span><br><span class="line">        <span class="keyword">return</span> partition;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æœ€ååœ¨driveré‡Œä¿®æ”¹ä»£ç </span></span><br><span class="line"><span class="comment">//8 æŒ‡å®šè‡ªå®šä¹‰åˆ†åŒºå™¨</span></span><br><span class="line">job.setPartitionerClass(ProvincePartitioner<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"><span class="comment">//9 åŒæ—¶æŒ‡å®šç›¸åº”æ•°é‡çš„ReduceTask</span></span><br><span class="line">job.setNumReduceTasks(<span class="number">5</span>);</span><br></pre></td></tr></table></figure>
<p><strong>WritableComparableæ’åº</strong></p>
<p>MapTaskå’ŒReduceTaskå‡ä¼šå¯¹æ•°æ®æŒ‰ç…§keyè¿›è¡Œæ’åºã€‚è¯¥æ“ä½œå±äºHadoopçš„é»˜è®¤è¡Œä¸ºã€‚ä»»ä½•åº”ç”¨ç¨‹åºä¸­çš„æ•°æ®å‡ä¼šè¢«æ’åºï¼Œè€Œä¸ç®¡é€»è¾‘ä¸Šæ˜¯å¦éœ€è¦ã€‚é»˜è®¤æ’åºæ˜¯æŒ‰ç…§å­—å…¸é¡ºåºæ’åºï¼Œä¸”å®ç°è¯¥æ’åºçš„æ–¹æ³•æ˜¯å¿«é€Ÿæ’åºã€‚</p>
<ul>
<li>å¯¹äºMapTaskï¼Œå®ƒä¼šå°†å¤„ç†çš„ç»“æœæš‚æ—¶æ”¾åˆ°ç¯å½¢ç¼“å†²åŒºä¸­ï¼Œå½“ç¯å½¢ç¼“å†²åŒºä½¿ç”¨ç‡è¾¾åˆ°ä¸€å®šé˜ˆå€¼åï¼Œå†å¯¹ç¼“å†²åŒºä¸­çš„æ•°æ®è¿›è¡Œä¸€æ¬¡å¿«é€Ÿæ’åºï¼Œå¹¶å°†è¿™äº›æœ‰åºæ•°æ®æº¢å†™åˆ°ç£ç›˜ä¸Šï¼Œè€Œå½“æ•°æ®å¤„ç†å®Œæ¯•åï¼Œå®ƒä¼šå¯¹ç£ç›˜ä¸Šæ‰€æœ‰æ–‡ä»¶è¿›è¡Œå½’å¹¶æ’åº</li>
<li>å¯¹äºReduceTaskï¼Œå®ƒä»æ¯ä¸ªMapTaskä¸Šè¿œç¨‹æ‹·è´ç›¸åº”çš„æ•°æ®æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶å¤§å°è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼Œåˆ™æº¢å†™ç£ç›˜ä¸Šï¼Œå¦åˆ™å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚å¦‚æœç£ç›˜ä¸Šæ–‡ä»¶æ•°ç›®è¾¾åˆ°ä¸€å®šé˜ˆå€¼ï¼Œåˆ™è¿›è¡Œä¸€æ¬¡å½’å¹¶æ’åºä»¥ç”Ÿæˆä¸€ä¸ªæ›´å¤§æ–‡ä»¶;å¦‚æœå†…å­˜ä¸­æ–‡ä»¶å¤§å°æˆ–è€…æ•°ç›®è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼Œåˆ™è¿›è¡Œä¸€æ¬¡åˆå¹¶åå°†æ•°æ®æº¢å†™åˆ°ç£ç›˜ä¸Šã€‚å½“æ‰€æœ‰æ•°æ®æ‹·è´å®Œæ¯•åï¼ŒReduceTaskç»Ÿä¸€å¯¹å†…å­˜å’Œç£ç›˜ä¸Šçš„æ‰€æœ‰æ•°æ®è¿›è¡Œä¸€æ¬¡å½’å¹¶æ’åºã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WritableComparableæ’åºæ¡ˆä¾‹å®æ“ï¼ˆå…¨æ’åºï¼‰</span></span><br><span class="line"><span class="comment">// å¯¹ä¸Šé¢åºåˆ—åŒ–æ¡ˆä¾‹çš„FlowBeané‡å†™å…¶compareæ¥å£</span></span><br><span class="line"><span class="comment">// ç›®æ ‡æ ¹æ®æ€»æµé‡å€’å™è¿›è¡Œæ’åº</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(FlowBean o)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æŒ‰ç…§æ€»æµé‡æ¯”è¾ƒ,å€’åºæ’åˆ—</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.sumFlow &gt; o.sumFlow)&#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.sumFlow &lt; o.sumFlow)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼–å†™Mapperç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlowMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">FlowBean</span>, <span class="title">Text</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> FlowBean outK = <span class="keyword">new</span> FlowBean();</span><br><span class="line">    <span class="keyword">private</span> Text outV = <span class="keyword">new</span> Text();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1 è·å–ä¸€è¡Œæ•°æ®</span></span><br><span class="line">        String line = value.toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2 æŒ‰ç…§"\t",åˆ‡å‰²æ•°æ®</span></span><br><span class="line">        String[] split = line.split(<span class="string">"\t"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3 å°è£…outK outV</span></span><br><span class="line">        outK.setUpFlow(Long.parseLong(split[<span class="number">1</span>]));</span><br><span class="line">        outK.setDownFlow(Long.parseLong(split[<span class="number">2</span>]));</span><br><span class="line">        outK.setSumFlow();</span><br><span class="line">        outV.set(split[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4 å†™å‡ºoutK outV</span></span><br><span class="line">        context.write(outK,outV);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼–å†™Reducerç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlowReducer</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">FlowBean</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">FlowBean</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(FlowBean key, Iterable&lt;Text&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//éå†valuesé›†åˆ,å¾ªç¯å†™å‡º,é¿å…æ€»æµé‡ç›¸åŒçš„æƒ…å†µ</span></span><br><span class="line">        <span class="keyword">for</span> (Text value : values) &#123;</span><br><span class="line">            <span class="comment">//è°ƒæ¢KVä½ç½®,åå‘å†™å‡º</span></span><br><span class="line">            context.write(value,key);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼–å†™Driverç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlowDriver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException,ClassNotFoundException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1 è·å–jobå¯¹è±¡</span></span><br><span class="line">        Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        Job job = Job.getInstance(conf);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2 å…³è”æœ¬Driverç±»</span></span><br><span class="line">        job.setJarByClass(FlowDriver<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3 å…³è”Mapperå’ŒReducer</span></span><br><span class="line">        job.setMapperClass(FlowMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setReducerClass(FlowReducer<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4 è®¾ç½®Mapç«¯è¾“å‡ºæ•°æ®çš„KVç±»å‹</span></span><br><span class="line">        job.setMapOutputKeyClass(FlowBean<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setMapOutputValueClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5 è®¾ç½®ç¨‹åºæœ€ç»ˆè¾“å‡ºçš„KVç±»å‹</span></span><br><span class="line">        job.setOutputKeyClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputValueClass(FlowBean<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6 è®¾ç½®è¾“å…¥è¾“å‡ºè·¯å¾„</span></span><br><span class="line">        FileInputFormat.setInputPaths(job, <span class="keyword">new</span> Path(<span class="string">"D:\\inputflow2"</span>));</span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(<span class="string">"D:\\comparout"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//7 æäº¤Job</span></span><br><span class="line">        <span class="keyword">boolean</span> b = job.waitForCompletion(<span class="keyword">true</span>);</span><br><span class="line">        System.exit(b ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Combineråˆå¹¶</strong></p>
<ul>
<li>Combineræ˜¯MRç¨‹åºä¸­Mapperå’Œå£Reducerä¹‹å¤–çš„â€”ç§ç»„ä»¶</li>
<li>Combinerç»„ä»¶çš„çˆ¶ç±»å°±æ˜¯Reducer</li>
<li>Cobinerå’Œå£Reducerçš„åŒºåˆ«åœ¨äºè¿è¡Œçš„ä½ç½®
<ul>
<li>Combineræ˜¯åœ¨æ¯ä¸€ä¸ªMapTaskæ‰€åœ¨çš„èŠ‚ç‚¹è¿è¡Œ;</li>
<li>Reduceræ˜¯æ¥æ”¶å…¨å±€æ‰€æœ‰Mapperçš„è¾“å‡ºç»“æœ;</li>
</ul>
</li>
<li>Combinerçš„æ„ä¹‰å°±æ˜¯å¯¹æ¯ä¸€ä¸ªMapTaskçš„è¾“å‡ºè¿›è¡Œå±€éƒ¨æ±‡æ€»ï¼Œä»¥å‡å°ç½‘ç»œä¼ è¾“é‡</li>
<li>Combinerèƒ½å¤Ÿåº”ç”¨çš„å‰ææ˜¯ä¸èƒ½å½±å“æœ€ç»ˆçš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸”Combinerçš„è¾“å‡ºkvåº”è¯¥è·ŸReducerçš„è¾“å…¥kvç±»å‹è¦å¯¹åº”èµ·æ¥</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Combineråˆå¹¶æ¡ˆä¾‹å®æ“</span></span><br><span class="line"><span class="comment">//è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šCombinerç±»ï¼Œåˆ™ä¸ä¼šæ‰§è¡ŒCombineræ“ä½œ</span></span><br><span class="line"><span class="comment">//å¢åŠ ä¸€ä¸ªWordCountCombinerç±»ç»§æ‰¿Reducer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCountCombiner</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">IntWritable</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> IntWritable outV = <span class="keyword">new</span> IntWritable();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;IntWritable&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (IntWritable value : values) &#123;</span><br><span class="line">            sum += value.get();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å°è£…outKV</span></span><br><span class="line">        outV.set(sum);</span><br><span class="line">        <span class="comment">//å†™å‡ºoutKV</span></span><br><span class="line">        context.write(key,outV);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åœ¨WordcountDriveré©±åŠ¨ç±»ä¸­æŒ‡å®šCombiner</span></span><br><span class="line"><span class="comment">// æŒ‡å®šéœ€è¦ä½¿ç”¨combinerï¼Œä»¥åŠç”¨å“ªä¸ªç±»ä½œä¸ºcombinerçš„é€»è¾‘</span></span><br><span class="line"><span class="comment">// ä¸è¿‡ä¸€èˆ¬ç›´æ¥ç”¨reduceçš„ç±»å³å¯</span></span><br><span class="line">job.setCombinerClass(WordCountCombiner<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¦‚æœè®¾ç½®job.setNumReduceTasks(0);å³æ²¡æœ‰reduceé˜¶æ®µï¼Œé‚£ä¹ˆshuffleåé¢çš„éƒ½ä¸ä¼šæœ‰</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-OutputFormatæ•°æ®è¾“å‡º">3.4 OutputFormatæ•°æ®è¾“å‡º</h3>
<p>OutputFomatæ˜¯MapReduceè¾“å‡ºçš„åŸºç±»ï¼Œæ‰€æœ‰å®ç°MapReduceè¾“å‡ºéƒ½å®ç°äº†OutputFormatæ¥å£ã€‚é»˜è®¤æ˜¯TextOutputFormat</p>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330924.png" alt></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è‡ªå®šä¹‰OutputFormatæ¡ˆä¾‹å®æ“</span></span><br><span class="line"><span class="comment">// ç¼–å†™ LogMapper ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>,<span class="title">Text</span>,</span></span><br><span class="line"><span class="class">        <span class="title">NullWritable</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//ä¸åšä»»ä½•å¤„ç†,ç›´æ¥å†™å‡ºä¸€è¡Œ log æ•°æ®</span></span><br><span class="line">        context.write(value, NullWritable.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼–å†™ LogReducer ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogReducer</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">NullWritable</span>,<span class="title">Text</span>,</span></span><br><span class="line"><span class="class">        <span class="title">NullWritable</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;NullWritable&gt; values, Context</span></span></span><br><span class="line"><span class="function"><span class="params">            context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// é˜²æ­¢æœ‰ç›¸åŒçš„æ•°æ®,è¿­ä»£å†™å‡º</span></span><br><span class="line">        <span class="keyword">for</span> (NullWritable value : values) &#123;</span><br><span class="line">            context.write(key, NullWritable.get());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//è‡ªå®šä¹‰ä¸€ä¸ª LogOutputFormat ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogOutputFormat</span> <span class="keyword">extends</span> <span class="title">FileOutputFormat</span>&lt;<span class="title">Text</span>, <span class="title">NullWritable</span>&gt;</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> RecordWriter&lt;Text, NullWritable&gt;</span><br><span class="line">    getRecordWriter(TaskAttemptContext job) <span class="keyword">throws</span> IOException,</span><br><span class="line">            InterruptedException &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ RecordWriter è¿”å›</span></span><br><span class="line">        LogRecordWriter logRecordWriter = <span class="keyword">new</span> LogRecordWriter(job);</span><br><span class="line">        <span class="keyword">return</span> logRecordWriter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼–å†™ LogRecordWriter ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogRecordWriter</span> <span class="keyword">extends</span> <span class="title">RecordWriter</span>&lt;<span class="title">Text</span>, <span class="title">NullWritable</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> FSDataOutputStream atguiguOut;</span><br><span class="line">    <span class="keyword">private</span> FSDataOutputStream otherOut;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LogRecordWriter</span><span class="params">(TaskAttemptContext job)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//è·å–æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡</span></span><br><span class="line">            FileSystem fs = FileSystem.get(job.getConfiguration());</span><br><span class="line">            <span class="comment">//ç”¨æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡åˆ›å»ºä¸¤ä¸ªè¾“å‡ºæµå¯¹åº”ä¸åŒçš„ç›®å½•</span></span><br><span class="line">            atguiguOut = fs.create(<span class="keyword">new</span> Path(<span class="string">"d:/hadoop/atguigu.log"</span>));</span><br><span class="line">            otherOut = fs.create(<span class="keyword">new</span> Path(<span class="string">"d:/hadoop/other.log"</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(Text key, NullWritable value)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        String log = key.toString();</span><br><span class="line">        <span class="comment">//æ ¹æ®ä¸€è¡Œçš„logæ•°æ®æ˜¯å¦åŒ…å«atguigu,åˆ¤æ–­ä¸¤æ¡è¾“å‡ºæµè¾“å‡ºçš„å†…å®¹</span></span><br><span class="line">        <span class="keyword">if</span> (log.contains(<span class="string">"atguigu"</span>)) &#123;</span><br><span class="line">            atguiguOut.writeBytes(log + <span class="string">"\n"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            otherOut.writeBytes(log + <span class="string">"\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(TaskAttemptContext context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//å…³æµ</span></span><br><span class="line">        IOUtils.closeStream(atguiguOut);</span><br><span class="line">        IOUtils.closeStream(otherOut);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼–å†™LogDriverç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogDriver</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        Job job = Job.getInstance(conf);</span><br><span class="line"></span><br><span class="line">        job.setJarByClass(LogDriver<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setMapperClass(LogMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setReducerClass(LogReducer<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        job.setMapOutputKeyClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setMapOutputValueClass(NullWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        job.setOutputKeyClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputValueClass(NullWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®è‡ªå®šä¹‰çš„outputformat</span></span><br><span class="line">        job.setOutputFormatClass(LogOutputFormat<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        FileInputFormat.setInputPaths(job, <span class="keyword">new</span> Path(<span class="string">"D:\\input"</span>));</span><br><span class="line">        <span class="comment">//è™½ç„¶æˆ‘ä»¬è‡ªå®šä¹‰äº†outputformatï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬çš„outputformatç»§æ‰¿è‡ªfileoutputformat</span></span><br><span class="line">        <span class="comment">//è€Œfileoutputformatè¦è¾“å‡ºä¸€ä¸ª_SUCCESSæ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨è¿™è¿˜å¾—æŒ‡å®šä¸€ä¸ªè¾“å‡ºç›®å½•</span></span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(<span class="string">"D:\\logoutput"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> b = job.waitForCompletion(<span class="keyword">true</span>);</span><br><span class="line">        System.exit(b ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-5-MapReduceå†…æ ¸æºç è§£æ">3.5 MapReduceå†…æ ¸æºç è§£æ</h3>
<p><strong>MapTaskå·¥ä½œæœºåˆ¶</strong></p>
<ul>
<li>Readé˜¶æ®µï¼šMapTaské€šè¿‡InputFormatè·å¾—çš„RecordReaderï¼Œä»è¾“å…¥InputSplitä¸­è§£æå‡ºä¸€ä¸ªä¸ªkey/value</li>
<li>Mapé˜¶æ®µï¼šè¯¥èŠ‚ç‚¹ä¸»è¦æ˜¯å°†è§£æå‡ºçš„key/valueäº¤ç»™ç”¨æˆ·ç¼–å†™map()å‡½æ•°å¤„ç†ï¼Œå¹¶äº§ç”Ÿä¸€ç³»åˆ—æ–°çš„key/value</li>
<li>Collectæ”¶é›†é˜¶æ®µï¼šåœ¨ç”¨æˆ·ç¼–å†™map()å‡½æ•°ä¸­ï¼Œå½“æ•°æ®å¤„ç†å®Œæˆåï¼Œä¸€èˆ¬ä¼šè°ƒç”¨OutputCollector.collect()è¾“å‡ºç»“æœã€‚åœ¨è¯¥å‡½æ•°å†…éƒ¨ï¼Œå®ƒä¼šå°†ç”Ÿæˆçš„key/valueåˆ†åŒºï¼ˆè°ƒç”¨Partitionerï¼‰ï¼Œå¹¶å†™å…¥ä¸€ä¸ªç¯å½¢å†…å­˜ç¼“å†²åŒºä¸­</li>
<li>Spillé˜¶æ®µï¼šå³&quot;æº¢å†™&quot;ï¼Œå½“ç¯å½¢ç¼“å†²åŒºæ»¡åï¼ŒMapReduceä¼šå°†æ•°æ®å†™åˆ°æœ¬åœ°ç£ç›˜ä¸Šï¼Œç”Ÿæˆä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°†æ•°æ®å†™å…¥æœ¬åœ°ç£ç›˜ä¹‹å‰ï¼Œå…ˆè¦å¯¹æ•°æ®è¿›è¡Œä¸€æ¬¡æœ¬åœ°æ’åºï¼Œå¹¶åœ¨å¿…è¦æ—¶å¯¹æ•°æ®è¿›è¡Œåˆå¹¶ã€å‹ç¼©ç­‰æ“ä½œã€‚æº¢å†™é˜¶æ®µè¯¦æƒ…ï¼š
<ul>
<li>æ­¥éª¤1ï¼šåˆ©ç”¨å¿«é€Ÿæ’åºç®—æ³•å¯¹ç¼“å­˜åŒºå†…çš„æ•°æ®è¿›è¡Œæ’åºï¼Œæ’åºæ–¹å¼æ˜¯ï¼Œå…ˆæŒ‰ç…§åˆ†åŒºç¼–å·Partitionè¿›è¡Œæ’åºï¼Œç„¶åæŒ‰ç…§keyè¿›è¡Œæ’åºã€‚è¿™æ ·ï¼Œç»è¿‡æ’åºåï¼Œæ•°æ®ä»¥åˆ†åŒºä¸ºå•ä½èšé›†åœ¨ä¸€èµ·ï¼Œä¸”åŒä¸€åˆ†åŒºå†…æ‰€æœ‰æ•°æ®æŒ‰ç…§keyæœ‰åºã€‚</li>
<li>æ­¥éª¤2ï¼šæŒ‰ç…§åˆ†åŒºç¼–å·ç”±å°åˆ°å¤§ä¾æ¬¡å°†æ¯ä¸ªåˆ†åŒºä¸­çš„æ•°æ®å†™å…¥ä»»åŠ¡å·¥ä½œç›®å½•ä¸‹çš„ä¸´æ—¶æ–‡ä»¶output/spillN.outï¼ˆNè¡¨ç¤ºå½“å‰æº¢å†™æ¬¡æ•°ï¼‰ä¸­ã€‚å¦‚æœç”¨æˆ·è®¾ç½®äº†Combinerï¼Œåˆ™å†™å…¥æ–‡ä»¶ä¹‹å‰ï¼Œå¯¹æ¯ä¸ªåˆ†åŒºä¸­çš„æ•°æ®è¿›è¡Œä¸€æ¬¡èšé›†æ“ä½œã€‚</li>
<li>æ­¥éª¤3ï¼šå°†åˆ†åŒºæ•°æ®çš„å…ƒä¿¡æ¯å†™åˆ°å†…å­˜ç´¢å¼•æ•°æ®ç»“æ„SpillRecordä¸­ï¼Œå…¶ä¸­æ¯ä¸ªåˆ†åŒºçš„å…ƒä¿¡æ¯åŒ…æ‹¬åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­çš„åç§»é‡ã€å‹ç¼©å‰æ•°æ®å¤§å°å’Œå‹ç¼©åæ•°æ®å¤§å°ã€‚å¦‚æœå½“å‰å†…å­˜ç´¢å¼•å¤§å°è¶…è¿‡1MBï¼Œåˆ™å°†å†…å­˜ç´¢å¼•å†™åˆ°æ–‡ä»¶output/spillN.out.indexä¸­ã€‚</li>
</ul>
</li>
<li>Mergeé˜¶æ®µï¼šå½“æ‰€æœ‰æ•°æ®å¤„ç†å®Œæˆåï¼ŒMapTaskå¯¹æ‰€æœ‰ä¸´æ—¶æ–‡ä»¶è¿›è¡Œä¸€æ¬¡åˆå¹¶ï¼Œä»¥ç¡®ä¿æœ€ç»ˆåªä¼šç”Ÿæˆä¸€ä¸ªæ•°æ®æ–‡ä»¶ã€‚å½“æ‰€æœ‰æ•°æ®å¤„ç†å®Œåï¼ŒMapTaskä¼šå°†æ‰€æœ‰ä¸´æ—¶æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œå¹¶ä¿å­˜åˆ°æ–‡ä»¶output/file.outä¸­ï¼ŒåŒæ—¶ç”Ÿæˆç›¸åº”çš„ç´¢å¼•æ–‡ä»¶output/file.out.indexã€‚åœ¨è¿›è¡Œæ–‡ä»¶åˆå¹¶è¿‡ç¨‹ä¸­ï¼ŒMapTaskä»¥åˆ†åŒºä¸ºå•ä½è¿›è¡Œåˆå¹¶ã€‚å¯¹äºæŸä¸ªåˆ†åŒºï¼Œå®ƒå°†é‡‡ç”¨å¤šè½®é€’å½’åˆå¹¶çš„æ–¹å¼ã€‚æ¯è½®åˆå¹¶mapreduce.task.io.sort.factorï¼ˆé»˜è®¤10ï¼‰ä¸ªæ–‡ä»¶ï¼Œå¹¶å°†äº§ç”Ÿçš„æ–‡ä»¶é‡æ–°åŠ å…¥å¾…åˆå¹¶åˆ—è¡¨ä¸­ï¼Œå¯¹æ–‡ä»¶æ’åºåï¼Œé‡å¤ä»¥ä¸Šè¿‡ç¨‹ï¼Œç›´åˆ°æœ€ç»ˆå¾—åˆ°ä¸€ä¸ªå¤§æ–‡ä»¶ã€‚è®©æ¯ä¸ªMapTaskæœ€ç»ˆåªç”Ÿæˆä¸€ä¸ªæ•°æ®æ–‡ä»¶ï¼Œå¯é¿å…åŒæ—¶æ‰“å¼€å¤§é‡æ–‡ä»¶å’ŒåŒæ—¶è¯»å–å¤§é‡å°æ–‡ä»¶äº§ç”Ÿçš„éšæœºè¯»å–å¸¦æ¥çš„å¼€é”€</li>
</ul>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330925.png" alt></p>
<p><strong>ReduceTaskå·¥ä½œæœºåˆ¶</strong></p>
<ul>
<li>Copyé˜¶æ®µï¼šReduceTaskä»å„ä¸ªMapTaskä¸Šè¿œç¨‹æ‹·è´ä¸€ç‰‡æ•°æ®ï¼Œå¹¶é’ˆå¯¹æŸä¸€ç‰‡æ•°æ®ï¼Œå¦‚æœå…¶å¤§å°è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼Œåˆ™å†™åˆ°ç£ç›˜ä¸Šï¼Œå¦åˆ™ç›´æ¥æ”¾åˆ°å†…å­˜ä¸­</li>
<li>Sorté˜¶æ®µï¼šåœ¨è¿œç¨‹æ‹·è´æ•°æ®çš„åŒæ—¶ï¼ŒReduceTaskå¯åŠ¨äº†ä¸¤ä¸ªåå°çº¿ç¨‹å¯¹å†…å­˜å’Œç£ç›˜ä¸Šçš„æ–‡ä»¶è¿›è¡Œåˆå¹¶ï¼Œä»¥é˜²æ­¢å†…å­˜ä½¿ç”¨è¿‡å¤šæˆ–ç£ç›˜ä¸Šæ–‡ä»¶è¿‡å¤šã€‚æŒ‰ç…§MapReduceè¯­ä¹‰ï¼Œç”¨æˆ·ç¼–å†™reduce()å‡½æ•°è¾“å…¥æ•°æ®æ˜¯æŒ‰keyè¿›è¡Œèšé›†çš„ä¸€ç»„æ•°æ®ã€‚ä¸ºäº†å°†keyç›¸åŒçš„æ•°æ®èšåœ¨ä¸€èµ·ï¼ŒHadoopé‡‡ç”¨äº†åŸºäºæ’åºçš„ç­–ç•¥ã€‚ç”±äºå„ä¸ªMapTaskå·²ç»å®ç°å¯¹è‡ªå·±çš„å¤„ç†ç»“æœè¿›è¡Œäº†å±€éƒ¨æ’åºï¼Œå› æ­¤ï¼ŒReduceTaskåªéœ€å¯¹æ‰€æœ‰æ•°æ®è¿›è¡Œä¸€æ¬¡å½’å¹¶æ’åºå³å¯</li>
<li>Reduceé˜¶æ®µï¼šreduce()å‡½æ•°å°†è®¡ç®—ç»“æœå†™åˆ°HDFSä¸Šã€‚</li>
</ul>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330926.png" alt></p>
<p><strong>ReduceTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶</strong></p>
<p>MapTaskå¹¶è¡Œåº¦ç”±åˆ‡ç‰‡ä¸ªæ•°å†³å®šï¼Œåˆ‡ç‰‡ä¸ªæ•°ç”±è¾“å…¥æ–‡ä»¶å’Œåˆ‡ç‰‡è§„åˆ™å†³å®šã€‚reduceTaskçš„å¹¶è¡Œåº¦åŒæ ·å½±å“æ•´ä¸ªJobçš„æ‰§è¡Œå¹¶å‘åº¦å’Œæ‰§è¡Œæ•ˆç‡ï¼Œä½†ä¸MapTaskçš„å¹¶å‘æ•°ç”±åˆ‡ç‰‡æ•°å†³å®šä¸åŒï¼ŒReduceTaskæ•°é‡çš„å†³å®šæ˜¯å¯ä»¥ç›´æ¥æ‰‹åŠ¨è®¾ç½®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é»˜è®¤å€¼æ˜¯1ï¼Œæ‰‹åŠ¨è®¾ç½®ä¸º4</span></span><br><span class="line">job.setNumReduceTasks(<span class="number">4</span>);</span><br><span class="line"><span class="comment">// ReduceTask=Oï¼Œè¡¨ç¤ºæ¼«æœ‰Reduceé˜¶æ®µï¼Œè¾“å‡ºæ–‡ä»¶ä¸ªæ•°æ•°å£Mapä¸ªæ•°ä¸€è‡´ã€‚</span></span><br><span class="line"><span class="comment">// ReduceTask:é»˜è®¤å€¼å°±æ˜¯1ï¼Œæ‰€ä»¥è¾“å‡ºæ–‡ä»¶ä¸ªæ•°ä¸ºä¸€ä¸ªã€‚</span></span><br><span class="line"><span class="comment">// å¦‚æœæ•°æ®åˆ†å¸ƒä¸å‡åŒ€ï¼Œå°±æœ‰å¯èƒ½åœ¨Reduceé˜¶æ®µäº§ç”Ÿæ•°å±…å€¾æ–œ</span></span><br><span class="line"><span class="comment">// ReduceTaskæ•°é‡å¹¶ä¸æ˜¯ä»»æ„è®¾ç½®ï¼Œè¿˜è¦è€ƒè™‘ä¸šåŠ¡é€»è¾‘éœ€æ±‚ï¼Œæœ‰äº›æƒ…å†µä¸‹ï¼Œéœ€è¦è®¡ç®—å…¨å±€æ±‡æ€»ç»“æœï¼Œå°±åªèƒ½æœ‰1ä¸ªReduceTaskã€‚</span></span><br><span class="line"><span class="comment">// å…·ä½“å¤šå°‘ä¸ªReduceTaskï¼Œéœ€è¦æ ¹æ®é›†ç¾¤æ€§èƒ½è€Œå®šã€‚ä¸€èˆ¬ç­‰äºcpuå†…æ ¸æ•°æœ€ä½³</span></span><br><span class="line"><span class="comment">// å¦‚æœåˆ†åŒºæ•°ä¸æ˜¯1ï¼Œä½†æ˜¯ReduceTaskä¸º1ï¼Œæ˜¯å¦æ‰§è¡Œåˆ†åŒºè¿‡ç¨‹ã€‚ç­”æ¡ˆæ˜¯:ä¸æ‰§è¡Œåˆ†åŒºè¿‡ç¨‹ã€‚å› ä¸ºåœ¨M apTaskçš„æºç ä¸­ï¼Œæ‰§è¡Œåˆ†åŒºçš„å‰ææ˜¯å…ˆåˆ¤æ–­ReduceNumä¸ªæ•°æ˜¯å¦å¤§äº1ã€‚ä¸å¤§äº1è‚¯å®šä¸æ‰§è¡Œã€‚</span></span><br></pre></td></tr></table></figure>
<p><strong>MapTask &amp; ReduceTaskæºç è§£æ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">=================== MapTask ===================</span><br><span class="line">context.write(k, NullWritable.get());   </span><br><span class="line"><span class="comment">//è‡ªå®šä¹‰çš„mapæ–¹æ³•çš„å†™å‡ºï¼Œè¿›å…¥</span></span><br><span class="line">output.write(key, value);  </span><br><span class="line">  <span class="comment">//MapTask727è¡Œï¼Œæ”¶é›†æ–¹æ³•ï¼Œè¿›å…¥ä¸¤æ¬¡ </span></span><br><span class="line">  collector.collect(key, value,partitioner.getPartition(key, value, partitions));</span><br><span class="line">  HashPartitioner(); <span class="comment">//é»˜è®¤åˆ†åŒºå™¨</span></span><br><span class="line">  <span class="comment">//MapTask1082è¡Œ mapç«¯æ‰€æœ‰çš„kvå…¨éƒ¨å†™å‡ºåä¼šèµ°ä¸‹é¢çš„closeæ–¹æ³•</span></span><br><span class="line">  collect()  </span><br><span class="line">    close() <span class="comment">//MapTask732è¡Œ</span></span><br><span class="line">    collector.flush() <span class="comment">// æº¢å‡ºåˆ·å†™æ–¹æ³•ï¼ŒMapTask735è¡Œï¼Œæå‰æ‰“ä¸ªæ–­ç‚¹ï¼Œè¿›å…¥</span></span><br><span class="line">      sortAndSpill() <span class="comment">//æº¢å†™æ’åºï¼ŒMapTask1505è¡Œï¼Œè¿›å…¥</span></span><br><span class="line">        sorter.sort()   QuickSort <span class="comment">//æº¢å†™æ’åºæ–¹æ³•ï¼ŒMapTask1625è¡Œï¼Œè¿›å…¥</span></span><br><span class="line">       mergeParts(); <span class="comment">//åˆå¹¶æ–‡ä»¶ï¼ŒMapTask1527è¡Œï¼Œè¿›å…¥</span></span><br><span class="line"></span><br><span class="line">     collector.close(); <span class="comment">//MapTask739è¡Œ,æ”¶é›†å™¨å…³é—­,å³å°†è¿›å…¥ReduceTask</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=================== ReduceTask ===================</span><br><span class="line"><span class="keyword">if</span> (isMapOrReduce())  <span class="comment">//reduceTask324è¡Œï¼Œæå‰æ‰“æ–­ç‚¹</span></span><br><span class="line">initialize()   <span class="comment">// reduceTask333è¡Œ,è¿›å…¥</span></span><br><span class="line">init(shuffleContext);  <span class="comment">// reduceTask375è¡Œ,èµ°åˆ°è¿™éœ€è¦å…ˆç»™ä¸‹é¢çš„æ‰“æ–­ç‚¹</span></span><br><span class="line">        totalMaps = job.getNumMapTasks(); <span class="comment">// ShuffleSchedulerImplç¬¬120è¡Œï¼Œæå‰æ‰“æ–­ç‚¹</span></span><br><span class="line">         merger = createMergeManager(context); <span class="comment">//åˆå¹¶æ–¹æ³•ï¼ŒShuffleç¬¬80è¡Œ</span></span><br><span class="line">      <span class="comment">// MergeManagerImplç¬¬232 235è¡Œï¼Œæå‰æ‰“æ–­ç‚¹</span></span><br><span class="line">      <span class="keyword">this</span>.inMemoryMerger = createInMemoryMerger(); <span class="comment">//å†…å­˜åˆå¹¶</span></span><br><span class="line">      <span class="keyword">this</span>.onDiskMerger = <span class="keyword">new</span> OnDiskMerger(<span class="keyword">this</span>); <span class="comment">//ç£ç›˜åˆå¹¶</span></span><br><span class="line">rIter = shuffleConsumerPlugin.run();</span><br><span class="line">    eventFetcher.start();  <span class="comment">//å¼€å§‹æŠ“å–æ•°æ®ï¼ŒShuffleç¬¬107è¡Œï¼Œæå‰æ‰“æ–­ç‚¹</span></span><br><span class="line">    eventFetcher.shutDown();  <span class="comment">//æŠ“å–ç»“æŸï¼ŒShuffleç¬¬141è¡Œï¼Œæå‰æ‰“æ–­ç‚¹</span></span><br><span class="line">    copyPhase.complete();   <span class="comment">//copyé˜¶æ®µå®Œæˆï¼ŒShuffleç¬¬151è¡Œ</span></span><br><span class="line">    taskStatus.setPhase(TaskStatus.Phase.SORT);  <span class="comment">//å¼€å§‹æ’åºé˜¶æ®µï¼ŒShuffleç¬¬152è¡Œ</span></span><br><span class="line">  sortPhase.complete();   <span class="comment">//æ’åºé˜¶æ®µå®Œæˆï¼Œå³å°†è¿›å…¥reduceé˜¶æ®µ reduceTask382è¡Œ</span></span><br><span class="line">reduce();  <span class="comment">//reduceé˜¶æ®µè°ƒç”¨çš„å°±æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„reduceæ–¹æ³•ï¼Œä¼šè¢«è°ƒç”¨å¤šæ¬¡</span></span><br><span class="line">  cleanup(context); <span class="comment">//reduceå®Œæˆä¹‹å‰ï¼Œä¼šæœ€åè°ƒç”¨ä¸€æ¬¡Reduceré‡Œé¢çš„cleanupæ–¹æ³•</span></span><br></pre></td></tr></table></figure>
<h3 id="3-6-Joinåº”ç”¨">3.6 Joinåº”ç”¨</h3>
<p>ç°åœ¨æœ‰ä»¥ä¸‹éœ€æ±‚</p>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330927.png" alt></p>
<p>é¦–å…ˆæ˜¯ä¼ ç»Ÿçš„æ–¹å¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TableBean</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TableBean</span> <span class="keyword">implements</span> <span class="title">Writable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String id; <span class="comment">//è®¢å•id</span></span><br><span class="line">    <span class="keyword">private</span> String pid; <span class="comment">//äº§å“id</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> amount; <span class="comment">//äº§å“æ•°é‡</span></span><br><span class="line">    <span class="keyword">private</span> String pname; <span class="comment">//äº§å“åç§°</span></span><br><span class="line">    <span class="keyword">private</span> String flag; <span class="comment">//åˆ¤æ–­æ˜¯orderè¡¨è¿˜æ˜¯pdè¡¨çš„æ ‡å¿—å­—æ®µ</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TableBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPid</span><span class="params">(String pid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pid = pid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAmount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> amount;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAmount</span><span class="params">(<span class="keyword">int</span> amount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.amount = amount;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pname;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPname</span><span class="params">(String pname)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pname = pname;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFlag</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFlag</span><span class="params">(String flag)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.flag = flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id + <span class="string">"\t"</span> + pname + <span class="string">"\t"</span> + amount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(DataOutput out)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        out.writeUTF(id);</span><br><span class="line">        out.writeUTF(pid);</span><br><span class="line">        out.writeInt(amount);</span><br><span class="line">        out.writeUTF(pname);</span><br><span class="line">        out.writeUTF(flag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readFields</span><span class="params">(DataInput in)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = in.readUTF();</span><br><span class="line">        <span class="keyword">this</span>.pid = in.readUTF();</span><br><span class="line">        <span class="keyword">this</span>.amount = in.readInt();</span><br><span class="line">        <span class="keyword">this</span>.pname = in.readUTF();</span><br><span class="line">        <span class="keyword">this</span>.flag = in.readUTF();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//TableMapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TableMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>,<span class="title">Text</span>,<span class="title">TableBean</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String filename;</span><br><span class="line">    <span class="keyword">private</span> Text outK = <span class="keyword">new</span> Text();</span><br><span class="line">    <span class="keyword">private</span> TableBean outV = <span class="keyword">new</span> TableBean();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setup</span><span class="params">(Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//è·å–å¯¹åº”æ–‡ä»¶åç§°</span></span><br><span class="line">        InputSplit split = context.getInputSplit();</span><br><span class="line">        FileSplit fileSplit = (FileSplit) split;</span><br><span class="line">        filename = fileSplit.getPath().getName();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–ä¸€è¡Œ</span></span><br><span class="line">        String line = value.toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ¤æ–­æ˜¯å“ªä¸ªæ–‡ä»¶,ç„¶åé’ˆå¯¹æ–‡ä»¶è¿›è¡Œä¸åŒçš„æ“ä½œ</span></span><br><span class="line">        <span class="keyword">if</span>(filename.contains(<span class="string">"order"</span>))&#123;  <span class="comment">//è®¢å•è¡¨çš„å¤„ç†</span></span><br><span class="line">            String[] split = line.split(<span class="string">"\t"</span>);</span><br><span class="line">            <span class="comment">//å°è£…outK</span></span><br><span class="line">            outK.set(split[<span class="number">1</span>]);</span><br><span class="line">            <span class="comment">//å°è£…outV</span></span><br><span class="line">            outV.setId(split[<span class="number">0</span>]);</span><br><span class="line">            outV.setPid(split[<span class="number">1</span>]);</span><br><span class="line">            outV.setAmount(Integer.parseInt(split[<span class="number">2</span>]));</span><br><span class="line">            outV.setPname(<span class="string">""</span>);</span><br><span class="line">            outV.setFlag(<span class="string">"order"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;                             <span class="comment">//å•†å“è¡¨çš„å¤„ç†</span></span><br><span class="line">            String[] split = line.split(<span class="string">"\t"</span>);</span><br><span class="line">            <span class="comment">//å°è£…outK</span></span><br><span class="line">            outK.set(split[<span class="number">0</span>]);</span><br><span class="line">            <span class="comment">//å°è£…outV</span></span><br><span class="line">            outV.setId(<span class="string">""</span>);</span><br><span class="line">            outV.setPid(split[<span class="number">0</span>]);</span><br><span class="line">            outV.setAmount(<span class="number">0</span>);</span><br><span class="line">            outV.setPname(split[<span class="number">1</span>]);</span><br><span class="line">            outV.setFlag(<span class="string">"pd"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å†™å‡ºKV</span></span><br><span class="line">        context.write(outK,outV);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TableReducer</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>,<span class="title">TableBean</span>,<span class="title">TableBean</span>, <span class="title">NullWritable</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;TableBean&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        ArrayList&lt;TableBean&gt; orderBeans = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        TableBean pdBean = <span class="keyword">new</span> TableBean();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (TableBean value : values) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åˆ¤æ–­æ•°æ®æ¥è‡ªå“ªä¸ªè¡¨</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="string">"order"</span>.equals(value.getFlag()))&#123;   <span class="comment">//è®¢å•è¡¨</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">//åˆ›å»ºä¸€ä¸ªä¸´æ—¶TableBeanå¯¹è±¡æ¥æ”¶value</span></span><br><span class="line">                TableBean tmpOrderBean = <span class="keyword">new</span> TableBean();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    BeanUtils.copyProperties(tmpOrderBean,value);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IllegalAccessException | InvocationTargetException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//å°†ä¸´æ—¶TableBeanå¯¹è±¡æ·»åŠ åˆ°é›†åˆorderBeans</span></span><br><span class="line">                orderBeans.add(tmpOrderBean);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;                                    <span class="comment">//å•†å“è¡¨</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    BeanUtils.copyProperties(pdBean,value);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IllegalAccessException | InvocationTargetException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//éå†é›†åˆorderBeans,æ›¿æ¢æ‰æ¯ä¸ªorderBeançš„pidä¸ºpname,ç„¶åå†™å‡º</span></span><br><span class="line">        <span class="keyword">for</span> (TableBean orderBean : orderBeans) &#123;</span><br><span class="line"></span><br><span class="line">            orderBean.setPname(pdBean.getPname());</span><br><span class="line">            <span class="comment">//å†™å‡ºä¿®æ”¹åçš„orderBeanå¯¹è±¡</span></span><br><span class="line">            context.write(orderBean,NullWritable.get());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TableDriver</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, InterruptedException </span>&#123;</span><br><span class="line">        Job job = Job.getInstance(<span class="keyword">new</span> Configuration());</span><br><span class="line"></span><br><span class="line">        job.setJarByClass(TableDriver<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setMapperClass(TableMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setReducerClass(TableReducer<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        job.setMapOutputKeyClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setMapOutputValueClass(TableBean<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        job.setOutputKeyClass(TableBean<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputValueClass(NullWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        FileInputFormat.setInputPaths(job, <span class="keyword">new</span> Path(<span class="string">"C:\\Users\\SHAWN\\Desktop\\Hadoop3.x\\input"</span>));</span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(<span class="string">"C:\\Users\\SHAWN\\Desktop\\Hadoop3.x\\output"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> b = job.waitForCompletion(<span class="keyword">true</span>);</span><br><span class="line">        System.exit(b ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†è¿™ç§æ–¹å¼ä¸­ï¼Œåˆå¹¶çš„æ“ä½œæ˜¯åœ¨Reduceé˜¶æ®µå®Œæˆï¼ŒReduceç«¯çš„å¤„ç†å‹åŠ›å¤ªå¤§ï¼ŒMapèŠ‚ç‚¹çš„è¿ç®—è´Ÿè½½åˆ™å¾ˆä½ï¼Œèµ„æºåˆ©ç”¨ç‡ä¸é«˜ï¼Œä¸”åœ¨Reduceé˜¶æ®µææ˜“äº§ç”Ÿæ•°æ®å€¾æ–œã€‚<strong>è§£å†³æ–¹æ¡ˆï¼šMapç«¯å®ç°æ•°æ®åˆå¹¶</strong></p>
<p>Map Joiné€‚ç”¨äºä¸€å¼ è¡¨ååˆ†å°ã€ä¸€å¼ è¡¨å¾ˆå¤§çš„åœºæ™¯ã€‚åœ¨Mapç«¯ç¼“å­˜å¤šå¼ è¡¨ï¼Œæå‰å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œè¿™æ ·å¢åŠ Mapç«¯ä¸šåŠ¡ï¼Œå‡å°‘Reduceç«¯æ•°æ®çš„å‹åŠ›ï¼Œå°½å¯èƒ½çš„å‡å°‘æ•°æ®å€¾æ–œã€‚<strong>å…·ä½“åŠæ³•ï¼šé‡‡ç”¨DistributedCache</strong>ï¼Œåœ¨Mapperçš„setupé˜¶æ®µï¼Œå°†æ–‡ä»¶è¯»å–åˆ°ç¼“å­˜é›†åˆä¸­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å…ˆåœ¨MapJoinDriveré©±åŠ¨ç±»ä¸­æ·»åŠ ç¼“å­˜æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapJoinDriver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, URISyntaxException, ClassNotFoundException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1 è·å–jobä¿¡æ¯</span></span><br><span class="line">        Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        Job job = Job.getInstance(conf);</span><br><span class="line">        <span class="comment">// 2 è®¾ç½®åŠ è½½jaråŒ…è·¯å¾„</span></span><br><span class="line">        job.setJarByClass(MapJoinDriver<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">// 3 å…³è”mapper</span></span><br><span class="line">        job.setMapperClass(MapJoinMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">// 4 è®¾ç½®Mapè¾“å‡ºKVç±»å‹</span></span><br><span class="line">        job.setMapOutputKeyClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setMapOutputValueClass(NullWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">// 5 è®¾ç½®æœ€ç»ˆè¾“å‡ºKVç±»å‹</span></span><br><span class="line">        job.setOutputKeyClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputValueClass(NullWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŠ è½½ç¼“å­˜æ•°æ®</span></span><br><span class="line">        job.addCacheFile(<span class="keyword">new</span> URI(<span class="string">"file:///D:/input/tablecache/pd.txt"</span>));</span><br><span class="line">        <span class="comment">// Mapç«¯Joinçš„é€»è¾‘ä¸éœ€è¦Reduceé˜¶æ®µï¼Œè®¾ç½®reduceTaskæ•°é‡ä¸º0</span></span><br><span class="line">        job.setNumReduceTasks(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6 è®¾ç½®è¾“å…¥è¾“å‡ºè·¯å¾„</span></span><br><span class="line">        FileInputFormat.setInputPaths(job, <span class="keyword">new</span> Path(<span class="string">"D:\\input"</span>));</span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(<span class="string">"D:\\output"</span>));</span><br><span class="line">        <span class="comment">// 7 æäº¤</span></span><br><span class="line">        <span class="keyword">boolean</span> b = job.waitForCompletion(<span class="keyword">true</span>);</span><br><span class="line">        System.exit(b ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åœ¨MapJoinMapperç±»ä¸­çš„setupæ–¹æ³•ä¸­è¯»å–ç¼“å­˜æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapJoinMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">NullWritable</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; pdMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> Text text = <span class="keyword">new</span> Text();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä»»åŠ¡å¼€å§‹å‰å°†pdæ•°æ®ç¼“å­˜è¿›pdMap</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setup</span><span class="params">(Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//é€šè¿‡ç¼“å­˜æ–‡ä»¶å¾—åˆ°å°è¡¨æ•°æ®pd.txt</span></span><br><span class="line">        URI[] cacheFiles = context.getCacheFiles();</span><br><span class="line">        Path path = <span class="keyword">new</span> Path(cacheFiles[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡,å¹¶å¼€æµ</span></span><br><span class="line">        FileSystem fs = FileSystem.get(context.getConfiguration());</span><br><span class="line">        FSDataInputStream fis = fs.open(path);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//é€šè¿‡åŒ…è£…æµè½¬æ¢ä¸ºreader,æ–¹ä¾¿æŒ‰è¡Œè¯»å–</span></span><br><span class="line">        BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(fis, <span class="string">"UTF-8"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//é€è¡Œè¯»å–ï¼ŒæŒ‰è¡Œå¤„ç†</span></span><br><span class="line">        String line;</span><br><span class="line">        <span class="keyword">while</span> (StringUtils.isNotEmpty(line = reader.readLine())) &#123;</span><br><span class="line">            <span class="comment">//åˆ‡å‰²ä¸€è¡Œ    </span></span><br><span class="line">            <span class="comment">//01  å°ç±³</span></span><br><span class="line">            String[] split = line.split(<span class="string">"\t"</span>);</span><br><span class="line">            pdMap.put(split[<span class="number">0</span>], split[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å…³æµ</span></span><br><span class="line">        IOUtils.closeStream(reader);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¯»å–å¤§è¡¨æ•°æ®    </span></span><br><span class="line">        <span class="comment">//1001  01  1</span></span><br><span class="line">        String[] fields = value.toString().split(<span class="string">"\t"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//é€šè¿‡å¤§è¡¨æ¯è¡Œæ•°æ®çš„pid,å»pdMapé‡Œé¢å–å‡ºpname</span></span><br><span class="line">        String pname = pdMap.get(fields[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å°†å¤§è¡¨æ¯è¡Œæ•°æ®çš„pidæ›¿æ¢ä¸ºpname</span></span><br><span class="line">        text.set(fields[<span class="number">0</span>] + <span class="string">"\t"</span> + pname + <span class="string">"\t"</span> + fields[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å†™å‡º</span></span><br><span class="line">        context.write(text,NullWritable.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-7-æ•°æ®æ¸…æ´—-ETL">3.7 æ•°æ®æ¸…æ´—(ETL)</h3>
<p>ETLï¼Œæ˜¯è‹±æ–‡Extract-Transform-Loadçš„ç¼©å†™ï¼Œç”¨æ¥æè¿°å°†æ•°æ®ä»æ¥æºç«¯ç»è¿‡æŠ½å–ï¼ˆExtractï¼‰ã€è½¬æ¢ï¼ˆTransformï¼‰ã€åŠ è½½ï¼ˆLoadï¼‰è‡³ç›®çš„ç«¯çš„è¿‡ç¨‹ã€‚ETLä¸€è¯è¾ƒå¸¸ç”¨åœ¨æ•°æ®ä»“åº“ï¼Œä½†å…¶å¯¹è±¡å¹¶ä¸é™äºæ•°æ®ä»“åº“ã€‚</p>
<p>åœ¨è¿è¡Œæ ¸å¿ƒä¸šåŠ¡MapReduceç¨‹åºä¹‹å‰ï¼Œå¾€å¾€è¦å…ˆå¯¹æ•°æ®è¿›è¡Œæ¸…æ´—ï¼Œæ¸…ç†æ‰ä¸ç¬¦åˆç”¨æˆ·è¦æ±‚çš„æ•°æ®ã€‚**æ¸…ç†çš„è¿‡ç¨‹å¾€å¾€åªéœ€è¦è¿è¡ŒMapperç¨‹åºï¼Œä¸éœ€è¦è¿è¡ŒReduceç¨‹åºã€‚**ä¾‹å¦‚å»é™¤æ—¥å¿—ä¸­å­—æ®µä¸ªæ•°å°äºç­‰äº11çš„æ—¥å¿—</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">194.237.142.21 - - [18/Sep/2013:06:49:18 +0000] <span class="string">"GET /wp-content/uploads/2013/07/rstudio-git3.png HTTP/1.1"</span> 304 0 <span class="string">"-"</span> <span class="string">"Mozilla/4.0 (compatible;)"</span></span><br><span class="line">183.49.46.228 - - [18/Sep/2013:06:49:23 +0000] <span class="string">"-"</span> 400 0 <span class="string">"-"</span> <span class="string">"-"</span></span><br><span class="line">163.177.71.12 - - [18/Sep/2013:06:49:33 +0000] <span class="string">"HEAD / HTTP/1.1"</span> 200 20 <span class="string">"-"</span> <span class="string">"DNSPod-Monitor/1.0"</span></span><br><span class="line">163.177.71.12 - - [18/Sep/2013:06:49:36 +0000] <span class="string">"HEAD / HTTP/1.1"</span> 200 20 <span class="string">"-"</span> <span class="string">"DNSPod-Monitor/1.0"</span></span><br><span class="line">101.226.68.137 - - [18/Sep/2013:06:49:42 +0000] <span class="string">"HEAD / HTTP/1.1"</span> 200 20 <span class="string">"-"</span> <span class="string">"DNSPod-Monitor/1.0"</span></span><br><span class="line">101.226.68.137 - - [18/Sep/2013:06:49:45 +0000] <span class="string">"HEAD / HTTP/1.1"</span> 200 20 <span class="string">"-"</span> <span class="string">"DNSPod-Monitor/1.0"</span></span><br></pre></td></tr></table></figure>
<p>éœ€è¦åœ¨Mapé˜¶æ®µå¯¹è¾“å…¥çš„æ•°æ®æ ¹æ®è§„åˆ™è¿›è¡Œè¿‡æ»¤æ¸…æ´—ï¼Œå¼€å§‹ç¼–å†™ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¼–å†™WebLogMapperç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebLogMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">NullWritable</span>&gt;</span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1 è·å–1è¡Œæ•°æ®</span></span><br><span class="line">    String line = value.toString();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2 è§£ææ—¥å¿—</span></span><br><span class="line">    <span class="keyword">boolean</span> result = parseLog(line,context);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3 æ—¥å¿—ä¸åˆæ³•é€€å‡º</span></span><br><span class="line">    <span class="keyword">if</span> (!result) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4 æ—¥å¿—åˆæ³•å°±ç›´æ¥å†™å‡º</span></span><br><span class="line">    context.write(value, NullWritable.get());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2 å°è£…è§£ææ—¥å¿—çš„æ–¹æ³•</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">parseLog</span><span class="params">(String line, Context context)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1 æˆªå–</span></span><br><span class="line">    String[] fields = line.split(<span class="string">" "</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2 æ—¥å¿—é•¿åº¦å¤§äº11çš„ä¸ºåˆæ³•</span></span><br><span class="line">    <span class="keyword">if</span> (fields.length &gt; <span class="number">11</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼–å†™WebLogDriverç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebLogDriver</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å…¥è¾“å‡ºè·¯å¾„éœ€è¦æ ¹æ®è‡ªå·±ç”µè„‘ä¸Šå®é™…çš„è¾“å…¥è¾“å‡ºè·¯å¾„è®¾ç½®</span></span><br><span class="line">        args = <span class="keyword">new</span> String[] &#123; <span class="string">"D:/input/inputlog"</span>, <span class="string">"D:/output1"</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1 è·å–jobä¿¡æ¯</span></span><br><span class="line">    Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">    Job job = Job.getInstance(conf);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2 åŠ è½½jaråŒ…</span></span><br><span class="line">    job.setJarByClass(LogDriver<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3 å…³è”map</span></span><br><span class="line">    job.setMapperClass(WebLogMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4 è®¾ç½®æœ€ç»ˆè¾“å‡ºç±»å‹</span></span><br><span class="line">    job.setOutputKeyClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    job.setOutputValueClass(NullWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®reducetaskä¸ªæ•°ä¸º0</span></span><br><span class="line">    job.setNumReduceTasks(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5 è®¾ç½®è¾“å…¥å’Œè¾“å‡ºè·¯å¾„</span></span><br><span class="line">    FileInputFormat.setInputPaths(job, <span class="keyword">new</span> Path(args[<span class="number">0</span>]));</span><br><span class="line">    FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(args[<span class="number">1</span>]));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6 æäº¤</span></span><br><span class="line">         <span class="keyword">boolean</span> b = job.waitForCompletion(<span class="keyword">true</span>);</span><br><span class="line">         System.exit(b ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-8-MapReduceå¼€å‘æ€»ç»“">3.8 MapReduceå¼€å‘æ€»ç»“</h3>
<ul>
<li>
<p>è¾“å…¥æ•°æ®æ¥å£ï¼šInputFormat</p>
<ul>
<li>é»˜è®¤ä½¿ç”¨çš„å®ç°ç±»æ˜¯ï¼šTextInputFormat</li>
<li>TextInputFormatçš„åŠŸèƒ½é€»è¾‘æ˜¯ï¼šä¸€æ¬¡è¯»ä¸€è¡Œæ–‡æœ¬ï¼Œç„¶åå°†è¯¥è¡Œçš„èµ·å§‹åç§»é‡ä½œä¸ºkeyï¼Œè¡Œå†…å®¹ä½œä¸ºvalueè¿”å›</li>
<li>CombineTextInputFormatå¯ä»¥æŠŠå¤šä¸ªå°æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªåˆ‡ç‰‡å¤„ç†ï¼Œæé«˜å¤„ç†æ•ˆç‡ã€‚</li>
</ul>
</li>
<li>
<p>é€»è¾‘å¤„ç†æ¥å£ï¼šMapper </p>
<p>ç”¨æˆ·æ ¹æ®ä¸šåŠ¡éœ€æ±‚å®ç°å…¶ä¸­ä¸‰ä¸ªæ–¹æ³•ï¼šmap()   setup()   cleanup ()</p>
</li>
<li>
<p>Partitioneråˆ†åŒº</p>
<ul>
<li>æœ‰é»˜è®¤å®ç° HashPartitionerï¼Œé€»è¾‘æ˜¯æ ¹æ®keyçš„å“ˆå¸Œå€¼å’ŒnumReducesæ¥è¿”å›ä¸€ä¸ªåˆ†åŒºå·ï¼›key.hashCode()&amp;Integer.MAXVALUE % numReduces</li>
<li>å¦‚æœä¸šåŠ¡ä¸Šæœ‰ç‰¹åˆ«çš„éœ€æ±‚ï¼Œå¯ä»¥è‡ªå®šä¹‰åˆ†åŒº</li>
</ul>
</li>
<li>
<p>Comparableæ’åº</p>
<ul>
<li>å½“æˆ‘ä»¬ç”¨è‡ªå®šä¹‰çš„å¯¹è±¡ä½œä¸ºkeyæ¥è¾“å‡ºæ—¶ï¼Œå°±å¿…é¡»è¦å®ç°WritableComparableæ¥å£ï¼Œé‡å†™å…¶ä¸­çš„compareTo()æ–¹æ³•</li>
<li>éƒ¨åˆ†æ’åºï¼šå¯¹æœ€ç»ˆè¾“å‡ºçš„æ¯ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œå†…éƒ¨æ’åº</li>
<li>å…¨æ’åºï¼šå¯¹æ‰€æœ‰æ•°æ®è¿›è¡Œæ’åºï¼Œé€šå¸¸åªæœ‰ä¸€ä¸ªReduce</li>
<li>äºŒæ¬¡æ’åºï¼šæ’åºçš„æ¡ä»¶æœ‰ä¸¤ä¸ª</li>
</ul>
</li>
<li>
<p>Combineråˆå¹¶</p>
<p>Combineråˆå¹¶å¯ä»¥æé«˜ç¨‹åºæ‰§è¡Œæ•ˆç‡ï¼Œå‡å°‘IOä¼ è¾“ã€‚ä½†æ˜¯ä½¿ç”¨æ—¶å¿…é¡»ä¸èƒ½å½±å“åŸæœ‰çš„ä¸šåŠ¡å¤„ç†ç»“æœ</p>
</li>
<li>
<p>é€»è¾‘å¤„ç†æ¥å£ï¼šReducer</p>
<p>ç”¨æˆ·æ ¹æ®ä¸šåŠ¡éœ€æ±‚å®ç°å…¶ä¸­ä¸‰ä¸ªæ–¹æ³•ï¼šreduce()   setup()   cleanup () </p>
</li>
<li>
<p>è¾“å‡ºæ•°æ®æ¥å£ï¼šOutputFormat</p>
<ul>
<li>é»˜è®¤å®ç°ç±»æ˜¯TextOutputFormatï¼ŒåŠŸèƒ½é€»è¾‘æ˜¯ï¼šå°†æ¯ä¸€ä¸ªKVå¯¹ï¼Œå‘ç›®æ ‡æ–‡æœ¬æ–‡ä»¶è¾“å‡ºä¸€è¡Œ</li>
<li>ç”¨æˆ·è¿˜å¯ä»¥è‡ªå®šä¹‰OutputFormat</li>
</ul>
</li>
</ul>
<h2 id="4ã€Hadoopæ•°æ®å‹ç¼©">4ã€Hadoopæ•°æ®å‹ç¼©</h2>
<h3 id="4-1-æ¦‚è¿°">4.1 æ¦‚è¿°</h3>
<p><strong>å‹ç¼©çš„å¥½å¤„å’Œåå¤„</strong></p>
<ul>
<li>å‹ç¼©çš„ä¼˜ç‚¹ï¼šä»¥å‡å°‘ç£ç›˜IOã€å‡å°‘ç£ç›˜å­˜å‚¨ç©ºé—´</li>
<li>å‹ç¼©çš„ç¼ºç‚¹ï¼šå¢åŠ CPUå¼€é”€</li>
</ul>
<p><strong>å‹ç¼©åŸåˆ™</strong></p>
<ul>
<li>è¿ç®—å¯†é›†å‹çš„Jobï¼Œå°‘ç”¨å‹ç¼©</li>
<li>IOå¯†é›†å‹çš„Jobï¼Œå¤šç”¨å‹ç¼©</li>
</ul>
<h3 id="4-2-MRæ”¯æŒçš„å‹ç¼©ç¼–ç ">4.2 MRæ”¯æŒçš„å‹ç¼©ç¼–ç </h3>
<table>
<thead>
<tr>
<th>å‹ç¼©æ ¼å¼</th>
<th>Hadoopè‡ªå¸¦ï¼Ÿ</th>
<th>ç®—æ³•</th>
<th>æ–‡ä»¶æ‰©å±•å</th>
<th>æ˜¯å¦å¯åˆ‡ç‰‡</th>
<th>æ¢æˆå‹ç¼©æ ¼å¼åï¼ŒåŸæ¥çš„ç¨‹åºæ˜¯å¦éœ€è¦ä¿®æ”¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>DEFLATE</td>
<td>æ˜¯ï¼Œç›´æ¥ä½¿ç”¨</td>
<td>DEFLATE</td>
<td>.deflate</td>
<td>å¦</td>
<td>å’Œæ–‡æœ¬å¤„ç†ä¸€æ ·ï¼Œä¸éœ€è¦ä¿®æ”¹</td>
</tr>
<tr>
<td>Gzip</td>
<td>æ˜¯ï¼Œç›´æ¥ä½¿ç”¨</td>
<td>DEFLATE</td>
<td>.gz</td>
<td>å¦</td>
<td>å’Œæ–‡æœ¬å¤„ç†ä¸€æ ·ï¼Œä¸éœ€è¦ä¿®æ”¹</td>
</tr>
<tr>
<td>bzip2</td>
<td>æ˜¯ï¼Œç›´æ¥ä½¿ç”¨</td>
<td>bzip2</td>
<td>.bz2</td>
<td><strong>æ˜¯</strong></td>
<td>å’Œæ–‡æœ¬å¤„ç†ä¸€æ ·ï¼Œä¸éœ€è¦ä¿®æ”¹</td>
</tr>
<tr>
<td>LZO</td>
<td>å¦ï¼Œéœ€è¦å®‰è£…</td>
<td>LZO</td>
<td>.lzo</td>
<td><strong>æ˜¯</strong></td>
<td>éœ€è¦å»ºç´¢å¼•ï¼Œè¿˜éœ€è¦æŒ‡å®šè¾“å…¥æ ¼å¼</td>
</tr>
<tr>
<td>Snappy</td>
<td>æ˜¯ï¼Œç›´æ¥ä½¿ç”¨</td>
<td>Snappy</td>
<td>.snappy</td>
<td>å¦</td>
<td>å’Œæ–‡æœ¬å¤„ç†ä¸€æ ·ï¼Œä¸éœ€è¦ä¿®æ”¹</td>
</tr>
</tbody>
</table>
<p>å‹ç¼©æ€§èƒ½çš„æ¯”è¾ƒ</p>
<table>
<thead>
<tr>
<th>å‹ç¼©ç®—æ³•</th>
<th>åŸå§‹æ–‡ä»¶å¤§å°</th>
<th>å‹ç¼©æ–‡ä»¶å¤§å°</th>
<th>å‹ç¼©é€Ÿåº¦</th>
<th>è§£å‹é€Ÿåº¦</th>
</tr>
</thead>
<tbody>
<tr>
<td>gzip</td>
<td>8.3GB</td>
<td>1.8GB</td>
<td>17.5MB/s</td>
<td>58MB/s</td>
</tr>
<tr>
<td>bzip2</td>
<td>8.3GB</td>
<td>1.1GB</td>
<td>2.4MB/s</td>
<td>9.5MB/s</td>
</tr>
<tr>
<td>LZO</td>
<td>8.3GB</td>
<td>2.9GB</td>
<td>49.3MB/s</td>
<td>74.6MB/s</td>
</tr>
</tbody>
</table>
<h3 id="4-3-å‹ç¼©æ–¹å¼é€‰æ‹©">4.3 å‹ç¼©æ–¹å¼é€‰æ‹©</h3>
<p>å‹ç¼©æ–¹å¼é€‰æ‹©æ—¶é‡ç‚¹è€ƒè™‘ï¼šå‹ç¼©/è§£å‹ç¼©é€Ÿåº¦ã€å‹ç¼©ç‡ï¼ˆå‹ç¼©åå­˜å‚¨å¤§å°ï¼‰ã€å‹ç¼©åæ˜¯å¦å¯ä»¥æ”¯æŒåˆ‡ç‰‡</p>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330928.png" alt></p>
<h3 id="4-4-å‹ç¼©å‚æ•°é…ç½®">4.4 å‹ç¼©å‚æ•°é…ç½®</h3>
<p>ä¸ºäº†æ”¯æŒå¤šç§å‹ç¼©/è§£å‹ç¼©ç®—æ³•ï¼ŒHadoopå¼•å…¥äº†ç¼–ç /è§£ç å™¨</p>
<table>
<thead>
<tr>
<th><strong>å‹ç¼©æ ¼å¼</strong></th>
<th><strong>å¯¹åº”çš„ç¼–ç /è§£ç å™¨</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>DEFLATE</td>
<td>org.apache.hadoop.io.compress.DefaultCodec</td>
</tr>
<tr>
<td>gzip</td>
<td>org.apache.hadoop.io.compress.GzipCodec</td>
</tr>
<tr>
<td>bzip2</td>
<td>org.apache.hadoop.io.compress.BZip2Codec</td>
</tr>
<tr>
<td>LZO</td>
<td>com.hadoop.compression.lzo.LzopCodec</td>
</tr>
<tr>
<td>Snappy</td>
<td>org.apache.hadoop.io.compress.SnappyCodec</td>
</tr>
</tbody>
</table>
<p>è¦åœ¨Hadoopä¸­å¯ç”¨å‹ç¼©ï¼Œå¯ä»¥é…ç½®å¦‚ä¸‹å‚æ•°</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>é»˜è®¤å€¼</th>
<th>é˜¶æ®µ</th>
<th>å»ºè®®</th>
</tr>
</thead>
<tbody>
<tr>
<td>io.compression.codecs ï¼ˆåœ¨core-site.xmlä¸­é…ç½®ï¼‰</td>
<td>æ— ï¼Œè¿™ä¸ªéœ€è¦åœ¨å‘½ä»¤è¡Œè¾“å…¥hadoop checknativeæŸ¥çœ‹</td>
<td>è¾“å…¥å‹ç¼©</td>
<td>Hadoopä½¿ç”¨æ–‡ä»¶æ‰©å±•ååˆ¤æ–­æ˜¯å¦æ”¯æŒæŸç§ç¼–è§£ç å™¨</td>
</tr>
<tr>
<td>mapreduce.map.output.compressï¼ˆåœ¨mapred-site.xmlä¸­é…ç½®ï¼‰</td>
<td>false</td>
<td>mapperè¾“å‡º</td>
<td>è¿™ä¸ªå‚æ•°è®¾ä¸ºtrueå¯ç”¨å‹ç¼©</td>
</tr>
<tr>
<td>mapreduce.map.output.compress.codecï¼ˆåœ¨mapred-site.xmlä¸­é…ç½®ï¼‰</td>
<td>org.apache.hadoop.io.compress.DefaultCodec</td>
<td>mapperè¾“å‡º</td>
<td>ä¼ä¸šå¤šä½¿ç”¨LZOæˆ–Snappyç¼–è§£ç å™¨åœ¨æ­¤é˜¶æ®µå‹ç¼©æ•°æ®</td>
</tr>
<tr>
<td>mapreduce.output.fileoutputformat.compressï¼ˆåœ¨mapred-site.xmlä¸­é…ç½®ï¼‰</td>
<td>false</td>
<td>reducerè¾“å‡º</td>
<td>è¿™ä¸ªå‚æ•°è®¾ä¸ºtrueå¯ç”¨å‹ç¼©</td>
</tr>
<tr>
<td>mapreduce.output.fileoutputformat.compress.codecï¼ˆåœ¨mapred-site.xmlä¸­é…ç½®ï¼‰</td>
<td>xxxxxxxxxxÂ drop table if exists promotion_info;create table promotion_info( Â   promotion_id string comment â€˜ä¼˜æƒ æ´»åŠ¨idâ€™, Â   brand Â  Â  Â   string comment â€˜ä¼˜æƒ å“ç‰Œâ€™, Â   start_date Â  string comment â€˜ä¼˜æƒ æ´»åŠ¨å¼€å§‹æ—¥æœŸâ€™, Â   end_date Â  Â  string comment â€˜ä¼˜æƒ æ´»åŠ¨ç»“æŸæ—¥æœŸâ€™) comment â€˜å„å“ç‰Œæ´»åŠ¨å‘¨æœŸè¡¨â€™;â€‹select Â   brand, Â  Â sum(datediff(end_date,start_date)+1) promotion_day_countfrom( Â  Â select Â  Â  Â   brand, Â  Â  Â   max_end_date, Â  Â  Â  Â if(max_end_date is null or start_date&gt;max_end_date,start_date,date_add(max_end_date,1)) start_date, Â  Â  Â   end_date Â  Â from Â  Â ( Â  Â  Â  Â select Â  Â  Â  Â  Â   brand, Â  Â  Â  Â  Â   start_date, Â  Â  Â  Â  Â   end_date, Â  Â  Â  Â  Â  Â max(end_date) over(partition by brand order by start_date rows between unbounded preceding and 1 preceding) max_end_date Â  Â  Â  Â from promotion_info Â  Â )t1)t2where end_date&gt;start_dategroup by brand;â€‹sql</td>
<td>reducerè¾“å‡º</td>
<td>ä½¿ç”¨æ ‡å‡†å·¥å…·æˆ–è€…ç¼–è§£ç å™¨ï¼Œå¦‚gzipå’Œbzip2</td>
</tr>
</tbody>
</table>
<h3 id="4-5-å‹ç¼©å®æ“æ¡ˆä¾‹">4.5 å‹ç¼©å®æ“æ¡ˆä¾‹</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨driverå¼€å¯mapperå‹ç¼©ï¼Œå…¶ä»–éƒ½ä¸éœ€è¦å˜ï¼Œå³ä¸­é—´æ–‡ä»¶å‹ç¼©äº†ï¼Œä¸å½±å“è¾“å‡º</span></span><br><span class="line">Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line"><span class="comment">// å¼€å¯mapç«¯è¾“å‡ºå‹ç¼©</span></span><br><span class="line">conf.setBoolean(<span class="string">"mapreduce.map.output.compress"</span>, <span class="keyword">true</span>);</span><br><span class="line"><span class="comment">// è®¾ç½®mapç«¯è¾“å‡ºå‹ç¼©æ–¹å¼</span></span><br><span class="line">conf.setClass(<span class="string">"mapreduce.map.output.compress.codec"</span>, BZip2Codec<span class="class">.<span class="keyword">class</span>,<span class="title">CompressionCodec</span>.<span class="title">class</span>)</span>;</span><br><span class="line">Job job = Job.getInstance(conf);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®reducerçš„å‹ç¼©ï¼Œå½±å“æœ€ç»ˆè¾“å‡ºç»“æœ</span></span><br><span class="line"><span class="comment">// è®¾ç½®reduceç«¯è¾“å‡ºå‹ç¼©å¼€å¯</span></span><br><span class="line">FileOutputFormat.setCompressOutput(job, <span class="keyword">true</span>);</span><br><span class="line"><span class="comment">// è®¾ç½®å‹ç¼©çš„æ–¹å¼</span></span><br><span class="line">FileOutputFormat.setOutputCompressorClass(job, BZip2Codec<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure>
<h1>å››ã€Yarn</h1>
<h2 id="1ã€Yarnèµ„æºè°ƒåº¦å™¨">1ã€Yarnèµ„æºè°ƒåº¦å™¨</h2>
<blockquote>
<p>Yarnæ˜¯ä¸€ä¸ªèµ„æºè°ƒåº¦å¹³å°ï¼Œè´Ÿè´£ä¸ºè¿ç®—ç¨‹åºæä¾›æœåŠ¡å™¨è¿ç®—èµ„æºï¼Œç›¸å½“äºä¸€ä¸ªåˆ†å¸ƒå¼çš„æ“ä½œç³»ç»Ÿå¹³å°ï¼Œè€ŒMapReduceç­‰è¿ç®—ç¨‹åºåˆ™ç›¸å½“äºè¿è¡Œäºæ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„åº”ç”¨ç¨‹åº</p>
</blockquote>
<h3 id="1-1-YarnåŸºç¡€æ¶æ„">1.1 YarnåŸºç¡€æ¶æ„</h3>
<p>YARNä¸»è¦ç”±ResourceManagerã€NodeManagerã€ApplicationMasterå’ŒContainerç­‰ç»„ä»¶æ„æˆ</p>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330929.png" alt></p>
<h3 id="1-2-Yarnå·¥ä½œæœºåˆ¶">1.2 Yarnå·¥ä½œæœºåˆ¶</h3>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330930.png" alt></p>
<h3 id="1-3-Yarnè°ƒåº¦å™¨å’Œè°ƒåº¦ç®—æ³•">1.3 Yarnè°ƒåº¦å™¨å’Œè°ƒåº¦ç®—æ³•</h3>
<blockquote>
<p>ç›®å‰ï¼ŒHadoopä½œä¸šè°ƒåº¦å™¨ä¸»è¦æœ‰ä¸‰ç§ï¼šFIFOã€å®¹é‡ï¼ˆCapacity Schedulerï¼‰å’Œå…¬å¹³ï¼ˆFair Schedulerï¼‰ã€‚Apache Hadoop3.1.3é»˜è®¤çš„èµ„æºè°ƒåº¦å™¨æ˜¯Capacity Scheduler(å…·ä½“è®¾ç½®è¯¦è§ï¼šyarn-default.xmlæ–‡ä»¶)ï¼ŒCDHæ¡†æ¶é»˜è®¤è°ƒåº¦å™¨æ˜¯Fair Scheduler</p>
</blockquote>
<p><strong>å…ˆè¿›å…ˆå‡ºè°ƒåº¦å™¨ï¼ˆFIFOï¼‰</strong></p>
<p>FIFOè°ƒåº¦å™¨ï¼ˆFirst In First Outï¼‰ï¼šå•é˜Ÿåˆ—ï¼Œæ ¹æ®æäº¤ä½œä¸šçš„å…ˆåé¡ºåºï¼Œå…ˆæ¥å…ˆæœåŠ¡</p>
<p><strong>å®¹é‡è°ƒåº¦å™¨ï¼ˆCapacity Schedulerï¼‰</strong></p>
<blockquote>
<p>Capacity Scheduler æ˜¯ Yahoo å¼€å‘çš„å¤šç”¨æˆ·è°ƒåº¦å™¨</p>
</blockquote>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330931.png" alt></p>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330932.png" alt></p>
<p><strong>å…¬å¹³è°ƒåº¦å™¨ï¼ˆFair Schedulerï¼‰</strong></p>
<blockquote>
<p>Fair Schedulere æ˜¯ Facebook å¼€å‘çš„å¤šç”¨æˆ·è°ƒåº¦å™¨</p>
</blockquote>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330933.png" alt></p>
<p>å…¬å¹³è°ƒåº¦å™¨è®¾è®¡ç›®æ ‡æ˜¯ï¼šåœ¨æ—¶é—´å°ºåº¦ä¸Šï¼Œæ‰€æœ‰ä½œä¸šè·å¾—å…¬å¹³çš„èµ„æºã€‚æŸä¸€<br>
æ—¶åˆ»ä¸€ä¸ªä½œä¸šåº”è·èµ„æºå’Œå®é™…è·å–èµ„æºçš„å·®è·å«&quot;ç¼ºé¢&quot;ã€‚è°ƒåº¦å™¨ä¼šä¼˜å…ˆä¸ºç¼ºé¢å¤§çš„ä½œä¸šåˆ†é…èµ„æº</p>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330934.png" alt></p>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330935.png" alt></p>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330936.png" alt></p>
<p>DRFç­–ç•¥ï¼šDRFï¼ˆDominant Resource Fairnessï¼‰ï¼Œæˆ‘ä»¬ä¹‹å‰è¯´çš„èµ„æºï¼Œéƒ½æ˜¯å•ä¸€æ ‡å‡†ï¼Œä¾‹å¦‚åªè€ƒè™‘å†…å­˜ï¼ˆä¹Ÿæ˜¯Yarné»˜è®¤çš„æƒ…å†µï¼‰ã€‚ä½†æ˜¯å¾ˆå¤šæ—¶å€™æˆ‘ä»¬èµ„æºæœ‰å¾ˆå¤šç§ï¼Œä¾‹å¦‚å†…å­˜ï¼ŒCPUï¼Œç½‘ç»œå¸¦å®½ç­‰ï¼Œè¿™æ ·æˆ‘ä»¬å¾ˆéš¾è¡¡é‡ä¸¤ä¸ªåº”ç”¨åº”è¯¥åˆ†é…çš„èµ„æºæ¯”ä¾‹ã€‚</p>
<h3 id="1-4-Yarn-å¸¸ç”¨å‘½ä»¤">1.4 Yarn å¸¸ç”¨å‘½ä»¤</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yarnçŠ¶æ€çš„æŸ¥è¯¢ï¼Œé™¤äº†å¯ä»¥åœ¨hadoop103:8088é¡µé¢æŸ¥çœ‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡å‘½ä»¤æ“ä½œ</span></span><br><span class="line"><span class="comment"># å…ˆè¿è¡Œ</span></span><br><span class="line">myhadoop.sh start</span><br><span class="line">hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount /input /output</span><br><span class="line"></span><br><span class="line"><span class="comment"># =======================yarn applicationæŸ¥çœ‹ä»»åŠ¡==============</span></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰Application</span></span><br><span class="line">yarn application -list</span><br><span class="line"><span class="comment"># æ ¹æ®ApplicationçŠ¶æ€è¿‡æ»¤ï¼šyarn application -list -appStates ï¼ˆæ‰€æœ‰çŠ¶æ€ï¼šALLã€NEWã€NEW_SAVINGã€SUBMITTEDã€ACCEPTEDã€RUNNINGã€FINISHEDã€FAILEDã€KILLEDï¼‰</span></span><br><span class="line">yarn application -list -appStates FINISHED</span><br><span class="line"><span class="comment"># Killæ‰Application</span></span><br><span class="line">yarn application -<span class="built_in">kill</span> application_1612577921195_0001</span><br><span class="line"></span><br><span class="line"><span class="comment"># ====================yarn logsæŸ¥çœ‹æ—¥å¿—======================</span></span><br><span class="line"><span class="comment"># æŸ¥è¯¢Applicationæ—¥å¿—ï¼šyarn logs -applicationId &lt;ApplicationId&gt;</span></span><br><span class="line">yarn logs -applicationId application_1612577921195_0001</span><br><span class="line"><span class="comment"># æŸ¥è¯¢Containeræ—¥å¿—ï¼šyarn logs -applicationId &lt;ApplicationId&gt; -containerId &lt;ContainerId&gt;</span></span><br><span class="line">yarn logs -applicationId application_1612577921195_0001 -containerId container_1612577921195_0001_01_000001</span><br><span class="line"></span><br><span class="line"><span class="comment"># ====================yarn applicationattemptæŸ¥çœ‹å°è¯•è¿è¡Œçš„ä»»åŠ¡=====</span></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰Applicationå°è¯•çš„åˆ—è¡¨ï¼šyarn applicationattempt -list &lt;ApplicationId&gt;</span></span><br><span class="line">yarn applicationattempt -list application_1612577921195_0001</span><br><span class="line"><span class="comment"># æ‰“å°ApplicationAttempçŠ¶æ€ï¼šyarn applicationattempt -status &lt;ApplicationAttemptId&gt;</span></span><br><span class="line">yarn applicationattempt -status appattempt_1612577921195_0001_000001</span><br><span class="line"></span><br><span class="line"><span class="comment"># =====================yarn containeræŸ¥çœ‹å®¹å™¨===============</span></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰Containerï¼šyarn container -list &lt;ApplicationAttemptId&gt;</span></span><br><span class="line">yarn container -list appattempt_1612577921195_0001_000001</span><br><span class="line"><span class="comment"># æ‰“å°ContainerçŠ¶æ€ï¼š  yarn container -status &lt;ContainerId&gt;</span></span><br><span class="line"><span class="comment"># æ³¨ï¼šåªæœ‰åœ¨ä»»åŠ¡è·‘çš„é€”ä¸­æ‰èƒ½çœ‹åˆ°containerçš„çŠ¶æ€</span></span><br><span class="line">yarn container -status container_1612577921195_0001_01_000001</span><br><span class="line"></span><br><span class="line"><span class="comment"># ==========================yarn rmadminæ›´æ–°é…ç½®==============</span></span><br><span class="line"><span class="comment"># åŠ è½½é˜Ÿåˆ—é…ç½®ï¼šyarn rmadmin -refreshQueues</span></span><br><span class="line">yarn rmadmin -refreshQueues</span><br><span class="line"></span><br><span class="line"><span class="comment"># =======================yarn queueæŸ¥çœ‹é˜Ÿåˆ—====================</span></span><br><span class="line"><span class="comment"># æ‰“å°é˜Ÿåˆ—ä¿¡æ¯ï¼šyarn queue -status &lt;QueueName&gt;</span></span><br><span class="line">yarn queue -status default</span><br></pre></td></tr></table></figure>
<h3 id="1-5-Yarn-ç”Ÿäº§ç¯å¢ƒæ ¸å¿ƒå‚æ•°">1.5 Yarn ç”Ÿäº§ç¯å¢ƒæ ¸å¿ƒå‚æ•°</h3>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330937.png" alt></p>
<h2 id="2ã€Yarn-æ¡ˆä¾‹å®æ“">2ã€Yarn æ¡ˆä¾‹å®æ“</h2>
<blockquote>
<p>æ³¨ï¼šè°ƒæ•´ä¸‹åˆ—å‚æ•°ä¹‹å‰å°½é‡æ‹æ‘„ Linux å¿«ç…§ï¼Œå¦åˆ™åç»­çš„æ¡ˆä¾‹ï¼Œè¿˜éœ€è¦é‡å†™å‡†å¤‡é›†ç¾¤</p>
</blockquote>
<h3 id="2-1-Yarnç”Ÿäº§ç¯å¢ƒæ ¸å¿ƒå‚æ•°é…ç½®æ¡ˆä¾‹">2.1 Yarnç”Ÿäº§ç¯å¢ƒæ ¸å¿ƒå‚æ•°é…ç½®æ¡ˆä¾‹</h3>
<p>éœ€æ±‚ï¼šä»1Gæ•°æ®ä¸­ï¼Œç»Ÿè®¡æ¯ä¸ªå•è¯å‡ºç°æ¬¡æ•°ã€‚æœåŠ¡å™¨3å°ï¼Œæ¯å°é…ç½®4Gå†…å­˜ï¼Œ4æ ¸CPUï¼Œ4çº¿ç¨‹ã€‚éœ€æ±‚åˆ†æï¼š1G / 128m = 8ä¸ªMapTaskï¼›1ä¸ªReduceTaskï¼›1ä¸ªmrAppMasterï¼Œå¹³å‡æ¯ä¸ªèŠ‚ç‚¹è¿è¡Œ10ä¸ª / 3å° â‰ˆ 3ä¸ªä»»åŠ¡ï¼ˆ4 3 3ï¼‰ï¼Œæ‰€ä»¥è¦æ”¹<code>yarn-site.xml</code>é…ç½®å‚æ•°å¦‚ä¸‹</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- é€‰æ‹©è°ƒåº¦å™¨ï¼Œé»˜è®¤å®¹é‡ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>The class to use as the resource scheduler.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.class<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ResourceManagerå¤„ç†è°ƒåº¦å™¨è¯·æ±‚çš„çº¿ç¨‹æ•°é‡,é»˜è®¤50ï¼›å¦‚æœæäº¤çš„ä»»åŠ¡æ•°å¤§äº50ï¼Œå¯ä»¥å¢åŠ è¯¥å€¼ï¼Œä½†æ˜¯ä¸èƒ½è¶…è¿‡3å° * 4çº¿ç¨‹ = 12çº¿ç¨‹ï¼ˆå»é™¤å…¶ä»–åº”ç”¨ç¨‹åºå®é™…ä¸èƒ½è¶…è¿‡8ï¼‰ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Number of threads to handle scheduler interface.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.client.thread-count<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>8<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- æ˜¯å¦è®©yarnè‡ªåŠ¨æ£€æµ‹ç¡¬ä»¶è¿›è¡Œé…ç½®ï¼Œé»˜è®¤æ˜¯falseï¼Œå¦‚æœè¯¥èŠ‚ç‚¹æœ‰å¾ˆå¤šå…¶ä»–åº”ç”¨ç¨‹åºï¼Œå»ºè®®æ‰‹åŠ¨é…ç½®ã€‚å¦‚æœè¯¥èŠ‚ç‚¹æ²¡æœ‰å…¶ä»–åº”ç”¨ç¨‹åºï¼Œå¯ä»¥é‡‡ç”¨è‡ªåŠ¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Enable auto-detection of node capabilities such as</span><br><span class="line">  memory and CPU.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.detect-hardware-capabilities<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- æ˜¯å¦å°†è™šæ‹Ÿæ ¸æ•°å½“ä½œCPUæ ¸æ•°ï¼Œé»˜è®¤æ˜¯falseï¼Œé‡‡ç”¨ç‰©ç†CPUæ ¸æ•° --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Flag to determine if logical processors(such as</span><br><span class="line">  hyperthreads) should be counted as cores. Only applicable on Linux</span><br><span class="line">  when yarn.nodemanager.resource.cpu-vcores is set to -1 and</span><br><span class="line">  yarn.nodemanager.resource.detect-hardware-capabilities is true.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.count-logical-processors-as-cores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- è™šæ‹Ÿæ ¸æ•°å’Œç‰©ç†æ ¸æ•°ä¹˜æ•°ï¼Œé»˜è®¤æ˜¯1.0 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Multiplier to determine how to convert phyiscal cores to</span><br><span class="line">  vcores. This value is used if yarn.nodemanager.resource.cpu-vcores</span><br><span class="line">  is set to -1(which implies auto-calculate vcores) and</span><br><span class="line">  yarn.nodemanager.resource.detect-hardware-capabilities is set to true. The  number of vcores will be calculated as  number of CPUs * multiplier.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.pcores-vcores-multiplier<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- NodeManagerä½¿ç”¨å†…å­˜æ•°ï¼Œé»˜è®¤8Gï¼Œä¿®æ”¹ä¸º4Gå†…å­˜ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Amount of physical memory, in MB, that can be allocated </span><br><span class="line">  for containers. If set to -1 and</span><br><span class="line">  yarn.nodemanager.resource.detect-hardware-capabilities is true, it is</span><br><span class="line">  automatically calculated(in case of Windows and Linux).</span><br><span class="line">  In other cases, the default is 8192MB.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.memory-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>4096<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- nodemanagerçš„CPUæ ¸æ•°ï¼Œä¸æŒ‰ç…§ç¡¬ä»¶ç¯å¢ƒè‡ªåŠ¨è®¾å®šæ—¶é»˜è®¤æ˜¯8ä¸ªï¼Œä¿®æ”¹ä¸º4ä¸ª --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Number of vcores that can be allocated</span><br><span class="line">  for containers. This is used by the RM scheduler when allocating</span><br><span class="line">  resources for containers. This is not used to limit the number of</span><br><span class="line">  CPUs used by YARN containers. If it is set to -1 and</span><br><span class="line">  yarn.nodemanager.resource.detect-hardware-capabilities is true, it is</span><br><span class="line">  automatically determined from the hardware in case of Windows and Linux.</span><br><span class="line">  In other cases, number of vcores is 8 by default.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.cpu-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å®¹å™¨æœ€å°å†…å­˜ï¼Œé»˜è®¤1G --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>The minimum allocation for every container request at theRM  in MBs. Memory requests lower than this will be set to the value of this  property. Additionally, a node manager that is configured to have less memory  than this value will be shut down by the resource manager.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.minimum-allocation-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>1024<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å®¹å™¨æœ€å¤§å†…å­˜ï¼Œé»˜è®¤8Gï¼Œä¿®æ”¹ä¸º2G --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>The maximum allocation for every container request at the RM  in MBs. Memory requests higher than this will throw an  InvalidResourceRequestException.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.maximum-allocation-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>2048<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å®¹å™¨æœ€å°CPUæ ¸æ•°ï¼Œé»˜è®¤1ä¸ª --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>The minimum allocation for every container request at the RM  in terms of virtual CPU cores. Requests lower than this will be set to the  value of this property. Additionally, a node manager that is configured to  have fewer virtual cores than this value will be shut down by the resource  manager.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.minimum-allocation-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å®¹å™¨æœ€å¤§CPUæ ¸æ•°ï¼Œé»˜è®¤4ä¸ªï¼Œä¿®æ”¹ä¸º2ä¸ª --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>The maximum allocation for every container request at the RM  in terms of virtual CPU cores. Requests higher than this will throw an</span><br><span class="line">  InvalidResourceRequestException.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.maximum-allocation-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- yarnå¯¹ç‰©ç†å†…å­˜é»˜è®¤æ‰“å¼€ï¼Œå»ºè®®æ‰“å¼€ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.pmem-check-enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">&lt;!-- è™šæ‹Ÿå†…å­˜æ£€æŸ¥ï¼Œé»˜è®¤æ‰“å¼€ï¼Œä¿®æ”¹ä¸ºå…³é—­ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Whether virtual memory limits will be enforced for</span><br><span class="line">  containers.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.vmem-check-enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- è™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜è®¾ç½®æ¯”ä¾‹,é»˜è®¤2.1 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Ratio between virtual memory to physical memory when  setting memory limits for containers. Container allocations are  expressed in terms of physical memory, and virtual memory usage  is allowed to exceed this allocation by this ratio.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.vmem-pmem-ratio<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>2.1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœé›†ç¾¤çš„ç¡¬ä»¶èµ„æºä¸ä¸€è‡´ï¼Œè¦æ¯ä¸ªNodeManagerå•ç‹¬é…ç½®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡å¯é›†ç¾¤</span></span><br><span class="line">sbin/stop-yarn.sh</span><br><span class="line">sbin/start-yarn.sh</span><br><span class="line"><span class="comment"># æ‰§è¡ŒWordCountç¨‹åº</span></span><br><span class="line">hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount /input /output</span><br><span class="line"><span class="comment"># http://hadoop103:8088/cluster/apps</span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-å®¹é‡è°ƒåº¦å™¨å¤šé˜Ÿåˆ—æäº¤æ¡ˆä¾‹">2.2 å®¹é‡è°ƒåº¦å™¨å¤šé˜Ÿåˆ—æäº¤æ¡ˆä¾‹</h3>
<ul>
<li>éœ€æ±‚1ï¼šdefaulté˜Ÿåˆ—å æ€»å†…å­˜çš„40%ï¼Œæœ€å¤§èµ„æºå®¹é‡å æ€»èµ„æº60%ï¼Œhiveé˜Ÿåˆ—å æ€»å†…å­˜çš„60%ï¼Œæœ€å¤§èµ„æºå®¹é‡å æ€»èµ„æº80%</li>
<li>éœ€æ±‚2ï¼šé…ç½®é˜Ÿåˆ—ä¼˜å…ˆçº§</li>
</ul>
<p>åœ¨<code>capacity-scheduler.xml</code>ä¸­é…ç½®å¦‚ä¸‹</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--ä¸ºæ–°åŠ é˜Ÿåˆ—æ·»åŠ å¿…è¦å±æ€§--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- æŒ‡å®šå¤šé˜Ÿåˆ—ï¼Œå¢åŠ hiveé˜Ÿåˆ— --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.capacity.root.queues<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>default,hive<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">      The queues at the this level (root is the root queue).</span><br><span class="line">    <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- é™ä½defaulté˜Ÿåˆ—èµ„æºé¢å®šå®¹é‡ä¸º40%ï¼Œé»˜è®¤100% --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.capacity.root.default.capacity<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>40<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- é™ä½defaulté˜Ÿåˆ—èµ„æºæœ€å¤§å®¹é‡ä¸º60%ï¼Œé»˜è®¤100% --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.capacity.root.default.maximum-capacity<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>60<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!------------------------ä¸ºæ–°åŠ é˜Ÿåˆ—æ·»åŠ å¿…è¦å±æ€§-------------------------&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- æŒ‡å®šhiveé˜Ÿåˆ—çš„èµ„æºé¢å®šå®¹é‡ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.capacity.root.hive.capacity<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>60<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ç”¨æˆ·æœ€å¤šå¯ä»¥ä½¿ç”¨é˜Ÿåˆ—å¤šå°‘èµ„æºï¼Œ1è¡¨ç¤º --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.capacity.root.hive.user-limit-factor<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- æŒ‡å®šhiveé˜Ÿåˆ—çš„èµ„æºæœ€å¤§å®¹é‡ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.capacity.root.hive.maximum-capacity<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>80<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å¯åŠ¨hiveé˜Ÿåˆ— --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.capacity.root.hive.state<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>RUNNING<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å“ªäº›ç”¨æˆ·æœ‰æƒå‘é˜Ÿåˆ—æäº¤ä½œä¸š --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.capacity.root.hive.acl_submit_applications<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å“ªäº›ç”¨æˆ·æœ‰æƒæ“ä½œé˜Ÿåˆ—ï¼Œç®¡ç†å‘˜æƒé™ï¼ˆæŸ¥çœ‹/æ€æ­»ï¼‰ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.capacity.root.hive.acl_administer_queue<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å“ªäº›ç”¨æˆ·æœ‰æƒé…ç½®æäº¤ä»»åŠ¡ä¼˜å…ˆçº§ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.capacity.root.hive.acl_application_max_priority<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ä»»åŠ¡çš„è¶…æ—¶æ—¶é—´è®¾ç½®ï¼šyarn application -appId appId -updateLifetime Timeout</span></span><br><span class="line"><span class="comment">å‚è€ƒèµ„æ–™ï¼šhttps://blog.cloudera.com/enforcing-application-lifetime-slas-yarn/ --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å¦‚æœapplicationæŒ‡å®šäº†è¶…æ—¶æ—¶é—´ï¼Œåˆ™æäº¤åˆ°è¯¥é˜Ÿåˆ—çš„applicationèƒ½å¤ŸæŒ‡å®šçš„æœ€å¤§è¶…æ—¶æ—¶é—´ä¸èƒ½è¶…è¿‡è¯¥å€¼ã€‚ </span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.capacity.root.hive.maximum-application-lifetime<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>-1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å¦‚æœapplicationæ²¡æŒ‡å®šè¶…æ—¶æ—¶é—´ï¼Œåˆ™ç”¨default-application-lifetimeä½œä¸ºé»˜è®¤å€¼ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.capacity.root.hive.default-application-lifetime<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>-1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åˆ†å‘é…ç½®æ–‡ä»¶ï¼Œé‡å¯Yarnæˆ–è€…æ‰§è¡Œ<code>yarn rmadmin -refreshQueues</code>åˆ·æ–°é˜Ÿåˆ—ï¼Œå°±å¯ä»¥çœ‹åˆ°ä¸¤æ¡é˜Ÿåˆ—ï¼Œç„¶ååƒHiveæäº¤ä»»åŠ¡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘Hiveé˜Ÿåˆ—æäº¤ä»»åŠ¡</span></span><br><span class="line">hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount -D mapreduce.job.queuename=hive /input /output</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“jaråŒ…çš„æ–¹å¼,é»˜è®¤çš„ä»»åŠ¡æäº¤éƒ½æ˜¯æäº¤åˆ°defaulté˜Ÿåˆ—çš„ã€‚å¦‚æœå¸Œæœ›å‘å…¶ä»–é˜Ÿåˆ—æäº¤ä»»åŠ¡ï¼Œéœ€è¦åœ¨Driverä¸­å£°æ˜</span></span><br><span class="line">public class WcDrvier &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException &#123;</span><br><span class="line">        Configuration conf = new Configuration();</span><br><span class="line">        conf.set(<span class="string">"mapreduce.job.queuename"</span>,<span class="string">"hive"</span>);</span><br><span class="line">        //1. è·å–ä¸€ä¸ªJobå®ä¾‹</span><br><span class="line">        Job job = Job.getInstance(conf);</span><br><span class="line">        ã€‚ã€‚ã€‚ ã€‚ã€‚ã€‚</span><br><span class="line">        //6. æäº¤Job</span><br><span class="line">        boolean b = job.waitForCompletion(<span class="literal">true</span>);</span><br><span class="line">        System.exit(b ? 0 : 1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åè¯´ä¸€ä¸‹ä»»åŠ¡ä¼˜å…ˆçº§ï¼Œå®¹é‡è°ƒåº¦å™¨ï¼Œæ”¯æŒä»»åŠ¡ä¼˜å…ˆçº§çš„é…ç½®ï¼Œåœ¨èµ„æºç´§å¼ æ—¶ï¼Œä¼˜å…ˆçº§é«˜çš„ä»»åŠ¡å°†ä¼˜å…ˆè·å–èµ„æºã€‚é»˜è®¤æƒ…å†µï¼ŒYarnå°†æ‰€æœ‰ä»»åŠ¡çš„ä¼˜å…ˆçº§é™åˆ¶ä¸º0ï¼Œè‹¥æƒ³ä½¿ç”¨ä»»åŠ¡çš„ä¼˜å…ˆçº§åŠŸèƒ½ï¼Œé¡»å¼€æ”¾è¯¥é™åˆ¶ï¼Œä¿®æ”¹<code>yarn-site.xml</code>æ–‡ä»¶ï¼Œå¢åŠ ä»¥ä¸‹å‚æ•°</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;yarn.cluster.max-application-priority&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;5&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†å‘é…ç½®ï¼Œå¹¶é‡å¯Yarn</span></span><br><span class="line">xsync yarn-site.xml</span><br><span class="line">sbin/stop-yarn.sh</span><br><span class="line">sbin/start-yarn.sh</span><br><span class="line"><span class="comment"># æ¨¡æ‹Ÿèµ„æºç´§å¼ ç¯å¢ƒï¼Œå¯è¿ç»­æäº¤ä»¥ä¸‹ä»»åŠ¡ï¼Œç›´åˆ°æ–°æäº¤çš„ä»»åŠ¡ç”³è¯·ä¸åˆ°èµ„æºä¸ºæ­¢</span></span><br><span class="line">hadoop jar /opt/module/hadoop-3.1.3/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar pi 5 2000000</span><br><span class="line"><span class="comment"># å†æ¬¡é‡æ–°æäº¤ä¼˜å…ˆçº§é«˜çš„ä»»åŠ¡</span></span><br><span class="line">hadoop jar /opt/module/hadoop-3.1.3/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar pi  -D mapreduce.job.priority=5 5 2000000</span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤ä¿®æ”¹æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡çš„ä¼˜å…ˆçº§</span></span><br><span class="line"><span class="comment"># yarn application -appID &lt;ApplicationID&gt; -updatePriority ä¼˜å…ˆçº§</span></span><br><span class="line">yarn application -appID application_1611133087930_0009 -updatePriority 5</span><br></pre></td></tr></table></figure>
<h3 id="2-3-å…¬å¹³è°ƒåº¦å™¨æ¡ˆä¾‹">2.3 å…¬å¹³è°ƒåº¦å™¨æ¡ˆä¾‹</h3>
<blockquote>
<p>é…ç½®æ–‡ä»¶å‚è€ƒèµ„æ–™ï¼š<a href="https://hadoop.apache.org/docs/r3.1.3/hadoop-yarn/hadoop-yarn-site/FairScheduler.html" target="_blank" rel="noopener" title="https://hadoop.apache.org/docs/r3.1.3/hadoop-yarn/hadoop-yarn-site/FairScheduler.html">https://hadoop.apache.org/docs/r3.1.3/hadoop-yarn/hadoop-yarn-site/FairScheduler.html</a><br>
ä»»åŠ¡é˜Ÿåˆ—æ”¾ç½®è§„åˆ™å‚è€ƒèµ„æ–™ï¼š<a href="https://blog.cloudera.com/untangling-apache-hadoop-yarn-part-4-fair-scheduler-queue-basics/" target="_blank" rel="noopener" title="https://blog.cloudera.com/untangling-apache-hadoop-yarn-part-4-fair-scheduler-queue-basics/">https://blog.cloudera.com/untangling-apache-hadoop-yarn-part-4-fair-scheduler-queue-basics/</a></p>
</blockquote>
<p>åˆ›å»ºä¸¤ä¸ªé˜Ÿåˆ—ï¼Œåˆ†åˆ«æ˜¯testå’Œatguiguï¼ˆä»¥ç”¨æˆ·æ‰€å±ç»„å‘½åï¼‰ã€‚æœŸæœ›å®ç°ä»¥ä¸‹æ•ˆæœï¼šè‹¥ç”¨æˆ·æäº¤ä»»åŠ¡æ—¶æŒ‡å®šé˜Ÿåˆ—ï¼Œåˆ™ä»»åŠ¡æäº¤åˆ°æŒ‡å®šé˜Ÿåˆ—è¿è¡Œï¼›è‹¥æœªæŒ‡å®šé˜Ÿåˆ—ï¼Œtestç”¨æˆ·æäº¤çš„ä»»åŠ¡åˆ°root.group.testé˜Ÿåˆ—è¿è¡Œï¼Œatguiguæäº¤çš„ä»»åŠ¡åˆ°root.group.atguigué˜Ÿåˆ—è¿è¡Œï¼ˆæ³¨ï¼šgroupä¸ºç”¨æˆ·æ‰€å±ç»„ï¼‰ã€‚å…¬å¹³è°ƒåº¦å™¨çš„é…ç½®æ¶‰åŠåˆ°ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯<code>yarn-site.xml</code>ï¼Œå¦ä¸€ä¸ªæ˜¯å…¬å¹³è°ƒåº¦å™¨é˜Ÿåˆ—åˆ†é…æ–‡ä»¶<code>fair-scheduler.xml</code>ï¼ˆæ–‡ä»¶åå¯è‡ªå®šä¹‰ï¼‰ã€‚</p>
<p>ä¿®æ”¹<code>yarn-site.xml</code>æ–‡ä»¶ï¼ŒåŠ å…¥ä»¥ä¸‹å‚æ•°</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.class<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FairScheduler<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>é…ç½®ä½¿ç”¨å…¬å¹³è°ƒåº¦å™¨<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.fair.allocation.file<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/module/hadoop-3.1.3/etc/hadoop/fair-scheduler.xml<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>æŒ‡æ˜å…¬å¹³è°ƒåº¦å™¨é˜Ÿåˆ—åˆ†é…é…ç½®æ–‡ä»¶<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.fair.preemption<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>ç¦æ­¢é˜Ÿåˆ—é—´èµ„æºæŠ¢å <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>é…ç½®fair-scheduler.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">allocations</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- å•ä¸ªé˜Ÿåˆ—ä¸­Application Masterå ç”¨èµ„æºçš„æœ€å¤§æ¯”ä¾‹,å–å€¼0-1 ï¼Œä¼ä¸šä¸€èˆ¬é…ç½®0.1 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">queueMaxAMShareDefault</span>&gt;</span>0.5<span class="tag">&lt;/<span class="name">queueMaxAMShareDefault</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- å•ä¸ªé˜Ÿåˆ—æœ€å¤§èµ„æºçš„é»˜è®¤å€¼ test atguigu default --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">queueMaxResourcesDefault</span>&gt;</span>4096mb,4vcores<span class="tag">&lt;/<span class="name">queueMaxResourcesDefault</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- å¢åŠ ä¸€ä¸ªé˜Ÿåˆ—test --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">queue</span> <span class="attr">name</span>=<span class="string">"test"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é˜Ÿåˆ—æœ€å°èµ„æº --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">minResources</span>&gt;</span>2048mb,2vcores<span class="tag">&lt;/<span class="name">minResources</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é˜Ÿåˆ—æœ€å¤§èµ„æº --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maxResources</span>&gt;</span>4096mb,4vcores<span class="tag">&lt;/<span class="name">maxResources</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é˜Ÿåˆ—ä¸­æœ€å¤šåŒæ—¶è¿è¡Œçš„åº”ç”¨æ•°ï¼Œé»˜è®¤50ï¼Œæ ¹æ®çº¿ç¨‹æ•°é…ç½® --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maxRunningApps</span>&gt;</span>4<span class="tag">&lt;/<span class="name">maxRunningApps</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é˜Ÿåˆ—ä¸­Application Masterå ç”¨èµ„æºçš„æœ€å¤§æ¯”ä¾‹ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maxAMShare</span>&gt;</span>0.5<span class="tag">&lt;/<span class="name">maxAMShare</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- è¯¥é˜Ÿåˆ—èµ„æºæƒé‡,é»˜è®¤å€¼ä¸º1.0 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">weight</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">weight</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é˜Ÿåˆ—å†…éƒ¨çš„èµ„æºåˆ†é…ç­–ç•¥ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">schedulingPolicy</span>&gt;</span>fair<span class="tag">&lt;/<span class="name">schedulingPolicy</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">queue</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- å¢åŠ ä¸€ä¸ªé˜Ÿåˆ—atguigu --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">queue</span> <span class="attr">name</span>=<span class="string">"atguigu"</span> <span class="attr">type</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é˜Ÿåˆ—æœ€å°èµ„æº --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">minResources</span>&gt;</span>2048mb,2vcores<span class="tag">&lt;/<span class="name">minResources</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é˜Ÿåˆ—æœ€å¤§èµ„æº --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maxResources</span>&gt;</span>4096mb,4vcores<span class="tag">&lt;/<span class="name">maxResources</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é˜Ÿåˆ—ä¸­æœ€å¤šåŒæ—¶è¿è¡Œçš„åº”ç”¨æ•°ï¼Œé»˜è®¤50ï¼Œæ ¹æ®çº¿ç¨‹æ•°é…ç½® --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maxRunningApps</span>&gt;</span>4<span class="tag">&lt;/<span class="name">maxRunningApps</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é˜Ÿåˆ—ä¸­Application Masterå ç”¨èµ„æºçš„æœ€å¤§æ¯”ä¾‹,maxAMShareåªèƒ½ç”¨äºå¶å­é˜Ÿåˆ— --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- è¯¥é˜Ÿåˆ—èµ„æºæƒé‡,é»˜è®¤å€¼ä¸º1.0 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">weight</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">weight</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é˜Ÿåˆ—å†…éƒ¨çš„èµ„æºåˆ†é…ç­–ç•¥ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">schedulingPolicy</span>&gt;</span>fair<span class="tag">&lt;/<span class="name">schedulingPolicy</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">queue</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- ä»»åŠ¡é˜Ÿåˆ—åˆ†é…ç­–ç•¥,å¯é…ç½®å¤šå±‚è§„åˆ™,ä»ç¬¬ä¸€ä¸ªè§„åˆ™å¼€å§‹åŒ¹é…,ç›´åˆ°åŒ¹é…æˆåŠŸ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">queuePlacementPolicy</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æäº¤ä»»åŠ¡æ—¶æŒ‡å®šé˜Ÿåˆ—,å¦‚æœªæŒ‡å®šæäº¤é˜Ÿåˆ—,åˆ™ç»§ç»­åŒ¹é…ä¸‹ä¸€ä¸ªè§„åˆ™; falseè¡¨ç¤ºï¼šå¦‚æœæŒ‡å®šé˜Ÿåˆ—ä¸å­˜åœ¨,ä¸å…è®¸è‡ªåŠ¨åˆ›å»º--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">"specified"</span> <span class="attr">create</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æäº¤åˆ°root.group.usernameé˜Ÿåˆ—,è‹¥root.groupä¸å­˜åœ¨,ä¸å…è®¸è‡ªåŠ¨åˆ›å»ºï¼›è‹¥root.group.userä¸å­˜åœ¨,å…è®¸è‡ªåŠ¨åˆ›å»º --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">"nestedUserQueue"</span> <span class="attr">create</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">"primaryGroup"</span> <span class="attr">create</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æœ€åä¸€ä¸ªè§„åˆ™å¿…é¡»ä¸ºrejectæˆ–è€…defaultã€‚Rejectè¡¨ç¤ºæ‹’ç»åˆ›å»ºæäº¤å¤±è´¥ï¼Œdefaultè¡¨ç¤ºæŠŠä»»åŠ¡æäº¤åˆ°defaulté˜Ÿåˆ— --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">"reject"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">queuePlacementPolicy</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">allocations</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åˆ†å‘å¹¶æµ‹è¯•æäº¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xsync yarn-site.xml</span><br><span class="line">xsync fair-scheduler.xml</span><br><span class="line">sbin/stop-yarn.sh</span><br><span class="line">sbin/start-yarn.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># æäº¤ä»»åŠ¡æ—¶æŒ‡å®šé˜Ÿåˆ—ï¼ŒæŒ‰ç…§é…ç½®è§„åˆ™ï¼Œä»»åŠ¡ä¼šåˆ°æŒ‡å®šçš„root.testé˜Ÿåˆ—</span></span><br><span class="line">hadoop jar /opt/module/hadoop-3.1.3/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar pi -Dmapreduce.job.queuename=root.test 1 1</span><br><span class="line"><span class="comment"># æäº¤ä»»åŠ¡æ—¶ä¸æŒ‡å®šé˜Ÿåˆ—ï¼ŒæŒ‰ç…§é…ç½®è§„åˆ™ï¼Œä»»åŠ¡ä¼šåˆ°root.atguigu.atguigué˜Ÿåˆ—</span></span><br><span class="line">hadoop jar /opt/module/hadoop-3.1.3/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar pi 1 1</span><br></pre></td></tr></table></figure>
<h3 id="2-4-Yarnçš„Toolæ¥å£æ¡ˆä¾‹">2.4 Yarnçš„Toolæ¥å£æ¡ˆä¾‹</h3>
<p>è‡ªå·±å†™çš„jaråŒ…æœŸæœ›å¯ä»¥åŠ¨æ€ä¼ å‚ï¼Œç»“æœæŠ¥é”™ï¼Œè¯¯è®¤ä¸ºæ˜¯ç¬¬ä¸€ä¸ªè¾“å…¥å‚æ•°ï¼Œè§£å†³æ–¹æ³•ç¼–å†™ Yarn çš„ Tool æ¥å£ï¼Œé¦–å…ˆç¼–å†™mavené¡¹ç›®ï¼Œå¯¼åŒ…</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºç±»WordCountå¹¶å®ç°Toolæ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCount</span> <span class="keyword">implements</span> <span class="title">Tool</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Configuration conf;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">run</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        Job job = Job.getInstance(conf);</span><br><span class="line"></span><br><span class="line">        job.setJarByClass(WordCountDriver<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        job.setMapperClass(WordCountMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setReducerClass(WordCountReducer<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        job.setMapOutputKeyClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setMapOutputValueClass(IntWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputKeyClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputValueClass(IntWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        FileInputFormat.setInputPaths(job, <span class="keyword">new</span> Path(args[<span class="number">0</span>]));</span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(args[<span class="number">1</span>]));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> job.waitForCompletion(<span class="keyword">true</span>) ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConf</span><span class="params">(Configuration conf)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.conf = conf;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Configuration <span class="title">getConf</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> conf;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCountMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Text outK = <span class="keyword">new</span> Text();</span><br><span class="line">        <span class="keyword">private</span> IntWritable outV = <span class="keyword">new</span> IntWritable(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">            String line = value.toString();</span><br><span class="line">            String[] words = line.split(<span class="string">" "</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (String word : words) &#123;</span><br><span class="line">                outK.set(word);</span><br><span class="line">                context.write(outK, outV);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCountReducer</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">IntWritable</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> IntWritable outV = <span class="keyword">new</span> IntWritable();</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;IntWritable&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (IntWritable value : values) &#123;</span><br><span class="line">                sum += value.get();</span><br><span class="line">            &#125;</span><br><span class="line">            outV.set(sum);</span><br><span class="line">            context.write(key, outV);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–°å»ºWordCountDriver</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCountDriver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Tool tool;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 1. åˆ›å»ºé…ç½®æ–‡ä»¶</span></span><br><span class="line">        Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. åˆ¤æ–­æ˜¯å¦æœ‰toolæ¥å£</span></span><br><span class="line">        <span class="keyword">switch</span> (args[<span class="number">0</span>])&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"wordcount"</span>:</span><br><span class="line">                tool = <span class="keyword">new</span> WordCount();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">" No such tool: "</span>+ args[<span class="number">0</span>] );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3. ç”¨Toolæ‰§è¡Œç¨‹åº</span></span><br><span class="line">        <span class="comment">// ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥è¿‡æ»¤-D</span></span><br><span class="line">        <span class="comment">// Arrays.copyOfRange å°†è€æ•°ç»„çš„å…ƒç´ æ”¾åˆ°æ–°æ•°ç»„é‡Œé¢</span></span><br><span class="line">        <span class="keyword">int</span> run = ToolRunner.run(conf, tool, Arrays.copyOfRange(args, <span class="number">1</span>, args.length));</span><br><span class="line"></span><br><span class="line">        System.exit(run);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨HDFSä¸Šå‡†å¤‡è¾“å…¥æ–‡ä»¶ï¼Œå‡è®¾ä¸º/inputç›®å½•ï¼Œå‘é›†ç¾¤æäº¤è¯¥JaråŒ…<code>yarn jar YarnDemo.jar com.atguigu.yarn.WordCountDriver wordcount /input /output</code>æ³¨æ„æ­¤æ—¶æäº¤çš„3ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªç”¨äºç”Ÿæˆç‰¹å®šçš„Toolï¼Œç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªä¸ºè¾“å…¥è¾“å‡ºç›®å½•ã€‚æ­¤æ—¶å¦‚æœæˆ‘ä»¬å¸Œæœ›åŠ å…¥è®¾ç½®å‚æ•°ï¼Œå¯ä»¥åœ¨wordcountåé¢æ·»åŠ å‚æ•°ï¼Œä¾‹å¦‚ï¼š<code>yarn jar YarnDemo.jar com.atguigu.yarn.WordCountDriver wordcount -Dmapreduce.job.queuename=root.test /input /output1</code></p>
<h1>äº”ã€Hadoopç”Ÿäº§è°ƒä¼˜</h1>
<h2 id="1ã€HDFSæ ¸å¿ƒå‚æ•°">1ã€HDFSæ ¸å¿ƒå‚æ•°</h2>
<h3 id="1-1-NameNodeå†…å­˜ç”Ÿäº§é…ç½®">1.1 NameNodeå†…å­˜ç”Ÿäº§é…ç½®</h3>
<p>NameNodeå†…å­˜è®¡ç®—ï¼Œæ¯ä¸ªæ–‡ä»¶å—å¤§æ¦‚å ç”¨150byteï¼Œä¸€å°æœåŠ¡å™¨128Gå†…å­˜ä¸ºä¾‹ï¼Œèƒ½å­˜å‚¨å¤šå°‘æ–‡ä»¶å—å‘¢ï¼Ÿ128 * 1024 * 1024 * 1024 Â / 150Byte â‰ˆ 9.1äº¿</p>
<p>Hadoop2.xç³»åˆ—ï¼Œé…ç½®NameNodeå†…å­˜ï¼Œ<strong>NameNodeå†…å­˜é»˜è®¤2000m</strong>ï¼Œå¦‚æœæœåŠ¡å™¨å†…å­˜4Gï¼ŒNameNodeå†…å­˜å¯ä»¥é…ç½®3gã€‚åœ¨hadoop-env.shæ–‡ä»¶ä¸­é…ç½®å¦‚ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HADOOP_NAMENODE_OPTS=-Xmx3072m</span><br></pre></td></tr></table></figure>
<p>Hadoop3.xç³»åˆ—ï¼Œé…ç½®NameNodeå†…å­˜ï¼Œ<strong>hadoop-env.shä¸­æè¿°Hadoopçš„å†…å­˜æ˜¯åŠ¨æ€åˆ†é…çš„</strong>(<strong><a href="http://hadoop-env.sh" target="_blank" rel="noopener">hadoop-env.sh</a></strong>åœ¨etc/hadoopç›®å½•ä¸‹)ï¼Œæ¯”å¦‚æˆ‘4gå†…å­˜åˆ†é…äº†948MBå †å†…å­˜</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹NameNodeå’ŒDataNodeå ç”¨å†…å­˜</span></span><br><span class="line">jps</span><br><span class="line">jmap -heap 2611</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å‘ç°hadoop102ä¸Šçš„NameNodeå’ŒDataNodeå ç”¨å†…å­˜éƒ½æ˜¯è‡ªåŠ¨åˆ†é…çš„ï¼Œä¸”ç›¸ç­‰ã€‚ä¸æ˜¯å¾ˆåˆç†</span></span><br><span class="line"><span class="comment"># ç»éªŒå‚è€ƒ:https://docs.cloudera.com/documentation/enterprise/6/release-notes/topics/rg_hardware_requirements.html#concept_fzz_dq4_gbb</span></span><br><span class="line"><span class="comment"># ç»éªŒæ¨è</span></span><br><span class="line"><span class="comment"># namenodeæœ€å°å€¼1Gï¼Œæ¯å¢åŠ 1000000ä¸ªblockï¼Œå¢åŠ 1Gå†…å­˜</span></span><br><span class="line"><span class="comment"># datanodeæœ€å°å€¼4Gï¼Œblockæ•°,æˆ–è€…å‰¯æœ¬æ•°å‡é«˜ï¼Œéƒ½åº”è¯¥è°ƒå¤§datanodeçš„å€¼ã€‚ä¸€ä¸ªdatanodeä¸Šçš„å‰¯æœ¬æ€»æ•°ä½äº4000000,è°ƒä¸º4Gï¼Œè¶…è¿‡4000000,æ¯å¢åŠ 1000000ï¼Œå¢åŠ 1G</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…·ä½“ä¿®æ”¹ï¼šhadoop-env.sh</span></span><br><span class="line"><span class="built_in">export</span> HDFS_NAMENODE_OPTS=<span class="string">"-Dhadoop.security.logger=INFO,RFAS -Xmx1024m"</span></span><br><span class="line"><span class="built_in">export</span> HDFS_DATANODE_OPTS=<span class="string">"-Dhadoop.security.logger=ERROR,RFAS -Xmx1024m"</span></span><br></pre></td></tr></table></figure>
<h3 id="1-2-NameNodeå¿ƒè·³å¹¶å‘é…ç½®">1.2 NameNodeå¿ƒè·³å¹¶å‘é…ç½®</h3>
<p>æ¯ä¸ªèŠ‚ç‚¹å¯åŠ¨æ—¶ï¼Œéƒ½ä¼šå‘é€å¿ƒè·³åŒ…ç»™NNé‚£ä¹ˆNameNodeå‡†å¤‡å¤šå°‘çº¿ç¨‹åˆé€‚?<code>vim hdfs-site.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">The number of Namenode RPC server threads that listen to requests from clients. If dfs.namenode.servicerpc-address is not configured then Namenode RPC server threads listen to requests from all nodes.</span><br><span class="line">NameNodeæœ‰ä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ± ï¼Œç”¨æ¥å¤„ç†ä¸åŒDataNodeçš„å¹¶å‘å¿ƒè·³ä»¥åŠå®¢æˆ·ç«¯å¹¶å‘çš„å…ƒæ•°æ®æ“ä½œã€‚</span><br><span class="line">å¯¹äºå¤§é›†ç¾¤æˆ–è€…æœ‰å¤§é‡å®¢æˆ·ç«¯çš„é›†ç¾¤æ¥è¯´ï¼Œé€šå¸¸éœ€è¦å¢å¤§è¯¥å‚æ•°ã€‚é»˜è®¤å€¼æ˜¯10ã€‚</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.handler.count<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>21<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¼ä¸šç»éªŒï¼šdfs.namenode.handler.count=(20ä¹˜ä»¥ä»¥eä¸ºåº•logçš„ClusterSize)ï¼Œæ¯”å¦‚é›†ç¾¤è§„æ¨¡ï¼ˆDataNodeå°æ•°ï¼‰ä¸º3å°æ—¶ï¼Œæ­¤å‚æ•°è®¾ç½®ä¸º21ã€‚å¯é€šè¿‡ç®€å•çš„pythonä»£ç è®¡ç®—è¯¥å€¼</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> math</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> int(<span class="number">20</span>*math.log(<span class="number">3</span>))</span><br><span class="line"><span class="number">21</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>quit()</span><br></pre></td></tr></table></figure>
<h3 id="1-3-å¼€å¯å›æ”¶ç«™é…ç½®">1.3 å¼€å¯å›æ”¶ç«™é…ç½®</h3>
<blockquote>
<p>å¼€å¯å›æ”¶ç«™åŠŸèƒ½ï¼Œå¯ä»¥å°†åˆ é™¤çš„æ–‡ä»¶åœ¨ä¸è¶…æ—¶çš„æƒ…å†µä¸‹ï¼Œæ¢å¤åŸæ•°æ®ï¼Œèµ·åˆ°é˜²æ­¢è¯¯åˆ é™¤ã€å¤‡ä»½ç­‰ä½œç”¨</p>
</blockquote>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li>é»˜è®¤å€¼fs.trash.interval = 0ï¼Œ0è¡¨ç¤ºç¦ç”¨å›æ”¶ç«™ï¼›å…¶ä»–å€¼è¡¨ç¤ºè®¾ç½®æ–‡ä»¶çš„å­˜æ´»æ—¶é—´</li>
<li>é»˜è®¤å€¼fs.trash.checkpoint.interval = 0ï¼Œæ£€æŸ¥å›æ”¶ç«™çš„é—´éš”æ—¶é—´ã€‚å¦‚æœè¯¥å€¼ä¸º0ï¼Œåˆ™è¯¥å€¼è®¾ç½®å’Œfs.trash.intervalçš„å‚æ•°å€¼ç›¸ç­‰</li>
<li>è¦æ±‚fs.trash.checkpoint.interval &lt;= fs.trash.interval</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æµ‹è¯•</span></span><br><span class="line"><span class="comment"># ä¿®æ”¹core-site.xmlï¼Œé…ç½®åƒåœ¾å›æ”¶æ—¶é—´ä¸º1åˆ†é’Ÿ</span></span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;fs.trash.interval&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;1&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"><span class="comment"># ä¿®æ”¹å®Œåè¿›è¡Œåˆ†å‘ï¼Œç„¶åé‡å¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å›æ”¶ç«™ç›®å½•åœ¨HDFSé›†ç¾¤ä¸­çš„è·¯å¾„ï¼š/user/atguigu/.Trash/â€¦</span></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šé€šè¿‡ç½‘é¡µä¸Šç›´æ¥åˆ é™¤çš„æ–‡ä»¶ä¹Ÿä¸ä¼šèµ°å›æ”¶ç«™</span></span><br><span class="line"><span class="comment"># é€šè¿‡ç¨‹åºåˆ é™¤çš„æ–‡ä»¶ä¸ä¼šç»è¿‡å›æ”¶ç«™ï¼Œéœ€è¦è°ƒç”¨moveToTrash()æ‰è¿›å…¥å›æ”¶ç«™</span></span><br><span class="line">Trash trash = New Trash(conf);</span><br><span class="line">trash.moveToTrash(path);</span><br><span class="line"><span class="comment"># åªæœ‰åœ¨å‘½ä»¤è¡Œåˆ©ç”¨hadoop fs -rmå‘½ä»¤åˆ é™¤çš„æ–‡ä»¶æ‰ä¼šèµ°å›æ”¶ç«™ï¼Œéœ€è¦åœ¨NNæ‰€åœ¨å®¢æˆ·ç«¯æ‰§è¡Œ</span></span><br><span class="line">hadoop fs -rm -r /user/atguigu/input</span><br><span class="line"><span class="comment"># æ¢å¤å›æ”¶ç«™æ•°æ®</span></span><br><span class="line">hadoop fs -mv</span><br><span class="line">/user/atguigu/.Trash/Current/user/atguigu/input    /user/atguigu/input</span><br></pre></td></tr></table></figure>
<h2 id="2ã€HDFSé›†ç¾¤å‹æµ‹">2ã€HDFSé›†ç¾¤å‹æµ‹</h2>
<p>HDFSçš„è¯»å†™æ€§èƒ½ä¸»è¦å—<strong>ç½‘ç»œå’Œç£ç›˜</strong>å½±å“æ¯”è¾ƒå¤§ã€‚ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œå°†hadoop102ã€hadoop103ã€hadoop104è™šæ‹Ÿæœºç½‘ç»œéƒ½è®¾ç½®ä¸º100mbpsã€‚æµ‹è¯•ç½‘é€Ÿï¼šæ¥åˆ°hadoop102çš„<code>/opt/module</code>ç›®å½•ï¼Œåˆ›å»ºä¸€ä¸ª</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m SimpleHTTPServer</span><br></pre></td></tr></table></figure>
<h3 id="2-1-æµ‹è¯•HDFSå†™æ€§èƒ½">2.1 æµ‹è¯•HDFSå†™æ€§èƒ½</h3>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330938.png" alt></p>
<p>æµ‹è¯•å†…å®¹ï¼šå‘HDFSé›†ç¾¤å†™10ä¸ª128Mçš„æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„ï¼šnrFiles nä¸ºç”ŸæˆmapTaskçš„æ•°é‡ï¼Œç”Ÿäº§ç¯å¢ƒä¸€èˆ¬å¯é€šè¿‡hadoop103:8088æŸ¥çœ‹CPUæ ¸æ•°ï¼Œè®¾ç½®ä¸ºï¼ˆCPUæ ¸æ•° - 1ï¼‰</span></span><br><span class="line">hadoop jar /opt/module/hadoop-3.1.3/share/hadoop/mapreduce/hadoop-mapreduce-client-jobclient-3.1.3-tests.jar TestDFSIO -write -nrFiles 10 -fileSize 128MB</span><br><span class="line"><span class="comment"># æµ‹è¯•ç»“æœ</span></span><br><span class="line">2021-02-09 10:43:16,853 INFO fs.TestDFSIO: ----- TestDFSIO ----- : write</span><br><span class="line">2021-02-09 10:43:16,854 INFO fs.TestDFSIO:             Date &amp; time: Tue Feb 09 10:43:16 CST 2021</span><br><span class="line">2021-02-09 10:43:16,854 INFO fs.TestDFSIO:         Number of files: 10</span><br><span class="line">2021-02-09 10:43:16,854 INFO fs.TestDFSIO:  Total MBytes processed: 1280</span><br><span class="line">2021-02-09 10:43:16,854 INFO fs.TestDFSIO:       Throughput mb/sec: 1.61</span><br><span class="line">2021-02-09 10:43:16,854 INFO fs.TestDFSIO:  Average IO rate mb/sec: 1.9</span><br><span class="line">2021-02-09 10:43:16,854 INFO fs.TestDFSIO:   IO rate std deviation: 0.76</span><br><span class="line">2021-02-09 10:43:16,854 INFO fs.TestDFSIO:      Test <span class="built_in">exec</span> time sec: 133.05</span><br><span class="line">2021-02-09 10:43:16,854 INFO fs.TestDFSIO:</span><br></pre></td></tr></table></figure>
<ul>
<li>Number of filesï¼šç”ŸæˆmapTaskæ•°é‡ï¼Œä¸€èˆ¬æ˜¯é›†ç¾¤ä¸­ï¼ˆCPUæ ¸æ•°-1ï¼‰ï¼Œæˆ‘ä»¬æµ‹è¯•è™šæ‹Ÿæœºå°±æŒ‰ç…§å®é™…çš„ç‰©ç†å†…å­˜-1åˆ†é…å³å¯</li>
<li>Total MBytes processedï¼šå•ä¸ªmapå¤„ç†çš„æ–‡ä»¶å¤§å°</li>
<li>Throughput mb/secï¼šå•ä¸ªmapTakçš„ååé‡ ã€‚è®¡ç®—æ–¹å¼ï¼šå¤„ç†çš„æ€»æ–‡ä»¶å¤§å°/æ¯ä¸€ä¸ªmapTaskå†™æ•°æ®çš„æ—¶é—´ç´¯åŠ ï¼›é›†ç¾¤æ•´ä½“ååé‡ï¼šç”ŸæˆmapTaskæ•°é‡*å•ä¸ªmapTakçš„ååé‡</li>
<li>Average IO rate mb/secï¼šå¹³å‡mapTakçš„ååé‡ã€‚è®¡ç®—æ–¹å¼ï¼šæ¯ä¸ªmapTaskå¤„ç†æ–‡ä»¶å¤§å°/æ¯ä¸€ä¸ªmapTaskå†™æ•°æ®çš„æ—¶é—´ï¼Œå…¨éƒ¨ç›¸åŠ é™¤ä»¥taskæ•°é‡</li>
<li>IO rate std deviationï¼šæ–¹å·®ã€åæ˜ å„ä¸ªmapTaskå¤„ç†çš„å·®å€¼ï¼Œè¶Šå°è¶Šå‡è¡¡</li>
</ul>
<p>æ³¨æ„ï¼šå¦‚æœæµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œå‡ºç°å¼‚å¸¸ï¼Œè¯´æ˜æ£€æŸ¥äº†è™šæ‹Ÿå†…å­˜ï¼Œå¯ä»¥åœ¨yarn-site.xmlä¸­è®¾ç½®è™šæ‹Ÿå†…å­˜æ£€æµ‹ä¸ºfalseï¼Œåˆ†å‘é…ç½®å¹¶é‡å¯Yarné›†ç¾¤<code>sbin/stop-yarn.sh</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æ˜¯å¦å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ£€æŸ¥æ¯ä¸ªä»»åŠ¡æ­£ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜é‡ï¼Œå¦‚æœä»»åŠ¡è¶…å‡ºåˆ†é…å€¼ï¼Œåˆ™ç›´æ¥å°†å…¶æ€æ‰ï¼Œé»˜è®¤æ˜¯true --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.vmem-check-enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ç»“æœåˆ†æï¼Œç”±äºå‰¯æœ¬1å°±åœ¨æœ¬åœ°ï¼Œæ‰€ä»¥è¯¥å‰¯æœ¬ä¸å‚ä¸æµ‹è¯•ï¼Œä¸€å…±å‚ä¸æµ‹è¯•çš„æ–‡ä»¶ï¼š10ä¸ªæ–‡ä»¶ * 2ä¸ªå‰¯æœ¬ = 20ä¸ªï¼Œå‹æµ‹åçš„é€Ÿåº¦ï¼š1.61ï¼Œå®æµ‹é€Ÿåº¦ï¼š1.61M/s * 20ä¸ªæ–‡ä»¶ â‰ˆ 32M/sï¼Œä¸‰å°æœåŠ¡å™¨çš„å¸¦å®½ï¼š12.5 + 12.5 + 12.5 â‰ˆ 30m/sï¼Œæ‰€æœ‰ç½‘ç»œèµ„æºéƒ½å·²ç»ç”¨æ»¡ã€‚<strong>å¦‚æœå®æµ‹é€Ÿåº¦è¿œè¿œå°äºç½‘ç»œï¼Œå¹¶ä¸”å®æµ‹é€Ÿåº¦ä¸èƒ½æ»¡è¶³å·¥ä½œéœ€æ±‚ï¼Œå¯ä»¥è€ƒè™‘é‡‡ç”¨å›ºæ€ç¡¬ç›˜æˆ–è€…å¢åŠ ç£ç›˜ä¸ªæ•°</strong></p>
<p>å¦‚æœå®¢æˆ·ç«¯ä¸åœ¨é›†ç¾¤èŠ‚ç‚¹ï¼Œé‚£å°±ä¸‰ä¸ªå‰¯æœ¬éƒ½å‚ä¸è®¡ç®—</p>
<h3 id="2-2-æµ‹è¯•HDFSè¯»æ€§èƒ½">2.2 æµ‹è¯•HDFSè¯»æ€§èƒ½</h3>
<p>æµ‹è¯•å†…å®¹ï¼šè¯»å–HDFSé›†ç¾¤10ä¸ª128Mçš„æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">hadoop jar /opt/module/hadoop-3.1.3/share/hadoop/mapreduce/hadoop-mapreduce-client-jobclient-3.1.3-tests.jar TestDFSIO -<span class="built_in">read</span> -nrFiles 10 -fileSize 128MB</span><br><span class="line"><span class="comment"># ç»“æœ</span></span><br><span class="line">2021-02-09 11:34:15,847 INFO fs.TestDFSIO: ----- TestDFSIO ----- : <span class="built_in">read</span></span><br><span class="line">2021-02-09 11:34:15,847 INFO fs.TestDFSIO:             Date &amp; time: Tue Feb 09 11:34:15 CST 2021</span><br><span class="line">2021-02-09 11:34:15,847 INFO fs.TestDFSIO:         Number of files: 10</span><br><span class="line">2021-02-09 11:34:15,847 INFO fs.TestDFSIO:  Total MBytes processed: 1280</span><br><span class="line">2021-02-09 11:34:15,848 INFO fs.TestDFSIO:       Throughput mb/sec: 200.28</span><br><span class="line">2021-02-09 11:34:15,848 INFO fs.TestDFSIO:  Average IO rate mb/sec: 266.74</span><br><span class="line">2021-02-09 11:34:15,848 INFO fs.TestDFSIO:   IO rate std deviation: 143.12</span><br><span class="line">2021-02-09 11:34:15,848 INFO fs.TestDFSIO:      Test <span class="built_in">exec</span> time sec: 20.83</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•ç»“æœåˆ†æï¼šä¸ºä»€ä¹ˆè¯»å–æ–‡ä»¶é€Ÿåº¦å¤§äºç½‘ç»œå¸¦å®½ï¼Ÿç”±äºç›®å‰åªæœ‰ä¸‰å°æœåŠ¡å™¨ï¼Œä¸”æœ‰ä¸‰ä¸ªå‰¯æœ¬ï¼Œæ•°æ®è¯»å–å°±è¿‘åŸåˆ™ï¼Œç›¸å½“äºéƒ½æ˜¯è¯»å–çš„æœ¬åœ°ç£ç›˜æ•°æ®ï¼Œæ²¡æœ‰èµ°ç½‘ç»œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤æµ‹è¯•ç”Ÿæˆæ•°æ®</span></span><br><span class="line">hadoop jar /opt/module/hadoop-3.1.3/share/hadoop/mapreduce/hadoop-mapreduce-client-jobclient-3.1.3-tests.jar TestDFSIO -clean</span><br></pre></td></tr></table></figure>
<h2 id="3ã€HDFSå¤šç›®å½•">3ã€HDFSå¤šç›®å½•</h2>
<h3 id="3-1-NameNodeå¤šç›®å½•é…ç½®">3.1  NameNodeå¤šç›®å½•é…ç½®</h3>
<blockquote>
<p>NameNodeçš„æœ¬åœ°ç›®å½•å¯ä»¥é…ç½®æˆå¤šä¸ªï¼Œä¸”æ¯ä¸ªç›®å½•å­˜æ”¾å†…å®¹ç›¸åŒï¼Œå¢åŠ äº†å¯é æ€§(éé«˜å¯ç”¨)</p>
</blockquote>
<p>åœ¨hdfs-site.xmlæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œæ³¨æ„ï¼šå› ä¸ºæ¯å°æœåŠ¡å™¨èŠ‚ç‚¹çš„ç£ç›˜æƒ…å†µä¸åŒï¼Œæ‰€ä»¥è¿™ä¸ªé…ç½®é…å®Œä¹‹åï¼Œå¯ä»¥é€‰æ‹©ä¸åˆ†å‘</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">value</span>&gt;</span>file://$&#123;hadoop.tmp.dir&#125;/dfs/name1,file://$&#123;hadoop.tmp.dir&#125;/dfs/name2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœæ­¢é›†ç¾¤ï¼Œåˆ é™¤ä¸‰å°èŠ‚ç‚¹çš„dataå’Œlogsä¸­æ‰€æœ‰æ•°æ®ï¼Œæ ¼å¼åŒ–é›†ç¾¤å¹¶å¯åŠ¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‰å°éƒ½è¦åˆ é™¤</span></span><br><span class="line">rm -rf data/ logs/</span><br><span class="line"></span><br><span class="line">bin/hdfs namenode -format</span><br><span class="line">sbin/start-dfs.sh</span><br><span class="line"><span class="comment"># æ£€æŸ¥name1å’Œname2é‡Œé¢çš„å†…å®¹ï¼Œå‘ç°ä¸€æ¨¡ä¸€æ ·</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-DataNodeå¤šç›®å½•é…ç½®-é‡è¦">3.2 DataNodeå¤šç›®å½•é…ç½®(é‡è¦)</h3>
<blockquote>
<p>DataNodeå¯ä»¥é…ç½®æˆå¤šä¸ªç›®å½•ï¼Œ<strong>æ¯ä¸ªç›®å½•å­˜å‚¨çš„æ•°æ®ä¸ä¸€æ ·</strong>ï¼ˆæ•°æ®ä¸æ˜¯å‰¯æœ¬ï¼‰</p>
</blockquote>
<p>åœ¨hdfs-site.xmlæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">value</span>&gt;</span>file://$&#123;hadoop.tmp.dir&#125;/dfs/data1,file://$&#123;hadoop.tmp.dir&#125;/dfs/data2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>é‡å¯é›†ç¾¤ï¼ŒæŸ¥çœ‹ç»“æœ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /opt/module/hadoop-3.1.3/data/dfs</span></span><br><span class="line"><span class="comment"># å‘é›†ç¾¤ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œå†æ¬¡è§‚å¯Ÿä¸¤ä¸ªæ–‡ä»¶å¤¹é‡Œé¢çš„å†…å®¹å‘ç°ä¸ä¸€è‡´ï¼ˆä¸€ä¸ªæœ‰æ•°ä¸€ä¸ªæ²¡æœ‰ï¼‰</span></span><br></pre></td></tr></table></figure>
<h3 id="3-3-é›†ç¾¤æ•°æ®å‡è¡¡ä¹‹ç£ç›˜é—´æ•°æ®å‡è¡¡">3.3 é›†ç¾¤æ•°æ®å‡è¡¡ä¹‹ç£ç›˜é—´æ•°æ®å‡è¡¡</h3>
<p>ç”Ÿäº§ç¯å¢ƒï¼Œç”±äºç¡¬ç›˜ç©ºé—´ä¸è¶³ï¼Œå¾€å¾€éœ€è¦å¢åŠ ä¸€å—ç¡¬ç›˜ã€‚åˆšåŠ è½½çš„ç¡¬ç›˜æ²¡æœ‰æ•°æ®æ—¶ï¼Œå¯ä»¥æ‰§è¡Œç£ç›˜æ•°æ®å‡è¡¡å‘½ä»¤ã€‚ï¼ˆHadoop3.xæ–°ç‰¹æ€§ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿæˆå‡è¡¡è®¡åˆ’ï¼ˆæˆ‘ä»¬åªæœ‰ä¸€å—ç£ç›˜ï¼Œä¸ä¼šç”Ÿæˆè®¡åˆ’ï¼‰</span></span><br><span class="line">hdfs diskbalancer -plan hadoop103</span><br><span class="line"><span class="comment"># æ‰§è¡Œå‡è¡¡è®¡åˆ’</span></span><br><span class="line">hdfs diskbalancer -execute hadoop103.plan.json</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰å‡è¡¡ä»»åŠ¡çš„æ‰§è¡Œæƒ…å†µ</span></span><br><span class="line">hdfs diskbalancer -query hadoop103</span><br><span class="line"><span class="comment"># å–æ¶ˆå‡è¡¡ä»»åŠ¡</span></span><br><span class="line">hdfs diskbalancer -cancel hadoop103.plan.json</span><br></pre></td></tr></table></figure>
<h2 id="4ã€HDFSé›†ç¾¤æ‰©å®¹åŠç¼©å®¹-é‡è¦">4ã€HDFSé›†ç¾¤æ‰©å®¹åŠç¼©å®¹(é‡è¦)</h2>
<h3 id="4-1-æ·»åŠ ç™½åå•">4.1 æ·»åŠ ç™½åå•</h3>
<p>ç™½åå•ï¼šè¡¨ç¤ºåœ¨ç™½åå•çš„ä¸»æœºIPåœ°å€å¯ä»¥ï¼Œç”¨æ¥å­˜å‚¨æ•°æ®ï¼Œè€Œéç™½åå•çš„èŠ‚ç‚¹åªèƒ½ä½œä¸ºå®¢æˆ·ç«¯è®¿é—®ï¼Œæ— æ³•å­˜å‚¨æ•°æ®ã€‚ä¼ä¸šä¸­ï¼šé…ç½®ç™½åå•ï¼Œå¯ä»¥å°½é‡é˜²æ­¢é»‘å®¢æ¶æ„è®¿é—®æ”»å‡»</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨NameNodeèŠ‚ç‚¹çš„/opt/module/hadoop-3.1.3/etc/hadoopç›®å½•ä¸‹åˆ†åˆ«åˆ›å»ºwhitelist å’Œblacklistæ–‡ä»¶</span></span><br><span class="line"><span class="comment"># åˆ›å»ºç™½åå•</span></span><br><span class="line">vim whitelist</span><br><span class="line">hadoop102</span><br><span class="line">hadoop103</span><br><span class="line"><span class="comment"># åˆ›å»ºé»‘åå•,ä¿æŒç©ºå³å¯</span></span><br><span class="line">touch blacklist</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨hdfs-site.xmlé…ç½®æ–‡ä»¶ä¸­å¢åŠ dfs.hostsé…ç½®å‚æ•°</span></span><br><span class="line">&lt;!-- ç™½åå• --&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">     &lt;name&gt;dfs.hosts&lt;/name&gt;</span><br><span class="line">     &lt;value&gt;/opt/module/hadoop-3.1.3/etc/hadoop/whitelist&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- é»‘åå• --&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">     &lt;name&gt;dfs.hosts.exclude&lt;/name&gt;</span><br><span class="line">     &lt;value&gt;/opt/module/hadoop-3.1.3/etc/hadoop/blacklist&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†å‘é…ç½®æ–‡ä»¶whitelistï¼Œhdfs-site.xml</span></span><br><span class="line">xsync hdfs-site.xml whitelist</span><br><span class="line"><span class="comment"># ç¬¬ä¸€æ¬¡æ·»åŠ ç™½åå•å¿…é¡»é‡å¯é›†ç¾¤ï¼Œä¸æ˜¯ç¬¬ä¸€æ¬¡ï¼Œåªéœ€è¦åˆ·æ–°NameNodeèŠ‚ç‚¹å³å¯</span></span><br><span class="line">myhadoop.sh stop</span><br><span class="line">myhadoop.sh start</span><br><span class="line"><span class="comment"># åœ¨webæµè§ˆå™¨ä¸ŠæŸ¥çœ‹DNï¼Œhttp://hadoop102:9870/dfshealth.html#tab-datanode</span></span><br><span class="line"><span class="comment"># åœ¨hadoop104ä¸Šæ‰§è¡Œä¸Šä¼ æ•°æ®æ•°æ®å¤±è´¥</span></span><br><span class="line"><span class="comment"># äºŒæ¬¡ä¿®æ”¹ç™½åå•ï¼Œå¢åŠ hadoop104</span></span><br><span class="line"><span class="comment"># åˆ·æ–°NameNode</span></span><br><span class="line">hdfs dfsadmin -refreshNodes</span><br></pre></td></tr></table></figure>
<h3 id="4-2-æ–°å¢æœåŠ¡å™¨èŠ‚ç‚¹">4.2 æ–°å¢æœåŠ¡å™¨èŠ‚ç‚¹</h3>
<p>éšç€å…¬å¸ä¸šåŠ¡çš„å¢é•¿ï¼Œæ•°æ®é‡è¶Šæ¥è¶Šå¤§ï¼ŒåŸæœ‰çš„æ•°æ®èŠ‚ç‚¹çš„å®¹é‡å·²ç»ä¸èƒ½æ»¡è¶³å­˜å‚¨æ•°æ®çš„éœ€æ±‚ï¼Œéœ€è¦åœ¨åŸæœ‰é›†ç¾¤åŸºç¡€ä¸ŠåŠ¨æ€æ·»åŠ æ–°çš„æ•°æ®èŠ‚ç‚¹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¯å¢ƒå‡†å¤‡</span></span><br><span class="line"><span class="comment"># åœ¨hadoop100ä¸»æœºä¸Šå†å…‹éš†ä¸€å°hadoop105ä¸»æœº</span></span><br><span class="line"><span class="comment"># ä¿®æ”¹IPåœ°å€å’Œä¸»æœºåç§°</span></span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-ens33</span><br><span class="line">vim /etc/hostname</span><br><span class="line"><span class="comment"># æ‹·è´hadoop102çš„/opt/moduleç›®å½•å’Œ/etc/profile.d/my_env.shåˆ°hadoop105</span></span><br><span class="line">scp -r module/* atguigu@hadoop105:/opt/module/</span><br><span class="line">sudo scp /etc/profile.d/my_env.sh root@hadoop105:/etc/profile.d/my_env.sh</span><br><span class="line"><span class="comment"># å» 105</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="comment"># åˆ é™¤hadoop105ä¸ŠHadoopçš„å†å²æ•°æ®ï¼Œdataå’Œlogæ•°æ®</span></span><br><span class="line">rm -rf data/ logs/</span><br><span class="line"><span class="comment"># é…ç½®hadoop102å’Œhadoop103åˆ°hadoop105çš„sshæ— å¯†ç™»å½•</span></span><br><span class="line">ssh-copy-id hadoop105</span><br><span class="line">ssh-copy-id hadoop105</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœå½¹æ–°èŠ‚ç‚¹å…·ä½“æ­¥éª¤</span></span><br><span class="line"><span class="comment"># ç›´æ¥å¯åŠ¨DataNodeï¼Œå³å¯å…³è”åˆ°é›†ç¾¤</span></span><br><span class="line">hdfs --daemon start datanode</span><br><span class="line">yarn --daemon start nodemanager</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ç™½åå•ä¸­å¢åŠ æ–°æœå½¹çš„æœåŠ¡å™¨</span></span><br><span class="line"><span class="comment"># åœ¨ç™½åå•whitelistä¸­å¢åŠ hadoop104ã€hadoop105ï¼Œå¹¶é‡å¯é›†ç¾¤</span></span><br><span class="line">vim whitelist</span><br><span class="line"><span class="comment"># åˆ†å‘ä¸åˆ·æ–°</span></span><br><span class="line">xsync whitelist</span><br><span class="line">hdfs dfsadmin -refreshNodes</span><br><span class="line">Refresh nodes successful</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨hadoop105ä¸Šä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line">hadoop fs -put /opt/module/hadoop-3.1.3/LICENSE.txt /</span><br></pre></td></tr></table></figure>
<h3 id="4-3-æœåŠ¡å™¨é—´æ•°æ®å‡è¡¡">4.3 æœåŠ¡å™¨é—´æ•°æ®å‡è¡¡</h3>
<p>åœ¨ä¼ä¸šå¼€å‘ä¸­ï¼Œå¦‚æœç»å¸¸åœ¨hadoop102å’Œhadoop104ä¸Šæäº¤ä»»åŠ¡ï¼Œä¸”å‰¯æœ¬æ•°ä¸º2ï¼Œç”±äºæ•°æ®æœ¬åœ°æ€§åŸåˆ™ï¼Œå°±ä¼šå¯¼è‡´hadoop102å’Œhadoop104æ•°æ®è¿‡å¤šï¼Œhadoop103å­˜å‚¨çš„æ•°æ®é‡å°ã€‚å¦ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯æ–°æœå½¹çš„æœåŠ¡å™¨æ•°æ®é‡æ¯”è¾ƒå°‘ï¼Œéœ€è¦æ‰§è¡Œé›†ç¾¤å‡è¡¡å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å¯æ•°æ®å‡è¡¡å‘½ä»¤</span></span><br><span class="line"><span class="comment"># å¯¹äºå‚æ•°10ï¼Œä»£è¡¨çš„æ˜¯é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹çš„ç£ç›˜ç©ºé—´åˆ©ç”¨ç‡ç›¸å·®ä¸è¶…è¿‡10%ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´</span></span><br><span class="line">sbin/start-balancer.sh -threshold 10</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœæ­¢æ•°æ®å‡è¡¡å‘½ä»¤</span></span><br><span class="line">sbin/stop-balancer.sh</span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šç”±äºHDFSéœ€è¦å¯åŠ¨å•ç‹¬çš„Rebalance Serveræ¥æ‰§è¡ŒRebalanceæ“ä½œï¼Œæ‰€ä»¥å°½é‡ä¸è¦åœ¨NameNodeä¸Šæ‰§è¡Œstart-balancer.shï¼Œè€Œæ˜¯æ‰¾ä¸€å°æ¯”è¾ƒç©ºé—²çš„æœºå™¨</span></span><br></pre></td></tr></table></figure>
<h3 id="4-4-é»‘åå•é€€å½¹æœåŠ¡å™¨">4.4 é»‘åå•é€€å½¹æœåŠ¡å™¨</h3>
<p>é»‘åå•ï¼šè¡¨ç¤ºåœ¨é»‘åå•çš„ä¸»æœºIPåœ°å€ä¸å¯ä»¥ï¼Œç”¨æ¥å­˜å‚¨æ•°æ®ã€‚ä¼ä¸šä¸­ï¼šé…ç½®é»‘åå•ï¼Œç”¨æ¥é€€å½¹æœåŠ¡å™¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–è¾‘/opt/module/hadoop-3.1.3/etc/hadoopç›®å½•ä¸‹çš„blacklistæ–‡ä»¶</span></span><br><span class="line">vim blacklist</span><br><span class="line"><span class="comment"># æ·»åŠ å¦‚ä¸‹ä¸»æœºåç§°ï¼ˆè¦é€€å½¹çš„èŠ‚ç‚¹ï¼‰</span></span><br><span class="line">hadoop105</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šå¦‚æœç™½åå•ä¸­æ²¡æœ‰é…ç½®ï¼Œéœ€è¦åœ¨hdfs-site.xmlé…ç½®æ–‡ä»¶ä¸­å¢åŠ dfs.hostsé…ç½®å‚æ•°</span></span><br><span class="line">!-- é»‘åå• --&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">     &lt;name&gt;dfs.hosts.exclude&lt;/name&gt;</span><br><span class="line">     &lt;value&gt;/opt/module/hadoop-3.1.3/etc/hadoop/blacklist&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†å‘é…ç½®æ–‡ä»¶blacklistï¼Œhdfs-site.xml</span></span><br><span class="line">xsync hdfs-site.xml blacklist</span><br><span class="line"><span class="comment"># ç¬¬ä¸€æ¬¡æ·»åŠ é»‘åå•å¿…é¡»é‡å¯é›†ç¾¤ï¼Œä¸æ˜¯ç¬¬ä¸€æ¬¡ï¼Œåªéœ€è¦åˆ·æ–°NameNodeèŠ‚ç‚¹å³å¯</span></span><br><span class="line">hdfs dfsadmin -refreshNodes</span><br><span class="line"><span class="comment"># æ£€æŸ¥Webæµè§ˆå™¨ï¼Œé€€å½¹èŠ‚ç‚¹çš„çŠ¶æ€ä¸ºdecommission in progressï¼ˆé€€å½¹ä¸­ï¼‰ï¼Œè¯´æ˜æ•°æ®èŠ‚ç‚¹æ­£åœ¨å¤åˆ¶å—åˆ°å…¶ä»–èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"># ç­‰å¾…é€€å½¹èŠ‚ç‚¹çŠ¶æ€ä¸ºdecommissionedï¼ˆæ‰€æœ‰å—å·²ç»å¤åˆ¶å®Œæˆï¼‰ï¼Œåœæ­¢è¯¥èŠ‚ç‚¹åŠèŠ‚ç‚¹èµ„æºç®¡ç†å™¨ã€‚æ³¨æ„ï¼šå¦‚æœå‰¯æœ¬æ•°æ˜¯3ï¼Œæœå½¹çš„èŠ‚ç‚¹å°äºç­‰äº3ï¼Œæ˜¯ä¸èƒ½é€€å½¹æˆåŠŸçš„ï¼Œéœ€è¦ä¿®æ”¹å‰¯æœ¬æ•°åæ‰èƒ½é€€å½¹</span></span><br><span class="line">hdfs --daemon stop datanode</span><br><span class="line">yarn --daemon stop nodemanager</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæ•°æ®ä¸å‡è¡¡ï¼Œå¯ä»¥ç”¨å‘½ä»¤å®ç°é›†ç¾¤çš„å†å¹³è¡¡</span></span><br><span class="line">sbin/start-balancer.sh -threshold 10</span><br></pre></td></tr></table></figure>
<h3 id="4-5-HDFSâ€”é›†ç¾¤è¿ç§»">4.5 HDFSâ€”é›†ç¾¤è¿ç§»</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡‡ç”¨scpæ‹·è´æ•°æ®</span></span><br><span class="line"><span class="comment"># é‡‡ç”¨distcpå‘½ä»¤å®ç°ä¸¤ä¸ªHadoopé›†ç¾¤ä¹‹é—´çš„é€’å½’æ•°æ®å¤åˆ¶</span></span><br><span class="line">bin/hadoop distcp hdfs://hadoop102:8020/user/atguigu/hello.txt hdfs://hadoop105:8020/user/atguigu/hello.txt</span><br></pre></td></tr></table></figure>
<h2 id="5ã€HDFSå­˜å‚¨ä¼˜åŒ–">5ã€HDFSå­˜å‚¨ä¼˜åŒ–</h2>
<h3 id="5-1-çº åˆ ç ">5.1 çº åˆ ç </h3>
<blockquote>
<p>HDFSé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ–‡ä»¶æœ‰3ä¸ªå‰¯æœ¬ï¼Œè¿™æ ·æé«˜äº†æ•°æ®çš„å¯é æ€§ï¼Œä½†ä¹Ÿå¸¦æ¥äº†2å€çš„å†—ä½™å¼€é”€ã€‚Hadoop3.xå¼•å…¥äº†çº åˆ ç ï¼Œé‡‡ç”¨è®¡ç®—çš„æ–¹å¼ï¼Œå¯ä»¥èŠ‚çœçº¦50ï¼…å·¦å³çš„å­˜å‚¨ç©ºé—´</p>
</blockquote>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330939.png" alt></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 hadoop-3.1.3]$ hdfs ec</span><br><span class="line">Usage: bin/hdfs ec [COMMAND]</span><br><span class="line">          [-listPolicies]</span><br><span class="line">          [-addPolicies -policyFile &lt;file&gt;]</span><br><span class="line">          [-getPolicy -path &lt;path&gt;]</span><br><span class="line">          [-removePolicy -policy &lt;policy&gt;]</span><br><span class="line">          [-setPolicy -path &lt;path&gt; [-policy &lt;policy&gt;] [-replicate]]</span><br><span class="line">          [-unsetPolicy -path &lt;path&gt;]</span><br><span class="line">          [-listCodecs]</span><br><span class="line">          [-enablePolicy -policy &lt;policy&gt;]</span><br><span class="line">          [-disablePolicy -policy &lt;policy&gt;]</span><br><span class="line">          [-<span class="built_in">help</span> &lt;<span class="built_in">command</span>-name&gt;].</span><br><span class="line">          </span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰æ”¯æŒçš„çº åˆ ç ç­–ç•¥</span></span><br><span class="line">hdfs ec -listPolicies</span><br></pre></td></tr></table></figure>
<ul>
<li>RS-3-2-1024kï¼šä½¿ç”¨RSç¼–ç ï¼Œæ¯3ä¸ªæ•°æ®å•å…ƒï¼Œç”Ÿæˆ2ä¸ªæ ¡éªŒå•å…ƒï¼Œå…±5ä¸ªå•å…ƒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šè¿™5ä¸ªå•å…ƒä¸­ï¼Œåªè¦æœ‰ä»»æ„çš„3ä¸ªå•å…ƒå­˜åœ¨ï¼ˆä¸ç®¡æ˜¯æ•°æ®å•å…ƒè¿˜æ˜¯æ ¡éªŒå•å…ƒï¼Œåªè¦æ€»æ•°=3ï¼‰ï¼Œå°±å¯ä»¥å¾—åˆ°åŸå§‹æ•°æ®ã€‚æ¯ä¸ªå•å…ƒçš„å¤§å°æ˜¯1024k=1024*1024=1048576</li>
<li>RS-10-4-1024kï¼šä½¿ç”¨RSç¼–ç ï¼Œæ¯10ä¸ªæ•°æ®å•å…ƒï¼ˆcellï¼‰ï¼Œç”Ÿæˆ4ä¸ªæ ¡éªŒå•å…ƒï¼Œå…±14ä¸ªå•å…ƒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šè¿™14ä¸ªå•å…ƒä¸­ï¼Œåªè¦æœ‰ä»»æ„çš„10ä¸ªå•å…ƒå­˜åœ¨ï¼ˆä¸ç®¡æ˜¯æ•°æ®å•å…ƒè¿˜æ˜¯æ ¡éªŒå•å…ƒï¼Œåªè¦æ€»æ•°=10ï¼‰ï¼Œå°±å¯ä»¥å¾—åˆ°åŸå§‹æ•°æ®ã€‚æ¯ä¸ªå•å…ƒçš„å¤§å°æ˜¯1024k=1024*1024=1048576</li>
<li>RS-6-3-1024kï¼šä½¿ç”¨RSç¼–ç ï¼Œæ¯6ä¸ªæ•°æ®å•å…ƒï¼Œç”Ÿæˆ3ä¸ªæ ¡éªŒå•å…ƒï¼Œå…±9ä¸ªå•å…ƒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šè¿™9ä¸ªå•å…ƒä¸­ï¼Œåªè¦æœ‰ä»»æ„çš„6ä¸ªå•å…ƒå­˜åœ¨ï¼ˆä¸ç®¡æ˜¯æ•°æ®å•å…ƒè¿˜æ˜¯æ ¡éªŒå•å…ƒï¼Œåªè¦æ€»æ•°=6ï¼‰ï¼Œå°±å¯ä»¥å¾—åˆ°åŸå§‹æ•°æ®ã€‚æ¯ä¸ªå•å…ƒçš„å¤§å°æ˜¯1024k=1024*1024=1048576(é»˜è®¤å¼€å¯)</li>
<li>RS-LEGACY-6-3-1024kï¼šç­–ç•¥å’Œä¸Šé¢çš„RS-6-3-1024kä¸€æ ·ï¼Œåªæ˜¯ç¼–ç çš„ç®—æ³•ç”¨çš„æ˜¯rs-legacy</li>
<li>XOR-2-1-1024kï¼šä½¿ç”¨XORç¼–ç ï¼ˆé€Ÿåº¦æ¯”RSç¼–ç å¿«ï¼‰ï¼Œæ¯2ä¸ªæ•°æ®å•å…ƒï¼Œç”Ÿæˆ1ä¸ªæ ¡éªŒå•å…ƒï¼Œå…±3ä¸ªå•å…ƒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šè¿™3ä¸ªå•å…ƒä¸­ï¼Œåªè¦æœ‰ä»»æ„çš„2ä¸ªå•å…ƒå­˜åœ¨ï¼ˆä¸ç®¡æ˜¯æ•°æ®å•å…ƒè¿˜æ˜¯æ ¡éªŒå•å…ƒï¼Œåªè¦æ€»æ•°= 2ï¼‰ï¼Œå°±å¯ä»¥å¾—åˆ°åŸå§‹æ•°æ®ã€‚æ¯ä¸ªå•å…ƒçš„å¤§å°æ˜¯1024k=1024*1024=1048576</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># çº åˆ ç æ¡ˆä¾‹å®æ“ï¼Œå°†/inputç›®å½•è®¾ç½®ä¸ºRS-3-2-1024kç­–ç•¥</span></span><br><span class="line"><span class="comment"># é»˜è®¤åªå¼€å¯å¯¹RS-6-3-1024kç­–ç•¥çš„æ”¯æŒï¼Œå¦‚è¦ä½¿ç”¨åˆ«çš„ç­–ç•¥éœ€è¦æå‰å¯ç”¨</span></span><br><span class="line"><span class="comment"># å¼€å¯å¯¹RS-3-2-1024kç­–ç•¥çš„æ”¯æŒ</span></span><br><span class="line">hdfs ec -enablePolicy -policy RS-3-2-1024k</span><br><span class="line"><span class="comment"># åœ¨HDFSåˆ›å»ºç›®å½•ï¼Œå¹¶è®¾ç½®RS-3-2-1024kç­–ç•¥</span></span><br><span class="line">hdfs dfs -mkdir /input</span><br><span class="line">hdfs ec -setPolicy -path /input -policy RS-3-2-1024k</span><br><span class="line"><span class="comment"># ä¸Šä¼ æ–‡ä»¶ï¼Œå¹¶æŸ¥çœ‹æ–‡ä»¶ç¼–ç åçš„å­˜å‚¨æƒ…å†µ</span></span><br><span class="line"><span class="comment"># æ³¨ï¼šä½ æ‰€ä¸Šä¼ çš„æ–‡ä»¶éœ€è¦å¤§äº2Mæ‰èƒ½çœ‹å‡ºæ•ˆæœã€‚ï¼ˆä½äº2Mï¼Œåªæœ‰ä¸€ä¸ªæ•°æ®å•å…ƒå’Œä¸¤ä¸ªæ ¡éªŒå•å…ƒï¼‰</span></span><br><span class="line">hdfs dfs -put web.log /input</span><br></pre></td></tr></table></figure>
<h3 id="5-2-å¼‚æ„å­˜å‚¨ï¼ˆå†·çƒ­æ•°æ®åˆ†ç¦»ï¼‰">5.2 å¼‚æ„å­˜å‚¨ï¼ˆå†·çƒ­æ•°æ®åˆ†ç¦»ï¼‰</h3>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330940.png" alt></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰æœ‰å“ªäº›å­˜å‚¨ç­–ç•¥å¯ä»¥ç”¨</span></span><br><span class="line">hdfs storagepolicies -listPolicies</span><br><span class="line"><span class="comment"># ä¸ºæŒ‡å®šè·¯å¾„ï¼ˆæ•°æ®å­˜å‚¨ç›®å½•ï¼‰è®¾ç½®æŒ‡å®šçš„å­˜å‚¨ç­–ç•¥</span></span><br><span class="line">hdfs storagepolicies -setStoragePolicy -path xxx -policy xxx</span><br><span class="line"><span class="comment"># è·å–æŒ‡å®šè·¯å¾„ï¼ˆæ•°æ®å­˜å‚¨ç›®å½•æˆ–æ–‡ä»¶ï¼‰çš„å­˜å‚¨ç­–ç•¥</span></span><br><span class="line">hdfs storagepolicies -getStoragePolicy -path xxx</span><br><span class="line"><span class="comment"># å–æ¶ˆå­˜å‚¨ç­–ç•¥ï¼›æ‰§è¡Œæ”¹å‘½ä»¤ä¹‹åè¯¥ç›®å½•æˆ–è€…æ–‡ä»¶ï¼Œä»¥å…¶ä¸Šçº§çš„ç›®å½•ä¸ºå‡†ï¼Œå¦‚æœæ˜¯æ ¹ç›®å½•ï¼Œé‚£ä¹ˆå°±æ˜¯HOT</span></span><br><span class="line">hdfs storagepolicies -unsetStoragePolicy -path xxx</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ–‡ä»¶å—çš„åˆ†å¸ƒ</span></span><br><span class="line">bin/hdfs fsck xxx -files -blocks -locations</span><br><span class="line"><span class="comment"># æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹</span></span><br><span class="line">hadoop dfsadmin -report</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿™é‡Œè¿›è¡Œæµ‹è¯•ï¼Œé›†ç¾¤è§„åˆ’å¦‚ä¸‹</p>
<table>
<thead>
<tr>
<th>èŠ‚ç‚¹</th>
<th>å­˜å‚¨ç±»å‹åˆ†é…</th>
</tr>
</thead>
<tbody>
<tr>
<td>hadoop102</td>
<td>RAM_DISKï¼ŒSSD</td>
</tr>
<tr>
<td>hadoop103</td>
<td>SSDï¼ŒDISK</td>
</tr>
<tr>
<td>hadoop104</td>
<td>DISKï¼ŒRAM_DISK</td>
</tr>
<tr>
<td>hadoop105</td>
<td>ARCHIVE</td>
</tr>
<tr>
<td>hadoop106</td>
<td>ARCHIVE</td>
</tr>
</tbody>
</table>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--ä¸ºhadoop102èŠ‚ç‚¹çš„hdfs-site.xmlæ·»åŠ å¦‚ä¸‹ä¿¡æ¯--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.storage.policy.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>[SSD]file:///opt/module/hadoop-3.1.3/hdfsdata/ssd,[RAM_DISK]file:///opt/module/hadoop-3.1.3/hdfsdata/ram_disk<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--ä¸ºhadoop103èŠ‚ç‚¹çš„hdfs-site.xmlæ·»åŠ å¦‚ä¸‹ä¿¡æ¯--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.storage.policy.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>[SSD]file:///opt/module/hadoop-3.1.3/hdfsdata/ssd,[DISK]file:///opt/module/hadoop-3.1.3/hdfsdata/disk<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--ä¸ºhadoop104èŠ‚ç‚¹çš„hdfs-site.xmlæ·»åŠ å¦‚ä¸‹ä¿¡æ¯--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.storage.policy.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>[RAM_DISK]file:///opt/module/hdfsdata/ram_disk,[DISK]file:///opt/module/hadoop-3.1.3/hdfsdata/disk<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--ä¸ºhadoop105èŠ‚ç‚¹çš„hdfs-site.xmlæ·»åŠ å¦‚ä¸‹ä¿¡æ¯--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.storage.policy.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>[ARCHIVE]file:///opt/module/hadoop-3.1.3/hdfsdata/archive<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--ä¸ºhadoop106èŠ‚ç‚¹çš„hdfs-site.xmlæ·»åŠ å¦‚ä¸‹ä¿¡æ¯--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.storage.policy.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>[ARCHIVE]file:///opt/module/hadoop-3.1.3/hdfsdata/archive<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨é›†ç¾¤,æ³¨æ„è¦åˆ é™¤dataå’Œlogsç›®å½•</span></span><br><span class="line">hdfs namenode -format</span><br><span class="line">myhadoop.sh start</span><br><span class="line"><span class="comment"># å¹¶åœ¨HDFSä¸Šåˆ›å»ºæ–‡ä»¶ç›®å½•</span></span><br><span class="line">hadoop fs -mkdir /hdfsdata</span><br><span class="line">hadoop fs -put /opt/module/hadoop-3.1.3/NOTICE.txt /hdfsdata</span><br></pre></td></tr></table></figure>
<p>ç¯å¢ƒæ­å»ºå®Œï¼Œä¸‹é¢è¯¦ç»†ä»‹ç»é›†ä¸­å­˜å‚¨ç­–ç•¥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># =========================HOTå­˜å‚¨ç­–ç•¥æ¡ˆä¾‹========================</span></span><br><span class="line"><span class="comment"># æœ€å¼€å§‹æˆ‘ä»¬æœªè®¾ç½®å­˜å‚¨ç­–ç•¥çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è·å–è¯¥ç›®å½•çš„å­˜å‚¨ç­–ç•¥</span></span><br><span class="line">hdfs storagepolicies -getStoragePolicy -path /hdfsdata</span><br><span class="line"><span class="comment"># æˆ‘ä»¬æŸ¥çœ‹ä¸Šä¼ çš„æ–‡ä»¶å—åˆ†å¸ƒ</span></span><br><span class="line">hdfs fsck /hdfsdata -files -blocks -locations</span><br><span class="line"><span class="comment"># æœªè®¾ç½®å­˜å‚¨ç­–ç•¥ï¼Œæ‰€æœ‰æ–‡ä»¶å—éƒ½å­˜å‚¨åœ¨DISKä¸‹ã€‚æ‰€ä»¥ï¼Œé»˜è®¤å­˜å‚¨ç­–ç•¥ä¸ºHOT</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =======================WARMå­˜å‚¨ç­–ç•¥æµ‹è¯•========================</span></span><br><span class="line"><span class="comment"># æˆ‘ä»¬ä¸ºæ•°æ®é™æ¸©</span></span><br><span class="line">hdfs storagepolicies -setStoragePolicy -path /hdfsdata -policy WARM</span><br><span class="line"><span class="comment"># å†æ¬¡æŸ¥çœ‹æ–‡ä»¶å—åˆ†å¸ƒï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ–‡ä»¶å—ä¾ç„¶æ”¾åœ¨åŸå¤„</span></span><br><span class="line">hdfs fsck /hdfsdata -files -blocks -locations</span><br><span class="line"><span class="comment"># æˆ‘ä»¬éœ€è¦è®©ä»–HDFSæŒ‰ç…§å­˜å‚¨ç­–ç•¥è‡ªè¡Œç§»åŠ¨æ–‡ä»¶å—</span></span><br><span class="line">hdfs mover /hdfsdata</span><br><span class="line"><span class="comment"># å†æ¬¡æŸ¥çœ‹æ–‡ä»¶å—åˆ†å¸ƒï¼Œæ–‡ä»¶å—ä¸€åŠåœ¨DISKï¼Œä¸€åŠåœ¨ARCHIVEï¼Œç¬¦åˆæˆ‘ä»¬è®¾ç½®çš„WARMç­–ç•¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =======================COLDç­–ç•¥æµ‹è¯•============================</span></span><br><span class="line">hdfs storagepolicies -setStoragePolicy -path /hdfsdata -policy COLD</span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šå½“æˆ‘ä»¬å°†ç›®å½•è®¾ç½®ä¸ºCOLDå¹¶ä¸”æˆ‘ä»¬æœªé…ç½®ARCHIVEå­˜å‚¨ç›®å½•çš„æƒ…å†µä¸‹ï¼Œä¸å¯ä»¥å‘è¯¥ç›®å½•ç›´æ¥ä¸Šä¼ æ–‡ä»¶ï¼Œä¼šæŠ¥å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="comment"># æ‰‹åŠ¨è½¬ç§»</span></span><br><span class="line">hdfs mover /hdfsdata</span><br><span class="line">bin/hdfs fsck /hdfsdata -files -blocks -locations</span><br><span class="line"></span><br><span class="line"><span class="comment"># ======================ONE_SSDç­–ç•¥æµ‹è¯•==========================</span></span><br><span class="line"><span class="comment"># æ¥ä¸‹æ¥æˆ‘ä»¬å°†å­˜å‚¨ç­–ç•¥ä»é»˜è®¤çš„HOTæ›´æ”¹ä¸ºOne_SSD</span></span><br><span class="line">hdfs storagepolicies -setStoragePolicy -path /hdfsdata -policy One_SSD</span><br><span class="line"></span><br><span class="line"><span class="comment"># =====================ALL_SSDç­–ç•¥æµ‹è¯•===========================</span></span><br><span class="line">hdfs storagepolicies -setStoragePolicy -path /hdfsdata -policy All_SSD</span><br><span class="line"></span><br><span class="line"><span class="comment"># =====================LAZY_PERSISTç­–ç•¥æµ‹è¯•=======================</span></span><br><span class="line">hdfs storagepolicies -setStoragePolicy -path /hdfsdata -policy lazy_persist</span><br><span class="line"><span class="comment"># è¿™é‡Œæˆ‘ä»¬å‘ç°æ‰€æœ‰çš„æ–‡ä»¶å—éƒ½æ˜¯å­˜å‚¨åœ¨DISKï¼ŒæŒ‰ç…§ç†è®ºä¸€ä¸ªå‰¯æœ¬å­˜å‚¨åœ¨RAM_DISKï¼Œå…¶ä»–å‰¯æœ¬å­˜å‚¨åœ¨DISKä¸­ï¼Œè¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬è¿˜éœ€è¦é…ç½®â€œdfs.datanode.max.locked.memoryâ€ï¼Œâ€œdfs.block.sizeâ€å‚æ•°</span></span><br><span class="line"><span class="comment"># å½“å®¢æˆ·ç«¯æ‰€åœ¨çš„DataNodeèŠ‚ç‚¹æ²¡æœ‰RAM_DISKæ—¶ï¼Œåˆ™ä¼šå†™å…¥å®¢æˆ·ç«¯æ‰€åœ¨çš„DataNodeèŠ‚ç‚¹çš„DISKç£ç›˜ï¼Œå…¶ä½™å‰¯æœ¬ä¼šå†™å…¥å…¶ä»–èŠ‚ç‚¹çš„DISKç£ç›˜</span></span><br><span class="line"><span class="comment"># å½“å®¢æˆ·ç«¯æ‰€åœ¨çš„DataNodeæœ‰RAM_DISKï¼Œä½†â€œdfs.datanode.max.locked.memoryâ€å‚æ•°å€¼æœªè®¾ç½®æˆ–è€…è®¾ç½®è¿‡å°ï¼ˆå°äºâ€œdfs.block.sizeâ€å‚æ•°å€¼ï¼‰æ—¶ï¼Œåˆ™ä¼šå†™å…¥å®¢æˆ·ç«¯æ‰€åœ¨çš„DataNodeèŠ‚ç‚¹çš„DISKç£ç›˜ï¼Œå…¶ä½™å‰¯æœ¬ä¼šå†™å…¥å…¶ä»–èŠ‚ç‚¹çš„DISKç£ç›˜</span></span><br><span class="line"><span class="comment"># æ˜¯ç”±äºè™šæ‹Ÿæœºçš„â€œmax locked memoryâ€ä¸º64KBï¼Œæ‰€ä»¥ï¼Œå¦‚æœå‚æ•°é…ç½®è¿‡å¤§ï¼Œè¿˜ä¼šæŠ¥å‡ºé”™è¯¯</span></span><br><span class="line"><span class="built_in">ulimit</span> -a</span><br></pre></td></tr></table></figure>
<h2 id="6ã€HDFSæ•…éšœæ’é™¤">6ã€HDFSæ•…éšœæ’é™¤</h2>
<h3 id="6-1-NameNodeæ•…éšœå¤„ç†">6.1 NameNodeæ•…éšœå¤„ç†</h3>
<p>NameNodeè¿›ç¨‹æŒ‚äº†å¹¶ä¸”å­˜å‚¨çš„æ•°æ®ä¹Ÿä¸¢å¤±äº†ï¼Œå¦‚ä½•æ¢å¤NameNode</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ•…éšœæ¨¡æ‹Ÿ</span></span><br><span class="line"><span class="built_in">kill</span> -9 NameNodeè¿›ç¨‹</span><br><span class="line"><span class="comment"># åˆ é™¤NameNodeå­˜å‚¨çš„æ•°æ®ï¼ˆ/opt/module/hadoop-3.1.3/data/tmp/dfs/nameï¼‰</span></span><br><span class="line">rm -rf /opt/module/hadoop-3.1.3/data/dfs/name/*</span><br><span class="line"></span><br><span class="line"><span class="comment"># é—®é¢˜è§£å†³</span></span><br><span class="line"><span class="comment"># æ‹·è´SecondaryNameNodeä¸­æ•°æ®åˆ°åŸNameNodeå­˜å‚¨æ•°æ®ç›®å½•</span></span><br><span class="line">scp -r atguigu@hadoop104:/opt/module/hadoop-3.1.3/data/dfs/namesecondary/* ./name/</span><br><span class="line"><span class="comment"># é‡æ–°å¯åŠ¨NameNode</span></span><br><span class="line">hdfs --daemon start namenode</span><br></pre></td></tr></table></figure>
<h3 id="6-2-é›†ç¾¤å®‰å…¨æ¨¡å¼-ç£ç›˜ä¿®å¤">6.2 é›†ç¾¤å®‰å…¨æ¨¡å¼&amp;ç£ç›˜ä¿®å¤</h3>
<ul>
<li>**å®‰å…¨æ¨¡å¼ï¼š**æ–‡ä»¶ç³»ç»Ÿåªæ¥å—è¯»æ•°æ®è¯·æ±‚ï¼Œè€Œä¸æ¥å—åˆ é™¤ã€ä¿®æ”¹ç­‰å˜æ›´è¯·æ±‚</li>
<li>è¿›å…¥å®‰å…¨æ¨¡å¼åœºæ™¯
<ul>
<li>NameNodeåœ¨åŠ è½½é•œåƒæ–‡ä»¶å’Œç¼–è¾‘æ—¥å¿—æœŸé—´å¤„äºå®‰å…¨æ¨¡å¼ï¼›</li>
<li>NameNodeå†æ¥æ”¶DataNodeæ³¨å†Œæ—¶ï¼Œå¤„äºå®‰å…¨æ¨¡å¼</li>
</ul>
</li>
</ul>
<p><strong>é€€å‡ºå®‰å…¨æ¨¡å¼æ¡ä»¶</strong></p>
<ul>
<li>dfs.namenode.safemode.min.datanodes:æœ€å°å¯ç”¨datanodeæ•°é‡ï¼Œé»˜è®¤0</li>
<li>dfs.namenode.safemode.threshold-pct:å‰¯æœ¬æ•°è¾¾åˆ°æœ€å°è¦æ±‚çš„blockå ç³»ç»Ÿæ€»blockæ•°çš„ç™¾åˆ†æ¯”ï¼Œé»˜è®¤0.999fã€‚ï¼ˆåªå…è®¸ä¸¢ä¸€ä¸ªå—ï¼‰</li>
<li>dfs.namenode.safemode.extension:ç¨³å®šæ—¶é—´ï¼Œé»˜è®¤å€¼30000æ¯«ç§’ï¼Œå³30ç§’</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é›†ç¾¤å¤„äºå®‰å…¨æ¨¡å¼ï¼Œä¸èƒ½æ‰§è¡Œé‡è¦æ“ä½œï¼ˆå†™æ“ä½œï¼‰ã€‚é›†ç¾¤å¯åŠ¨å®Œæˆåï¼Œè‡ªåŠ¨é€€å‡ºå®‰å…¨æ¨¡å¼</span></span><br><span class="line">bin/hdfs dfsadmin -safemode get  ï¼ˆåŠŸèƒ½æè¿°ï¼šæŸ¥çœ‹å®‰å…¨æ¨¡å¼çŠ¶æ€ï¼‰</span><br><span class="line">bin/hdfs dfsadmin -safemode enter ï¼ˆåŠŸèƒ½æè¿°ï¼šè¿›å…¥å®‰å…¨æ¨¡å¼çŠ¶æ€ï¼‰</span><br><span class="line">bin/hdfs dfsadmin -safemode leave  ï¼ˆåŠŸèƒ½æè¿°ï¼šç¦»å¼€å®‰å…¨æ¨¡å¼çŠ¶æ€ï¼‰</span><br><span class="line">bin/hdfs dfsadmin -safemode <span class="built_in">wait</span>  ï¼ˆåŠŸèƒ½æè¿°ï¼šç­‰å¾…å®‰å…¨æ¨¡å¼çŠ¶æ€ï¼‰</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ========================æ¡ˆä¾‹1ï¼šå¯åŠ¨é›†ç¾¤è¿›å…¥å®‰å…¨æ¨¡å¼===============</span></span><br><span class="line"><span class="comment"># é›†ç¾¤å¯åŠ¨åï¼Œç«‹å³æ¥åˆ°é›†ç¾¤ä¸Šåˆ é™¤æ•°æ®ï¼Œæç¤ºé›†ç¾¤å¤„äºå®‰å…¨æ¨¡å¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==================æ¡ˆä¾‹2ï¼šç£ç›˜ä¿®å¤===========================</span></span><br><span class="line"><span class="comment"># éœ€æ±‚ï¼šæ•°æ®å—æŸåï¼Œè¿›å…¥å®‰å…¨æ¨¡å¼ï¼Œå¦‚ä½•å¤„ç†</span></span><br><span class="line"><span class="comment"># åˆ†åˆ«è¿›å…¥hadoop102ã€hadoop103ã€hadoop104çš„/opt/module/hadoop-3.1.3/data/dfs/data/current/BP-1015489500-192.168.10.102-1611909480872/current/finalized/subdir0/subdir0ç›®å½•ï¼Œç»Ÿä¸€åˆ é™¤æŸ2ä¸ªå—ä¿¡æ¯</span></span><br><span class="line">rm -rf blk_1073741847 blk_1073741847_1023.meta</span><br><span class="line">rm -rf blk_1073741865 blk_1073741865_1042.meta</span><br><span class="line"><span class="comment"># è¯´æ˜ï¼šhadoop103/hadoop104é‡å¤æ‰§è¡Œä»¥ä¸Šå‘½ä»¤</span></span><br><span class="line"><span class="comment"># é‡æ–°å¯åŠ¨é›†ç¾¤,å› ä¸ºé»˜è®¤æ˜¯6å°æ—¶æ‰æ±‡æŠ¥æ³¨å†Œä¸€æ¬¡ï¼Œåˆ äº†é›†ç¾¤ä¸€ä¸‹å­æ˜¯ä¸ä¼šæœ‰ååº”çš„</span></span><br><span class="line">myhadoop.sh stop</span><br><span class="line">myhadoop.sh start</span><br><span class="line"><span class="comment"># è§‚å¯Ÿhttp://hadoop102:9870/dfshealth.html#tab-overview</span></span><br><span class="line"><span class="comment"># è¯´æ˜ï¼šå®‰å…¨æ¨¡å¼å·²ç»æ‰“å¼€ï¼Œå—çš„æ•°é‡æ²¡æœ‰è¾¾åˆ°è¦æ±‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¦»å¼€å®‰å…¨æ¨¡å¼</span></span><br><span class="line">hdfs dfsadmin -safemode get</span><br><span class="line">hdfs dfsadmin -safemode leave</span><br><span class="line"><span class="comment"># è§‚å¯Ÿhttp://hadoop102:9870/dfshealth.html#tab-overview</span></span><br><span class="line"><span class="comment"># æˆ–è€…å°†å…ƒæ•°æ®åˆ é™¤é‚£ä¹ˆå°±ä¼šè‡ªåŠ¨é€€å‡ºå®‰å…¨æ¨¡å¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ===================æ¡ˆä¾‹3ï¼šæ¨¡æ‹Ÿç­‰å¾…å®‰å…¨æ¨¡å¼================</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰æ¨¡å¼</span></span><br><span class="line">hdfs dfsadmin -safemode get</span><br><span class="line"><span class="comment"># å…ˆè¿›å…¥å®‰å…¨æ¨¡å¼</span></span><br><span class="line">bin/hdfs dfsadmin -safemode enter</span><br><span class="line"><span class="comment"># åˆ›å»ºå¹¶æ‰§è¡Œä¸‹é¢çš„è„šæœ¬ï¼Œåœ¨/opt/module/hadoop-3.1.3è·¯å¾„ä¸Šï¼Œç¼–è¾‘ä¸€ä¸ªè„šæœ¬safemode.sh</span></span><br><span class="line"><span class="comment"># ä¸€ç¦»å¼€å®‰å…¨æ¨¡å¼å°±ç«‹åˆ»ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line">vim safemode.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">hdfs dfsadmin -safemode <span class="built_in">wait</span></span><br><span class="line">hdfs dfs -put /opt/module/hadoop-3.1.3/README.txt /</span><br><span class="line"></span><br><span class="line">chmod 777 safemode.sh</span><br><span class="line">./safemode.sh </span><br><span class="line"><span class="comment"># å†æ‰“å¼€ä¸€ä¸ªçª—å£ï¼Œæ‰§è¡Œ</span></span><br><span class="line">bin/hdfs dfsadmin -safemode leave</span><br></pre></td></tr></table></figure>
<h3 id="6-3-æ…¢ç£ç›˜ç›‘æ§">6.3 æ…¢ç£ç›˜ç›‘æ§</h3>
<p>&quot;æ…¢ç£ç›˜&quot;æŒ‡çš„æ—¶å†™å…¥æ•°æ®éå¸¸æ…¢çš„ä¸€ç±»ç£ç›˜ã€‚å…¶å®æ…¢æ€§ç£ç›˜å¹¶ä¸å°‘è§ï¼Œå½“æœºå™¨è¿è¡Œæ—¶é—´é•¿äº†ï¼Œä¸Šé¢è·‘çš„ä»»åŠ¡å¤šäº†ï¼Œç£ç›˜çš„è¯»å†™æ€§èƒ½è‡ªç„¶ä¼šé€€åŒ–ï¼Œä¸¥é‡æ—¶å°±ä¼šå‡ºç°å†™å…¥æ•°æ®å»¶æ—¶çš„é—®é¢˜ã€‚å¦‚ä½•å‘ç°æ…¢ç£ç›˜ï¼Ÿæ­£å¸¸åœ¨HDFSä¸Šåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œåªéœ€è¦ä¸åˆ°1sçš„æ—¶é—´ã€‚å¦‚æœä½ å‘ç°åˆ›å»ºç›®å½•è¶…è¿‡1åˆ†é’ŸåŠä»¥ä¸Šï¼Œè€Œä¸”è¿™ä¸ªç°è±¡å¹¶ä¸æ˜¯æ¯æ¬¡éƒ½æœ‰ã€‚åªæ˜¯å¶å°”æ…¢äº†ä¸€ä¸‹ï¼Œå°±å¾ˆæœ‰å¯èƒ½å­˜åœ¨æ…¢ç£ç›˜ã€‚å¯ä»¥é‡‡ç”¨å¦‚ä¸‹æ–¹æ³•æ‰¾å‡ºæ˜¯å“ªå—ç£ç›˜æ…¢ï¼š</p>
<ul>
<li>é€šè¿‡å¿ƒè·³æœªè”ç³»æ—¶é—´ï¼Œä¸€èˆ¬å‡ºç°æ…¢ç£ç›˜ç°è±¡ï¼Œä¼šå½±å“åˆ°DataNodeä¸NameNodeä¹‹é—´çš„å¿ƒè·³ã€‚<strong>æ­£å¸¸æƒ…å†µå¿ƒè·³æ—¶é—´é—´éš”æ˜¯3sã€‚è¶…è¿‡3sè¯´æ˜æœ‰å¼‚å¸¸</strong></li>
<li>fioå‘½ä»¤ï¼Œæµ‹è¯•ç£ç›˜çš„è¯»å†™æ€§èƒ½</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y fio</span><br><span class="line"><span class="comment"># ====================é¡ºåºè¯»æµ‹è¯•=====================</span></span><br><span class="line">sudo fio -filename=/home/atguigu/test.log -direct=1 -iodepth 1 -thread -rw=<span class="built_in">read</span> -ioengine=psync -bs=16k -size=2G -numjobs=10 -runtime=60 -group_reporting -name=test_r</span><br><span class="line"></span><br><span class="line"><span class="comment"># ====================é¡ºåºå†™æµ‹è¯•=====================</span></span><br><span class="line">sudo fio -filename=/home/atguigu/test.log -direct=1 -iodepth 1 -thread -rw=write -ioengine=psync -bs=16k -size=2G -numjobs=10 -runtime=60 -group_reporting -name=test_w</span><br><span class="line"></span><br><span class="line"><span class="comment"># ====================éšæœºå†™æµ‹è¯•=======================</span></span><br><span class="line">sudo fio -filename=/home/atguigu/test.log -direct=1 -iodepth 1 -thread -rw=randwrite -ioengine=psync -bs=16k -size=2G -numjobs=10 -runtime=60 -group_reporting -name=test_randw</span><br><span class="line"></span><br><span class="line"><span class="comment"># ===================æ··åˆéšæœºè¯»å†™=======================</span></span><br><span class="line">sudo fio -filename=/home/atguigu/test.log -direct=1 -iodepth 1 -thread -rw=randrw -rwmixread=70 -ioengine=psync -bs=16k -size=2G -numjobs=10 -runtime=60 -group_reporting -name=test_r_w -ioscheduler=noop</span><br></pre></td></tr></table></figure>
<h3 id="6-4-å°æ–‡ä»¶å½’æ¡£">6.4 å°æ–‡ä»¶å½’æ¡£</h3>
<p><strong>HDFSå­˜å‚¨å°æ–‡ä»¶å¼Šç«¯</strong></p>
<p>æ¯ä¸ªæ–‡ä»¶å‡æŒ‰å—å­˜å‚¨ï¼Œæ¯ä¸ªå—çš„å…ƒæ•°æ®å­˜å‚¨åœ¨NameNodeçš„å†…å­˜ä¸­ï¼Œå› æ­¤HDFSå­˜å‚¨å°æ–‡ä»¶ä¼šéå¸¸ä½æ•ˆã€‚å› ä¸ºå¤§é‡çš„å°æ–‡ä»¶ä¼šè€—å°½NameNodeä¸­çš„å¤§éƒ¨åˆ†å†…å­˜ã€‚ä½†æ³¨æ„ï¼Œå­˜å‚¨å°æ–‡ä»¶æ‰€éœ€è¦çš„ç£ç›˜å®¹é‡å’Œæ•°æ®å—çš„å¤§å°æ— å…³ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª1MBçš„æ–‡ä»¶è®¾ç½®ä¸º128MBçš„å—å­˜å‚¨ï¼Œå®é™…ä½¿ç”¨çš„æ˜¯1MBçš„ç£ç›˜ç©ºé—´ï¼Œè€Œä¸æ˜¯128MB</p>
<p><strong>è§£å†³å­˜å‚¨å°æ–‡ä»¶åŠæ³•ä¹‹ä¸€</strong></p>
<p>HDFSå­˜æ¡£æ–‡ä»¶æˆ–HARæ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ªæ›´é«˜æ•ˆçš„æ–‡ä»¶å­˜æ¡£å·¥å…·ï¼Œå®ƒå°†æ–‡ä»¶å­˜å…¥HDFSå—ï¼Œåœ¨å‡å°‘NameNodeå†…å­˜ä½¿ç”¨çš„åŒæ—¶ï¼Œå…è®¸å¯¹æ–‡ä»¶è¿›è¡Œé€æ˜çš„è®¿é—®ã€‚å…·ä½“è¯´æ¥ï¼ŒHDFSå­˜æ¡£æ–‡ä»¶å¯¹å†…è¿˜æ˜¯ä¸€ä¸ªä¸€ä¸ªç‹¬ç«‹æ–‡ä»¶ï¼Œå¯¹NameNodeè€Œè¨€å´æ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œå‡å°‘äº†NameNodeçš„å†…å­˜</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¡ˆä¾‹å®æ“</span></span><br><span class="line"><span class="comment"># éœ€è¦å¯åŠ¨YARNè¿›ç¨‹</span></span><br><span class="line">start-yarn.sh</span><br><span class="line"><span class="comment"># å½’æ¡£æ–‡ä»¶</span></span><br><span class="line"><span class="comment"># æŠŠ/inputç›®å½•é‡Œé¢çš„æ‰€æœ‰æ–‡ä»¶å½’æ¡£æˆä¸€ä¸ªå«input.harçš„å½’æ¡£æ–‡ä»¶ï¼Œå¹¶æŠŠå½’æ¡£åæ–‡ä»¶å­˜å‚¨åˆ°/outputè·¯å¾„ä¸‹</span></span><br><span class="line">hadoop archive -archiveName input.har -p  /input   /output</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½’æ¡£</span></span><br><span class="line">hadoop fs -ls /output/input.har</span><br><span class="line">hadoop fs -ls har:///output/input.har</span><br><span class="line"><span class="comment"># è§£å½’æ¡£æ–‡ä»¶</span></span><br><span class="line">hadoop fs -cp har:///output/input.har/* /</span><br></pre></td></tr></table></figure>
<h2 id="7ã€MapReduceç”Ÿäº§ç»éªŒ-é‡ç‚¹">7ã€MapReduceç”Ÿäº§ç»éªŒ(é‡ç‚¹)</h2>
<h3 id="7-1-MapReduceæ…¢çš„åŸå› ">7.1 MapReduceæ…¢çš„åŸå› </h3>
<p>apReduceç¨‹åºæ•ˆç‡çš„ç“¶é¢ˆåœ¨äºä¸¤ç‚¹ï¼š</p>
<ul>
<li>
<p>è®¡ç®—æœºæ€§èƒ½</p>
<p>CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œ</p>
</li>
<li>
<p><strong>I/O</strong>æ“ä½œä¼˜åŒ–</p>
<ul>
<li>æ•°æ®å€¾æ–œ</li>
<li>Mapè¿è¡Œæ—¶é—´å¤ªé•¿ï¼Œå¯¼è‡´Reduceç­‰å¾…è¿‡ä¹…</li>
<li>å°æ–‡ä»¶è¿‡å¤š</li>
</ul>
</li>
</ul>
<h3 id="7-2-MapReduceå¸¸ç”¨è°ƒä¼˜å‚æ•°">7.2 MapReduceå¸¸ç”¨è°ƒä¼˜å‚æ•°</h3>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330941.png" alt></p>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330942.png" alt></p>
<h3 id="7-3-MapReduceæ•°æ®å€¾æ–œé—®é¢˜">7.3 MapReduceæ•°æ®å€¾æ–œé—®é¢˜</h3>
<ul>
<li>æ•°æ®é¢‘ç‡å€¾æ–œâ€”â€”æŸä¸€ä¸ªåŒºåŸŸçš„æ•°æ®é‡è¦è¿œè¿œå¤§äºå…¶ä»–åŒºåŸŸ</li>
<li>æ•°æ®å¤§å°å€¾æ–œâ€”â€”éƒ¨åˆ†è®°å½•çš„å¤§å°è¿œè¿œå¤§äºå¹³å‡å€¼</li>
</ul>
<p><strong>å‡å°‘æ•°æ®å€¾æ–œçš„æ–¹æ³•</strong></p>
<ul>
<li>é¦–å…ˆæ£€æŸ¥æ˜¯å¦ç©ºå€¼è¿‡å¤šé€ æˆçš„æ•°æ®å€¾æ–œï¼Œç”Ÿäº§ç¯å¢ƒï¼Œå¯ä»¥ç›´æ¥è¿‡æ»¤æ‰ç©ºå€¼ï¼›å¦‚æœæƒ³ä¿ç•™ç©ºå€¼ï¼Œå°±è‡ªå®šä¹‰åˆ†åŒºï¼Œå°†ç©ºå€¼åŠ éšæœºæ•°æ‰“æ•£ã€‚æœ€åå†äºŒæ¬¡èšåˆ</li>
<li>èƒ½åœ¨mapé˜¶æ®µæå‰å¤„ç†ï¼Œæœ€å¥½å…ˆåœ¨Mapé˜¶æ®µå¤„ç†ã€‚å¦‚ï¼šCombinerã€MapJoin</li>
<li>è®¾ç½®å¤šä¸ªreduceä¸ªæ•°</li>
</ul>
<h2 id="8ã€Yarnç”Ÿäº§ç»éªŒ">8ã€Yarnç”Ÿäº§ç»éªŒ</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># =========================Resourcemanagerç›¸å…³================</span></span><br><span class="line"><span class="comment"># ResourceManagerå¤„ç†è°ƒåº¦å™¨è¯·æ±‚çš„çº¿ç¨‹æ•°é‡</span></span><br><span class="line">yarn.resourcemanager.scheduler.client.thread-count</span><br><span class="line"><span class="comment"># é…ç½®è°ƒåº¦å™¨</span></span><br><span class="line">yarn.resourcemanager.scheduler.class</span><br><span class="line"></span><br><span class="line"><span class="comment"># =========================Nodemanagerç›¸å…³===================</span></span><br><span class="line"><span class="comment"># NodeManagerä½¿ç”¨å†…å­˜æ•°</span></span><br><span class="line">yarn.nodemanager.resource.memory-mb</span><br><span class="line"><span class="comment"># NodeManagerä¸ºç³»ç»Ÿä¿ç•™å¤šå°‘å†…å­˜ï¼Œå’Œä¸Šä¸€ä¸ªå‚æ•°äºŒè€…å–ä¸€å³å¯</span></span><br><span class="line">yarn.nodemanager.resource.system-reserved-memory-mb</span><br><span class="line"><span class="comment"># NodeManagerä½¿ç”¨CPUæ ¸æ•°</span></span><br><span class="line">yarn.nodemanager.resource.cpu-vcores</span><br><span class="line"><span class="comment"># æ˜¯å¦å°†è™šæ‹Ÿæ ¸æ•°å½“ä½œCPUæ ¸æ•°</span></span><br><span class="line">yarn.nodemanager.resource.count-logical-processors-as-cores</span><br><span class="line"><span class="comment"># è™šæ‹Ÿæ ¸æ•°å’Œç‰©ç†æ ¸æ•°ä¹˜æ•°ï¼Œä¾‹å¦‚ï¼š4æ ¸8çº¿ç¨‹ï¼Œè¯¥å‚æ•°å°±åº”è®¾ä¸º2</span></span><br><span class="line">yarn.nodemanager.resource.pcores-vcores-multiplier</span><br><span class="line"><span class="comment"># æ˜¯å¦è®©yarnè‡ªå·±æ£€æµ‹ç¡¬ä»¶è¿›è¡Œé…ç½®</span></span><br><span class="line">yarn.nodemanager.resource.detect-hardware-capabilities</span><br><span class="line"><span class="comment"># æ˜¯å¦å¼€å¯ç‰©ç†å†…å­˜æ£€æŸ¥é™åˆ¶container</span></span><br><span class="line">yarn.nodemanager.pmem-check-enabled</span><br><span class="line"><span class="comment"># æ˜¯å¦å¼€å¯è™šæ‹Ÿå†…å­˜æ£€æŸ¥é™åˆ¶container</span></span><br><span class="line">yarn.nodemanager.vmem-check-enabled</span><br><span class="line"><span class="comment"># è™šæ‹Ÿå†…å­˜ç‰©ç†å†…å­˜æ¯”ä¾‹</span></span><br><span class="line">yarn.nodemanager.vmem-pmem-ratio      </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =======================Containerå®¹å™¨ç›¸å…³========================</span></span><br><span class="line"><span class="comment"># å®¹å™¨æœ€å°å†…å­˜</span></span><br><span class="line">yarn.scheduler.minimum-allocation-mb</span><br><span class="line"><span class="comment"># å®¹å™¨æœ€å¤§å†…å­˜</span></span><br><span class="line">yarn.scheduler.maximum-allocation-mb</span><br><span class="line"><span class="comment"># å®¹å™¨æœ€å°æ ¸æ•°</span></span><br><span class="line">yarn.scheduler.minimum-allocation-vcores</span><br><span class="line"><span class="comment"># å®¹å™¨æœ€å¤§æ ¸æ•°</span></span><br><span class="line">yarn.scheduler.maximum-allocation-vcores</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒåº¦å™¨è¯¦è§yarnçŸ¥è¯†ç‚¹</span></span><br></pre></td></tr></table></figure>
<h2 id="9ã€Hadoopç»¼åˆè°ƒä¼˜">9ã€Hadoopç»¼åˆè°ƒä¼˜</h2>
<h3 id="9-1-Hadoopå°æ–‡ä»¶ä¼˜åŒ–æ–¹æ³•">9.1 Hadoopå°æ–‡ä»¶ä¼˜åŒ–æ–¹æ³•</h3>
<p>HDFSä¸Šæ¯ä¸ªæ–‡ä»¶éƒ½è¦åœ¨NameNodeä¸Šåˆ›å»ºå¯¹åº”çš„å…ƒæ•°æ®ï¼Œè¿™ä¸ªå…ƒæ•°æ®çš„å¤§å°çº¦ä¸º150byteï¼Œè¿™æ ·å½“å°æ–‡ä»¶æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œå°±ä¼šäº§ç”Ÿå¾ˆå¤šçš„å…ƒæ•°æ®æ–‡ä»¶ï¼Œ**ä¸€æ–¹é¢ä¼šå¤§é‡å ç”¨NameNodeçš„å†…å­˜ç©ºé—´ï¼Œå¦ä¸€æ–¹é¢å°±æ˜¯å…ƒæ•°æ®æ–‡ä»¶è¿‡å¤šï¼Œä½¿å¾—å¯»å€ç´¢å¼•é€Ÿåº¦å˜æ…¢ã€‚**å°æ–‡ä»¶è¿‡å¤šï¼Œåœ¨è¿›è¡ŒMRè®¡ç®—æ—¶ï¼Œä¼šç”Ÿæˆè¿‡å¤šåˆ‡ç‰‡ï¼Œéœ€è¦å¯åŠ¨è¿‡å¤šçš„MapTaskã€‚æ¯ä¸ªMapTaskå¤„ç†çš„æ•°æ®é‡å°ï¼Œ<strong>å¯¼è‡´MapTaskçš„å¤„ç†æ—¶é—´æ¯”å¯åŠ¨æ—¶é—´è¿˜å°ï¼Œç™½ç™½æ¶ˆè€—èµ„æº</strong>ã€‚</p>
<p>Hadoopå°æ–‡ä»¶è§£å†³æ–¹æ¡ˆæœ‰å‡ ç§æ–¹æ¡ˆï¼š</p>
<ul>
<li><strong>åœ¨æ•°æ®é‡‡é›†çš„æ—¶å€™ï¼Œå°±å°†å°æ–‡ä»¶æˆ–å°æ‰¹æ•°æ®åˆæˆå¤§æ–‡ä»¶å†ä¸Šä¼ HDFSï¼ˆæ•°æ®æºå¤´ï¼‰</strong></li>
<li><strong>Hadoop Archiveï¼ˆå­˜å‚¨æ–¹å‘ï¼‰</strong>ï¼šæ˜¯ä¸€ä¸ªé«˜æ•ˆçš„å°†å°æ–‡ä»¶æ”¾å…¥HDFSå—ä¸­çš„æ–‡ä»¶å­˜æ¡£å·¥å…·ï¼Œèƒ½å¤Ÿå°†å¤šä¸ªå°æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ªHARæ–‡ä»¶ï¼Œä»è€Œè¾¾åˆ°å‡å°‘NameNodeçš„å†…å­˜ä½¿ç”¨</li>
<li>CombineTextInputFormatï¼ˆè®¡ç®—æ–¹å‘ï¼‰ï¼šCombineTextInputFormatç”¨äºå°†å¤šä¸ªå°æ–‡ä»¶åœ¨åˆ‡ç‰‡è¿‡ç¨‹ä¸­ç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„åˆ‡ç‰‡æˆ–è€…å°‘é‡çš„åˆ‡ç‰‡</li>
<li>å¼€å¯uberæ¨¡å¼ï¼Œå®ç°JVMé‡ç”¨ï¼ˆè®¡ç®—æ–¹å‘ï¼‰ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªTaskä»»åŠ¡éƒ½éœ€è¦å¯åŠ¨ä¸€ä¸ªJVMæ¥è¿è¡Œï¼Œå¦‚æœTaskä»»åŠ¡è®¡ç®—çš„æ•°æ®é‡å¾ˆå°ï¼Œæˆ‘ä»¬å¯ä»¥è®©åŒä¸€ä¸ªJobçš„å¤šä¸ªTaskè¿è¡Œåœ¨ä¸€ä¸ªJVMä¸­ï¼Œä¸å¿…ä¸ºæ¯ä¸ªTaskéƒ½å¼€å¯ä¸€ä¸ªJVM</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœªå¼€å¯uberæ¨¡å¼ï¼Œåœ¨/inputè·¯å¾„ä¸Šä¸Šä¼ å¤šä¸ªå°æ–‡ä»¶å¹¶æ‰§è¡Œwordcountç¨‹åº</span></span><br><span class="line">hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount /input /output2</span><br><span class="line"><span class="comment"># è§‚å¯Ÿæ§åˆ¶å°,è§‚å¯Ÿhttp://hadoop103:8088/cluster</span></span><br><span class="line"><span class="comment"># å¼€å¯uberæ¨¡å¼ï¼Œåœ¨mapred-site.xmlä¸­æ·»åŠ å¦‚ä¸‹é…ç½®</span></span><br><span class="line">&lt;!--  å¼€å¯uberæ¨¡å¼ï¼Œé»˜è®¤å…³é—­ --&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;mapreduce.job.ubertask.enable&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;<span class="literal">true</span>&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--mapreduceæ¡†æ¶ä¼šè®¤ä¸ºæ˜¯å°ä»»åŠ¡çš„æ¡ä»¶--&gt;</span><br><span class="line">&lt;!-- uberæ¨¡å¼ä¸­æœ€å¤§çš„mapTaskæ•°é‡ï¼Œå¯å‘ä¸‹ä¿®æ”¹  --&gt; </span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;mapreduce.job.ubertask.maxmaps&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;9&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;!-- uberæ¨¡å¼ä¸­æœ€å¤§çš„reduceæ•°é‡ï¼Œå¯å‘ä¸‹ä¿®æ”¹ --&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;mapreduce.job.ubertask.maxreduces&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;1&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;!-- uberæ¨¡å¼ä¸­æœ€å¤§çš„è¾“å…¥æ•°æ®é‡ï¼Œé»˜è®¤ä½¿ç”¨dfs.blocksize çš„å€¼ï¼Œå¯å‘ä¸‹ä¿®æ”¹ --&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;mapreduce.job.ubertask.maxbytes&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†å‘é…ç½®</span></span><br><span class="line">xsync mapred-site.xml</span><br><span class="line"><span class="comment"># å†æ¬¡æ‰§è¡Œwordcountç¨‹åº,å·²ç»è§‚å¯Ÿ</span></span><br></pre></td></tr></table></figure>
<h3 id="9-2-æµ‹è¯•MapReduceè®¡ç®—æ€§èƒ½">9.2 æµ‹è¯•MapReduceè®¡ç®—æ€§èƒ½</h3>
<p>ä½¿ç”¨Sortç¨‹åºè¯„æµ‹MapReduce(æ³¨ï¼šä¸€ä¸ªè™šæ‹Ÿæœºä¸è¶…è¿‡150Gç£ç›˜å°½é‡ä¸è¦æ‰§è¡Œè¿™æ®µä»£ç )</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨RandomWriteræ¥äº§ç”Ÿéšæœºæ•°ï¼Œæ¯ä¸ªèŠ‚ç‚¹è¿è¡Œ10ä¸ªMapä»»åŠ¡ï¼Œæ¯ä¸ªMapäº§ç”Ÿå¤§çº¦1Gå¤§å°çš„äºŒè¿›åˆ¶éšæœºæ•°</span></span><br><span class="line">hadoop jar /opt/module/hadoop-3.1.3/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar randomwriter random-data</span><br><span class="line"><span class="comment"># æ‰§è¡ŒSortç¨‹åº</span></span><br><span class="line">hadoop jar /opt/module/hadoop-3.1.3/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar sort random-data sorted-data</span><br><span class="line"><span class="comment"># éªŒè¯æ•°æ®æ˜¯å¦çœŸæ­£æ’å¥½åºäº†</span></span><br><span class="line">hadoop jar /opt/module/hadoop-3.1.3/share/hadoop/mapreduce/hadoop-mapreduce-client-jobclient-3.1.3-tests.jar testmapredsort -sortInput random-data -sortOutput sorted-data</span><br></pre></td></tr></table></figure>
<h3 id="9-3-ä¼ä¸šå¼€å‘åœºæ™¯æ¡ˆä¾‹">9.3 ä¼ä¸šå¼€å‘åœºæ™¯æ¡ˆä¾‹</h3>
<p>éœ€æ±‚ï¼šä»1Gæ•°æ®ä¸­ï¼Œç»Ÿè®¡æ¯ä¸ªå•è¯å‡ºç°æ¬¡æ•°ã€‚æœåŠ¡å™¨3å°ï¼Œæ¯å°é…ç½®4Gå†…å­˜ï¼Œ4æ ¸CPUï¼Œ4çº¿ç¨‹ã€‚éœ€æ±‚åˆ†æï¼š1G / 128m = 8ä¸ªMapTaskï¼›1ä¸ªReduceTaskï¼›1ä¸ªmrAppMasterå¹³å‡æ¯ä¸ªèŠ‚ç‚¹è¿è¡Œ10ä¸ª / 3å° â‰ˆ 3ä¸ªä»»åŠ¡ï¼ˆ4 3 3ï¼‰</p>
<p><strong>HDFSå‚æ•°è°ƒä¼˜</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹ï¼šhadoop-env.sh</span></span><br><span class="line"><span class="built_in">export</span> HDFS_NAMENODE_OPTS=<span class="string">"-Dhadoop.security.logger=INFO,RFAS -Xmx1024m"</span></span><br><span class="line"><span class="built_in">export</span> HDFS_DATANODE_OPTS=<span class="string">"-Dhadoop.security.logger=ERROR,RFAS -Xmx1024m"</span></span><br></pre></td></tr></table></figure>
<p>åˆ†åˆ«ä¿®æ”¹hdfs-site.xmlå’Œä¿®æ”¹core-site.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- NameNodeæœ‰ä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ± ï¼Œé»˜è®¤å€¼æ˜¯10 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.handler.count<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>21<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- é…ç½®åƒåœ¾å›æ”¶æ—¶é—´ä¸º60åˆ†é’Ÿ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.trash.interval<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>60<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åˆ†å‘é…ç½®ï¼š<code>xsync hadoop-env.sh hdfs-site.xml core-site.xml</code></p>
<p><strong>MapReduceå‚æ•°è°ƒä¼˜</strong></p>
<p>ä¿®æ”¹mapred-site.xmlï¼Œä¿®æ”¹å®Œååˆ†å‘</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç¯å½¢ç¼“å†²åŒºå¤§å°ï¼Œé»˜è®¤100m --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.task.io.sort.mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>100<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ç¯å½¢ç¼“å†²åŒºæº¢å†™é˜ˆå€¼ï¼Œé»˜è®¤0.8 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.map.sort.spill.percent<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>0.80<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- mergeåˆå¹¶æ¬¡æ•°ï¼Œé»˜è®¤10ä¸ª --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.task.io.sort.factor<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>10<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- maptaskå†…å­˜ï¼Œé»˜è®¤1gï¼› maptaskå †å†…å­˜å¤§å°é»˜è®¤å’Œè¯¥å€¼å¤§å°ä¸€è‡´mapreduce.map.java.opts --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.map.memory.mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>-1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>The amount of memory to request from the scheduler for each    map task. If this is not specified or is non-positive, it is inferred from mapreduce.map.java.opts and mapreduce.job.heap.memory-mb.ratio. If java-opts are also not specified, we set it to 1024.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- mataskçš„CPUæ ¸æ•°ï¼Œé»˜è®¤1ä¸ª --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.map.cpu.vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- mataskå¼‚å¸¸é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤4æ¬¡ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.map.maxattempts<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- æ¯ä¸ªReduceå»Mapä¸­æ‹‰å–æ•°æ®çš„å¹¶è¡Œæ•°ã€‚é»˜è®¤å€¼æ˜¯5 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.shuffle.parallelcopies<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>5<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Bufferå¤§å°å Reduceå¯ç”¨å†…å­˜çš„æ¯”ä¾‹ï¼Œé»˜è®¤å€¼0.7 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.shuffle.input.buffer.percent<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>0.70<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Bufferä¸­çš„æ•°æ®è¾¾åˆ°å¤šå°‘æ¯”ä¾‹å¼€å§‹å†™å…¥ç£ç›˜ï¼Œé»˜è®¤å€¼0.66ã€‚ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.shuffle.merge.percent<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>0.66<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- reducetaskå†…å­˜ï¼Œé»˜è®¤1gï¼›reducetaskå †å†…å­˜å¤§å°é»˜è®¤å’Œè¯¥å€¼å¤§å°ä¸€è‡´mapreduce.reduce.java.opts --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.memory.mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>-1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>The amount of memory to request from the scheduler for each    reduce task. If this is not specified or is non-positive, it is inferred</span><br><span class="line">    from mapreduce.reduce.java.opts and mapreduce.job.heap.memory-mb.ratio.</span><br><span class="line">    If java-opts are also not specified, we set it to 1024.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- reducetaskçš„CPUæ ¸æ•°ï¼Œé»˜è®¤1ä¸ª --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.cpu.vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- reducetaskå¤±è´¥é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤4æ¬¡ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.maxattempts<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å½“MapTaskå®Œæˆçš„æ¯”ä¾‹è¾¾åˆ°è¯¥å€¼åæ‰ä¼šä¸ºReduceTaskç”³è¯·èµ„æºã€‚é»˜è®¤æ˜¯0.05 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.job.reduce.slowstart.completedmaps<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>0.05<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å¦‚æœç¨‹åºåœ¨è§„å®šçš„é»˜è®¤10åˆ†é’Ÿå†…æ²¡æœ‰è¯»åˆ°æ•°æ®ï¼Œå°†å¼ºåˆ¶è¶…æ—¶é€€å‡º --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.task.timeout<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>600000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>Yarnå‚æ•°è°ƒä¼˜</strong></p>
<p>ä¿®æ”¹yarn-site.xmlé…ç½®å‚æ•°å¦‚ä¸‹ï¼Œæœ€ååˆ†å‘</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- é€‰æ‹©è°ƒåº¦å™¨ï¼Œé»˜è®¤å®¹é‡ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>The class to use as the resource scheduler.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.class<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ResourceManagerå¤„ç†è°ƒåº¦å™¨è¯·æ±‚çš„çº¿ç¨‹æ•°é‡,é»˜è®¤50ï¼›å¦‚æœæäº¤çš„ä»»åŠ¡æ•°å¤§äº50ï¼Œå¯ä»¥å¢åŠ è¯¥å€¼ï¼Œä½†æ˜¯ä¸èƒ½è¶…è¿‡3å° * 4çº¿ç¨‹ = 12çº¿ç¨‹ï¼ˆå»é™¤å…¶ä»–åº”ç”¨ç¨‹åºå®é™…ä¸èƒ½è¶…è¿‡8ï¼‰ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Number of threads to handle scheduler interface.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.client.thread-count<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>8<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- æ˜¯å¦è®©yarnè‡ªåŠ¨æ£€æµ‹ç¡¬ä»¶è¿›è¡Œé…ç½®ï¼Œé»˜è®¤æ˜¯falseï¼Œå¦‚æœè¯¥èŠ‚ç‚¹æœ‰å¾ˆå¤šå…¶ä»–åº”ç”¨ç¨‹åºï¼Œå»ºè®®æ‰‹åŠ¨é…ç½®ã€‚å¦‚æœè¯¥èŠ‚ç‚¹æ²¡æœ‰å…¶ä»–åº”ç”¨ç¨‹åºï¼Œå¯ä»¥é‡‡ç”¨è‡ªåŠ¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Enable auto-detection of node capabilities such as</span><br><span class="line">  memory and CPU.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.detect-hardware-capabilities<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- æ˜¯å¦å°†è™šæ‹Ÿæ ¸æ•°å½“ä½œCPUæ ¸æ•°ï¼Œé»˜è®¤æ˜¯falseï¼Œé‡‡ç”¨ç‰©ç†CPUæ ¸æ•° --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Flag to determine if logical processors(such as</span><br><span class="line">  hyperthreads) should be counted as cores. Only applicable on Linux</span><br><span class="line">  when yarn.nodemanager.resource.cpu-vcores is set to -1 and</span><br><span class="line">  yarn.nodemanager.resource.detect-hardware-capabilities is true.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.count-logical-processors-as-cores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- è™šæ‹Ÿæ ¸æ•°å’Œç‰©ç†æ ¸æ•°ä¹˜æ•°ï¼Œé»˜è®¤æ˜¯1.0 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Multiplier to determine how to convert phyiscal cores to</span><br><span class="line">  vcores. This value is used if yarn.nodemanager.resource.cpu-vcores</span><br><span class="line">  is set to -1(which implies auto-calculate vcores) and</span><br><span class="line">  yarn.nodemanager.resource.detect-hardware-capabilities is set to true. The  number of vcores will be calculated as  number of CPUs * multiplier.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.pcores-vcores-multiplier<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- NodeManagerä½¿ç”¨å†…å­˜æ•°ï¼Œé»˜è®¤8Gï¼Œä¿®æ”¹ä¸º4Gå†…å­˜ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Amount of physical memory, in MB, that can be allocated </span><br><span class="line">  for containers. If set to -1 and</span><br><span class="line">  yarn.nodemanager.resource.detect-hardware-capabilities is true, it is</span><br><span class="line">  automatically calculated(in case of Windows and Linux).</span><br><span class="line">  In other cases, the default is 8192MB.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.memory-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>4096<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- nodemanagerçš„CPUæ ¸æ•°ï¼Œä¸æŒ‰ç…§ç¡¬ä»¶ç¯å¢ƒè‡ªåŠ¨è®¾å®šæ—¶é»˜è®¤æ˜¯8ä¸ªï¼Œä¿®æ”¹ä¸º4ä¸ª --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Number of vcores that can be allocated</span><br><span class="line">  for containers. This is used by the RM scheduler when allocating</span><br><span class="line">  resources for containers. This is not used to limit the number of</span><br><span class="line">  CPUs used by YARN containers. If it is set to -1 and</span><br><span class="line">  yarn.nodemanager.resource.detect-hardware-capabilities is true, it is</span><br><span class="line">  automatically determined from the hardware in case of Windows and Linux.</span><br><span class="line">  In other cases, number of vcores is 8 by default.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.cpu-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å®¹å™¨æœ€å°å†…å­˜ï¼Œé»˜è®¤1G --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>The minimum allocation for every container request at the RM  in MBs. Memory requests lower than this will be set to the value of this  property. Additionally, a node manager that is configured to have less memory  than this value will be shut down by the resource manager.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.minimum-allocation-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>1024<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å®¹å™¨æœ€å¤§å†…å­˜ï¼Œé»˜è®¤8Gï¼Œä¿®æ”¹ä¸º2G --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>The maximum allocation for every container request at the RM  in MBs. Memory requests higher than this will throw an  InvalidResourceRequestException.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.maximum-allocation-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>2048<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å®¹å™¨æœ€å°CPUæ ¸æ•°ï¼Œé»˜è®¤1ä¸ª --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>The minimum allocation for every container request at the RM  in terms of virtual CPU cores. Requests lower than this will be set to the  value of this property. Additionally, a node manager that is configured to  have fewer virtual cores than this value will be shut down by the resource  manager.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.minimum-allocation-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å®¹å™¨æœ€å¤§CPUæ ¸æ•°ï¼Œé»˜è®¤4ä¸ªï¼Œä¿®æ”¹ä¸º2ä¸ª --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>The maximum allocation for every container request at the RM  in terms of virtual CPU cores. Requests higher than this will throw an</span><br><span class="line">  InvalidResourceRequestException.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.maximum-allocation-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- è™šæ‹Ÿå†…å­˜æ£€æŸ¥ï¼Œé»˜è®¤æ‰“å¼€ï¼Œä¿®æ”¹ä¸ºå…³é—­ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Whether virtual memory limits will be enforced for</span><br><span class="line">  containers.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.vmem-check-enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- è™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜è®¾ç½®æ¯”ä¾‹,é»˜è®¤2.1 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Ratio between virtual memory to physical memory when  setting memory limits for containers. Container allocations are  expressed in terms of physical memory, and virtual memory usage  is allowed to exceed this allocation by this ratio.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.vmem-pmem-ratio<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>2.1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æœ€åæ‰§è¡Œç¨‹åº</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡å¯é›†ç¾¤</span></span><br><span class="line">sbin/stop-yarn.sh</span><br><span class="line">sbin/start-yarn.sh</span><br><span class="line"><span class="comment"># æ‰§è¡ŒWordCountç¨‹åº</span></span><br><span class="line">hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount /input /output</span><br><span class="line"><span class="comment"># è§‚å¯ŸYarnä»»åŠ¡æ‰§è¡Œé¡µé¢:http://hadoop103:8088/cluster/apps</span></span><br></pre></td></tr></table></figure>
<h1>å…­ã€Hadoopé«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²</h1>
<h2 id="1ã€-HA-æ¦‚è¿°">1ã€ HA æ¦‚è¿°</h2>
<p>HAï¼ˆHigh Availablityï¼‰ï¼Œå³é«˜å¯ç”¨(7*24 å°æ—¶ä¸ä¸­æ–­æœåŠ¡)ï¼Œå®ç°é«˜å¯ç”¨æœ€å…³é”®çš„ç­–ç•¥æ˜¯æ¶ˆé™¤å•ç‚¹æ•…éšœã€‚HA ä¸¥æ ¼æ¥è¯´åº”è¯¥åˆ†æˆå„ä¸ªç»„ä»¶çš„ HA</p>
<p>æœºåˆ¶ï¼šHDFS çš„ HA å’Œ YARN çš„ HAã€‚NameNode ä¸»è¦åœ¨ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢å½±å“ HDFS é›†ç¾¤</p>
<ul>
<li>NameNode æœºå™¨å‘ç”Ÿæ„å¤–ï¼Œå¦‚å®•æœºï¼Œé›†ç¾¤å°†æ— æ³•ä½¿ç”¨ï¼Œç›´åˆ°ç®¡ç†å‘˜é‡å¯</li>
<li>NameNode æœºå™¨éœ€è¦å‡çº§ï¼ŒåŒ…æ‹¬è½¯ä»¶ã€ç¡¬ä»¶å‡çº§ï¼Œæ­¤æ—¶é›†ç¾¤ä¹Ÿå°†æ— æ³•ä½¿ç”¨</li>
</ul>
<p>HDFS HA åŠŸèƒ½é€šè¿‡é…ç½®å¤šä¸ª NameNodes(Active/Standby)å®ç°åœ¨é›†ç¾¤ä¸­å¯¹ NameNode çš„çƒ­å¤‡æ¥è§£å†³ä¸Šè¿°é—®é¢˜ã€‚å¦‚æœå‡ºç°æ•…éšœï¼Œå¦‚æœºå™¨å´©æºƒæˆ–æœºå™¨éœ€è¦å‡çº§ç»´æŠ¤ï¼Œè¿™æ—¶å¯é€šè¿‡æ­¤ç§æ–¹å¼å°† NameNode å¾ˆå¿«çš„åˆ‡æ¢åˆ°å¦å¤–ä¸€å°æœºå™¨ã€‚</p>
<h2 id="2ã€HDFS-HA-é›†ç¾¤æ­å»º">2ã€HDFS-HA é›†ç¾¤æ­å»º</h2>
<h3 id="2-1-é›†ç¾¤è§„åˆ’">2.1 é›†ç¾¤è§„åˆ’</h3>
<table>
<thead>
<tr>
<th><strong>hadoop102</strong></th>
<th><strong>hadoop103</strong></th>
<th><strong>hadoop104</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>NameNode</td>
<td></td>
<td>Secondarynamenode</td>
</tr>
<tr>
<td>DataNode</td>
<td>DataNode</td>
<td>DataNode</td>
</tr>
</tbody>
</table>
<p>HA çš„ä¸»è¦ç›®çš„æ˜¯æ¶ˆé™¤ namenode çš„å•ç‚¹æ•…éšœ,éœ€è¦å°† hdfs é›†ç¾¤è§„åˆ’æˆä»¥ä¸‹æ¨¡æ ·</p>
<table>
<thead>
<tr>
<th><strong>hadoop102</strong></th>
<th><strong>hadoop103</strong></th>
<th><strong>hadoop104</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>NameNode</td>
<td>NameNode</td>
<td>NameNode</td>
</tr>
<tr>
<td>DataNode</td>
<td>DataNode</td>
<td>DataNode</td>
</tr>
</tbody>
</table>
<h3 id="2-2-HDFS-HA-æ ¸å¿ƒé—®é¢˜">2.2 HDFS-HA æ ¸å¿ƒé—®é¢˜</h3>
<p><strong>æ€ä¹ˆä¿è¯ä¸‰å° namenode çš„æ•°æ®ä¸€è‡´?</strong></p>
<ul>
<li>Fsimage:è®©ä¸€å° nn ç”Ÿæˆæ•°æ®,è®©å…¶ä»–æœºå™¨ nn åŒæ­¥</li>
<li>Edits:éœ€è¦å¼•è¿›æ–°çš„æ¨¡å— JournalNode æ¥ä¿è¯ edtis çš„æ–‡ä»¶çš„æ•°æ®ä¸€è‡´æ€§</li>
</ul>
<p><strong>æ€ä¹ˆè®©åŒæ—¶åªæœ‰ä¸€å° nn æ˜¯ activeï¼Œå…¶ä»–æ‰€æœ‰æ˜¯ standby çš„?</strong></p>
<ul>
<li>æ‰‹åŠ¨åˆ†é…</li>
<li>è‡ªåŠ¨åˆ†é…</li>
</ul>
<p><strong>2nn åœ¨ ha æ¶æ„ä¸­å¹¶ä¸å­˜åœ¨ï¼Œå®šæœŸåˆå¹¶ fsimage å’Œ edtis çš„æ´»è°æ¥å¹²?</strong></p>
<ul>
<li>ç”± standby çš„ nn æ¥å¹²</li>
</ul>
<p><strong>å¦‚æœ nn çœŸçš„å‘ç”Ÿäº†é—®é¢˜ï¼Œæ€ä¹ˆè®©å…¶ä»–çš„ nn ä¸Šä½å¹²æ´»?</strong></p>
<ul>
<li>æ‰‹åŠ¨æ•…éšœè½¬ç§»</li>
<li>è‡ªåŠ¨æ•…éšœè½¬ç§»</li>
</ul>
<h2 id="3ã€HDFS-HA-æ‰‹åŠ¨æ¨¡å¼">3ã€HDFS-HA æ‰‹åŠ¨æ¨¡å¼</h2>
<h3 id="3-1-ç¯å¢ƒå‡†å¤‡-v2">3.1 ç¯å¢ƒå‡†å¤‡</h3>
<p>é¦–å…ˆæŒ‰ç…§ä¹‹å‰çš„é…ç½®æ­å»ºå¥½ç¯å¢ƒï¼Œåœ¨æ¯ä¸ªé›†ç¾¤éœ€è¦å¯åŠ¨JournalNode</p>
<h3 id="3-2-é…ç½®-HDFS-HA-é›†ç¾¤">3.2 é…ç½® HDFS-HA é›†ç¾¤</h3>
<blockquote>
<p>å®˜ç½‘åœ°å€ï¼š<a href="https://hadoop.apache.org/" target="_blank" rel="noopener" title="https://hadoop.apache.org/">https://hadoop.apache.org/</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ opt ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª ha æ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">sudo mkdir ha</span><br><span class="line">sudo chown atguigu:atguigu /opt/ha</span><br><span class="line"><span class="comment"># å°†/opt/module/ä¸‹çš„ hadoop-3.1.3 æ‹·è´åˆ°/opt/ha ç›®å½•ä¸‹ï¼ˆè®°å¾—åˆ é™¤ data å’Œ log ç›®å½•ï¼‰</span></span><br><span class="line">cp -r /opt/module/hadoop-3.1.3 /opt/ha/</span><br></pre></td></tr></table></figure>
<p>ç„¶åä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œwindowså¯ä»¥ä½¿ç”¨sublimeç›´æ¥ä¿®æ”¹ä¿å­˜(Fileâ†’SFTP/FTPâ†’Browse Serverï¼Œè‡ªè¡Œå®‰è£…æ’ä»¶)</p>
<p>é…ç½® core-site.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æŠŠå¤šä¸ª NameNode çš„åœ°å€ç»„è£…æˆä¸€ä¸ªé›†ç¾¤ mycluster --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://mycluster<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- æŒ‡å®š hadoop è¿è¡Œæ—¶äº§ç”Ÿæ–‡ä»¶çš„å­˜å‚¨ç›®å½• --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/ha/hadoop-3.1.3/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>é…ç½® hdfs-site.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  Licensed under the Apache License, Version 2.0 (the "License");</span></span><br><span class="line"><span class="comment">  you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment">  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment">  distributed under the License is distributed on an "AS IS" BASIS,</span></span><br><span class="line"><span class="comment">  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment">  See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment">  limitations under the License. See accompanying LICENSE file.</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Put site-specific property overrides in this file. --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- NameNode æ•°æ®å­˜å‚¨ç›®å½• --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>file://$&#123;hadoop.tmp.dir&#125;/name<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- DataNode æ•°æ®å­˜å‚¨ç›®å½• --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>file://$&#123;hadoop.tmp.dir&#125;/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- JournalNode æ•°æ®å­˜å‚¨ç›®å½• --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.journalnode.edits.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;hadoop.tmp.dir&#125;/jn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- å®Œå…¨åˆ†å¸ƒå¼é›†ç¾¤åç§° --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.nameservices<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>mycluster<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- é›†ç¾¤ä¸­ NameNode èŠ‚ç‚¹éƒ½æœ‰å“ªäº›ï¼Œ3ä¹‹å‰åªèƒ½æœ‰ä¸¤ä¸ªnn --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.namenodes.mycluster<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>nn1,nn2,nn3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- NameNode çš„ RPC é€šä¿¡åœ°å€ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.rpc-address.mycluster.nn1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.rpc-address.mycluster.nn2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.rpc-address.mycluster.nn3<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop104:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- NameNode çš„ http é€šä¿¡åœ°å€ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address.mycluster.nn1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102:9870<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address.mycluster.nn2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103:9870<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address.mycluster.nn3<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop104:9870<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æŒ‡å®š NameNode å…ƒæ•°æ®åœ¨ JournalNode ä¸Šçš„å­˜æ”¾ä½ç½® --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.shared.edits.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>qjournal://hadoop102:8485;hadoop103:8485;hadoop104:8485/mycluster<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- è®¿é—®ä»£ç†ç±»ï¼šclient ç”¨äºç¡®å®šå“ªä¸ª NameNode ä¸º Active --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.client.failover.proxy.provider.mycluster<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- é…ç½®éš”ç¦»æœºåˆ¶ï¼Œå³åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€å°æœåŠ¡å™¨å¯¹å¤–å“åº” --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.fencing.methods<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>sshfence<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ä½¿ç”¨éš”ç¦»æœºåˆ¶æ—¶éœ€è¦ ssh ç§˜é’¥ç™»å½•--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.fencing.ssh.private-key-files<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/atguigu/.ssh/id_rsa<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æœ€ååˆ†å‘é…ç½®å¥½çš„ hadoop ç¯å¢ƒåˆ°å…¶ä»–èŠ‚ç‚¹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…¶ä»–èŠ‚ç‚¹å…ˆåˆ›å»ºå¥½ç›®å½•ä¿®æ”¹æƒé™</span></span><br><span class="line"><span class="comment"># æ¥åˆ°/optç›®å½•</span></span><br><span class="line">xsync ha/hadoop-3.1.3/</span><br></pre></td></tr></table></figure>
<h3 id="3-3-å¯åŠ¨-HDFS-HA-é›†ç¾¤">3.3 å¯åŠ¨ HDFS-HA é›†ç¾¤</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°† HADOOP_HOME ç¯å¢ƒå˜é‡æ›´æ”¹åˆ° HA ç›®å½•(ä¸‰å°æœºå™¨)</span></span><br><span class="line">sudo vim /etc/profile.d/my_env.sh</span><br><span class="line"><span class="comment"># å°† HADOOP_HOME éƒ¨åˆ†æ”¹ä¸ºå¦‚ä¸‹</span></span><br><span class="line"><span class="comment">#HADOOP_HOME</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/opt/ha/hadoop-3.1.3</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/bin</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/sbin</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ·æ–°</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨å„ä¸ª JournalNode èŠ‚ç‚¹ä¸Šï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ journalnode æœåŠ¡</span></span><br><span class="line">hdfs --daemon start journalnode</span><br><span class="line">hdfs --daemon start journalnode</span><br><span class="line">hdfs --daemon start journalnode</span><br><span class="line"><span class="comment"># æŸ¥çœ‹</span></span><br><span class="line">jpsall</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨[nn1]ä¸Šï¼Œå¯¹å…¶è¿›è¡Œæ ¼å¼åŒ–ï¼Œå¹¶å¯åŠ¨</span></span><br><span class="line">hdfs namenode -format</span><br><span class="line">hdfs --daemon start namenode</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨[nn2]å’Œ[nn3]ä¸Šï¼ŒåŒæ­¥ nn1 çš„å…ƒæ•°æ®ä¿¡æ¯</span></span><br><span class="line">hdfs namenode -bootstrapStandby</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨[nn2]å’Œ[nn3]</span></span><br><span class="line">hdfs --daemon start namenode</span><br><span class="line"><span class="comment"># æ‰“å¼€9870ç•Œé¢ï¼Œå‘ç°éƒ½æ˜¯standbyæ¨¡å¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šï¼Œå¯åŠ¨ datanode</span></span><br><span class="line">hdfs --daemon start datanode</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†[nn1]åˆ‡æ¢ä¸º Active</span></span><br><span class="line">hdfs haadmin -transitionToActive nn1</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ˜¯å¦ Active</span></span><br><span class="line">hdfs haadmin -getServiceState nn1</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰‹åŠ¨æ¨¡å¼ä¸‹éœ€è¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨æ‰èƒ½è½¬æ¢æŸä¸ªèŠ‚ç‚¹ä¸ºactiveï¼Œå¦åˆ™å®¹æ˜“è„‘è£‚</span></span><br></pre></td></tr></table></figure>
<h2 id="4ã€HDFS-HA-è‡ªåŠ¨æ¨¡å¼">4ã€HDFS-HA è‡ªåŠ¨æ¨¡å¼</h2>
<h3 id="4-1-è‡ªåŠ¨æ•…éšœè½¬ç§»å·¥ä½œæœºåˆ¶">4.1 è‡ªåŠ¨æ•…éšœè½¬ç§»å·¥ä½œæœºåˆ¶</h3>
<p>è‡ªåŠ¨æ•…éšœè½¬ç§»ä¸º HDFS éƒ¨ç½²å¢åŠ äº†ä¸¤ä¸ªæ–°ç»„ä»¶ï¼šZooKeeper å’Œ ZKFailoverControllerï¼ˆZKFCï¼‰è¿›ç¨‹ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚ZooKeeper æ˜¯ç»´æŠ¤å°‘é‡åè°ƒæ•°æ®ï¼Œé€šçŸ¥å®¢æˆ·ç«¯è¿™äº›æ•°æ®çš„æ”¹å˜å’Œç›‘è§†å®¢æˆ·ç«¯æ•…éšœçš„é«˜å¯ç”¨æœåŠ¡</p>
<p><img src="http://qnypic.shawncoding.top/blog/202401251330943.png" alt></p>
<h3 id="4-2-HDFS-HA-è‡ªåŠ¨æ•…éšœè½¬ç§»é…ç½®">4.2 HDFS-HA è‡ªåŠ¨æ•…éšœè½¬ç§»é…ç½®</h3>
<p>é¦–å…ˆé…ç½®hadoopé›†ç¾¤çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨ hdfs-site.xml ä¸­å¢åŠ </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¯ç”¨ nn æ•…éšœè‡ªåŠ¨è½¬ç§» --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.automatic-failover.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨ core-site.xml æ–‡ä»¶ä¸­å¢åŠ </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æŒ‡å®š zkfc è¦è¿æ¥çš„ zkServer åœ°å€ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>ha.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102:2181,hadoop103:2181,hadoop104:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹ååˆ†å‘é…ç½®æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">xsync hadoop/</span><br><span class="line"><span class="comment"># ä¸‹ä¸€æ­¥å¯åŠ¨</span></span><br><span class="line"><span class="comment"># å…³é—­æ‰€æœ‰ HDFS æœåŠ¡</span></span><br><span class="line">stop-dfs.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># zookeeperå¯ä»¥å‚è€ƒzookeeperæ–‡ç« ï¼Œä¸è¿‡æ­å»ºä¹Ÿä¸éš¾</span></span><br><span class="line"><span class="comment"># å¯åŠ¨ Zookeeper é›†ç¾¤,ä¹Ÿå¯ä»¥å•èŠ‚ç‚¹(é›†ç¾¤çš„è¯ä¸‰å°éƒ½è¦å¯åŠ¨ï¼Œè¿™æ¡å‘½ä»¤æ˜¯è„šæœ¬)</span></span><br><span class="line">zkServer.sh start</span><br><span class="line"><span class="comment"># å¯åŠ¨ Zookeeper ä»¥åï¼Œç„¶åå†åˆå§‹åŒ– HA åœ¨ Zookeeper ä¸­çŠ¶æ€</span></span><br><span class="line">hdfs zkfc -formatZK</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨ HDFS æœåŠ¡</span></span><br><span class="line">start-dfs.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥å» zkCli.sh å®¢æˆ·ç«¯æŸ¥çœ‹ Namenode é€‰ä¸¾é”èŠ‚ç‚¹å†…å®¹</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 7] get -s /hadoop-ha/mycluster/ActiveStandbyElectorLock</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°† Active NameNode è¿›ç¨‹ killï¼ŒæŸ¥çœ‹ç½‘é¡µç«¯ä¸‰å° Namenode çš„çŠ¶æ€å˜åŒ–</span></span><br><span class="line"><span class="built_in">kill</span> -9 namenode çš„è¿›ç¨‹ id</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ€æ­»è¿›ç¨‹ä¸èƒ½åˆ‡æ¢activeçš„è¯ï¼Œå¯ä»¥ä¿®æ”¹ä¸‹hdfs.site.xmlé‡Œé¢çš„éš”ç¦»æ–¹æ³•</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.fencing.methods<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">value</span>&gt;</span>sshfence<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">value</span>&gt;</span>shell(true)<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å‚è€ƒï¼š<a href="https://blog.csdn.net/chanyue123/article/details/108637181" target="_blank" rel="noopener" title="https://blog.csdn.net/chanyue123/article/details/108637181">https://blog.csdn.net/chanyue123/article/details/108637181</a></p>
<h3 id="4-3-è§£å†³-NN-è¿æ¥ä¸ä¸Š-JN-çš„é—®é¢˜">4.3 è§£å†³ NN è¿æ¥ä¸ä¸Š JN çš„é—®é¢˜</h3>
<p>è‡ªåŠ¨æ•…éšœè½¬ç§»é…ç½®å¥½ä»¥åï¼Œç„¶åä½¿ç”¨ <a href="http://start-dfs.sh" target="_blank" rel="noopener">start-dfs.sh</a> ç¾¤èµ·è„šæœ¬å¯åŠ¨ hdfs é›†ç¾¤ï¼Œæœ‰å¯èƒ½ä¼šé‡åˆ° NameNode èµ·æ¥ä¸€ä¼šåï¼Œè¿›ç¨‹è‡ªåŠ¨å…³é—­çš„é—®é¢˜ã€‚</p>
<p>æŸ¥çœ‹æŠ¥é”™æ—¥å¿—ï¼Œå¯åˆ†æå‡ºæŠ¥é”™åŸå› æ˜¯å› ä¸º NameNode è¿æ¥ä¸ä¸Š JournalNodeï¼Œè€Œåˆ©ç”¨ jps å‘½ä»¤æŸ¥çœ‹åˆ°ä¸‰å° JN éƒ½å·²ç»æ­£å¸¸å¯åŠ¨ï¼Œä¸ºä»€ä¹ˆ NN è¿˜æ˜¯æ— æ³•æ­£å¸¸è¿æ¥åˆ° JN å‘¢ï¼Ÿè¿™å› ä¸º <a href="http://start-dfs.sh" target="_blank" rel="noopener">start-dfs.sh</a> ç¾¤èµ·è„šæœ¬é»˜è®¤çš„å¯åŠ¨é¡ºåºæ˜¯å…ˆå¯åŠ¨ NNï¼Œå†å¯åŠ¨ DNï¼Œç„¶åå†å¯åŠ¨ JNï¼Œå¹¶ä¸”é»˜è®¤çš„ rpc è¿æ¥å‚æ•°æ˜¯é‡è¯•æ¬¡æ•°ä¸º 10ï¼Œæ¯æ¬¡é‡è¯•çš„é—´éš”æ˜¯ 1sï¼Œä¹Ÿå°±æ˜¯è¯´å¯åŠ¨å®Œ NNä»¥åçš„ 10s ä¸­å†…ï¼ŒJN è¿˜å¯åŠ¨ä¸èµ·æ¥ï¼ŒNN å°±ä¼šæŠ¥é”™äº†</p>
<p>core-default.xml é‡Œé¢æœ‰ä¸¤ä¸ªå‚æ•°å¦‚ä¸‹</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- NN è¿æ¥ JN é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤æ˜¯ 10 æ¬¡ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">name</span>&gt;</span>ipc.client.connect.max.retries<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">value</span>&gt;</span>10<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- é‡è¯•æ—¶é—´é—´éš”ï¼Œé»˜è®¤ 1s --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">name</span>&gt;</span>ipc.client.connect.retry.interval<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">value</span>&gt;</span>1000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è§£å†³æ–¹æ¡ˆï¼šé‡åˆ°ä¸Šè¿°é—®é¢˜åï¼Œå¯ä»¥ç¨ç­‰ç‰‡åˆ»ï¼Œç­‰ JN æˆåŠŸå¯åŠ¨åï¼Œæ‰‹åŠ¨å¯åŠ¨ä¸‹ä¸‰å°ï¼Œä¹Ÿå¯ä»¥åœ¨ core-site.xml é‡Œé¢é€‚å½“è°ƒå¤§ä¸Šé¢çš„ä¸¤ä¸ªå‚æ•°</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs --daemon start namenode</span><br></pre></td></tr></table></figure>
<h2 id="5ã€YARN-HA-é…ç½®">5ã€YARN-HA é…ç½®</h2>
<blockquote>
<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://hadoop.apache.org/docs/r2.7.2/hadoop-yarn/hadoop-yarn-site/ResourceManagerHA.html" target="_blank" rel="noopener" title="https://hadoop.apache.org/docs/r2.7.2/hadoop-yarn/hadoop-yarn-site/ResourceManagerHA.html">https://hadoop.apache.org/docs/r2.7.2/hadoop-yarn/hadoop-yarn-site/ResourceManagerHA.html</a></p>
</blockquote>
<h3 id="5-1-ç¯å¢ƒä¸æ ¸å¿ƒé—®é¢˜">5.1 ç¯å¢ƒä¸æ ¸å¿ƒé—®é¢˜</h3>
<p><strong>å¦‚æœå½“å‰ active rm æŒ‚äº†ï¼Œå…¶ä»– rm æ€ä¹ˆå°†å…¶ä»– standby rm ä¸Šä½</strong></p>
<ul>
<li>æ ¸å¿ƒåŸç†è·Ÿ hdfs ä¸€æ ·ï¼Œåˆ©ç”¨äº† zk çš„ä¸´æ—¶èŠ‚ç‚¹</li>
</ul>
<p><strong>å½“å‰ rm ä¸Šæœ‰å¾ˆå¤šçš„è®¡ç®—ç¨‹åºåœ¨ç­‰å¾…è¿è¡Œ,å…¶ä»–çš„ rm æ€ä¹ˆå°†è¿™äº›ç¨‹åºæ¥æ‰‹è¿‡æ¥æ¥ç€è·‘</strong></p>
<ul>
<li>rm ä¼šå°†å½“å‰çš„æ‰€æœ‰è®¡ç®—ç¨‹åºçš„çŠ¶æ€å­˜å‚¨åœ¨ zk ä¸­,å…¶ä»– rm ä¸Šä½åä¼šå»è¯»å–ï¼Œç„¶åæ¥ç€è·‘</li>
</ul>
<h3 id="5-2-é…ç½®-YARN-HA-é›†ç¾¤">5.2 é…ç½® YARN-HA é›†ç¾¤</h3>
<p>é…ç½®yarn-site.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- å¯ç”¨ resourcemanager ha --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.ha.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- å£°æ˜ä¸¤å° resourcemanager çš„åœ°å€ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.cluster-id<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>cluster-yarn1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--æŒ‡å®š resourcemanager çš„é€»è¾‘åˆ—è¡¨--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.ha.rm-ids<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>rm1,rm2,rm3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ========== rm1 çš„é…ç½® ========== --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æŒ‡å®š rm1 çš„ä¸»æœºå --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname.rm1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æŒ‡å®š rm1 çš„ web ç«¯åœ°å€ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.webapp.address.rm1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102:8088<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æŒ‡å®š rm1 çš„å†…éƒ¨é€šä¿¡åœ°å€ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.address.rm1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102:8032<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æŒ‡å®š AM å‘ rm1 ç”³è¯·èµ„æºçš„åœ°å€ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.address.rm1<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102:8030<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æŒ‡å®šä¾› NM è¿æ¥çš„åœ°å€ --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.resource-tracker.address.rm1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102:8031<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ========== rm2 çš„é…ç½® ========== --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æŒ‡å®š rm2 çš„ä¸»æœºå --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname.rm2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.webapp.address.rm2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103:8088<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.address.rm2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103:8032<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.address.rm2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103:8030<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.resource-tracker.address.rm2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103:8031<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ========== rm3 çš„é…ç½® ========== --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æŒ‡å®š rm1 çš„ä¸»æœºå --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname.rm3<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop104<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æŒ‡å®š rm1 çš„ web ç«¯åœ°å€ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.webapp.address.rm3<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop104:8088<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æŒ‡å®š rm1 çš„å†…éƒ¨é€šä¿¡åœ°å€ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.address.rm3<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop104:8032<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æŒ‡å®š AM å‘ rm1 ç”³è¯·èµ„æºçš„åœ°å€ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.address.rm3<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop104:8030<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æŒ‡å®šä¾› NM è¿æ¥çš„åœ°å€ --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.resource-tracker.address.rm3<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop104:8031<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æŒ‡å®š zookeeper é›†ç¾¤çš„åœ°å€ --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.zk-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102:2181,hadoop103:2181,hadoop104:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- å¯ç”¨è‡ªåŠ¨æ¢å¤ --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.recovery.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æŒ‡å®š resourcemanager çš„çŠ¶æ€ä¿¡æ¯å­˜å‚¨åœ¨ zookeeper é›†ç¾¤ --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.store.class<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateStore<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ç¯å¢ƒå˜é‡çš„ç»§æ‰¿ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.env-whitelist<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åˆ†å‘å¹¶æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŒæ­¥æ›´æ–°å…¶ä»–èŠ‚ç‚¹çš„é…ç½®ä¿¡æ¯</span></span><br><span class="line">xsync hadoop/</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨ YARN</span></span><br><span class="line"><span class="comment"># åœ¨ hadoop102 æˆ–è€… hadoop103 ä¸­æ‰§è¡Œ</span></span><br><span class="line">start-yarn.sh</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æœåŠ¡çŠ¶æ€</span></span><br><span class="line">yarn rmadmin -getServiceState rm1</span><br><span class="line"><span class="comment"># å¯ä»¥å» zkCli.sh å®¢æˆ·ç«¯æŸ¥çœ‹ ResourceManager é€‰ä¸¾é”èŠ‚ç‚¹å†…å®¹</span></span><br><span class="line"></span><br><span class="line">zkCli.sh</span><br><span class="line">[zk: localhost:2181(CONNECTED) 16] get -s /yarn-leader-election/cluster-yarn1/ActiveStandbyElectorLock</span><br><span class="line"></span><br><span class="line"><span class="comment"># web ç«¯æŸ¥çœ‹ hadoop102:8088 å’Œ hadoop103:8088 çš„ YARN çš„çŠ¶æ€</span></span><br></pre></td></tr></table></figure>
<h3 id="5-3-HADOOP-HA-çš„æœ€ç»ˆè§„åˆ’">5.3 HADOOP HA çš„æœ€ç»ˆè§„åˆ’</h3>
<table>
<thead>
<tr>
<th><strong>hadoop102</strong></th>
<th><strong>hadoop103</strong></th>
<th><strong>hadoop104</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>NameNode</td>
<td>NameNode</td>
<td>NameNode</td>
</tr>
<tr>
<td>DataNode</td>
<td>DataNode</td>
<td>DataNode</td>
</tr>
<tr>
<td>JournalNode</td>
<td>JournalNode</td>
<td>JournalNode</td>
</tr>
<tr>
<td>Zookeeper</td>
<td>Zookeeper</td>
<td>Zookeeper</td>
</tr>
<tr>
<td>ZKFC</td>
<td>ZKFC</td>
<td>ZKFC</td>
</tr>
</tbody>
</table>

      

      


      
        <div class="page-reward">
          <a href="javascript:;" class="page-reward-btn tooltip-top">
            <div class="tooltip tooltip-east">
            <span class="tooltip-item">
              èµ
            </span>
            <span class="tooltip-content">
              <span class="tooltip-text">
                <span class="tooltip-inner">
                  <p class="reward-p"><i class="icon icon-quo-left"></i>è°¢è°¢ä½ è¯·æˆ‘åƒç³–æœ<i class="icon icon-quo-right"></i></p>
                  <div class="reward-box">
                    
                    <div class="reward-box-item">
                      <img class="reward-img" src="/img/alipay.png">
                      <span class="reward-type">æ”¯ä»˜å®</span>
                    </div>
                    
                    
                  </div>
                </span>
              </span>
            </span>
          </div>
          </a>
        </div>
      
    </div>

    <!-- æ·»åŠ æœ¬æ–‡ç»“æŸæ ‡è®°-->
    
    <div style="text-align:center;color: #00BFFF;font-size:14px;">
         -------------æœ¬æ–‡ç»“æŸ^-^æ„Ÿè°¢æ‚¨çš„é˜…è¯»-------------
         </div>
    
    <!-- æ·»åŠ å®Œæˆ -->


      <!-- ã€Šæ·»åŠ ç‰ˆæƒå£°æ˜ -->
      
          <!-- ã€Šæ·»åŠ ç‰ˆæƒå£°æ˜ -->
<!--æ·»åŠ ç‰ˆæƒå£°æ˜https://github.com/JoeyBling/hexo-theme-yilia-plus/commit/c1215e132f6d5621c5fea83d3c4f7ccbcca074a3-->


<!-- #ç‰ˆæƒåŸºç¡€è®¾å®šï¼š0-å…³é—­å£°æ˜ï¼› 1-æ–‡ç« å¯¹åº”çš„mdæ–‡ä»¶é‡Œæœ‰declare: trueå±æ€§ï¼Œæ‰æœ‰ç‰ˆæƒå£°æ˜ï¼› 2-æ‰€æœ‰æ–‡ç« å‡æœ‰ç‰ˆæƒå£°æ˜ -->

  <div class="declare">
    <strong class="author">æœ¬æ–‡ä½œè€…ï¼š</strong>
    
      Shawn
    
    <br>
    <strong class="create-time">å‘å¸ƒæ—¶é—´ï¼š</strong>
    2024-02-06
    <br>
    <strong class="update-time">æœ€åæ›´æ–°ï¼š</strong>
    2024-02-29
    <br>
    <strong class="article-titles">æœ¬æ–‡æ ‡é¢˜ï¼š</strong>
    <a href="https://blog.shawncoding.top/posts/6f0694e3.html" title="Hadoop3.xå­¦ä¹ ç¬”è®°" target="_blank">Hadoop3.xå­¦ä¹ ç¬”è®°</a>
    <br>
    <strong class="article-url">æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="https://blog.shawncoding.top/posts/6f0694e3.html" title="Hadoop3.xå­¦ä¹ ç¬”è®°" target="_blank">https://blog.shawncoding.top/posts/6f0694e3.html</a>
    <br>
    <strong class="copyright">ç‰ˆæƒå£°æ˜ï¼š</strong>
    æœ¬ä½œå“é‡‡ç”¨
    <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®">CC BY-NC-SA 4.0</a>
    è®¸å¯åè®®è¿›è¡Œè®¸å¯ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
    
      <br>
      <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank"><img alt="çŸ¥è¯†å…±äº«è®¸å¯åè®®" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"/></a>
    
  </div>

<!-- æ·»åŠ ç‰ˆæƒå£°æ˜ã€‹ -->
      
      <!-- æ·»åŠ ç‰ˆæƒå£°æ˜ã€‹ -->

    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">å¤§æ•°æ®</a>
        		</li>
      		
		</ul>
	</div>

      
      <!-- æ–‡æœ«è®¿é—®é‡ç»Ÿè®¡ï¼ˆå¼€å§‹ï¼‰ -->
      <!--<span id="busuanzi_container_page_pv">
          |é˜…è¯»é‡:<span id="busuanzi_value_page_pv"></span>æ¬¡
      </span>-->
      <!-- æ–‡æœ«è®¿é—®é‡ç»Ÿè®¡ï¼ˆç»“æŸï¼‰ -->

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/å¤§æ•°æ®//" class="article-tag-list-link color4">å¤§æ•°æ®</a>
        		</li>
      		
		</ul>
	</div>


     

      
        
<div class="share-btn share-icons tooltip-left">
  <div class="tooltip tooltip-east">
    <span class="tooltip-item">
      <a href="javascript:;" class="share-sns share-outer">
        <i class="icon icon-share"></i>
      </a>
    </span>
    <span class="tooltip-content">
      <div class="share-wrap">
        <div class="share-icons">
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="icon icon-weibo"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="icon icon-weixin"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="icon icon-qq"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="icon icon-douban"></i>
          </a>
          <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a>
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="icon icon-facebook"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="icon icon-twitter"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="icon icon-google"></i>
          </a>
        </div>
      </div>
    </span>
  </div>
</div>

<div class="page-modal wx-share js-wx-box">
    <a class="close js-modal-close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <div class="wx-qrcode">
      <img src="//pan.baidu.com/share/qrcode?url=https://blog.shawncoding.top/posts/6f0694e3.html" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
    </div>
</div>

<div class="mask js-mask"></div>
      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

  
<nav id="article-nav">
  
    <a href="/posts/ccc73924.html" id="article-nav-newer" class="article-nav-link-wrap">
      <i class="icon-circle-left"></i>
      <div class="article-nav-title">
        
          Hadoop3.xæºç è§£æ
        
      </div>
    </a>
  
  
    <a href="/posts/917a1f63.html" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Flume1.9åŸºç¡€å­¦ä¹ </div>
      <i class="icon-circle-right"></i>
    </a>
  
</nav>


<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
        <div class="toc-container tooltip-left">
            <i class="icon-font icon-category"></i>
            <div class="tooltip tooltip-east">
                <span class="tooltip-item">
                </span>
                <span class="tooltip-content">
                    <div class="toc-article">
                    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#null"><span class="toc-number">1.</span> <span class="toc-text">ä¸€ã€Hadoopå…¥é—¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1ã€Hadoopæ¦‚è¿°"><span class="toc-number">1.1.</span> <span class="toc-text">1ã€Hadoopæ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-ç®€ä»‹"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 ç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-hadoopä¼˜åŠ¿"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 hadoopä¼˜åŠ¿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-hadoopç»„æˆ"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3 hadoopç»„æˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-å¤§æ•°æ®æŠ€æœ¯ç”Ÿæ€ä½“ç³»"><span class="toc-number">1.1.4.</span> <span class="toc-text">1.4 å¤§æ•°æ®æŠ€æœ¯ç”Ÿæ€ä½“ç³»</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2ã€ç¯å¢ƒå‡†å¤‡-é‡ç‚¹"><span class="toc-number">1.2.</span> <span class="toc-text">2ã€ç¯å¢ƒå‡†å¤‡(é‡ç‚¹)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-æ¨¡æ¿æœºé…ç½®"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 æ¨¡æ¿æœºé…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-æ¨¡æ¿åˆ›å»º"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 æ¨¡æ¿åˆ›å»º</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3ã€æœ¬åœ°è¿è¡Œæ¨¡å¼ï¼ˆå®˜æ–¹WordCountï¼‰"><span class="toc-number">1.3.</span> <span class="toc-text">3ã€æœ¬åœ°è¿è¡Œæ¨¡å¼ï¼ˆå®˜æ–¹WordCountï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4ã€Hadoopé›†ç¾¤æ­å»º-ğŸŒŸé‡ç‚¹"><span class="toc-number">1.4.</span> <span class="toc-text">4ã€Hadoopé›†ç¾¤æ­å»º(ğŸŒŸé‡ç‚¹)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-ç¯å¢ƒå‡†å¤‡-é›†ç¾¤åˆ†å‘è„šæœ¬xsync"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 ç¯å¢ƒå‡†å¤‡(é›†ç¾¤åˆ†å‘è„šæœ¬xsync)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-SSHå…å¯†é…ç½®"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 SSHå…å¯†é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-é›†ç¾¤é…ç½®"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3 é›†ç¾¤é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-å¯åŠ¨é›†ç¾¤"><span class="toc-number">1.4.4.</span> <span class="toc-text">4.4 å¯åŠ¨é›†ç¾¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-é…ç½®å†å²æœåŠ¡å™¨"><span class="toc-number">1.4.5.</span> <span class="toc-text">4.5 é…ç½®å†å²æœåŠ¡å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-é…ç½®æ—¥å¿—çš„èšé›†"><span class="toc-number">1.4.6.</span> <span class="toc-text">4.6 é…ç½®æ—¥å¿—çš„èšé›†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-é›†ç¾¤å¯åŠ¨-åœæ­¢æ–¹å¼æ€»ç»“"><span class="toc-number">1.4.7.</span> <span class="toc-text">4.7 é›†ç¾¤å¯åŠ¨&#x2F;åœæ­¢æ–¹å¼æ€»ç»“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8-Hadoopé›†ç¾¤å¸¸ç”¨è„šæœ¬"><span class="toc-number">1.4.8.</span> <span class="toc-text">4.8 Hadoopé›†ç¾¤å¸¸ç”¨è„šæœ¬</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9-å¸¸ç”¨ç«¯å£å·è¯´æ˜"><span class="toc-number">1.4.9.</span> <span class="toc-text">4.9 å¸¸ç”¨ç«¯å£å·è¯´æ˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-10-é›†ç¾¤æ—¶é—´åŒæ­¥-å¯é€‰"><span class="toc-number">1.4.10.</span> <span class="toc-text">4.10 é›†ç¾¤æ—¶é—´åŒæ­¥(å¯é€‰)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#null"><span class="toc-number">2.</span> <span class="toc-text">äºŒã€HDFS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1ã€HDFSæ¦‚è¿°"><span class="toc-number">2.1.</span> <span class="toc-text">1ã€HDFSæ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-ç®€ä»‹-v2"><span class="toc-number">2.1.1.</span> <span class="toc-text">1.1 ç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-HDFSä¼˜ç¼ºç‚¹"><span class="toc-number">2.1.2.</span> <span class="toc-text">1.2 HDFSä¼˜ç¼ºç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-HDFSç»„æˆæ¶æ„"><span class="toc-number">2.1.3.</span> <span class="toc-text">1.3 HDFSç»„æˆæ¶æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-HDFSæ–‡ä»¶å—å¤§å°-é¢è¯•é‡ç‚¹"><span class="toc-number">2.1.4.</span> <span class="toc-text">1.4 HDFSæ–‡ä»¶å—å¤§å°(é¢è¯•é‡ç‚¹)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2ã€HDFSçš„Shellæ“ä½œ-é‡ç‚¹"><span class="toc-number">2.2.</span> <span class="toc-text">2ã€HDFSçš„Shellæ“ä½œ(é‡ç‚¹)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3ã€HDFSçš„APIæ“ä½œ"><span class="toc-number">2.3.</span> <span class="toc-text">3ã€HDFSçš„APIæ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-ç¯å¢ƒå‡†å¤‡"><span class="toc-number">2.3.1.</span> <span class="toc-text">3.1 ç¯å¢ƒå‡†å¤‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-HDFSçš„APIæ¡ˆä¾‹å®æ“"><span class="toc-number">2.3.2.</span> <span class="toc-text">3.2 HDFSçš„APIæ¡ˆä¾‹å®æ“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4ã€HDFSçš„è¯»å†™æµç¨‹-é¢è¯•é‡ç‚¹"><span class="toc-number">2.4.</span> <span class="toc-text">4ã€HDFSçš„è¯»å†™æµç¨‹(é¢è¯•é‡ç‚¹)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-HDFS-å†™æ•°æ®æµç¨‹"><span class="toc-number">2.4.1.</span> <span class="toc-text">4.1 HDFS å†™æ•°æ®æµç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-HDFS-è¯»æ•°æ®æµç¨‹"><span class="toc-number">2.4.2.</span> <span class="toc-text">4.2 HDFS è¯»æ•°æ®æµç¨‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5ã€NameNode-å’Œ-SecondaryNameNode"><span class="toc-number">2.5.</span> <span class="toc-text">5ã€NameNode å’Œ SecondaryNameNode</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-NNå’Œ2NNå·¥ä½œæœºåˆ¶"><span class="toc-number">2.5.1.</span> <span class="toc-text">5.1 NNå’Œ2NNå·¥ä½œæœºåˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-Fsimageå’ŒEditsè§£æ"><span class="toc-number">2.5.2.</span> <span class="toc-text">5.2 Fsimageå’ŒEditsè§£æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-CheckPointæ—¶é—´è®¾ç½®"><span class="toc-number">2.5.3.</span> <span class="toc-text">5.3 CheckPointæ—¶é—´è®¾ç½®</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6ã€DataNode"><span class="toc-number">2.6.</span> <span class="toc-text">6ã€DataNode</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-DataNodeå·¥ä½œæœºåˆ¶"><span class="toc-number">2.6.1.</span> <span class="toc-text">6.1 DataNodeå·¥ä½œæœºåˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-æ•°æ®å®Œæ•´æ€§"><span class="toc-number">2.6.2.</span> <span class="toc-text">6.2 æ•°æ®å®Œæ•´æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-æ‰çº¿æ—¶é™å‚æ•°è®¾ç½®"><span class="toc-number">2.6.3.</span> <span class="toc-text">6.3 æ‰çº¿æ—¶é™å‚æ•°è®¾ç½®</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#null"><span class="toc-number">3.</span> <span class="toc-text">ä¸‰ã€MapReduce</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1ã€MapReduceæ¦‚è¿°"><span class="toc-number">3.1.</span> <span class="toc-text">1ã€MapReduceæ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-MapReduceå®šä¹‰"><span class="toc-number">3.1.1.</span> <span class="toc-text">1.1 MapReduceå®šä¹‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-ä¼˜ç¼ºç‚¹"><span class="toc-number">3.1.2.</span> <span class="toc-text">1.2 ä¼˜ç¼ºç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-MapReduceæ ¸å¿ƒæ€æƒ³"><span class="toc-number">3.1.3.</span> <span class="toc-text">1.3 MapReduceæ ¸å¿ƒæ€æƒ³</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-åºåˆ—åŒ–ç±»å‹ä¸ç¼–ç¨‹è§„èŒƒ"><span class="toc-number">3.1.4.</span> <span class="toc-text">1.4 åºåˆ—åŒ–ç±»å‹ä¸ç¼–ç¨‹è§„èŒƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-WordCountæ¡ˆä¾‹å®æ“"><span class="toc-number">3.1.5.</span> <span class="toc-text">1.5 WordCountæ¡ˆä¾‹å®æ“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2ã€Hadoopåºåˆ—åŒ–"><span class="toc-number">3.2.</span> <span class="toc-text">2ã€Hadoopåºåˆ—åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-æ¦‚è¿°"><span class="toc-number">3.2.1.</span> <span class="toc-text">2.1 æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-è‡ªå®šä¹‰beanå¯¹è±¡å®ç°åºåˆ—åŒ–æ¥å£-Writable"><span class="toc-number">3.2.2.</span> <span class="toc-text">2.2 è‡ªå®šä¹‰beanå¯¹è±¡å®ç°åºåˆ—åŒ–æ¥å£(Writable)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-åºåˆ—åŒ–æ¡ˆä¾‹å®æ“"><span class="toc-number">3.2.3.</span> <span class="toc-text">2.3 åºåˆ—åŒ–æ¡ˆä¾‹å®æ“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3ã€MapReduceæ¡†æ¶åŸç†"><span class="toc-number">3.3.</span> <span class="toc-text">3ã€MapReduceæ¡†æ¶åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-InputFormatæ•°æ®è¾“å…¥"><span class="toc-number">3.3.1.</span> <span class="toc-text">3.1 InputFormatæ•°æ®è¾“å…¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-MapReduceå·¥ä½œæµç¨‹"><span class="toc-number">3.3.2.</span> <span class="toc-text">3.2 MapReduceå·¥ä½œæµç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-Shuffleæœºåˆ¶"><span class="toc-number">3.3.3.</span> <span class="toc-text">3.3 Shuffleæœºåˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-OutputFormatæ•°æ®è¾“å‡º"><span class="toc-number">3.3.4.</span> <span class="toc-text">3.4 OutputFormatæ•°æ®è¾“å‡º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-MapReduceå†…æ ¸æºç è§£æ"><span class="toc-number">3.3.5.</span> <span class="toc-text">3.5 MapReduceå†…æ ¸æºç è§£æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-Joinåº”ç”¨"><span class="toc-number">3.3.6.</span> <span class="toc-text">3.6 Joinåº”ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-æ•°æ®æ¸…æ´—-ETL"><span class="toc-number">3.3.7.</span> <span class="toc-text">3.7 æ•°æ®æ¸…æ´—(ETL)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-MapReduceå¼€å‘æ€»ç»“"><span class="toc-number">3.3.8.</span> <span class="toc-text">3.8 MapReduceå¼€å‘æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4ã€Hadoopæ•°æ®å‹ç¼©"><span class="toc-number">3.4.</span> <span class="toc-text">4ã€Hadoopæ•°æ®å‹ç¼©</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-æ¦‚è¿°"><span class="toc-number">3.4.1.</span> <span class="toc-text">4.1 æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-MRæ”¯æŒçš„å‹ç¼©ç¼–ç "><span class="toc-number">3.4.2.</span> <span class="toc-text">4.2 MRæ”¯æŒçš„å‹ç¼©ç¼–ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-å‹ç¼©æ–¹å¼é€‰æ‹©"><span class="toc-number">3.4.3.</span> <span class="toc-text">4.3 å‹ç¼©æ–¹å¼é€‰æ‹©</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-å‹ç¼©å‚æ•°é…ç½®"><span class="toc-number">3.4.4.</span> <span class="toc-text">4.4 å‹ç¼©å‚æ•°é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-å‹ç¼©å®æ“æ¡ˆä¾‹"><span class="toc-number">3.4.5.</span> <span class="toc-text">4.5 å‹ç¼©å®æ“æ¡ˆä¾‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#null"><span class="toc-number">4.</span> <span class="toc-text">å››ã€Yarn</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1ã€Yarnèµ„æºè°ƒåº¦å™¨"><span class="toc-number">4.1.</span> <span class="toc-text">1ã€Yarnèµ„æºè°ƒåº¦å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-YarnåŸºç¡€æ¶æ„"><span class="toc-number">4.1.1.</span> <span class="toc-text">1.1 YarnåŸºç¡€æ¶æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-Yarnå·¥ä½œæœºåˆ¶"><span class="toc-number">4.1.2.</span> <span class="toc-text">1.2 Yarnå·¥ä½œæœºåˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-Yarnè°ƒåº¦å™¨å’Œè°ƒåº¦ç®—æ³•"><span class="toc-number">4.1.3.</span> <span class="toc-text">1.3 Yarnè°ƒåº¦å™¨å’Œè°ƒåº¦ç®—æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-Yarn-å¸¸ç”¨å‘½ä»¤"><span class="toc-number">4.1.4.</span> <span class="toc-text">1.4 Yarn å¸¸ç”¨å‘½ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-Yarn-ç”Ÿäº§ç¯å¢ƒæ ¸å¿ƒå‚æ•°"><span class="toc-number">4.1.5.</span> <span class="toc-text">1.5 Yarn ç”Ÿäº§ç¯å¢ƒæ ¸å¿ƒå‚æ•°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2ã€Yarn-æ¡ˆä¾‹å®æ“"><span class="toc-number">4.2.</span> <span class="toc-text">2ã€Yarn æ¡ˆä¾‹å®æ“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Yarnç”Ÿäº§ç¯å¢ƒæ ¸å¿ƒå‚æ•°é…ç½®æ¡ˆä¾‹"><span class="toc-number">4.2.1.</span> <span class="toc-text">2.1 Yarnç”Ÿäº§ç¯å¢ƒæ ¸å¿ƒå‚æ•°é…ç½®æ¡ˆä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-å®¹é‡è°ƒåº¦å™¨å¤šé˜Ÿåˆ—æäº¤æ¡ˆä¾‹"><span class="toc-number">4.2.2.</span> <span class="toc-text">2.2 å®¹é‡è°ƒåº¦å™¨å¤šé˜Ÿåˆ—æäº¤æ¡ˆä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-å…¬å¹³è°ƒåº¦å™¨æ¡ˆä¾‹"><span class="toc-number">4.2.3.</span> <span class="toc-text">2.3 å…¬å¹³è°ƒåº¦å™¨æ¡ˆä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-Yarnçš„Toolæ¥å£æ¡ˆä¾‹"><span class="toc-number">4.2.4.</span> <span class="toc-text">2.4 Yarnçš„Toolæ¥å£æ¡ˆä¾‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#null"><span class="toc-number">5.</span> <span class="toc-text">äº”ã€Hadoopç”Ÿäº§è°ƒä¼˜</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1ã€HDFSæ ¸å¿ƒå‚æ•°"><span class="toc-number">5.1.</span> <span class="toc-text">1ã€HDFSæ ¸å¿ƒå‚æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-NameNodeå†…å­˜ç”Ÿäº§é…ç½®"><span class="toc-number">5.1.1.</span> <span class="toc-text">1.1 NameNodeå†…å­˜ç”Ÿäº§é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-NameNodeå¿ƒè·³å¹¶å‘é…ç½®"><span class="toc-number">5.1.2.</span> <span class="toc-text">1.2 NameNodeå¿ƒè·³å¹¶å‘é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-å¼€å¯å›æ”¶ç«™é…ç½®"><span class="toc-number">5.1.3.</span> <span class="toc-text">1.3 å¼€å¯å›æ”¶ç«™é…ç½®</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2ã€HDFSé›†ç¾¤å‹æµ‹"><span class="toc-number">5.2.</span> <span class="toc-text">2ã€HDFSé›†ç¾¤å‹æµ‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-æµ‹è¯•HDFSå†™æ€§èƒ½"><span class="toc-number">5.2.1.</span> <span class="toc-text">2.1 æµ‹è¯•HDFSå†™æ€§èƒ½</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-æµ‹è¯•HDFSè¯»æ€§èƒ½"><span class="toc-number">5.2.2.</span> <span class="toc-text">2.2 æµ‹è¯•HDFSè¯»æ€§èƒ½</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3ã€HDFSå¤šç›®å½•"><span class="toc-number">5.3.</span> <span class="toc-text">3ã€HDFSå¤šç›®å½•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-NameNodeå¤šç›®å½•é…ç½®"><span class="toc-number">5.3.1.</span> <span class="toc-text">3.1  NameNodeå¤šç›®å½•é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-DataNodeå¤šç›®å½•é…ç½®-é‡è¦"><span class="toc-number">5.3.2.</span> <span class="toc-text">3.2 DataNodeå¤šç›®å½•é…ç½®(é‡è¦)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-é›†ç¾¤æ•°æ®å‡è¡¡ä¹‹ç£ç›˜é—´æ•°æ®å‡è¡¡"><span class="toc-number">5.3.3.</span> <span class="toc-text">3.3 é›†ç¾¤æ•°æ®å‡è¡¡ä¹‹ç£ç›˜é—´æ•°æ®å‡è¡¡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4ã€HDFSé›†ç¾¤æ‰©å®¹åŠç¼©å®¹-é‡è¦"><span class="toc-number">5.4.</span> <span class="toc-text">4ã€HDFSé›†ç¾¤æ‰©å®¹åŠç¼©å®¹(é‡è¦)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-æ·»åŠ ç™½åå•"><span class="toc-number">5.4.1.</span> <span class="toc-text">4.1 æ·»åŠ ç™½åå•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-æ–°å¢æœåŠ¡å™¨èŠ‚ç‚¹"><span class="toc-number">5.4.2.</span> <span class="toc-text">4.2 æ–°å¢æœåŠ¡å™¨èŠ‚ç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-æœåŠ¡å™¨é—´æ•°æ®å‡è¡¡"><span class="toc-number">5.4.3.</span> <span class="toc-text">4.3 æœåŠ¡å™¨é—´æ•°æ®å‡è¡¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-é»‘åå•é€€å½¹æœåŠ¡å™¨"><span class="toc-number">5.4.4.</span> <span class="toc-text">4.4 é»‘åå•é€€å½¹æœåŠ¡å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-HDFSâ€”é›†ç¾¤è¿ç§»"><span class="toc-number">5.4.5.</span> <span class="toc-text">4.5 HDFSâ€”é›†ç¾¤è¿ç§»</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5ã€HDFSå­˜å‚¨ä¼˜åŒ–"><span class="toc-number">5.5.</span> <span class="toc-text">5ã€HDFSå­˜å‚¨ä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-çº åˆ ç "><span class="toc-number">5.5.1.</span> <span class="toc-text">5.1 çº åˆ ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-å¼‚æ„å­˜å‚¨ï¼ˆå†·çƒ­æ•°æ®åˆ†ç¦»ï¼‰"><span class="toc-number">5.5.2.</span> <span class="toc-text">5.2 å¼‚æ„å­˜å‚¨ï¼ˆå†·çƒ­æ•°æ®åˆ†ç¦»ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6ã€HDFSæ•…éšœæ’é™¤"><span class="toc-number">5.6.</span> <span class="toc-text">6ã€HDFSæ•…éšœæ’é™¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-NameNodeæ•…éšœå¤„ç†"><span class="toc-number">5.6.1.</span> <span class="toc-text">6.1 NameNodeæ•…éšœå¤„ç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-é›†ç¾¤å®‰å…¨æ¨¡å¼-ç£ç›˜ä¿®å¤"><span class="toc-number">5.6.2.</span> <span class="toc-text">6.2 é›†ç¾¤å®‰å…¨æ¨¡å¼&amp;ç£ç›˜ä¿®å¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-æ…¢ç£ç›˜ç›‘æ§"><span class="toc-number">5.6.3.</span> <span class="toc-text">6.3 æ…¢ç£ç›˜ç›‘æ§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-å°æ–‡ä»¶å½’æ¡£"><span class="toc-number">5.6.4.</span> <span class="toc-text">6.4 å°æ–‡ä»¶å½’æ¡£</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7ã€MapReduceç”Ÿäº§ç»éªŒ-é‡ç‚¹"><span class="toc-number">5.7.</span> <span class="toc-text">7ã€MapReduceç”Ÿäº§ç»éªŒ(é‡ç‚¹)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-MapReduceæ…¢çš„åŸå› "><span class="toc-number">5.7.1.</span> <span class="toc-text">7.1 MapReduceæ…¢çš„åŸå› </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-MapReduceå¸¸ç”¨è°ƒä¼˜å‚æ•°"><span class="toc-number">5.7.2.</span> <span class="toc-text">7.2 MapReduceå¸¸ç”¨è°ƒä¼˜å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-MapReduceæ•°æ®å€¾æ–œé—®é¢˜"><span class="toc-number">5.7.3.</span> <span class="toc-text">7.3 MapReduceæ•°æ®å€¾æ–œé—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8ã€Yarnç”Ÿäº§ç»éªŒ"><span class="toc-number">5.8.</span> <span class="toc-text">8ã€Yarnç”Ÿäº§ç»éªŒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9ã€Hadoopç»¼åˆè°ƒä¼˜"><span class="toc-number">5.9.</span> <span class="toc-text">9ã€Hadoopç»¼åˆè°ƒä¼˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-Hadoopå°æ–‡ä»¶ä¼˜åŒ–æ–¹æ³•"><span class="toc-number">5.9.1.</span> <span class="toc-text">9.1 Hadoopå°æ–‡ä»¶ä¼˜åŒ–æ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-æµ‹è¯•MapReduceè®¡ç®—æ€§èƒ½"><span class="toc-number">5.9.2.</span> <span class="toc-text">9.2 æµ‹è¯•MapReduceè®¡ç®—æ€§èƒ½</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-ä¼ä¸šå¼€å‘åœºæ™¯æ¡ˆä¾‹"><span class="toc-number">5.9.3.</span> <span class="toc-text">9.3 ä¼ä¸šå¼€å‘åœºæ™¯æ¡ˆä¾‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#null"><span class="toc-number">6.</span> <span class="toc-text">å…­ã€Hadoopé«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1ã€-HA-æ¦‚è¿°"><span class="toc-number">6.1.</span> <span class="toc-text">1ã€ HA æ¦‚è¿°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2ã€HDFS-HA-é›†ç¾¤æ­å»º"><span class="toc-number">6.2.</span> <span class="toc-text">2ã€HDFS-HA é›†ç¾¤æ­å»º</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-é›†ç¾¤è§„åˆ’"><span class="toc-number">6.2.1.</span> <span class="toc-text">2.1 é›†ç¾¤è§„åˆ’</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-HDFS-HA-æ ¸å¿ƒé—®é¢˜"><span class="toc-number">6.2.2.</span> <span class="toc-text">2.2 HDFS-HA æ ¸å¿ƒé—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3ã€HDFS-HA-æ‰‹åŠ¨æ¨¡å¼"><span class="toc-number">6.3.</span> <span class="toc-text">3ã€HDFS-HA æ‰‹åŠ¨æ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-ç¯å¢ƒå‡†å¤‡-v2"><span class="toc-number">6.3.1.</span> <span class="toc-text">3.1 ç¯å¢ƒå‡†å¤‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-é…ç½®-HDFS-HA-é›†ç¾¤"><span class="toc-number">6.3.2.</span> <span class="toc-text">3.2 é…ç½® HDFS-HA é›†ç¾¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-å¯åŠ¨-HDFS-HA-é›†ç¾¤"><span class="toc-number">6.3.3.</span> <span class="toc-text">3.3 å¯åŠ¨ HDFS-HA é›†ç¾¤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4ã€HDFS-HA-è‡ªåŠ¨æ¨¡å¼"><span class="toc-number">6.4.</span> <span class="toc-text">4ã€HDFS-HA è‡ªåŠ¨æ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-è‡ªåŠ¨æ•…éšœè½¬ç§»å·¥ä½œæœºåˆ¶"><span class="toc-number">6.4.1.</span> <span class="toc-text">4.1 è‡ªåŠ¨æ•…éšœè½¬ç§»å·¥ä½œæœºåˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-HDFS-HA-è‡ªåŠ¨æ•…éšœè½¬ç§»é…ç½®"><span class="toc-number">6.4.2.</span> <span class="toc-text">4.2 HDFS-HA è‡ªåŠ¨æ•…éšœè½¬ç§»é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-è§£å†³-NN-è¿æ¥ä¸ä¸Š-JN-çš„é—®é¢˜"><span class="toc-number">6.4.3.</span> <span class="toc-text">4.3 è§£å†³ NN è¿æ¥ä¸ä¸Š JN çš„é—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5ã€YARN-HA-é…ç½®"><span class="toc-number">6.5.</span> <span class="toc-text">5ã€YARN-HA é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-ç¯å¢ƒä¸æ ¸å¿ƒé—®é¢˜"><span class="toc-number">6.5.1.</span> <span class="toc-text">5.1 ç¯å¢ƒä¸æ ¸å¿ƒé—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-é…ç½®-YARN-HA-é›†ç¾¤"><span class="toc-number">6.5.2.</span> <span class="toc-text">5.2 é…ç½® YARN-HA é›†ç¾¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-HADOOP-HA-çš„æœ€ç»ˆè§„åˆ’"><span class="toc-number">6.5.3.</span> <span class="toc-text">5.3 HADOOP HA çš„æœ€ç»ˆè§„åˆ’</span></a></li></ol></li></ol></li></ol>
                    </div>
                </span>
            </div>
        </div>
        
    </div>
</aside>

<!-- è¯„è®º -->

  
    <section id="comments" class="comments">
       <div id="vcomment" class="comment"></div> 
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script>
   var notify = 'false' == true ? true : false;
   var verify = 'false' == true ? true : false;
    window.onload = function() {
        new Valine({
            el: '.comment',
            notify: notify,
            verify: verify,
            app_id: "hRDQtFPNrfKmHhxhBlFlXkGq-gzGzoHsz",
            app_key: "jSCOVLxSm31BVC1D8RrKWn1d",
            placeholder: "ğŸ˜‰çœ‹äº†è¿™ä¹ˆä¹…ï¼Œæœ‰å•¥æƒ³è¯´çš„å—ï¼ŸğŸ¤”",
            avatar:"retro"
        });
    }
</script>
  </section>

  
  
  

  

  

  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
        <div class="footer-left">
            <!--å¦‚æœæœ‰è®¾ç½®theme.sinceï¼Œå¹¶ä¸”æ—¶é—´å°äºå½“å‰æ—¶é—´ï¼ˆå¹´ä»½ï¼‰ï¼Œå½¢å¼ä¸ºï¼š@ 2018 - 2019(+ä½œè€…/æ ‡é¢˜)ï¼›å¦åˆ™é»˜è®¤ä¸ºå½“å‰å¹´ä»½(+ä½œè€…/æ ‡é¢˜)ã€‚ -->
            
                &copy; 2020-2024
            
            Shawn
        </div>


<!-- ã€Šç½‘ç«™å¤‡æ¡ˆå· -->
    
        <div class="BeiAn-info">
            <!-- <img src="https://gitee.com/LXT2017/Picbed/raw/blogimg/noteimg/china.png" title="å¤‡æ¡ˆç®¡ç†ç³»ç»Ÿ"> -->
            <img src="https://picblog.shawncoding.top/background/china.png" title="å¤‡æ¡ˆç®¡ç†ç³»ç»Ÿ">
            <a href="https://beian.miit.gov.cn/" style="color:#f72b07" target="_blank" title="å¤‡æ¡ˆå·">
                ç²¤ICPå¤‡00000000å·
            </a>
        </div>
    
    <!-- ç½‘ç«™å¤‡æ¡ˆå·ã€‹ -->

<div class="footer-right">
        <span id="timeDate">è½½å…¥å¤©æ•°...</span><span id="times">è½½å…¥æ—¶åˆ†ç§’...</span>
    <script>
        var now = new Date(); 
        function createtime() { 
            var grt= new Date("1/1/2020 00:00:00");//æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´ 
            now.setTime(now.getTime()+250); 
            days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
            hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
            if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
            mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
            seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
            snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
            document.getElementById("timeDate").innerHTML = "æœ¬ç«™å·²å®‰å…¨è¿è¡Œ "+dnum+" å¤© "; 
            document.getElementById("times").innerHTML = hnum + " å°æ—¶ " + mnum + " åˆ† " + snum + " ç§’"; 
        } 
        setInterval("createtime()",250);
    </script>


    	
    </div>
</div>
</div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		toc_hide_index: true,
		root: "/",
		innerArchive: true,
		showTags: false
	}
</script>

<script>!function(t){function n(e){if(r[e])return r[e].exports;var i=r[e]={exports:{},id:e,loaded:!1};return t[e].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var r={};n.m=t,n.c=r,n.p="./",n(0)}([function(t,n,r){r(195),t.exports=r(191)},function(t,n,r){var e=r(3),i=r(52),o=r(27),u=r(28),c=r(53),f="prototype",a=function(t,n,r){var s,l,h,v,p=t&a.F,d=t&a.G,y=t&a.S,g=t&a.P,b=t&a.B,m=d?e:y?e[n]||(e[n]={}):(e[n]||{})[f],x=d?i:i[n]||(i[n]={}),w=x[f]||(x[f]={});d&&(r=n);for(s in r)l=!p&&m&&void 0!==m[s],h=(l?m:r)[s],v=b&&l?c(h,e):g&&"function"==typeof h?c(Function.call,h):h,m&&u(m,s,h,t&a.U),x[s]!=h&&o(x,s,v),g&&w[s]!=h&&(w[s]=h)};e.core=i,a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,t.exports=a},function(t,n,r){var e=r(6);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n,r){var e=r(126)("wks"),i=r(76),o=r(3).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n,r){var e=r(94),i=r(33);t.exports=function(t){return e(i(t))}},function(t,n,r){t.exports=!r(4)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(2),i=r(167),o=r(50),u=Object.defineProperty;n.f=r(10)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){t.exports=!r(18)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(14),i=r(22);t.exports=r(12)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(20),i=r(58),o=r(42),u=Object.defineProperty;n.f=r(12)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){var e=r(40)("wks"),i=r(23),o=r(5).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n,r){var e=r(67),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n,r){var e=r(46);t.exports=function(t){return Object(e(t))}},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n,r){var e=r(63),i=r(34);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(21);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n,r){var e=r(11),i=r(66);t.exports=r(10)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(3),i=r(27),o=r(24),u=r(76)("src"),c="toString",f=Function[c],a=(""+f).split(c);r(52).inspectSource=function(t){return f.call(t)},(t.exports=function(t,n,r,c){var f="function"==typeof r;f&&(o(r,"name")||i(r,"name",n)),t[n]!==r&&(f&&(o(r,u)||i(r,u,t[n]?""+t[n]:a.join(String(n)))),t===e?t[n]=r:c?t[n]?t[n]=r:i(t,n,r):(delete t[n],i(t,n,r)))})(Function.prototype,c,function(){return"function"==typeof this&&this[u]||f.call(this)})},function(t,n,r){var e=r(1),i=r(4),o=r(46),u=function(t,n,r,e){var i=String(o(t)),u="<"+n;return""!==r&&(u+=" "+r+'="'+String(e).replace(/"/g,"&quot;")+'"'),u+">"+i+"</"+n+">"};t.exports=function(t,n){var r={};r[t]=n(u),e(e.P+e.F*i(function(){var n=""[t]('"');return n!==n.toLowerCase()||n.split('"').length>3}),"String",r)}},function(t,n,r){var e=r(115),i=r(46);t.exports=function(t){return e(i(t))}},function(t,n,r){var e=r(116),i=r(66),o=r(30),u=r(50),c=r(24),f=r(167),a=Object.getOwnPropertyDescriptor;n.f=r(10)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(24),i=r(17),o=r(145)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n){t.exports={}},function(t,n){t.exports=!0},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(14).f,i=r(8),o=r(15)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(40)("keys"),i=r(23);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(5),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n,r){var e=r(21);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(5),i=r(25),o=r(36),u=r(44),c=r(14).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){n.f=r(15)},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n,r){var e=r(4);t.exports=function(t,n){return!!t&&e(function(){n?t.call(null,function(){},1):t.call(null)})}},function(t,n,r){var e=r(53),i=r(115),o=r(17),u=r(16),c=r(203);t.exports=function(t,n){var r=1==t,f=2==t,a=3==t,s=4==t,l=6==t,h=5==t||l,v=n||c;return function(n,c,p){for(var d,y,g=o(n),b=i(g),m=e(c,p,3),x=u(b.length),w=0,S=r?v(n,x):f?v(n,0):void 0;x>w;w++)if((h||w in b)&&(d=b[w],y=m(d,w,g),t))if(r)S[w]=y;else if(y)switch(t){case 3:return!0;case 5:return d;case 6:return w;case 2:S.push(d)}else if(s)return!1;return l?-1:a||s?s:S}}},function(t,n,r){var e=r(1),i=r(52),o=r(4);t.exports=function(t,n){var r=(i.Object||{})[t]||Object[t],u={};u[t]=n(r),e(e.S+e.F*o(function(){r(1)}),"Object",u)}},function(t,n,r){var e=r(6);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(5),i=r(25),o=r(91),u=r(13),c="prototype",f=function(t,n,r){var a,s,l,h=t&f.F,v=t&f.G,p=t&f.S,d=t&f.P,y=t&f.B,g=t&f.W,b=v?i:i[n]||(i[n]={}),m=b[c],x=v?e:p?e[n]:(e[n]||{})[c];v&&(r=n);for(a in r)(s=!h&&x&&void 0!==x[a])&&a in b||(l=s?x[a]:r[a],b[a]=v&&"function"!=typeof x[a]?r[a]:y&&s?o(l,e):g&&x[a]==l?function(t){var n=function(n,r,e){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,r)}return new t(n,r,e)}return t.apply(this,arguments)};return n[c]=t[c],n}(l):d&&"function"==typeof l?o(Function.call,l):l,d&&((b.virtual||(b.virtual={}))[a]=l,t&f.R&&m&&!m[a]&&u(m,a,l)))};f.F=1,f.G=2,f.S=4,f.P=8,f.B=16,f.W=32,f.U=64,f.R=128,t.exports=f},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n,r){var e=r(26);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(183),i=r(1),o=r(126)("metadata"),u=o.store||(o.store=new(r(186))),c=function(t,n,r){var i=u.get(t);if(!i){if(!r)return;u.set(t,i=new e)}var o=i.get(n);if(!o){if(!r)return;i.set(n,o=new e)}return o},f=function(t,n,r){var e=c(n,r,!1);return void 0!==e&&e.has(t)},a=function(t,n,r){var e=c(n,r,!1);return void 0===e?void 0:e.get(t)},s=function(t,n,r,e){c(r,e,!0).set(t,n)},l=function(t,n){var r=c(t,n,!1),e=[];return r&&r.forEach(function(t,n){e.push(n)}),e},h=function(t){return void 0===t||"symbol"==typeof t?t:String(t)},v=function(t){i(i.S,"Reflect",t)};t.exports={store:u,map:c,has:f,get:a,set:s,keys:l,key:h,exp:v}},function(t,n,r){"use strict";if(r(10)){var e=r(69),i=r(3),o=r(4),u=r(1),c=r(127),f=r(152),a=r(53),s=r(68),l=r(66),h=r(27),v=r(73),p=r(67),d=r(16),y=r(75),g=r(50),b=r(24),m=r(180),x=r(114),w=r(6),S=r(17),_=r(137),O=r(70),E=r(32),P=r(71).f,j=r(154),F=r(76),M=r(7),A=r(48),N=r(117),T=r(146),I=r(155),k=r(80),L=r(123),R=r(74),C=r(130),D=r(160),U=r(11),W=r(31),G=U.f,B=W.f,V=i.RangeError,z=i.TypeError,q=i.Uint8Array,K="ArrayBuffer",J="Shared"+K,Y="BYTES_PER_ELEMENT",H="prototype",$=Array[H],X=f.ArrayBuffer,Q=f.DataView,Z=A(0),tt=A(2),nt=A(3),rt=A(4),et=A(5),it=A(6),ot=N(!0),ut=N(!1),ct=I.values,ft=I.keys,at=I.entries,st=$.lastIndexOf,lt=$.reduce,ht=$.reduceRight,vt=$.join,pt=$.sort,dt=$.slice,yt=$.toString,gt=$.toLocaleString,bt=M("iterator"),mt=M("toStringTag"),xt=F("typed_constructor"),wt=F("def_constructor"),St=c.CONSTR,_t=c.TYPED,Ot=c.VIEW,Et="Wrong length!",Pt=A(1,function(t,n){return Tt(T(t,t[wt]),n)}),jt=o(function(){return 1===new q(new Uint16Array([1]).buffer)[0]}),Ft=!!q&&!!q[H].set&&o(function(){new q(1).set({})}),Mt=function(t,n){if(void 0===t)throw z(Et);var r=+t,e=d(t);if(n&&!m(r,e))throw V(Et);return e},At=function(t,n){var r=p(t);if(r<0||r%n)throw V("Wrong offset!");return r},Nt=function(t){if(w(t)&&_t in t)return t;throw z(t+" is not a typed array!")},Tt=function(t,n){if(!(w(t)&&xt in t))throw z("It is not a typed array constructor!");return new t(n)},It=function(t,n){return kt(T(t,t[wt]),n)},kt=function(t,n){for(var r=0,e=n.length,i=Tt(t,e);e>r;)i[r]=n[r++];return i},Lt=function(t,n,r){G(t,n,{get:function(){return this._d[r]}})},Rt=function(t){var n,r,e,i,o,u,c=S(t),f=arguments.length,s=f>1?arguments[1]:void 0,l=void 0!==s,h=j(c);if(void 0!=h&&!_(h)){for(u=h.call(c),e=[],n=0;!(o=u.next()).done;n++)e.push(o.value);c=e}for(l&&f>2&&(s=a(s,arguments[2],2)),n=0,r=d(c.length),i=Tt(this,r);r>n;n++)i[n]=l?s(c[n],n):c[n];return i},Ct=function(){for(var t=0,n=arguments.length,r=Tt(this,n);n>t;)r[t]=arguments[t++];return r},Dt=!!q&&o(function(){gt.call(new q(1))}),Ut=function(){return gt.apply(Dt?dt.call(Nt(this)):Nt(this),arguments)},Wt={copyWithin:function(t,n){return D.call(Nt(this),t,n,arguments.length>2?arguments[2]:void 0)},every:function(t){return rt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return C.apply(Nt(this),arguments)},filter:function(t){return It(this,tt(Nt(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return et(Nt(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return it(Nt(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){Z(Nt(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return ut(Nt(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return ot(Nt(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return vt.apply(Nt(this),arguments)},lastIndexOf:function(t){return st.apply(Nt(this),arguments)},map:function(t){return Pt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return lt.apply(Nt(this),arguments)},reduceRight:function(t){return ht.apply(Nt(this),arguments)},reverse:function(){for(var t,n=this,r=Nt(n).length,e=Math.floor(r/2),i=0;i<e;)t=n[i],n[i++]=n[--r],n[r]=t;return n},some:function(t){return nt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return pt.call(Nt(this),t)},subarray:function(t,n){var r=Nt(this),e=r.length,i=y(t,e);return new(T(r,r[wt]))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,d((void 0===n?e:y(n,e))-i))}},Gt=function(t,n){return It(this,dt.call(Nt(this),t,n))},Bt=function(t){Nt(this);var n=At(arguments[1],1),r=this.length,e=S(t),i=d(e.length),o=0;if(i+n>r)throw V(Et);for(;o<i;)this[n+o]=e[o++]},Vt={entries:function(){return at.call(Nt(this))},keys:function(){return ft.call(Nt(this))},values:function(){return ct.call(Nt(this))}},zt=function(t,n){return w(t)&&t[_t]&&"symbol"!=typeof n&&n in t&&String(+n)==String(n)},qt=function(t,n){return zt(t,n=g(n,!0))?l(2,t[n]):B(t,n)},Kt=function(t,n,r){return!(zt(t,n=g(n,!0))&&w(r)&&b(r,"value"))||b(r,"get")||b(r,"set")||r.configurable||b(r,"writable")&&!r.writable||b(r,"enumerable")&&!r.enumerable?G(t,n,r):(t[n]=r.value,t)};St||(W.f=qt,U.f=Kt),u(u.S+u.F*!St,"Object",{getOwnPropertyDescriptor:qt,defineProperty:Kt}),o(function(){yt.call({})})&&(yt=gt=function(){return vt.call(this)});var Jt=v({},Wt);v(Jt,Vt),h(Jt,bt,Vt.values),v(Jt,{slice:Gt,set:Bt,constructor:function(){},toString:yt,toLocaleString:Ut}),Lt(Jt,"buffer","b"),Lt(Jt,"byteOffset","o"),Lt(Jt,"byteLength","l"),Lt(Jt,"length","e"),G(Jt,mt,{get:function(){return this[_t]}}),t.exports=function(t,n,r,f){f=!!f;var a=t+(f?"Clamped":"")+"Array",l="Uint8Array"!=a,v="get"+t,p="set"+t,y=i[a],g=y||{},b=y&&E(y),m=!y||!c.ABV,S={},_=y&&y[H],j=function(t,r){var e=t._d;return e.v[v](r*n+e.o,jt)},F=function(t,r,e){var i=t._d;f&&(e=(e=Math.round(e))<0?0:e>255?255:255&e),i.v[p](r*n+i.o,e,jt)},M=function(t,n){G(t,n,{get:function(){return j(this,n)},set:function(t){return F(this,n,t)},enumerable:!0})};m?(y=r(function(t,r,e,i){s(t,y,a,"_d");var o,u,c,f,l=0,v=0;if(w(r)){if(!(r instanceof X||(f=x(r))==K||f==J))return _t in r?kt(y,r):Rt.call(y,r);o=r,v=At(e,n);var p=r.byteLength;if(void 0===i){if(p%n)throw V(Et);if((u=p-v)<0)throw V(Et)}else if((u=d(i)*n)+v>p)throw V(Et);c=u/n}else c=Mt(r,!0),u=c*n,o=new X(u);for(h(t,"_d",{b:o,o:v,l:u,e:c,v:new Q(o)});l<c;)M(t,l++)}),_=y[H]=O(Jt),h(_,"constructor",y)):L(function(t){new y(null),new y(t)},!0)||(y=r(function(t,r,e,i){s(t,y,a);var o;return w(r)?r instanceof X||(o=x(r))==K||o==J?void 0!==i?new g(r,At(e,n),i):void 0!==e?new g(r,At(e,n)):new g(r):_t in r?kt(y,r):Rt.call(y,r):new g(Mt(r,l))}),Z(b!==Function.prototype?P(g).concat(P(b)):P(g),function(t){t in y||h(y,t,g[t])}),y[H]=_,e||(_.constructor=y));var A=_[bt],N=!!A&&("values"==A.name||void 0==A.name),T=Vt.values;h(y,xt,!0),h(_,_t,a),h(_,Ot,!0),h(_,wt,y),(f?new y(1)[mt]==a:mt in _)||G(_,mt,{get:function(){return a}}),S[a]=y,u(u.G+u.W+u.F*(y!=g),S),u(u.S,a,{BYTES_PER_ELEMENT:n,from:Rt,of:Ct}),Y in _||h(_,Y,n),u(u.P,a,Wt),R(a),u(u.P+u.F*Ft,a,{set:Bt}),u(u.P+u.F*!N,a,Vt),u(u.P+u.F*(_.toString!=yt),a,{toString:yt}),u(u.P+u.F*o(function(){new y(1).slice()}),a,{slice:Gt}),u(u.P+u.F*(o(function(){return[1,2].toLocaleString()!=new y([1,2]).toLocaleString()})||!o(function(){_.toLocaleString.call([1,2])})),a,{toLocaleString:Ut}),k[a]=N?A:T,e||N||h(_,bt,T)}}else t.exports=function(){}},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n,r){var e=r(21),i=r(5).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n,r){t.exports=!r(12)&&!r(18)(function(){return 7!=Object.defineProperty(r(57)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){"use strict";var e=r(36),i=r(51),o=r(64),u=r(13),c=r(8),f=r(35),a=r(96),s=r(38),l=r(103),h=r(15)("iterator"),v=!([].keys&&"next"in[].keys()),p="keys",d="values",y=function(){return this};t.exports=function(t,n,r,g,b,m,x){a(r,n,g);var w,S,_,O=function(t){if(!v&&t in F)return F[t];switch(t){case p:case d:return function(){return new r(this,t)}}return function(){return new r(this,t)}},E=n+" Iterator",P=b==d,j=!1,F=t.prototype,M=F[h]||F["@@iterator"]||b&&F[b],A=M||O(b),N=b?P?O("entries"):A:void 0,T="Array"==n?F.entries||M:M;if(T&&(_=l(T.call(new t)))!==Object.prototype&&(s(_,E,!0),e||c(_,h)||u(_,h,y)),P&&M&&M.name!==d&&(j=!0,A=function(){return M.call(this)}),e&&!x||!v&&!j&&F[h]||u(F,h,A),f[n]=A,f[E]=y,b)if(w={values:P?A:O(d),keys:m?A:O(p),entries:N},x)for(S in w)S in F||o(F,S,w[S]);else i(i.P+i.F*(v||j),n,w);return w}},function(t,n,r){var e=r(20),i=r(100),o=r(34),u=r(39)("IE_PROTO"),c=function(){},f="prototype",a=function(){var t,n=r(57)("iframe"),e=o.length;for(n.style.display="none",r(93).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;e--;)delete a[f][o[e]];return a()};t.exports=Object.create||function(t,n){var r;return null!==t?(c[f]=e(t),r=new c,c[f]=null,r[u]=t):r=a(),void 0===n?r:i(r,n)}},function(t,n,r){var e=r(63),i=r(34).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(8),i=r(9),o=r(90)(!1),u=r(39)("IE_PROTO");t.exports=function(t,n){var r,c=i(t),f=0,a=[];for(r in c)r!=u&&e(c,r)&&a.push(r);for(;n.length>f;)e(c,r=n[f++])&&(~o(a,r)||a.push(r));return a}},function(t,n,r){t.exports=r(13)},function(t,n,r){var e=r(76)("meta"),i=r(6),o=r(24),u=r(11).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(4)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},h=function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},v=function(t){return a&&p.NEED&&f(t)&&!o(t,e)&&s(t),t},p=t.exports={KEY:e,NEED:!1,fastKey:l,getWeak:h,onFreeze:v}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n){t.exports=function(t,n,r,e){if(!(t instanceof n)||void 0!==e&&e in t)throw TypeError(r+": incorrect invocation!");return t}},function(t,n){t.exports=!1},function(t,n,r){var e=r(2),i=r(173),o=r(133),u=r(145)("IE_PROTO"),c=function(){},f="prototype",a=function(){var t,n=r(132)("iframe"),e=o.length;for(n.style.display="none",r(135).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;e--;)delete a[f][o[e]];return a()};t.exports=Object.create||function(t,n){var r;return null!==t?(c[f]=e(t),r=new c,c[f]=null,r[u]=t):r=a(),void 0===n?r:i(r,n)}},function(t,n,r){var e=r(175),i=r(133).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n,r){var e=r(175),i=r(133);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(28);t.exports=function(t,n,r){for(var i in n)e(t,i,n[i],r);return t}},function(t,n,r){"use strict";var e=r(3),i=r(11),o=r(10),u=r(7)("species");t.exports=function(t){var n=e[t];o&&n&&!n[u]&&i.f(n,u,{configurable:!0,get:function(){return this}})}},function(t,n,r){var e=r(67),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n,r){var e=r(33);t.exports=function(t){return Object(e(t))}},function(t,n,r){var e=r(7)("unscopables"),i=Array.prototype;void 0==i[e]&&r(27)(i,e,{}),t.exports=function(t){i[e][t]=!0}},function(t,n,r){var e=r(53),i=r(169),o=r(137),u=r(2),c=r(16),f=r(154),a={},s={},n=t.exports=function(t,n,r,l,h){var v,p,d,y,g=h?function(){return t}:f(t),b=e(r,l,n?2:1),m=0;if("function"!=typeof g)throw TypeError(t+" is not iterable!");if(o(g)){for(v=c(t.length);v>m;m++)if((y=n?b(u(p=t[m])[0],p[1]):b(t[m]))===a||y===s)return y}else for(d=g.call(t);!(p=d.next()).done;)if((y=i(d,b,p.value,n))===a||y===s)return y};n.BREAK=a,n.RETURN=s},function(t,n){t.exports={}},function(t,n,r){var e=r(11).f,i=r(24),o=r(7)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(1),i=r(46),o=r(4),u=r(150),c="["+u+"]",f="â€‹Â…",a=RegExp("^"+c+c+"*"),s=RegExp(c+c+"*$"),l=function(t,n,r){var i={},c=o(function(){return!!u[t]()||f[t]()!=f}),a=i[t]=c?n(h):u[t];r&&(i[r]=a),e(e.P+e.F*c,"String",i)},h=l.trim=function(t,n){return t=String(i(t)),1&n&&(t=t.replace(a,"")),2&n&&(t=t.replace(s,"")),t};t.exports=l},function(t,n,r){t.exports={default:r(86),__esModule:!0}},function(t,n,r){t.exports={default:r(87),__esModule:!0}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var i=r(84),o=e(i),u=r(83),c=e(u),f="function"==typeof c.default&&"symbol"==typeof o.default?function(t){return typeof t}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":typeof t};n.default="function"==typeof c.default&&"symbol"===f(o.default)?function(t){return void 0===t?"undefined":f(t)}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":void 0===t?"undefined":f(t)}},function(t,n,r){r(110),r(108),r(111),r(112),t.exports=r(25).Symbol},function(t,n,r){r(109),r(113),t.exports=r(44).f("iterator")},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n){t.exports=function(){}},function(t,n,r){var e=r(9),i=r(106),o=r(105);t.exports=function(t){return function(n,r,u){var c,f=e(n),a=i(f.length),s=o(u,a);if(t&&r!=r){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===r)return t||s||0;return!t&&-1}}},function(t,n,r){var e=r(88);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(19),i=r(62),o=r(37);t.exports=function(t){var n=e(t),r=i.f;if(r)for(var u,c=r(t),f=o.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n,r){t.exports=r(5).document&&document.documentElement},function(t,n,r){var e=r(56);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n,r){var e=r(56);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(60),i=r(22),o=r(38),u={};r(13)(u,r(15)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,r){var e=r(19),i=r(9);t.exports=function(t,n){for(var r,o=i(t),u=e(o),c=u.length,f=0;c>f;)if(o[r=u[f++]]===n)return r}},function(t,n,r){var e=r(23)("meta"),i=r(21),o=r(8),u=r(14).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(18)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},h=function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},v=function(t){return a&&p.NEED&&f(t)&&!o(t,e)&&s(t),t},p=t.exports={KEY:e,NEED:!1,fastKey:l,getWeak:h,onFreeze:v}},function(t,n,r){var e=r(14),i=r(20),o=r(19);t.exports=r(12)?Object.defineProperties:function(t,n){i(t);for(var r,u=o(n),c=u.length,f=0;c>f;)e.f(t,r=u[f++],n[r]);return t}},function(t,n,r){var e=r(37),i=r(22),o=r(9),u=r(42),c=r(8),f=r(58),a=Object.getOwnPropertyDescriptor;n.f=r(12)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(9),i=r(61).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return i(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?c(t):i(e(t))}},function(t,n,r){var e=r(8),i=r(77),o=r(39)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,r){var e=r(41),i=r(33);t.exports=function(t){return function(n,r){var o,u,c=String(i(n)),f=e(r),a=c.length;return f<0||f>=a?t?"":void 0:(o=c.charCodeAt(f),o<55296||o>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):o:t?c.slice(f,f+2):u-56320+(o-55296<<10)+65536)}}},function(t,n,r){var e=r(41),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n,r){var e=r(41),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n,r){"use strict";var e=r(89),i=r(97),o=r(35),u=r(9);t.exports=r(59)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){},function(t,n,r){"use strict";var e=r(104)(!0);r(59)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";var e=r(5),i=r(8),o=r(12),u=r(51),c=r(64),f=r(99).KEY,a=r(18),s=r(40),l=r(38),h=r(23),v=r(15),p=r(44),d=r(43),y=r(98),g=r(92),b=r(95),m=r(20),x=r(9),w=r(42),S=r(22),_=r(60),O=r(102),E=r(101),P=r(14),j=r(19),F=E.f,M=P.f,A=O.f,N=e.Symbol,T=e.JSON,I=T&&T.stringify,k="prototype",L=v("_hidden"),R=v("toPrimitive"),C={}.propertyIsEnumerable,D=s("symbol-registry"),U=s("symbols"),W=s("op-symbols"),G=Object[k],B="function"==typeof N,V=e.QObject,z=!V||!V[k]||!V[k].findChild,q=o&&a(function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=F(G,n);e&&delete G[n],M(t,n,r),e&&t!==G&&M(G,n,e)}:M,K=function(t){var n=U[t]=_(N[k]);return n._k=t,n},J=B&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===G&&Y(W,n,r),m(t),n=w(n,!0),m(r),i(U,n)?(r.enumerable?(i(t,L)&&t[L][n]&&(t[L][n]=!1),r=_(r,{enumerable:S(0,!1)})):(i(t,L)||M(t,L,S(1,{})),t[L][n]=!0),q(t,n,r)):M(t,n,r)},H=function(t,n){m(t);for(var r,e=g(n=x(n)),i=0,o=e.length;o>i;)Y(t,r=e[i++],n[r]);return t},$=function(t,n){return void 0===n?_(t):H(_(t),n)},X=function(t){var n=C.call(this,t=w(t,!0));return!(this===G&&i(U,t)&&!i(W,t))&&(!(n||!i(this,t)||!i(U,t)||i(this,L)&&this[L][t])||n)},Q=function(t,n){if(t=x(t),n=w(n,!0),t!==G||!i(U,n)||i(W,n)){var r=F(t,n);return!r||!i(U,n)||i(t,L)&&t[L][n]||(r.enumerable=!0),r}},Z=function(t){for(var n,r=A(x(t)),e=[],o=0;r.length>o;)i(U,n=r[o++])||n==L||n==f||e.push(n);return e},tt=function(t){for(var n,r=t===G,e=A(r?W:x(t)),o=[],u=0;e.length>u;)!i(U,n=e[u++])||r&&!i(G,n)||o.push(U[n]);return o};B||(N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),n=function(r){this===G&&n.call(W,r),i(this,L)&&i(this[L],t)&&(this[L][t]=!1),q(this,t,S(1,r))};return o&&z&&q(G,t,{configurable:!0,set:n}),K(t)},c(N[k],"toString",function(){return this._k}),E.f=Q,P.f=Y,r(61).f=O.f=Z,r(37).f=X,r(62).f=tt,o&&!r(36)&&c(G,"propertyIsEnumerable",X,!0),p.f=function(t){return K(v(t))}),u(u.G+u.W+u.F*!B,{Symbol:N});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;nt.length>rt;)v(nt[rt++]);for(var nt=j(v.store),rt=0;nt.length>rt;)d(nt[rt++]);u(u.S+u.F*!B,"Symbol",{for:function(t){return i(D,t+="")?D[t]:D[t]=N(t)},keyFor:function(t){if(J(t))return y(D,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),u(u.S+u.F*!B,"Object",{create:$,defineProperty:Y,defineProperties:H,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),T&&u(u.S+u.F*(!B||a(function(){var t=N();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!J(t)){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);return n=e[1],"function"==typeof n&&(r=n),!r&&b(n)||(n=function(t,n){if(r&&(n=r.call(this,t,n)),!J(n))return n}),e[1]=n,I.apply(T,e)}}}),N[k][R]||r(13)(N[k],R,N[k].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){r(43)("asyncIterator")},function(t,n,r){r(43)("observable")},function(t,n,r){r(107);for(var e=r(5),i=r(13),o=r(35),u=r(15)("toStringTag"),c=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],f=0;f<5;f++){var a=c[f],s=e[a],l=s&&s.prototype;l&&!l[u]&&i(l,u,a),o[a]=o.Array}},function(t,n,r){var e=r(45),i=r(7)("toStringTag"),o="Arguments"==e(function(){return arguments}()),u=function(t,n){try{return t[n]}catch(t){}};t.exports=function(t){var n,r,c;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=u(n=Object(t),i))?r:o?e(n):"Object"==(c=e(n))&&"function"==typeof n.callee?"Arguments":c}},function(t,n,r){var e=r(45);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(30),i=r(16),o=r(75);t.exports=function(t){return function(n,r,u){var c,f=e(n),a=i(f.length),s=o(u,a);if(t&&r!=r){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===r)return t||s||0;return!t&&-1}}},function(t,n,r){"use strict";var e=r(3),i=r(1),o=r(28),u=r(73),c=r(65),f=r(79),a=r(68),s=r(6),l=r(4),h=r(123),v=r(81),p=r(136);t.exports=function(t,n,r,d,y,g){var b=e[t],m=b,x=y?"set":"add",w=m&&m.prototype,S={},_=function(t){var n=w[t];o(w,t,"delete"==t?function(t){return!(g&&!s(t))&&n.call(this,0===t?0:t)}:"has"==t?function(t){return!(g&&!s(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return g&&!s(t)?void 0:n.call(this,0===t?0:t)}:"add"==t?function(t){return n.call(this,0===t?0:t),this}:function(t,r){return n.call(this,0===t?0:t,r),this})};if("function"==typeof m&&(g||w.forEach&&!l(function(){(new m).entries().next()}))){var O=new m,E=O[x](g?{}:-0,1)!=O,P=l(function(){O.has(1)}),j=h(function(t){new m(t)}),F=!g&&l(function(){for(var t=new m,n=5;n--;)t[x](n,n);return!t.has(-0)});j||(m=n(function(n,r){a(n,m,t);var e=p(new b,n,m);return void 0!=r&&f(r,y,e[x],e),e}),m.prototype=w,w.constructor=m),(P||F)&&(_("delete"),_("has"),y&&_("get")),(F||E)&&_(x),g&&w.clear&&delete w.clear}else m=d.getConstructor(n,t,y,x),u(m.prototype,r),c.NEED=!0;return v(m,t),S[t]=m,i(i.G+i.W+i.F*(m!=b),S),g||d.setStrong(m,t,y),m}},function(t,n,r){"use strict";var e=r(27),i=r(28),o=r(4),u=r(46),c=r(7);t.exports=function(t,n,r){var f=c(t),a=r(u,f,""[t]),s=a[0],l=a[1];o(function(){var n={};return n[f]=function(){return 7},7!=""[t](n)})&&(i(String.prototype,t,s),e(RegExp.prototype,f,2==n?function(t,n){return l.call(t,this,n)}:function(t){return l.call(t,this)}))}
},function(t,n,r){"use strict";var e=r(2);t.exports=function(){var t=e(this),n="";return t.global&&(n+="g"),t.ignoreCase&&(n+="i"),t.multiline&&(n+="m"),t.unicode&&(n+="u"),t.sticky&&(n+="y"),n}},function(t,n){t.exports=function(t,n,r){var e=void 0===r;switch(n.length){case 0:return e?t():t.call(r);case 1:return e?t(n[0]):t.call(r,n[0]);case 2:return e?t(n[0],n[1]):t.call(r,n[0],n[1]);case 3:return e?t(n[0],n[1],n[2]):t.call(r,n[0],n[1],n[2]);case 4:return e?t(n[0],n[1],n[2],n[3]):t.call(r,n[0],n[1],n[2],n[3])}return t.apply(r,n)}},function(t,n,r){var e=r(6),i=r(45),o=r(7)("match");t.exports=function(t){var n;return e(t)&&(void 0!==(n=t[o])?!!n:"RegExp"==i(t))}},function(t,n,r){var e=r(7)("iterator"),i=!1;try{var o=[7][e]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(t){}t.exports=function(t,n){if(!n&&!i)return!1;var r=!1;try{var o=[7],u=o[e]();u.next=function(){return{done:r=!0}},o[e]=function(){return u},t(o)}catch(t){}return r}},function(t,n,r){t.exports=r(69)||!r(4)(function(){var t=Math.random();__defineSetter__.call(null,t,function(){}),delete r(3)[t]})},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(3),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n,r){for(var e,i=r(3),o=r(27),u=r(76),c=u("typed_array"),f=u("view"),a=!(!i.ArrayBuffer||!i.DataView),s=a,l=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");l<9;)(e=i[h[l++]])?(o(e.prototype,c,!0),o(e.prototype,f,!0)):s=!1;t.exports={ABV:a,CONSTR:s,TYPED:c,VIEW:f}},function(t,n){"use strict";var r={versions:function(){var t=window.navigator.userAgent;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&-1==t.indexOf("KHTML"),mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1||t.indexOf("Mac")>-1,iPad:t.indexOf("iPad")>-1,webApp:-1==t.indexOf("Safari"),weixin:-1==t.indexOf("MicroMessenger")}}()};t.exports=r},function(t,n,r){"use strict";var e=r(85),i=function(t){return t&&t.__esModule?t:{default:t}}(e),o=function(){function t(t,n,e){return n||e?String.fromCharCode(n||e):r[t]||t}function n(t){return e[t]}var r={"&quot;":'"',"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" "},e={};for(var u in r)e[r[u]]=u;return r["&apos;"]="'",e["'"]="&#39;",{encode:function(t){return t?(""+t).replace(/['<> "&]/g,n).replace(/\r?\n/g,"<br/>").replace(/\s/g,"&nbsp;"):""},decode:function(n){return n?(""+n).replace(/<br\s*\/?>/gi,"\n").replace(/&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g,t).replace(/\u00a0/g," "):""},encodeBase16:function(t){if(!t)return t;t+="";for(var n=[],r=0,e=t.length;e>r;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},encodeBase16forJSON:function(t){if(!t)return t;t=t.replace(/[\u4E00-\u9FBF]/gi,function(t){return escape(t).replace("%u","\\u")});for(var n=[],r=0,e=t.length;e>r;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},decodeBase16:function(t){if(!t)return t;t+="";for(var n=[],r=0,e=t.length;e>r;r+=2)n.push(String.fromCharCode("0x"+t.slice(r,r+2)));return n.join("")},encodeObject:function(t){if(t instanceof Array)for(var n=0,r=t.length;r>n;n++)t[n]=o.encodeObject(t[n]);else if("object"==(void 0===t?"undefined":(0,i.default)(t)))for(var e in t)t[e]=o.encodeObject(t[e]);else if("string"==typeof t)return o.encode(t);return t},loadScript:function(t){var n=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(n),n.setAttribute("src",t)},addLoadEvent:function(t){var n=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){n(),t()}}}}();t.exports=o},function(t,n,r){"use strict";var e=r(17),i=r(75),o=r(16);t.exports=function(t){for(var n=e(this),r=o(n.length),u=arguments.length,c=i(u>1?arguments[1]:void 0,r),f=u>2?arguments[2]:void 0,a=void 0===f?r:i(f,r);a>c;)n[c++]=t;return n}},function(t,n,r){"use strict";var e=r(11),i=r(66);t.exports=function(t,n,r){n in t?e.f(t,n,i(0,r)):t[n]=r}},function(t,n,r){var e=r(6),i=r(3).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n,r){var e=r(7)("match");t.exports=function(t){var n=/./;try{"/./"[t](n)}catch(r){try{return n[e]=!1,!"/./"[t](n)}catch(t){}}return!0}},function(t,n,r){t.exports=r(3).document&&document.documentElement},function(t,n,r){var e=r(6),i=r(144).set;t.exports=function(t,n,r){var o,u=n.constructor;return u!==r&&"function"==typeof u&&(o=u.prototype)!==r.prototype&&e(o)&&i&&i(t,o),t}},function(t,n,r){var e=r(80),i=r(7)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(e.Array===t||o[i]===t)}},function(t,n,r){var e=r(45);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(70),i=r(66),o=r(81),u={};r(27)(u,r(7)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n,r){"use strict";var e=r(69),i=r(1),o=r(28),u=r(27),c=r(24),f=r(80),a=r(139),s=r(81),l=r(32),h=r(7)("iterator"),v=!([].keys&&"next"in[].keys()),p="keys",d="values",y=function(){return this};t.exports=function(t,n,r,g,b,m,x){a(r,n,g);var w,S,_,O=function(t){if(!v&&t in F)return F[t];switch(t){case p:case d:return function(){return new r(this,t)}}return function(){return new r(this,t)}},E=n+" Iterator",P=b==d,j=!1,F=t.prototype,M=F[h]||F["@@iterator"]||b&&F[b],A=M||O(b),N=b?P?O("entries"):A:void 0,T="Array"==n?F.entries||M:M;if(T&&(_=l(T.call(new t)))!==Object.prototype&&(s(_,E,!0),e||c(_,h)||u(_,h,y)),P&&M&&M.name!==d&&(j=!0,A=function(){return M.call(this)}),e&&!x||!v&&!j&&F[h]||u(F,h,A),f[n]=A,f[E]=y,b)if(w={values:P?A:O(d),keys:m?A:O(p),entries:N},x)for(S in w)S in F||o(F,S,w[S]);else i(i.P+i.F*(v||j),n,w);return w}},function(t,n){var r=Math.expm1;t.exports=!r||r(10)>22025.465794806718||r(10)<22025.465794806718||-2e-17!=r(-2e-17)?function(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:Math.exp(t)-1}:r},function(t,n){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},function(t,n,r){var e=r(3),i=r(151).set,o=e.MutationObserver||e.WebKitMutationObserver,u=e.process,c=e.Promise,f="process"==r(45)(u);t.exports=function(){var t,n,r,a=function(){var e,i;for(f&&(e=u.domain)&&e.exit();t;){i=t.fn,t=t.next;try{i()}catch(e){throw t?r():n=void 0,e}}n=void 0,e&&e.enter()};if(f)r=function(){u.nextTick(a)};else if(o){var s=!0,l=document.createTextNode("");new o(a).observe(l,{characterData:!0}),r=function(){l.data=s=!s}}else if(c&&c.resolve){var h=c.resolve();r=function(){h.then(a)}}else r=function(){i.call(e,a)};return function(e){var i={fn:e,next:void 0};n&&(n.next=i),t||(t=i,r()),n=i}}},function(t,n,r){var e=r(6),i=r(2),o=function(t,n){if(i(t),!e(n)&&null!==n)throw TypeError(n+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,n,e){try{e=r(53)(Function.call,r(31).f(Object.prototype,"__proto__").set,2),e(t,[]),n=!(t instanceof Array)}catch(t){n=!0}return function(t,r){return o(t,r),n?t.__proto__=r:e(t,r),t}}({},!1):void 0),check:o}},function(t,n,r){var e=r(126)("keys"),i=r(76);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(2),i=r(26),o=r(7)("species");t.exports=function(t,n){var r,u=e(t).constructor;return void 0===u||void 0==(r=e(u)[o])?n:i(r)}},function(t,n,r){var e=r(67),i=r(46);t.exports=function(t){return function(n,r){var o,u,c=String(i(n)),f=e(r),a=c.length;return f<0||f>=a?t?"":void 0:(o=c.charCodeAt(f),o<55296||o>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):o:t?c.slice(f,f+2):u-56320+(o-55296<<10)+65536)}}},function(t,n,r){var e=r(122),i=r(46);t.exports=function(t,n,r){if(e(n))throw TypeError("String#"+r+" doesn't accept regex!");return String(i(t))}},function(t,n,r){"use strict";var e=r(67),i=r(46);t.exports=function(t){var n=String(i(this)),r="",o=e(t);if(o<0||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(n+=n))1&o&&(r+=n);return r}},function(t,n){t.exports="\t\n\v\f\r Â áš€á â€€â€â€‚â€ƒâ€„â€…â€†â€‡â€ˆâ€‰â€Šâ€¯âŸã€€\u2028\u2029\ufeff"},function(t,n,r){var e,i,o,u=r(53),c=r(121),f=r(135),a=r(132),s=r(3),l=s.process,h=s.setImmediate,v=s.clearImmediate,p=s.MessageChannel,d=0,y={},g="onreadystatechange",b=function(){var t=+this;if(y.hasOwnProperty(t)){var n=y[t];delete y[t],n()}},m=function(t){b.call(t.data)};h&&v||(h=function(t){for(var n=[],r=1;arguments.length>r;)n.push(arguments[r++]);return y[++d]=function(){c("function"==typeof t?t:Function(t),n)},e(d),d},v=function(t){delete y[t]},"process"==r(45)(l)?e=function(t){l.nextTick(u(b,t,1))}:p?(i=new p,o=i.port2,i.port1.onmessage=m,e=u(o.postMessage,o,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts?(e=function(t){s.postMessage(t+"","*")},s.addEventListener("message",m,!1)):e=g in a("script")?function(t){f.appendChild(a("script"))[g]=function(){f.removeChild(this),b.call(t)}}:function(t){setTimeout(u(b,t,1),0)}),t.exports={set:h,clear:v}},function(t,n,r){"use strict";var e=r(3),i=r(10),o=r(69),u=r(127),c=r(27),f=r(73),a=r(4),s=r(68),l=r(67),h=r(16),v=r(71).f,p=r(11).f,d=r(130),y=r(81),g="ArrayBuffer",b="DataView",m="prototype",x="Wrong length!",w="Wrong index!",S=e[g],_=e[b],O=e.Math,E=e.RangeError,P=e.Infinity,j=S,F=O.abs,M=O.pow,A=O.floor,N=O.log,T=O.LN2,I="buffer",k="byteLength",L="byteOffset",R=i?"_b":I,C=i?"_l":k,D=i?"_o":L,U=function(t,n,r){var e,i,o,u=Array(r),c=8*r-n-1,f=(1<<c)-1,a=f>>1,s=23===n?M(2,-24)-M(2,-77):0,l=0,h=t<0||0===t&&1/t<0?1:0;for(t=F(t),t!=t||t===P?(i=t!=t?1:0,e=f):(e=A(N(t)/T),t*(o=M(2,-e))<1&&(e--,o*=2),t+=e+a>=1?s/o:s*M(2,1-a),t*o>=2&&(e++,o/=2),e+a>=f?(i=0,e=f):e+a>=1?(i=(t*o-1)*M(2,n),e+=a):(i=t*M(2,a-1)*M(2,n),e=0));n>=8;u[l++]=255&i,i/=256,n-=8);for(e=e<<n|i,c+=n;c>0;u[l++]=255&e,e/=256,c-=8);return u[--l]|=128*h,u},W=function(t,n,r){var e,i=8*r-n-1,o=(1<<i)-1,u=o>>1,c=i-7,f=r-1,a=t[f--],s=127&a;for(a>>=7;c>0;s=256*s+t[f],f--,c-=8);for(e=s&(1<<-c)-1,s>>=-c,c+=n;c>0;e=256*e+t[f],f--,c-=8);if(0===s)s=1-u;else{if(s===o)return e?NaN:a?-P:P;e+=M(2,n),s-=u}return(a?-1:1)*e*M(2,s-n)},G=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},B=function(t){return[255&t]},V=function(t){return[255&t,t>>8&255]},z=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},q=function(t){return U(t,52,8)},K=function(t){return U(t,23,4)},J=function(t,n,r){p(t[m],n,{get:function(){return this[r]}})},Y=function(t,n,r,e){var i=+r,o=l(i);if(i!=o||o<0||o+n>t[C])throw E(w);var u=t[R]._b,c=o+t[D],f=u.slice(c,c+n);return e?f:f.reverse()},H=function(t,n,r,e,i,o){var u=+r,c=l(u);if(u!=c||c<0||c+n>t[C])throw E(w);for(var f=t[R]._b,a=c+t[D],s=e(+i),h=0;h<n;h++)f[a+h]=s[o?h:n-h-1]},$=function(t,n){s(t,S,g);var r=+n,e=h(r);if(r!=e)throw E(x);return e};if(u.ABV){if(!a(function(){new S})||!a(function(){new S(.5)})){S=function(t){return new j($(this,t))};for(var X,Q=S[m]=j[m],Z=v(j),tt=0;Z.length>tt;)(X=Z[tt++])in S||c(S,X,j[X]);o||(Q.constructor=S)}var nt=new _(new S(2)),rt=_[m].setInt8;nt.setInt8(0,2147483648),nt.setInt8(1,2147483649),!nt.getInt8(0)&&nt.getInt8(1)||f(_[m],{setInt8:function(t,n){rt.call(this,t,n<<24>>24)},setUint8:function(t,n){rt.call(this,t,n<<24>>24)}},!0)}else S=function(t){var n=$(this,t);this._b=d.call(Array(n),0),this[C]=n},_=function(t,n,r){s(this,_,b),s(t,S,b);var e=t[C],i=l(n);if(i<0||i>e)throw E("Wrong offset!");if(r=void 0===r?e-i:h(r),i+r>e)throw E(x);this[R]=t,this[D]=i,this[C]=r},i&&(J(S,k,"_l"),J(_,I,"_b"),J(_,k,"_l"),J(_,L,"_o")),f(_[m],{getInt8:function(t){return Y(this,1,t)[0]<<24>>24},getUint8:function(t){return Y(this,1,t)[0]},getInt16:function(t){var n=Y(this,2,t,arguments[1]);return(n[1]<<8|n[0])<<16>>16},getUint16:function(t){var n=Y(this,2,t,arguments[1]);return n[1]<<8|n[0]},getInt32:function(t){return G(Y(this,4,t,arguments[1]))},getUint32:function(t){return G(Y(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return W(Y(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return W(Y(this,8,t,arguments[1]),52,8)},setInt8:function(t,n){H(this,1,t,B,n)},setUint8:function(t,n){H(this,1,t,B,n)},setInt16:function(t,n){H(this,2,t,V,n,arguments[2])},setUint16:function(t,n){H(this,2,t,V,n,arguments[2])},setInt32:function(t,n){H(this,4,t,z,n,arguments[2])},setUint32:function(t,n){H(this,4,t,z,n,arguments[2])},setFloat32:function(t,n){H(this,4,t,K,n,arguments[2])},setFloat64:function(t,n){H(this,8,t,q,n,arguments[2])}});y(S,g),y(_,b),c(_[m],u.VIEW,!0),n[g]=S,n[b]=_},function(t,n,r){var e=r(3),i=r(52),o=r(69),u=r(182),c=r(11).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){var e=r(114),i=r(7)("iterator"),o=r(80);t.exports=r(52).getIteratorMethod=function(t){if(void 0!=t)return t[i]||t["@@iterator"]||o[e(t)]}},function(t,n,r){"use strict";var e=r(78),i=r(170),o=r(80),u=r(30);t.exports=r(140)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){function r(t,n){t.classList?t.classList.add(n):t.className+=" "+n}t.exports=r},function(t,n){function r(t,n){if(t.classList)t.classList.remove(n);else{var r=new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(r," ")}}t.exports=r},function(t,n){function r(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function i(t){if(s===setTimeout)return setTimeout(t,0);if((s===r||!s)&&setTimeout)return s=setTimeout,setTimeout(t,0);try{return s(t,0)}catch(n){try{return s.call(null,t,0)}catch(n){return s.call(this,t,0)}}}function o(t){if(l===clearTimeout)return clearTimeout(t);if((l===e||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(n){try{return l.call(null,t)}catch(n){return l.call(this,t)}}}function u(){d&&v&&(d=!1,v.length?p=v.concat(p):y=-1,p.length&&c())}function c(){if(!d){var t=i(u);d=!0;for(var n=p.length;n;){for(v=p,p=[];++y<n;)v&&v[y].run();y=-1,n=p.length}v=null,d=!1,o(t)}}function f(t,n){this.fun=t,this.array=n}function a(){}var s,l,h=t.exports={};!function(){try{s="function"==typeof setTimeout?setTimeout:r}catch(t){s=r}try{l="function"==typeof clearTimeout?clearTimeout:e}catch(t){l=e}}();var v,p=[],d=!1,y=-1;h.nextTick=function(t){var n=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)n[r-1]=arguments[r];p.push(new f(t,n)),1!==p.length||d||i(c)},f.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=a,h.addListener=a,h.once=a,h.off=a,h.removeListener=a,h.removeAllListeners=a,h.emit=a,h.prependListener=a,h.prependOnceListener=a,h.listeners=function(t){return[]},h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(t,n,r){var e=r(45);t.exports=function(t,n){if("number"!=typeof t&&"Number"!=e(t))throw TypeError(n);return+t}},function(t,n,r){"use strict";var e=r(17),i=r(75),o=r(16);t.exports=[].copyWithin||function(t,n){var r=e(this),u=o(r.length),c=i(t,u),f=i(n,u),a=arguments.length>2?arguments[2]:void 0,s=Math.min((void 0===a?u:i(a,u))-f,u-c),l=1;for(f<c&&c<f+s&&(l=-1,f+=s-1,c+=s-1);s-- >0;)f in r?r[c]=r[f]:delete r[c],c+=l,f+=l;return r}},function(t,n,r){var e=r(79);t.exports=function(t,n){var r=[];return e(t,!1,r.push,r,n),r}},function(t,n,r){var e=r(26),i=r(17),o=r(115),u=r(16);t.exports=function(t,n,r,c,f){e(n);var a=i(t),s=o(a),l=u(a.length),h=f?l-1:0,v=f?-1:1;if(r<2)for(;;){if(h in s){c=s[h],h+=v;break}if(h+=v,f?h<0:l<=h)throw TypeError("Reduce of empty array with no initial value")}for(;f?h>=0:l>h;h+=v)h in s&&(c=n(c,s[h],h,a));return c}},function(t,n,r){"use strict";var e=r(26),i=r(6),o=r(121),u=[].slice,c={},f=function(t,n,r){if(!(n in c)){for(var e=[],i=0;i<n;i++)e[i]="a["+i+"]";c[n]=Function("F,a","return new F("+e.join(",")+")")}return c[n](t,r)};t.exports=Function.bind||function(t){var n=e(this),r=u.call(arguments,1),c=function(){var e=r.concat(u.call(arguments));return this instanceof c?f(n,e.length,e):o(n,e,t)};return i(n.prototype)&&(c.prototype=n.prototype),c}},function(t,n,r){"use strict";var e=r(11).f,i=r(70),o=r(73),u=r(53),c=r(68),f=r(46),a=r(79),s=r(140),l=r(170),h=r(74),v=r(10),p=r(65).fastKey,d=v?"_s":"size",y=function(t,n){var r,e=p(n);if("F"!==e)return t._i[e];for(r=t._f;r;r=r.n)if(r.k==n)return r};t.exports={getConstructor:function(t,n,r,s){var l=t(function(t,e){c(t,l,n,"_i"),t._i=i(null),t._f=void 0,t._l=void 0,t[d]=0,void 0!=e&&a(e,r,t[s],t)});return o(l.prototype,{clear:function(){for(var t=this,n=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];t._f=t._l=void 0,t[d]=0},delete:function(t){var n=this,r=y(n,t);if(r){var e=r.n,i=r.p;delete n._i[r.i],r.r=!0,i&&(i.n=e),e&&(e.p=i),n._f==r&&(n._f=e),n._l==r&&(n._l=i),n[d]--}return!!r},forEach:function(t){c(this,l,"forEach");for(var n,r=u(t,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!y(this,t)}}),v&&e(l.prototype,"size",{get:function(){return f(this[d])}}),l},def:function(t,n,r){var e,i,o=y(t,n);return o?o.v=r:(t._l=o={i:i=p(n,!0),k:n,v:r,p:e=t._l,n:void 0,r:!1},t._f||(t._f=o),e&&(e.n=o),t[d]++,"F"!==i&&(t._i[i]=o)),t},getEntry:y,setStrong:function(t,n,r){s(t,n,function(t,n){this._t=t,this._k=n,this._l=void 0},function(){for(var t=this,n=t._k,r=t._l;r&&r.r;)r=r.p;return t._t&&(t._l=r=r?r.n:t._t._f)?"keys"==n?l(0,r.k):"values"==n?l(0,r.v):l(0,[r.k,r.v]):(t._t=void 0,l(1))},r?"entries":"values",!r,!0),h(n)}}},function(t,n,r){var e=r(114),i=r(161);t.exports=function(t){return function(){if(e(this)!=t)throw TypeError(t+"#toJSON isn't generic");return i(this)}}},function(t,n,r){"use strict";var e=r(73),i=r(65).getWeak,o=r(2),u=r(6),c=r(68),f=r(79),a=r(48),s=r(24),l=a(5),h=a(6),v=0,p=function(t){return t._l||(t._l=new d)},d=function(){this.a=[]},y=function(t,n){return l(t.a,function(t){return t[0]===n})};d.prototype={get:function(t){var n=y(this,t);if(n)return n[1]},has:function(t){return!!y(this,t)},set:function(t,n){var r=y(this,t);r?r[1]=n:this.a.push([t,n])},delete:function(t){var n=h(this.a,function(n){return n[0]===t});return~n&&this.a.splice(n,1),!!~n}},t.exports={getConstructor:function(t,n,r,o){var a=t(function(t,e){c(t,a,n,"_i"),t._i=v++,t._l=void 0,void 0!=e&&f(e,r,t[o],t)});return e(a.prototype,{delete:function(t){if(!u(t))return!1;var n=i(t);return!0===n?p(this).delete(t):n&&s(n,this._i)&&delete n[this._i]},has:function(t){if(!u(t))return!1;var n=i(t);return!0===n?p(this).has(t):n&&s(n,this._i)}}),a},def:function(t,n,r){var e=i(o(n),!0);return!0===e?p(t).set(n,r):e[t._i]=r,t},ufstore:p}},function(t,n,r){t.exports=!r(10)&&!r(4)(function(){return 7!=Object.defineProperty(r(132)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(6),i=Math.floor;t.exports=function(t){return!e(t)&&isFinite(t)&&i(t)===t}},function(t,n,r){var e=r(2);t.exports=function(t,n,r,i){try{return i?n(e(r)[0],r[1]):n(r)}catch(n){var o=t.return;throw void 0!==o&&e(o.call(t)),n}}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n){t.exports=Math.log1p||function(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(t,n,r){"use strict";var e=r(72),i=r(125),o=r(116),u=r(17),c=r(115),f=Object.assign;t.exports=!f||r(4)(function(){var t={},n={},r=Symbol(),e="abcdefghijklmnopqrst";return t[r]=7,e.split("").forEach(function(t){n[t]=t}),7!=f({},t)[r]||Object.keys(f({},n)).join("")!=e})?function(t,n){for(var r=u(t),f=arguments.length,a=1,s=i.f,l=o.f;f>a;)for(var h,v=c(arguments[a++]),p=s?e(v).concat(s(v)):e(v),d=p.length,y=0;d>y;)l.call(v,h=p[y++])&&(r[h]=v[h]);return r}:f},function(t,n,r){var e=r(11),i=r(2),o=r(72);t.exports=r(10)?Object.defineProperties:function(t,n){i(t);for(var r,u=o(n),c=u.length,f=0;c>f;)e.f(t,r=u[f++],n[r]);return t}},function(t,n,r){var e=r(30),i=r(71).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return i(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?c(t):i(e(t))}},function(t,n,r){var e=r(24),i=r(30),o=r(117)(!1),u=r(145)("IE_PROTO");t.exports=function(t,n){var r,c=i(t),f=0,a=[];for(r in c)r!=u&&e(c,r)&&a.push(r);for(;n.length>f;)e(c,r=n[f++])&&(~o(a,r)||a.push(r));return a}},function(t,n,r){var e=r(72),i=r(30),o=r(116).f;t.exports=function(t){return function(n){for(var r,u=i(n),c=e(u),f=c.length,a=0,s=[];f>a;)o.call(u,r=c[a++])&&s.push(t?[r,u[r]]:u[r]);return s}}},function(t,n,r){var e=r(71),i=r(125),o=r(2),u=r(3).Reflect;t.exports=u&&u.ownKeys||function(t){var n=e.f(o(t)),r=i.f;return r?n.concat(r(t)):n}},function(t,n,r){var e=r(3).parseFloat,i=r(82).trim;t.exports=1/e(r(150)+"-0")!=-1/0?function(t){var n=i(String(t),3),r=e(n);return 0===r&&"-"==n.charAt(0)?-0:r}:e},function(t,n,r){var e=r(3).parseInt,i=r(82).trim,o=r(150),u=/^[\-+]?0[xX]/;t.exports=8!==e(o+"08")||22!==e(o+"0x16")?function(t,n){var r=i(String(t),3);return e(r,n>>>0||(u.test(r)?16:10))}:e},function(t,n){t.exports=Object.is||function(t,n){return t===n?0!==t||1/t==1/n:t!=t&&n!=n}},function(t,n,r){var e=r(16),i=r(149),o=r(46);t.exports=function(t,n,r,u){var c=String(o(t)),f=c.length,a=void 0===r?" ":String(r),s=e(n);if(s<=f||""==a)return c;var l=s-f,h=i.call(a,Math.ceil(l/a.length));return h.length>l&&(h=h.slice(0,l)),u?h+c:c+h}},function(t,n,r){n.f=r(7)},function(t,n,r){"use strict";var e=r(164);t.exports=r(118)("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var n=e.getEntry(this,t);return n&&n.v},set:function(t,n){return e.def(this,0===t?0:t,n)}},e,!0)},function(t,n,r){r(10)&&"g"!=/./g.flags&&r(11).f(RegExp.prototype,"flags",{configurable:!0,get:r(120)})},function(t,n,r){"use strict";var e=r(164);t.exports=r(118)("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return e.def(this,t=0===t?0:t,t)}},e)},function(t,n,r){"use strict";var e,i=r(48)(0),o=r(28),u=r(65),c=r(172),f=r(166),a=r(6),s=u.getWeak,l=Object.isExtensible,h=f.ufstore,v={},p=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},d={get:function(t){if(a(t)){var n=s(t);return!0===n?h(this).get(t):n?n[this._i]:void 0}},set:function(t,n){return f.def(this,t,n)}},y=t.exports=r(118)("WeakMap",p,d,f,!0,!0);7!=(new y).set((Object.freeze||Object)(v),7).get(v)&&(e=f.getConstructor(p),c(e.prototype,d),u.NEED=!0,i(["delete","has","get","set"],function(t){var n=y.prototype,r=n[t];o(n,t,function(n,i){if(a(n)&&!l(n)){this._f||(this._f=new e);var o=this._f[t](n,i);return"set"==t?this:o}return r.call(this,n,i)})}))},,,,function(t,n){"use strict";function r(){var t=document.querySelector("#page-nav");if(t&&!document.querySelector("#page-nav .extend.prev")&&(t.innerHTML='<a class="extend prev disabled" rel="prev">ä¸Šä¸€é¡µ</a>'+t.innerHTML),t&&!document.querySelector("#page-nav .extend.next")&&(t.innerHTML=t.innerHTML+'<a class="extend next disabled" rel="next">ä¸‹ä¸€é¡µ</a>'),yiliaConfig&&yiliaConfig.open_in_new){document.querySelectorAll(".article-entry a:not(.article-more-a)").forEach(function(t){var n=t.getAttribute("target");n&&""!==n||t.setAttribute("target","_blank")})}if(yiliaConfig&&yiliaConfig.toc_hide_index){document.querySelectorAll(".toc-number").forEach(function(t){t.style.display="none"})}var n=document.querySelector("#js-aboutme");n&&0!==n.length&&(n.innerHTML=n.innerText)}t.exports={init:r}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}function i(t,n){var r=/\/|index.html/g;return t.replace(r,"")===n.replace(r,"")}function o(){for(var t=document.querySelectorAll(".js-header-menu li a"),n=window.location.pathname,r=0,e=t.length;r<e;r++){var o=t[r];i(n,o.getAttribute("href"))&&(0,h.default)(o,"active")}}function u(t){for(var n=t.offsetLeft,r=t.offsetParent;null!==r;)n+=r.offsetLeft,r=r.offsetParent;return n}function c(t){for(var n=t.offsetTop,r=t.offsetParent;null!==r;)n+=r.offsetTop,r=r.offsetParent;return n}function f(t,n,r,e,i){var o=u(t),f=c(t)-n;if(f-r<=i){var a=t.$newDom;a||(a=t.cloneNode(!0),(0,d.default)(t,a),t.$newDom=a,a.style.position="fixed",a.style.top=(r||f)+"px",a.style.left=o+"px",a.style.zIndex=e||2,a.style.width="100%",a.style.color="#fff"),a.style.visibility="visible",t.style.visibility="hidden"}else{t.style.visibility="visible";var s=t.$newDom;s&&(s.style.visibility="hidden")}}function a(){var t=document.querySelector(".js-overlay"),n=document.querySelector(".js-header-menu");f(t,document.body.scrollTop,-63,2,0),f(n,document.body.scrollTop,1,3,0)}function s(){document.querySelector("#container").addEventListener("scroll",function(t){a()}),window.addEventListener("scroll",function(t){a()}),a()}var l=r(156),h=e(l),v=r(157),p=(e(v),r(382)),d=e(p),y=r(128),g=e(y),b=r(190),m=e(b),x=r(129);(function(){g.default.versions.mobile&&window.screen.width<800&&(o(),s())})(),(0,x.addLoadEvent)(function(){m.default.init()}),t.exports={}},,,,function(t,n,r){(function(t){"use strict";function n(t,n,r){t[n]||Object[e](t,n,{writable:!0,configurable:!0,value:r})}if(r(381),r(391),r(198),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;var e="defineProperty";n(String.prototype,"padLeft","".padStart),n(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&n(Array,t,Function.call.bind([][t]))})}).call(n,function(){return this}())},,,function(t,n,r){r(210),t.exports=r(52).RegExp.escape},,,,function(t,n,r){var e=r(6),i=r(138),o=r(7)("species");t.exports=function(t){var n;return i(t)&&(n=t.constructor,"function"!=typeof n||n!==Array&&!i(n.prototype)||(n=void 0),e(n)&&null===(n=n[o])&&(n=void 0)),void 0===n?Array:n}},function(t,n,r){var e=r(202);t.exports=function(t,n){return new(e(t))(n)}},function(t,n,r){"use strict";var e=r(2),i=r(50),o="number";t.exports=function(t){if("string"!==t&&t!==o&&"default"!==t)throw TypeError("Incorrect hint");return i(e(this),t!=o)}},function(t,n,r){var e=r(72),i=r(125),o=r(116);t.exports=function(t){var n=e(t),r=i.f;if(r)for(var u,c=r(t),f=o.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n,r){var e=r(72),i=r(30);t.exports=function(t,n){for(var r,o=i(t),u=e(o),c=u.length,f=0;c>f;)if(o[r=u[f++]]===n)return r}},function(t,n,r){"use strict";var e=r(208),i=r(121),o=r(26);t.exports=function(){for(var t=o(this),n=arguments.length,r=Array(n),u=0,c=e._,f=!1;n>u;)(r[u]=arguments[u++])===c&&(f=!0);return function(){var e,o=this,u=arguments.length,a=0,s=0;if(!f&&!u)return i(t,r,o);if(e=r.slice(),f)for(;n>a;a++)e[a]===c&&(e[a]=arguments[s++]);for(;u>s;)e.push(arguments[s++]);return i(t,e,o)}}},function(t,n,r){t.exports=r(3)},function(t,n){t.exports=function(t,n){var r=n===Object(n)?function(t){return n[t]}:n;return function(n){return String(n).replace(t,r)}}},function(t,n,r){var e=r(1),i=r(209)(/[\\^$*+?.()|[\]{}]/g,"\\$&");e(e.S,"RegExp",{escape:function(t){return i(t)}})},function(t,n,r){var e=r(1);e(e.P,"Array",{copyWithin:r(160)}),r(78)("copyWithin")},function(t,n,r){"use strict";var e=r(1),i=r(48)(4);e(e.P+e.F*!r(47)([].every,!0),"Array",{every:function(t){return i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.P,"Array",{fill:r(130)}),r(78)("fill")},function(t,n,r){"use strict";var e=r(1),i=r(48)(2);e(e.P+e.F*!r(47)([].filter,!0),"Array",{filter:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(6),o="findIndex",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{findIndex:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)(o)},function(t,n,r){"use strict";var e=r(1),i=r(48)(5),o="find",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{find:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)(o)},function(t,n,r){"use strict";var e=r(1),i=r(48)(0),o=r(47)([].forEach,!0);e(e.P+e.F*!o,"Array",{forEach:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(53),i=r(1),o=r(17),u=r(169),c=r(137),f=r(16),a=r(131),s=r(154);i(i.S+i.F*!r(123)(function(t){Array.from(t)}),"Array",{from:function(t){var n,r,i,l,h=o(t),v="function"==typeof this?this:Array,p=arguments.length,d=p>1?arguments[1]:void 0,y=void 0!==d,g=0,b=s(h);if(y&&(d=e(d,p>2?arguments[2]:void 0,2)),void 0==b||v==Array&&c(b))for(n=f(h.length),r=new v(n);n>g;g++)a(r,g,y?d(h[g],g):h[g]);else for(l=b.call(h),r=new v;!(i=l.next()).done;g++)a(r,g,y?u(l,d,[i.value,g],!0):i.value);return r.length=g,r}})},function(t,n,r){"use strict";var e=r(1),i=r(117)(!1),o=[].indexOf,u=!!o&&1/[1].indexOf(1,-0)<0;e(e.P+e.F*(u||!r(47)(o)),"Array",{indexOf:function(t){return u?o.apply(this,arguments)||0:i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.S,"Array",{isArray:r(138)})},function(t,n,r){"use strict";var e=r(1),i=r(30),o=[].join;e(e.P+e.F*(r(115)!=Object||!r(47)(o)),"Array",{join:function(t){return o.call(i(this),void 0===t?",":t)}})},function(t,n,r){"use strict";var e=r(1),i=r(30),o=r(67),u=r(16),c=[].lastIndexOf,f=!!c&&1/[1].lastIndexOf(1,-0)<0;e(e.P+e.F*(f||!r(47)(c)),"Array",{lastIndexOf:function(t){if(f)return c.apply(this,arguments)||0;var n=i(this),r=u(n.length),e=r-1;for(arguments.length>1&&(e=Math.min(e,o(arguments[1]))),e<0&&(e=r+e);e>=0;e--)if(e in n&&n[e]===t)return e||0;return-1}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(1);e(e.P+e.F*!r(47)([].map,!0),"Array",{map:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(131);e(e.S+e.F*r(4)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,n=arguments.length,r=new("function"==typeof this?this:Array)(n);n>t;)i(r,t,arguments[t++]);return r.length=n,r}})},function(t,n,r){"use strict";var e=r(1),i=r(162);e(e.P+e.F*!r(47)([].reduceRight,!0),"Array",{reduceRight:function(t){return i(this,t,arguments.length,arguments[1],!0)}})},function(t,n,r){"use strict";var e=r(1),i=r(162);e(e.P+e.F*!r(47)([].reduce,!0),"Array",{reduce:function(t){return i(this,t,arguments.length,arguments[1],!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(135),o=r(45),u=r(75),c=r(16),f=[].slice;e(e.P+e.F*r(4)(function(){i&&f.call(i)}),"Array",{slice:function(t,n){var r=c(this.length),e=o(this);if(n=void 0===n?r:n,"Array"==e)return f.call(this,t,n);for(var i=u(t,r),a=u(n,r),s=c(a-i),l=Array(s),h=0;h<s;h++)l[h]="String"==e?this.charAt(i+h):this[i+h];return l}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(3);e(e.P+e.F*!r(47)([].some,!0),"Array",{some:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(26),o=r(17),u=r(4),c=[].sort,f=[1,2,3];e(e.P+e.F*(u(function(){f.sort(void 0)})||!u(function(){f.sort(null)})||!r(47)(c)),"Array",{sort:function(t){return void 0===t?c.call(o(this)):c.call(o(this),i(t))}})},function(t,n,r){r(74)("Array")},function(t,n,r){var e=r(1);e(e.S,"Date",{now:function(){return(new Date).getTime()}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=Date.prototype.getTime,u=function(t){return t>9?t:"0"+t};e(e.P+e.F*(i(function(){return"0385-07-25T07:06:39.999Z"!=new Date(-5e13-1).toISOString()})||!i(function(){new Date(NaN).toISOString()})),"Date",{toISOString:function(){
if(!isFinite(o.call(this)))throw RangeError("Invalid time value");var t=this,n=t.getUTCFullYear(),r=t.getUTCMilliseconds(),e=n<0?"-":n>9999?"+":"";return e+("00000"+Math.abs(n)).slice(e?-6:-4)+"-"+u(t.getUTCMonth()+1)+"-"+u(t.getUTCDate())+"T"+u(t.getUTCHours())+":"+u(t.getUTCMinutes())+":"+u(t.getUTCSeconds())+"."+(r>99?r:"0"+u(r))+"Z"}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50);e(e.P+e.F*r(4)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var n=i(this),r=o(n);return"number"!=typeof r||isFinite(r)?n.toISOString():null}})},function(t,n,r){var e=r(7)("toPrimitive"),i=Date.prototype;e in i||r(27)(i,e,r(204))},function(t,n,r){var e=Date.prototype,i="Invalid Date",o="toString",u=e[o],c=e.getTime;new Date(NaN)+""!=i&&r(28)(e,o,function(){var t=c.call(this);return t===t?u.call(this):i})},function(t,n,r){var e=r(1);e(e.P,"Function",{bind:r(163)})},function(t,n,r){"use strict";var e=r(6),i=r(32),o=r(7)("hasInstance"),u=Function.prototype;o in u||r(11).f(u,o,{value:function(t){if("function"!=typeof this||!e(t))return!1;if(!e(this.prototype))return t instanceof this;for(;t=i(t);)if(this.prototype===t)return!0;return!1}})},function(t,n,r){var e=r(11).f,i=r(66),o=r(24),u=Function.prototype,c="name",f=Object.isExtensible||function(){return!0};c in u||r(10)&&e(u,c,{configurable:!0,get:function(){try{var t=this,n=(""+t).match(/^\s*function ([^ (]*)/)[1];return o(t,c)||!f(t)||e(t,c,i(5,n)),n}catch(t){return""}}})},function(t,n,r){var e=r(1),i=r(171),o=Math.sqrt,u=Math.acosh;e(e.S+e.F*!(u&&710==Math.floor(u(Number.MAX_VALUE))&&u(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:t>94906265.62425156?Math.log(t)+Math.LN2:i(t-1+o(t-1)*o(t+1))}})},function(t,n,r){function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}var i=r(1),o=Math.asinh;i(i.S+i.F*!(o&&1/o(0)>0),"Math",{asinh:e})},function(t,n,r){var e=r(1),i=Math.atanh;e(e.S+e.F*!(i&&1/i(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},function(t,n,r){var e=r(1),i=r(142);e(e.S,"Math",{cbrt:function(t){return i(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(t,n,r){var e=r(1),i=Math.exp;e(e.S,"Math",{cosh:function(t){return(i(t=+t)+i(-t))/2}})},function(t,n,r){var e=r(1),i=r(141);e(e.S+e.F*(i!=Math.expm1),"Math",{expm1:i})},function(t,n,r){var e=r(1),i=r(142),o=Math.pow,u=o(2,-52),c=o(2,-23),f=o(2,127)*(2-c),a=o(2,-126),s=function(t){return t+1/u-1/u};e(e.S,"Math",{fround:function(t){var n,r,e=Math.abs(t),o=i(t);return e<a?o*s(e/a/c)*a*c:(n=(1+c/u)*e,r=n-(n-e),r>f||r!=r?o*(1/0):o*r)}})},function(t,n,r){var e=r(1),i=Math.abs;e(e.S,"Math",{hypot:function(t,n){for(var r,e,o=0,u=0,c=arguments.length,f=0;u<c;)r=i(arguments[u++]),f<r?(e=f/r,o=o*e*e+1,f=r):r>0?(e=r/f,o+=e*e):o+=r;return f===1/0?1/0:f*Math.sqrt(o)}})},function(t,n,r){var e=r(1),i=Math.imul;e(e.S+e.F*r(4)(function(){return-5!=i(4294967295,5)||2!=i.length}),"Math",{imul:function(t,n){var r=65535,e=+t,i=+n,o=r&e,u=r&i;return 0|o*u+((r&e>>>16)*u+o*(r&i>>>16)<<16>>>0)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log10:function(t){return Math.log(t)/Math.LN10}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log1p:r(171)})},function(t,n,r){var e=r(1);e(e.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},function(t,n,r){var e=r(1);e(e.S,"Math",{sign:r(142)})},function(t,n,r){var e=r(1),i=r(141),o=Math.exp;e(e.S+e.F*r(4)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(i(t)-i(-t))/2:(o(t-1)-o(-t-1))*(Math.E/2)}})},function(t,n,r){var e=r(1),i=r(141),o=Math.exp;e(e.S,"Math",{tanh:function(t){var n=i(t=+t),r=i(-t);return n==1/0?1:r==1/0?-1:(n-r)/(o(t)+o(-t))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{trunc:function(t){return(t>0?Math.floor:Math.ceil)(t)}})},function(t,n,r){"use strict";var e=r(3),i=r(24),o=r(45),u=r(136),c=r(50),f=r(4),a=r(71).f,s=r(31).f,l=r(11).f,h=r(82).trim,v="Number",p=e[v],d=p,y=p.prototype,g=o(r(70)(y))==v,b="trim"in String.prototype,m=function(t){var n=c(t,!1);if("string"==typeof n&&n.length>2){n=b?n.trim():h(n,3);var r,e,i,o=n.charCodeAt(0);if(43===o||45===o){if(88===(r=n.charCodeAt(2))||120===r)return NaN}else if(48===o){switch(n.charCodeAt(1)){case 66:case 98:e=2,i=49;break;case 79:case 111:e=8,i=55;break;default:return+n}for(var u,f=n.slice(2),a=0,s=f.length;a<s;a++)if((u=f.charCodeAt(a))<48||u>i)return NaN;return parseInt(f,e)}}return+n};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(t){var n=arguments.length<1?0:t,r=this;return r instanceof p&&(g?f(function(){y.valueOf.call(r)}):o(r)!=v)?u(new d(m(n)),r,p):m(n)};for(var x,w=r(10)?a(d):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),S=0;w.length>S;S++)i(d,x=w[S])&&!i(p,x)&&l(p,x,s(d,x));p.prototype=y,y.constructor=p,r(28)(e,v,p)}},function(t,n,r){var e=r(1);e(e.S,"Number",{EPSILON:Math.pow(2,-52)})},function(t,n,r){var e=r(1),i=r(3).isFinite;e(e.S,"Number",{isFinite:function(t){return"number"==typeof t&&i(t)}})},function(t,n,r){var e=r(1);e(e.S,"Number",{isInteger:r(168)})},function(t,n,r){var e=r(1);e(e.S,"Number",{isNaN:function(t){return t!=t}})},function(t,n,r){var e=r(1),i=r(168),o=Math.abs;e(e.S,"Number",{isSafeInteger:function(t){return i(t)&&o(t)<=9007199254740991}})},function(t,n,r){var e=r(1);e(e.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(t,n,r){var e=r(1);e(e.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(t,n,r){var e=r(1),i=r(178);e(e.S+e.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(t,n,r){var e=r(1),i=r(179);e(e.S+e.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(t,n,r){"use strict";var e=r(1),i=r(67),o=r(159),u=r(149),c=1..toFixed,f=Math.floor,a=[0,0,0,0,0,0],s="Number.toFixed: incorrect invocation!",l="0",h=function(t,n){for(var r=-1,e=n;++r<6;)e+=t*a[r],a[r]=e%1e7,e=f(e/1e7)},v=function(t){for(var n=6,r=0;--n>=0;)r+=a[n],a[n]=f(r/t),r=r%t*1e7},p=function(){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==a[t]){var r=String(a[t]);n=""===n?r:n+u.call(l,7-r.length)+r}return n},d=function(t,n,r){return 0===n?r:n%2==1?d(t,n-1,r*t):d(t*t,n/2,r)},y=function(t){for(var n=0,r=t;r>=4096;)n+=12,r/=4096;for(;r>=2;)n+=1,r/=2;return n};e(e.P+e.F*(!!c&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!r(4)(function(){c.call({})})),"Number",{toFixed:function(t){var n,r,e,c,f=o(this,s),a=i(t),g="",b=l;if(a<0||a>20)throw RangeError(s);if(f!=f)return"NaN";if(f<=-1e21||f>=1e21)return String(f);if(f<0&&(g="-",f=-f),f>1e-21)if(n=y(f*d(2,69,1))-69,r=n<0?f*d(2,-n,1):f/d(2,n,1),r*=4503599627370496,(n=52-n)>0){for(h(0,r),e=a;e>=7;)h(1e7,0),e-=7;for(h(d(10,e,1),0),e=n-1;e>=23;)v(1<<23),e-=23;v(1<<e),h(1,1),v(2),b=p()}else h(0,r),h(1<<-n,0),b=p()+u.call(l,a);return a>0?(c=b.length,b=g+(c<=a?"0."+u.call(l,a-c)+b:b.slice(0,c-a)+"."+b.slice(c-a))):b=g+b,b}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=r(159),u=1..toPrecision;e(e.P+e.F*(i(function(){return"1"!==u.call(1,void 0)})||!i(function(){u.call({})})),"Number",{toPrecision:function(t){var n=o(this,"Number#toPrecision: incorrect invocation!");return void 0===t?u.call(n):u.call(n,t)}})},function(t,n,r){var e=r(1);e(e.S+e.F,"Object",{assign:r(172)})},function(t,n,r){var e=r(1);e(e.S,"Object",{create:r(70)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperties:r(173)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperty:r(11).f})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("freeze",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(30),i=r(31).f;r(49)("getOwnPropertyDescriptor",function(){return function(t,n){return i(e(t),n)}})},function(t,n,r){r(49)("getOwnPropertyNames",function(){return r(174).f})},function(t,n,r){var e=r(17),i=r(32);r(49)("getPrototypeOf",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(6);r(49)("isExtensible",function(t){return function(n){return!!e(n)&&(!t||t(n))}})},function(t,n,r){var e=r(6);r(49)("isFrozen",function(t){return function(n){return!e(n)||!!t&&t(n)}})},function(t,n,r){var e=r(6);r(49)("isSealed",function(t){return function(n){return!e(n)||!!t&&t(n)}})},function(t,n,r){var e=r(1);e(e.S,"Object",{is:r(180)})},function(t,n,r){var e=r(17),i=r(72);r(49)("keys",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("preventExtensions",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("seal",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(1);e(e.S,"Object",{setPrototypeOf:r(144).set})},function(t,n,r){"use strict";var e=r(114),i={};i[r(7)("toStringTag")]="z",i+""!="[object z]"&&r(28)(Object.prototype,"toString",function(){return"[object "+e(this)+"]"},!0)},function(t,n,r){var e=r(1),i=r(178);e(e.G+e.F*(parseFloat!=i),{parseFloat:i})},function(t,n,r){var e=r(1),i=r(179);e(e.G+e.F*(parseInt!=i),{parseInt:i})},function(t,n,r){"use strict";var e,i,o,u=r(69),c=r(3),f=r(53),a=r(114),s=r(1),l=r(6),h=r(26),v=r(68),p=r(79),d=r(146),y=r(151).set,g=r(143)(),b="Promise",m=c.TypeError,x=c.process,w=c[b],x=c.process,S="process"==a(x),_=function(){},O=!!function(){try{var t=w.resolve(1),n=(t.constructor={})[r(7)("species")]=function(t){t(_,_)};return(S||"function"==typeof PromiseRejectionEvent)&&t.then(_)instanceof n}catch(t){}}(),E=function(t,n){return t===n||t===w&&n===o},P=function(t){var n;return!(!l(t)||"function"!=typeof(n=t.then))&&n},j=function(t){return E(w,t)?new F(t):new i(t)},F=i=function(t){var n,r;this.promise=new t(function(t,e){if(void 0!==n||void 0!==r)throw m("Bad Promise constructor");n=t,r=e}),this.resolve=h(n),this.reject=h(r)},M=function(t){try{t()}catch(t){return{error:t}}},A=function(t,n){if(!t._n){t._n=!0;var r=t._c;g(function(){for(var e=t._v,i=1==t._s,o=0;r.length>o;)!function(n){var r,o,u=i?n.ok:n.fail,c=n.resolve,f=n.reject,a=n.domain;try{u?(i||(2==t._h&&I(t),t._h=1),!0===u?r=e:(a&&a.enter(),r=u(e),a&&a.exit()),r===n.promise?f(m("Promise-chain cycle")):(o=P(r))?o.call(r,c,f):c(r)):f(e)}catch(t){f(t)}}(r[o++]);t._c=[],t._n=!1,n&&!t._h&&N(t)})}},N=function(t){y.call(c,function(){var n,r,e,i=t._v;if(T(t)&&(n=M(function(){S?x.emit("unhandledRejection",i,t):(r=c.onunhandledrejection)?r({promise:t,reason:i}):(e=c.console)&&e.error&&e.error("Unhandled promise rejection",i)}),t._h=S||T(t)?2:1),t._a=void 0,n)throw n.error})},T=function(t){if(1==t._h)return!1;for(var n,r=t._a||t._c,e=0;r.length>e;)if(n=r[e++],n.fail||!T(n.promise))return!1;return!0},I=function(t){y.call(c,function(){var n;S?x.emit("rejectionHandled",t):(n=c.onrejectionhandled)&&n({promise:t,reason:t._v})})},k=function(t){var n=this;n._d||(n._d=!0,n=n._w||n,n._v=t,n._s=2,n._a||(n._a=n._c.slice()),A(n,!0))},L=function(t){var n,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw m("Promise can't be resolved itself");(n=P(t))?g(function(){var e={_w:r,_d:!1};try{n.call(t,f(L,e,1),f(k,e,1))}catch(t){k.call(e,t)}}):(r._v=t,r._s=1,A(r,!1))}catch(t){k.call({_w:r,_d:!1},t)}}};O||(w=function(t){v(this,w,b,"_h"),h(t),e.call(this);try{t(f(L,this,1),f(k,this,1))}catch(t){k.call(this,t)}},e=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},e.prototype=r(73)(w.prototype,{then:function(t,n){var r=j(d(this,w));return r.ok="function"!=typeof t||t,r.fail="function"==typeof n&&n,r.domain=S?x.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&A(this,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),F=function(){var t=new e;this.promise=t,this.resolve=f(L,t,1),this.reject=f(k,t,1)}),s(s.G+s.W+s.F*!O,{Promise:w}),r(81)(w,b),r(74)(b),o=r(52)[b],s(s.S+s.F*!O,b,{reject:function(t){var n=j(this);return(0,n.reject)(t),n.promise}}),s(s.S+s.F*(u||!O),b,{resolve:function(t){if(t instanceof w&&E(t.constructor,this))return t;var n=j(this);return(0,n.resolve)(t),n.promise}}),s(s.S+s.F*!(O&&r(123)(function(t){w.all(t).catch(_)})),b,{all:function(t){var n=this,r=j(n),e=r.resolve,i=r.reject,o=M(function(){var r=[],o=0,u=1;p(t,!1,function(t){var c=o++,f=!1;r.push(void 0),u++,n.resolve(t).then(function(t){f||(f=!0,r[c]=t,--u||e(r))},i)}),--u||e(r)});return o&&i(o.error),r.promise},race:function(t){var n=this,r=j(n),e=r.reject,i=M(function(){p(t,!1,function(t){n.resolve(t).then(r.resolve,e)})});return i&&e(i.error),r.promise}})},function(t,n,r){var e=r(1),i=r(26),o=r(2),u=(r(3).Reflect||{}).apply,c=Function.apply;e(e.S+e.F*!r(4)(function(){u(function(){})}),"Reflect",{apply:function(t,n,r){var e=i(t),f=o(r);return u?u(e,n,f):c.call(e,n,f)}})},function(t,n,r){var e=r(1),i=r(70),o=r(26),u=r(2),c=r(6),f=r(4),a=r(163),s=(r(3).Reflect||{}).construct,l=f(function(){function t(){}return!(s(function(){},[],t)instanceof t)}),h=!f(function(){s(function(){})});e(e.S+e.F*(l||h),"Reflect",{construct:function(t,n){o(t),u(n);var r=arguments.length<3?t:o(arguments[2]);if(h&&!l)return s(t,n,r);if(t==r){switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3])}var e=[null];return e.push.apply(e,n),new(a.apply(t,e))}var f=r.prototype,v=i(c(f)?f:Object.prototype),p=Function.apply.call(t,v,n);return c(p)?p:v}})},function(t,n,r){var e=r(11),i=r(1),o=r(2),u=r(50);i(i.S+i.F*r(4)(function(){Reflect.defineProperty(e.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,n,r){o(t),n=u(n,!0),o(r);try{return e.f(t,n,r),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(31).f,o=r(2);e(e.S,"Reflect",{deleteProperty:function(t,n){var r=i(o(t),n);return!(r&&!r.configurable)&&delete t[n]}})},function(t,n,r){"use strict";var e=r(1),i=r(2),o=function(t){this._t=i(t),this._i=0;var n,r=this._k=[];for(n in t)r.push(n)};r(139)(o,"Object",function(){var t,n=this,r=n._k;do{if(n._i>=r.length)return{value:void 0,done:!0}}while(!((t=r[n._i++])in n._t));return{value:t,done:!1}}),e(e.S,"Reflect",{enumerate:function(t){return new o(t)}})},function(t,n,r){var e=r(31),i=r(1),o=r(2);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(t,n){return e.f(o(t),n)}})},function(t,n,r){var e=r(1),i=r(32),o=r(2);e(e.S,"Reflect",{getPrototypeOf:function(t){return i(o(t))}})},function(t,n,r){function e(t,n){var r,c,s=arguments.length<3?t:arguments[2];return a(t)===s?t[n]:(r=i.f(t,n))?u(r,"value")?r.value:void 0!==r.get?r.get.call(s):void 0:f(c=o(t))?e(c,n,s):void 0}var i=r(31),o=r(32),u=r(24),c=r(1),f=r(6),a=r(2);c(c.S,"Reflect",{get:e})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{has:function(t,n){return n in t}})},function(t,n,r){var e=r(1),i=r(2),o=Object.isExtensible;e(e.S,"Reflect",{isExtensible:function(t){return i(t),!o||o(t)}})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{ownKeys:r(177)})},function(t,n,r){var e=r(1),i=r(2),o=Object.preventExtensions;e(e.S,"Reflect",{preventExtensions:function(t){i(t);try{return o&&o(t),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(144);i&&e(e.S,"Reflect",{setPrototypeOf:function(t,n){i.check(t,n);try{return i.set(t,n),!0}catch(t){return!1}}})},function(t,n,r){function e(t,n,r){var f,h,v=arguments.length<4?t:arguments[3],p=o.f(s(t),n);if(!p){if(l(h=u(t)))return e(h,n,r,v);p=a(0)}return c(p,"value")?!(!1===p.writable||!l(v)||(f=o.f(v,n)||a(0),f.value=r,i.f(v,n,f),0)):void 0!==p.set&&(p.set.call(v,r),!0)}var i=r(11),o=r(31),u=r(32),c=r(24),f=r(1),a=r(66),s=r(2),l=r(6);f(f.S,"Reflect",{set:e})},function(t,n,r){var e=r(3),i=r(136),o=r(11).f,u=r(71).f,c=r(122),f=r(120),a=e.RegExp,s=a,l=a.prototype,h=/a/g,v=/a/g,p=new a(h)!==h;if(r(10)&&(!p||r(4)(function(){return v[r(7)("match")]=!1,a(h)!=h||a(v)==v||"/a/i"!=a(h,"i")}))){a=function(t,n){var r=this instanceof a,e=c(t),o=void 0===n;return!r&&e&&t.constructor===a&&o?t:i(p?new s(e&&!o?t.source:t,n):s((e=t instanceof a)?t.source:t,e&&o?f.call(t):n),r?this:l,a)};for(var d=u(s),y=0;d.length>y;)!function(t){t in a||o(a,t,{configurable:!0,get:function(){return s[t]},set:function(n){s[t]=n}})}(d[y++]);l.constructor=a,a.prototype=l,r(28)(e,"RegExp",a)}r(74)("RegExp")},function(t,n,r){r(119)("match",1,function(t,n,r){return[function(r){"use strict";var e=t(this),i=void 0==r?void 0:r[n];return void 0!==i?i.call(r,e):new RegExp(r)[n](String(e))},r]})},function(t,n,r){r(119)("replace",2,function(t,n,r){return[function(e,i){"use strict";var o=t(this),u=void 0==e?void 0:e[n];return void 0!==u?u.call(e,o,i):r.call(String(o),e,i)},r]})},function(t,n,r){r(119)("search",1,function(t,n,r){return[function(r){"use strict";var e=t(this),i=void 0==r?void 0:r[n];return void 0!==i?i.call(r,e):new RegExp(r)[n](String(e))},r]})},function(t,n,r){r(119)("split",2,function(t,n,e){"use strict";var i=r(122),o=e,u=[].push,c="split",f="length",a="lastIndex";if("c"=="abbc"[c](/(b)*/)[1]||4!="test"[c](/(?:)/,-1)[f]||2!="ab"[c](/(?:ab)*/)[f]||4!="."[c](/(.?)(.?)/)[f]||"."[c](/()()/)[f]>1||""[c](/.?/)[f]){var s=void 0===/()??/.exec("")[1];e=function(t,n){var r=String(this);if(void 0===t&&0===n)return[];if(!i(t))return o.call(r,t,n);var e,c,l,h,v,p=[],d=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),y=0,g=void 0===n?4294967295:n>>>0,b=new RegExp(t.source,d+"g");for(s||(e=new RegExp("^"+b.source+"$(?!\\s)",d));(c=b.exec(r))&&!((l=c.index+c[0][f])>y&&(p.push(r.slice(y,c.index)),!s&&c[f]>1&&c[0].replace(e,function(){for(v=1;v<arguments[f]-2;v++)void 0===arguments[v]&&(c[v]=void 0)}),c[f]>1&&c.index<r[f]&&u.apply(p,c.slice(1)),h=c[0][f],y=l,p[f]>=g));)b[a]===c.index&&b[a]++;return y===r[f]?!h&&b.test("")||p.push(""):p.push(r.slice(y)),p[f]>g?p.slice(0,g):p}}else"0"[c](void 0,0)[f]&&(e=function(t,n){return void 0===t&&0===n?[]:o.call(this,t,n)});return[function(r,i){var o=t(this),u=void 0==r?void 0:r[n];return void 0!==u?u.call(r,o,i):e.call(String(o),r,i)},e]})},function(t,n,r){"use strict";r(184);var e=r(2),i=r(120),o=r(10),u="toString",c=/./[u],f=function(t){r(28)(RegExp.prototype,u,t,!0)};r(4)(function(){return"/a/b"!=c.call({source:"a",flags:"b"})})?f(function(){var t=e(this);return"/".concat(t.source,"/","flags"in t?t.flags:!o&&t instanceof RegExp?i.call(t):void 0)}):c.name!=u&&f(function(){return c.call(this)})},function(t,n,r){"use strict";r(29)("anchor",function(t){return function(n){return t(this,"a","name",n)}})},function(t,n,r){"use strict";r(29)("big",function(t){return function(){return t(this,"big","","")}})},function(t,n,r){"use strict";r(29)("blink",function(t){return function(){return t(this,"blink","","")}})},function(t,n,r){"use strict";r(29)("bold",function(t){return function(){return t(this,"b","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(147)(!1);e(e.P,"String",{codePointAt:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(16),o=r(148),u="endsWith",c=""[u];e(e.P+e.F*r(134)(u),"String",{endsWith:function(t){var n=o(this,t,u),r=arguments.length>1?arguments[1]:void 0,e=i(n.length),f=void 0===r?e:Math.min(i(r),e),a=String(t);return c?c.call(n,a,f):n.slice(f-a.length,f)===a}})},function(t,n,r){"use strict";r(29)("fixed",function(t){return function(){return t(this,"tt","","")}})},function(t,n,r){"use strict";r(29)("fontcolor",function(t){return function(n){return t(this,"font","color",n)}})},function(t,n,r){"use strict";r(29)("fontsize",function(t){return function(n){return t(this,"font","size",n)}})},function(t,n,r){var e=r(1),i=r(75),o=String.fromCharCode,u=String.fromCodePoint;e(e.S+e.F*(!!u&&1!=u.length),"String",{fromCodePoint:function(t){for(var n,r=[],e=arguments.length,u=0;e>u;){if(n=+arguments[u++],i(n,1114111)!==n)throw RangeError(n+" is not a valid code point");r.push(n<65536?o(n):o(55296+((n-=65536)>>10),n%1024+56320))}return r.join("")}})},function(t,n,r){"use strict";var e=r(1),i=r(148),o="includes";e(e.P+e.F*r(134)(o),"String",{includes:function(t){return!!~i(this,t,o).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},function(t,n,r){"use strict";r(29)("italics",function(t){return function(){return t(this,"i","","")}})},function(t,n,r){"use strict";var e=r(147)(!0);r(140)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";r(29)("link",function(t){return function(n){return t(this,"a","href",n)}})},function(t,n,r){var e=r(1),i=r(30),o=r(16);e(e.S,"String",{raw:function(t){for(var n=i(t.raw),r=o(n.length),e=arguments.length,u=[],c=0;r>c;)u.push(String(n[c++])),c<e&&u.push(String(arguments[c]));return u.join("")}})},function(t,n,r){var e=r(1);e(e.P,"String",{repeat:r(149)})},function(t,n,r){"use strict";r(29)("small",function(t){return function(){return t(this,"small","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(16),o=r(148),u="startsWith",c=""[u];e(e.P+e.F*r(134)(u),"String",{startsWith:function(t){var n=o(this,t,u),r=i(Math.min(arguments.length>1?arguments[1]:void 0,n.length)),e=String(t);return c?c.call(n,e,r):n.slice(r,r+e.length)===e}})},function(t,n,r){"use strict";r(29)("strike",function(t){return function(){return t(this,"strike","","")}})},function(t,n,r){"use strict";r(29)("sub",function(t){return function(){return t(this,"sub","","")}})},function(t,n,r){"use strict";r(29)("sup",function(t){return function(){return t(this,"sup","","")}})},function(t,n,r){"use strict";r(82)("trim",function(t){return function(){return t(this,3)}})},function(t,n,r){"use strict";var e=r(3),i=r(24),o=r(10),u=r(1),c=r(28),f=r(65).KEY,a=r(4),s=r(126),l=r(81),h=r(76),v=r(7),p=r(182),d=r(153),y=r(206),g=r(205),b=r(138),m=r(2),x=r(30),w=r(50),S=r(66),_=r(70),O=r(174),E=r(31),P=r(11),j=r(72),F=E.f,M=P.f,A=O.f,N=e.Symbol,T=e.JSON,I=T&&T.stringify,k="prototype",L=v("_hidden"),R=v("toPrimitive"),C={}.propertyIsEnumerable,D=s("symbol-registry"),U=s("symbols"),W=s("op-symbols"),G=Object[k],B="function"==typeof N,V=e.QObject,z=!V||!V[k]||!V[k].findChild,q=o&&a(function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=F(G,n);e&&delete G[n],M(t,n,r),e&&t!==G&&M(G,n,e)}:M,K=function(t){var n=U[t]=_(N[k]);return n._k=t,n},J=B&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===G&&Y(W,n,r),m(t),n=w(n,!0),m(r),i(U,n)?(r.enumerable?(i(t,L)&&t[L][n]&&(t[L][n]=!1),r=_(r,{enumerable:S(0,!1)})):(i(t,L)||M(t,L,S(1,{})),t[L][n]=!0),q(t,n,r)):M(t,n,r)},H=function(t,n){m(t);for(var r,e=g(n=x(n)),i=0,o=e.length;o>i;)Y(t,r=e[i++],n[r]);return t},$=function(t,n){return void 0===n?_(t):H(_(t),n)},X=function(t){var n=C.call(this,t=w(t,!0));return!(this===G&&i(U,t)&&!i(W,t))&&(!(n||!i(this,t)||!i(U,t)||i(this,L)&&this[L][t])||n)},Q=function(t,n){if(t=x(t),n=w(n,!0),t!==G||!i(U,n)||i(W,n)){var r=F(t,n);return!r||!i(U,n)||i(t,L)&&t[L][n]||(r.enumerable=!0),r}},Z=function(t){for(var n,r=A(x(t)),e=[],o=0;r.length>o;)i(U,n=r[o++])||n==L||n==f||e.push(n);return e},tt=function(t){for(var n,r=t===G,e=A(r?W:x(t)),o=[],u=0;e.length>u;)!i(U,n=e[u++])||r&&!i(G,n)||o.push(U[n]);return o};B||(N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),n=function(r){this===G&&n.call(W,r),i(this,L)&&i(this[L],t)&&(this[L][t]=!1),q(this,t,S(1,r))};return o&&z&&q(G,t,{configurable:!0,set:n}),K(t)},c(N[k],"toString",function(){return this._k}),E.f=Q,P.f=Y,r(71).f=O.f=Z,r(116).f=X,r(125).f=tt,o&&!r(69)&&c(G,"propertyIsEnumerable",X,!0),p.f=function(t){return K(v(t))}),u(u.G+u.W+u.F*!B,{Symbol:N});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;nt.length>rt;)v(nt[rt++]);for(var nt=j(v.store),rt=0;nt.length>rt;)d(nt[rt++]);u(u.S+u.F*!B,"Symbol",{for:function(t){return i(D,t+="")?D[t]:D[t]=N(t)},keyFor:function(t){if(J(t))return y(D,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),u(u.S+u.F*!B,"Object",{create:$,defineProperty:Y,defineProperties:H,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),T&&u(u.S+u.F*(!B||a(function(){var t=N();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!J(t)){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);return n=e[1],"function"==typeof n&&(r=n),!r&&b(n)||(n=function(t,n){if(r&&(n=r.call(this,t,n)),!J(n))return n}),e[1]=n,I.apply(T,e)}}}),N[k][R]||r(27)(N[k],R,N[k].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){"use strict";var e=r(1),i=r(127),o=r(152),u=r(2),c=r(75),f=r(16),a=r(6),s=r(3).ArrayBuffer,l=r(146),h=o.ArrayBuffer,v=o.DataView,p=i.ABV&&s.isView,d=h.prototype.slice,y=i.VIEW,g="ArrayBuffer";e(e.G+e.W+e.F*(s!==h),{ArrayBuffer:h}),e(e.S+e.F*!i.CONSTR,g,{isView:function(t){return p&&p(t)||a(t)&&y in t}}),e(e.P+e.U+e.F*r(4)(function(){return!new h(2).slice(1,void 0).byteLength}),g,{slice:function(t,n){if(void 0!==d&&void 0===n)return d.call(u(this),t);for(var r=u(this).byteLength,e=c(t,r),i=c(void 0===n?r:n,r),o=new(l(this,h))(f(i-e)),a=new v(this),s=new v(o),p=0;e<i;)s.setUint8(p++,a.getUint8(e++));return o}}),r(74)(g)},function(t,n,r){var e=r(1);e(e.G+e.W+e.F*!r(127).ABV,{DataView:r(152).DataView})},function(t,n,r){r(55)("Float32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Float64",8,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int16",2,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int8",1,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint16",2,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint8",1,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint8",1,function(t){return function(n,r,e){return t(this,n,r,e)}},!0)},function(t,n,r){"use strict";var e=r(166);r(118)("WeakSet",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return e.def(this,t,!0)}},e,!1,!0)},function(t,n,r){"use strict";var e=r(1),i=r(117)(!0);e(e.P,"Array",{includes:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)("includes")},function(t,n,r){var e=r(1),i=r(143)(),o=r(3).process,u="process"==r(45)(o);e(e.G,{asap:function(t){var n=u&&o.domain;i(n?n.bind(t):t)}})},function(t,n,r){var e=r(1),i=r(45);e(e.S,"Error",{isError:function(t){return"Error"===i(t)}})},function(t,n,r){var e=r(1);e(e.P+e.R,"Map",{toJSON:r(165)("Map")})},function(t,n,r){var e=r(1);e(e.S,"Math",{iaddh:function(t,n,r,e){var i=t>>>0,o=n>>>0,u=r>>>0;return o+(e>>>0)+((i&u|(i|u)&~(i+u>>>0))>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{imulh:function(t,n){var r=65535,e=+t,i=+n,o=e&r,u=i&r,c=e>>16,f=i>>16,a=(c*u>>>0)+(o*u>>>16);return c*f+(a>>16)+((o*f>>>0)+(a&r)>>16)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{isubh:function(t,n,r,e){var i=t>>>0,o=n>>>0,u=r>>>0;return o-(e>>>0)-((~i&u|~(i^u)&i-u>>>0)>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{umulh:function(t,n){var r=65535,e=+t,i=+n,o=e&r,u=i&r,c=e>>>16,f=i>>>16,a=(c*u>>>0)+(o*u>>>16);return c*f+(a>>>16)+((o*f>>>0)+(a&r)>>>16)}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(26),u=r(11);r(10)&&e(e.P+r(124),"Object",{__defineGetter__:function(t,n){u.f(i(this),t,{get:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(26),u=r(11);r(10)&&e(e.P+r(124),"Object",{__defineSetter__:function(t,n){u.f(i(this),t,{set:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){var e=r(1),i=r(176)(!0);e(e.S,"Object",{entries:function(t){return i(t)}})},function(t,n,r){var e=r(1),i=r(177),o=r(30),u=r(31),c=r(131);e(e.S,"Object",{getOwnPropertyDescriptors:function(t){for(var n,r=o(t),e=u.f,f=i(r),a={},s=0;f.length>s;)c(a,n=f[s++],e(r,n));return a}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50),u=r(32),c=r(31).f;r(10)&&e(e.P+r(124),"Object",{__lookupGetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.get}while(r=u(r))}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50),u=r(32),c=r(31).f;r(10)&&e(e.P+r(124),"Object",{__lookupSetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.set}while(r=u(r))}})},function(t,n,r){var e=r(1),i=r(176)(!1);e(e.S,"Object",{values:function(t){return i(t)}})},function(t,n,r){"use strict";var e=r(1),i=r(3),o=r(52),u=r(143)(),c=r(7)("observable"),f=r(26),a=r(2),s=r(68),l=r(73),h=r(27),v=r(79),p=v.RETURN,d=function(t){return null==t?void 0:f(t)},y=function(t){var n=t._c;n&&(t._c=void 0,n())},g=function(t){return void 0===t._o},b=function(t){g(t)||(t._o=void 0,y(t))},m=function(t,n){a(t),this._c=void 0,this._o=t,t=new x(this);try{var r=n(t),e=r;null!=r&&("function"==typeof r.unsubscribe?r=function(){e.unsubscribe()}:f(r),this._c=r)}catch(n){return void t.error(n)}g(this)&&y(this)};m.prototype=l({},{unsubscribe:function(){b(this)}});var x=function(t){this._s=t};x.prototype=l({},{next:function(t){var n=this._s;if(!g(n)){var r=n._o;try{var e=d(r.next);if(e)return e.call(r,t)}catch(t){try{b(n)}finally{throw t}}}},error:function(t){var n=this._s;if(g(n))throw t;var r=n._o;n._o=void 0;try{var e=d(r.error);if(!e)throw t;t=e.call(r,t)}catch(t){try{y(n)}finally{throw t}}return y(n),t},complete:function(t){var n=this._s;if(!g(n)){var r=n._o;n._o=void 0;try{var e=d(r.complete);t=e?e.call(r,t):void 0}catch(t){try{y(n)}finally{throw t}}return y(n),t}}});var w=function(t){s(this,w,"Observable","_f")._f=f(t)};l(w.prototype,{subscribe:function(t){return new m(t,this._f)},forEach:function(t){var n=this;return new(o.Promise||i.Promise)(function(r,e){f(t);var i=n.subscribe({next:function(n){try{return t(n)}catch(t){e(t),i.unsubscribe()}},error:e,complete:r})})}}),l(w,{from:function(t){var n="function"==typeof this?this:w,r=d(a(t)[c]);if(r){var e=a(r.call(t));return e.constructor===n?e:new n(function(t){return e.subscribe(t)})}return new n(function(n){var r=!1;return u(function(){if(!r){try{if(v(t,!1,function(t){if(n.next(t),r)return p})===p)return}catch(t){if(r)throw t;return void n.error(t)}n.complete()}}),function(){r=!0}})},of:function(){for(var t=0,n=arguments.length,r=Array(n);t<n;)r[t]=arguments[t++];return new("function"==typeof this?this:w)(function(t){var n=!1;return u(function(){if(!n){for(var e=0;e<r.length;++e)if(t.next(r[e]),n)return;t.complete()}}),function(){n=!0}})}}),h(w.prototype,c,function(){return this}),e(e.G,{Observable:w}),r(74)("Observable")},function(t,n,r){var e=r(54),i=r(2),o=e.key,u=e.set;e.exp({defineMetadata:function(t,n,r,e){u(t,n,i(r),o(e))}})},function(t,n,r){var e=r(54),i=r(2),o=e.key,u=e.map,c=e.store;e.exp({deleteMetadata:function(t,n){var r=arguments.length<3?void 0:o(arguments[2]),e=u(i(n),r,!1);if(void 0===e||!e.delete(t))return!1;if(e.size)return!0;var f=c.get(n);return f.delete(r),!!f.size||c.delete(n)}})},function(t,n,r){var e=r(185),i=r(161),o=r(54),u=r(2),c=r(32),f=o.keys,a=o.key,s=function(t,n){var r=f(t,n),o=c(t);if(null===o)return r;var u=s(o,n);return u.length?r.length?i(new e(r.concat(u))):u:r};o.exp({getMetadataKeys:function(t){return s(u(t),arguments.length<2?void 0:a(arguments[1]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(32),u=e.has,c=e.get,f=e.key,a=function(t,n,r){if(u(t,n,r))return c(t,n,r);var e=o(n);return null!==e?a(t,e,r):void 0};e.exp({getMetadata:function(t,n){return a(t,i(n),arguments.length<3?void 0:f(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.keys,u=e.key;e.exp({getOwnMetadataKeys:function(t){
return o(i(t),arguments.length<2?void 0:u(arguments[1]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.get,u=e.key;e.exp({getOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(32),u=e.has,c=e.key,f=function(t,n,r){if(u(t,n,r))return!0;var e=o(n);return null!==e&&f(t,e,r)};e.exp({hasMetadata:function(t,n){return f(t,i(n),arguments.length<3?void 0:c(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.has,u=e.key;e.exp({hasOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(26),u=e.key,c=e.set;e.exp({metadata:function(t,n){return function(r,e){c(t,n,(void 0!==e?i:o)(r),u(e))}}})},function(t,n,r){var e=r(1);e(e.P+e.R,"Set",{toJSON:r(165)("Set")})},function(t,n,r){"use strict";var e=r(1),i=r(147)(!0);e(e.P,"String",{at:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(46),o=r(16),u=r(122),c=r(120),f=RegExp.prototype,a=function(t,n){this._r=t,this._s=n};r(139)(a,"RegExp String",function(){var t=this._r.exec(this._s);return{value:t,done:null===t}}),e(e.P,"String",{matchAll:function(t){if(i(this),!u(t))throw TypeError(t+" is not a regexp!");var n=String(this),r="flags"in f?String(t.flags):c.call(t),e=new RegExp(t.source,~r.indexOf("g")?r:"g"+r);return e.lastIndex=o(t.lastIndex),new a(e,n)}})},function(t,n,r){"use strict";var e=r(1),i=r(181);e(e.P,"String",{padEnd:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(181);e(e.P,"String",{padStart:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!0)}})},function(t,n,r){"use strict";r(82)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},function(t,n,r){"use strict";r(82)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},function(t,n,r){r(153)("asyncIterator")},function(t,n,r){r(153)("observable")},function(t,n,r){var e=r(1);e(e.S,"System",{global:r(3)})},function(t,n,r){for(var e=r(155),i=r(28),o=r(3),u=r(27),c=r(80),f=r(7),a=f("iterator"),s=f("toStringTag"),l=c.Array,h=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],v=0;v<5;v++){var p,d=h[v],y=o[d],g=y&&y.prototype;if(g){g[a]||u(g,a,l),g[s]||u(g,s,d),c[d]=l;for(p in e)g[p]||i(g,p,e[p],!0)}}},function(t,n,r){var e=r(1),i=r(151);e(e.G+e.B,{setImmediate:i.set,clearImmediate:i.clear})},function(t,n,r){var e=r(3),i=r(1),o=r(121),u=r(207),c=e.navigator,f=!!c&&/MSIE .\./.test(c.userAgent),a=function(t){return f?function(n,r){return t(o(u,[].slice.call(arguments,2),"function"==typeof n?n:Function(n)),r)}:t};i(i.G+i.B+i.F*f,{setTimeout:a(e.setTimeout),setInterval:a(e.setInterval)})},function(t,n,r){r(330),r(269),r(271),r(270),r(273),r(275),r(280),r(274),r(272),r(282),r(281),r(277),r(278),r(276),r(268),r(279),r(283),r(284),r(236),r(238),r(237),r(286),r(285),r(256),r(266),r(267),r(257),r(258),r(259),r(260),r(261),r(262),r(263),r(264),r(265),r(239),r(240),r(241),r(242),r(243),r(244),r(245),r(246),r(247),r(248),r(249),r(250),r(251),r(252),r(253),r(254),r(255),r(317),r(322),r(329),r(320),r(312),r(313),r(318),r(323),r(325),r(308),r(309),r(310),r(311),r(314),r(315),r(316),r(319),r(321),r(324),r(326),r(327),r(328),r(231),r(233),r(232),r(235),r(234),r(220),r(218),r(224),r(221),r(227),r(229),r(217),r(223),r(214),r(228),r(212),r(226),r(225),r(219),r(222),r(211),r(213),r(216),r(215),r(230),r(155),r(302),r(307),r(184),r(303),r(304),r(305),r(306),r(287),r(183),r(185),r(186),r(342),r(331),r(332),r(337),r(340),r(341),r(335),r(338),r(336),r(339),r(333),r(334),r(288),r(289),r(290),r(291),r(292),r(295),r(293),r(294),r(296),r(297),r(298),r(299),r(301),r(300),r(343),r(369),r(372),r(371),r(373),r(374),r(370),r(375),r(376),r(354),r(357),r(353),r(351),r(352),r(355),r(356),r(346),r(368),r(377),r(345),r(347),r(349),r(348),r(350),r(359),r(360),r(362),r(361),r(364),r(363),r(365),r(366),r(367),r(344),r(358),r(380),r(379),r(378),t.exports=r(52)},function(t,n){function r(t,n){if("string"==typeof n)return t.insertAdjacentHTML("afterend",n);var r=t.nextSibling;return r?t.parentNode.insertBefore(n,r):t.parentNode.appendChild(n)}t.exports=r},,,,,,,,,function(t,n,r){(function(n,r){!function(n){"use strict";function e(t,n,r,e){var i=n&&n.prototype instanceof o?n:o,u=Object.create(i.prototype),c=new p(e||[]);return u._invoke=s(t,r,c),u}function i(t,n,r){try{return{type:"normal",arg:t.call(n,r)}}catch(t){return{type:"throw",arg:t}}}function o(){}function u(){}function c(){}function f(t){["next","throw","return"].forEach(function(n){t[n]=function(t){return this._invoke(n,t)}})}function a(t){function n(r,e,o,u){var c=i(t[r],t,e);if("throw"!==c.type){var f=c.arg,a=f.value;return a&&"object"==typeof a&&m.call(a,"__await")?Promise.resolve(a.__await).then(function(t){n("next",t,o,u)},function(t){n("throw",t,o,u)}):Promise.resolve(a).then(function(t){f.value=t,o(f)},u)}u(c.arg)}function e(t,r){function e(){return new Promise(function(e,i){n(t,r,e,i)})}return o=o?o.then(e,e):e()}"object"==typeof r&&r.domain&&(n=r.domain.bind(n));var o;this._invoke=e}function s(t,n,r){var e=P;return function(o,u){if(e===F)throw new Error("Generator is already running");if(e===M){if("throw"===o)throw u;return y()}for(r.method=o,r.arg=u;;){var c=r.delegate;if(c){var f=l(c,r);if(f){if(f===A)continue;return f}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(e===P)throw e=M,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);e=F;var a=i(t,n,r);if("normal"===a.type){if(e=r.done?M:j,a.arg===A)continue;return{value:a.arg,done:r.done}}"throw"===a.type&&(e=M,r.method="throw",r.arg=a.arg)}}}function l(t,n){var r=t.iterator[n.method];if(r===g){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=g,l(t,n),"throw"===n.method))return A;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return A}var e=i(r,t.iterator,n.arg);if("throw"===e.type)return n.method="throw",n.arg=e.arg,n.delegate=null,A;var o=e.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=g),n.delegate=null,A):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,A)}function h(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function v(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function p(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(h,this),this.reset(!0)}function d(t){if(t){var n=t[w];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,e=function n(){for(;++r<t.length;)if(m.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=g,n.done=!0,n};return e.next=e}}return{next:y}}function y(){return{value:g,done:!0}}var g,b=Object.prototype,m=b.hasOwnProperty,x="function"==typeof Symbol?Symbol:{},w=x.iterator||"@@iterator",S=x.asyncIterator||"@@asyncIterator",_=x.toStringTag||"@@toStringTag",O="object"==typeof t,E=n.regeneratorRuntime;if(E)return void(O&&(t.exports=E));E=n.regeneratorRuntime=O?t.exports:{},E.wrap=e;var P="suspendedStart",j="suspendedYield",F="executing",M="completed",A={},N={};N[w]=function(){return this};var T=Object.getPrototypeOf,I=T&&T(T(d([])));I&&I!==b&&m.call(I,w)&&(N=I);var k=c.prototype=o.prototype=Object.create(N);u.prototype=k.constructor=c,c.constructor=u,c[_]=u.displayName="GeneratorFunction",E.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===u||"GeneratorFunction"===(n.displayName||n.name))},E.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,_ in t||(t[_]="GeneratorFunction")),t.prototype=Object.create(k),t},E.awrap=function(t){return{__await:t}},f(a.prototype),a.prototype[S]=function(){return this},E.AsyncIterator=a,E.async=function(t,n,r,i){var o=new a(e(t,n,r,i));return E.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},f(k),k[_]="Generator",k.toString=function(){return"[object Generator]"},E.keys=function(t){var n=[];for(var r in t)n.push(r);return n.reverse(),function r(){for(;n.length;){var e=n.pop();if(e in t)return r.value=e,r.done=!1,r}return r.done=!0,r}},E.values=d,p.prototype={constructor:p,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=g,this.done=!1,this.delegate=null,this.method="next",this.arg=g,this.tryEntries.forEach(v),!t)for(var n in this)"t"===n.charAt(0)&&m.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=g)},stop:function(){this.done=!0;var t=this.tryEntries[0],n=t.completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(t){function n(n,e){return o.type="throw",o.arg=t,r.next=n,e&&(r.method="next",r.arg=g),!!e}if(this.done)throw t;for(var r=this,e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=m.call(i,"catchLoc"),c=m.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,n){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc<=this.prev&&m.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var i=e;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=n&&n<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=n,i?(this.method="next",this.next=i.finallyLoc,A):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),A},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),v(r),A}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var e=r.completion;if("throw"===e.type){var i=e.arg;v(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:d(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=g),A}}}("object"==typeof n?n:"object"==typeof window?window:"object"==typeof self?self:this)}).call(n,function(){return this}(),r(158))}])</script><script src="/./main.0cf68a.js"></script><script>!function(){!function(e){var t=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(t),t.setAttribute("src",e)}("/slider.e37972.js")}()</script>

    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
      
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">æ‰€æœ‰æ–‡ç« </a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'friends')"><a href="javascript:void(0)" q-class="active:friends">å‹é“¾</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">å…³äºæˆ‘</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find somethingâ€¦">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">SpringåŸºç¡€</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">å®‰å“</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">python</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">SpringCloud</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">è™šæ‹Ÿæœº</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">C&C++</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">docker</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">SQL</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">linuxåŸºç¡€</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">ä¸­é—´ä»¶</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">IDETools</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">MyBatis</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">JavaåŸºç¡€</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">SpringBoot</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">Linuxè¿ç»´</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">K8S</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">è™šæ‹ŸåŒ–ä¸äº‘è®¡ç®—</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">ç½‘ç»œ</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">ROS</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">Python</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">æºç åˆ†æ</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">è™šæ‹ŸåŒ–åŸºç¡€</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">å‰ç«¯</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">Github</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">linuxè¿ç»´</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">vue</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">å¤§æ•°æ®</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">è¿ç»´ç›¸å…³</a>
              </li>
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            ç¼ºå¤±æ¨¡å—ã€‚<br/>1ã€è¯·ç¡®ä¿nodeç‰ˆæœ¬å¤§äº6.2<br/>2ã€åœ¨åšå®¢æ ¹ç›®å½•ï¼ˆæ³¨æ„ä¸æ˜¯yiliaæ ¹ç›®å½•ï¼‰æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š<br/> npm i hexo-generator-json-content --save<br/><br/>
            3ã€åœ¨æ ¹ç›®å½•_config.ymlé‡Œæ·»åŠ é…ç½®ï¼š
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: false
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    
    	<section class="tools-section tools-section-friends" q-show="friends">
  		
        <ul class="search-ul">
          
            <li class="search-li">
              <a href="https://lxt2017.github.io/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>Github</a>
            </li>
          
            <li class="search-li">
              <a href="https://blog.csdn.net/lemon_TT" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>CSDNåšå®¢</a>
            </li>
          
            <li class="search-li">
              <a href="https://www.yansheng.xyz/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>è·å¡˜æœˆè‰²</a>
            </li>
          
            <li class="search-li">
              <a href="https://tding.top/archives/9a232bbe.html" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>å°ä¸çš„ä¸ªäººåšå®¢</a>
            </li>
          
        </ul>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
  	  	
          <div class="aboutme-wrap">
        <div style="display:;">
          <script type="text/javascript" src="https://api.lwl12.com/hitokoto/v1?encode=js&charset=utf-8"></script>
          <p style="margin:0 20px 0 20px;">
            <span id="lwlhitokoto">
              <script>
                lwlhitokoto();
              </script>
            </span>
          </p>
          <p id="js-aboutme" style="margin:0 20px 0 20px;">&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;å¿ƒæ€€å¤©ä¸‹&lt;br/&gt;åªè®¤çœŸç”Ÿæ´»&lt;br/&gt;è‡ªä¿¡å¾®ç¬‘é¢å¯¹æœªæ¥</P>
        </div>
      </div>
        
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
  <!-- é›ªèŠ±ç‰¹æ•ˆ3 -->
  
    <script type="text/javascript" src="/js/snow3.js"></script>
  
<!-- ä»£ç å—å¤åˆ¶åŠŸèƒ½ -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.js"></script>
<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script type="text/javascript" src="/js/clipboard_use.js"></script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hibiki.model.json"},"display":{"position":"right","width":120,"height":300},"mobile":{"show":false},"log":false});</script></body>

<!-- ã€Šæ·»åŠ æŠ˜å æŒ‰é’®è„šæœ¬ -->
<script>
    var hide = false;
    function myFunction(x) {
        x.classList.toggle("change");
        if(hide == false){
            $(".left-col").css('display', 'none');
            $(".mid-col").css("left", 6);
            $(".tools-col").css('display', 'none');
            $(".tools-col.hide").css('display', 'none');
            hide = true;

            $(".mymenucontainer").css('left', '0');

        }else{
            $(".left-col").css('display', '');
            $(".mid-col").css("left", 300);
            $(".tools-col").css('display', '');
            $(".tools-col.hide").css('display', '');
            hide = false;

            $(".mymenucontainer").css('left', '260px');
        }
    }
</script>
<script>
    // ç§»åŠ¨è®¾å¤‡ä¾¦æµ‹
    var isMobile = {
      Android: function () {
        return navigator.userAgent.match(/Android/i);
      },
      BlackBerry: function () {
        return navigator.userAgent.match(/BlackBerry/i);
      },
      iOS: function () {
        return navigator.userAgent.match(/iPhone|iPad|iPod/i);
      },
      Opera: function () {
        return navigator.userAgent.match(/Opera Mini/i);
      },
      Windows: function () {
        return navigator.userAgent.match(/IEMobile/i);
      },
      any: function () {
        return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());
      }
    };

    if(isMobile.any()){
        //æ‰‹æœºç«¯å–æ¶ˆæœç´¢åŠŸèƒ½
        $('.local-search').css("display","none");
    }

    if ($('.local-search').size() && !isMobile.any()) {
      $.getScript('/js/search.js', function() {
        searchFunc("/search.xml", 'local-search-input', 'local-search-result');
      });
    }
</script>
<!-- æ·»åŠ æŠ˜å æŒ‰é’®è„šæœ¬ã€‹ -->
</html>
<script type="text/javascript" src="/js/src/love.js"></script>